!function(){"use strict";frappe.provide("frappe.dom"),frappe.dom={id_count:0,freeze_count:0,by_id:function(e){return document.getElementById(e)},get_unique_id:function(){var e="unique-"+frappe.dom.id_count;return frappe.dom.id_count++,e},set_unique_id:function(e){var t=$(e);if(t.attr("id"))return t.attr("id");var i="unique-"+frappe.dom.id_count;return t.attr("id",i),frappe.dom.id_count++,i},eval:function(e){if(e){var t=document.createElement("script");t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)}},remove_script_and_style:function(e){var t=["script","style","noscript","title","meta","base","head"];if(!new RegExp(t.map(function(e){return"<"+e+">.*<\\/"+e+">"}).join("|")).test(e))return e;var i=document.createElement("div");i.innerHTML=e;var s=!1;t.forEach(function(e){var t=i.getElementsByTagName(e);for(a=t.length;a--;)s=!0,t[a].parentNode.removeChild(t[a])});for(var n=i.getElementsByTagName("link"),a=n.length;a--;)"stylesheet"==n[a].getAttribute("rel")&&(s=!0,n[a].parentNode.removeChild(n[a]));return s?i.innerHTML:e},is_element_in_viewport:function(e,t){void 0===t&&(t=0),"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var i=e.getBoundingClientRect();return i.top+t>=0&&i.left+t>=0&&i.bottom-t<=$(window).height()&&i.right-t<=$(window).width()},set_style:function(e,t){if(e){var i=document.createElement("style");if(i.type="text/css",t){var s=document.getElementById(t);s&&s.parentNode.removeChild(s),i.id=t}return i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(i),i}},add:function(e,t,i,s,n,a){e&&e.substr&&(e=frappe.dom.by_id(e));var r=document.createElement(t);return e&&e.appendChild(r),i&&("img"==t.toLowerCase()?r.src=i:r.className=i),s&&frappe.dom.css(r,s),n&&(r.innerHTML=n),a&&(r.onclick=a),r},css:function(e,t){return e&&t&&$.extend(e.style,t),e},activate:function(e,t,i,s){void 0===s&&(s="active"),e.find("."+i+"."+s).removeClass(s),t.addClass(s)},freeze:function(e,t){if($("#freeze").length)$("#freeze").addClass("in");else{var i=$('<div id="freeze" class="modal-backdrop fade"></div>').on("click",function(){if(cur_frm&&cur_frm.cur_grid)return cur_frm.cur_grid.toggle_view(),!1}).appendTo("#body_div");i.html(repl('<div class="freeze-message-container"><div class="freeze-message"><p class="lead">%(msg)s</p></div></div>',{msg:e||""})),setTimeout(function(){i.addClass("in")},1)}t&&$("#freeze").addClass(t),frappe.dom.freeze_count++},unfreeze:function(){if(frappe.dom.freeze_count&&(frappe.dom.freeze_count--,!frappe.dom.freeze_count))$("#freeze").removeClass("in").remove()},save_selection:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount){for(var t=[],i=0,s=e.rangeCount;i<s;++i)t.push(e.getRangeAt(i));return t}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restore_selection:function(e){if(e)if(window.getSelection){var t=window.getSelection();t.removeAllRanges();for(var i=0,s=e.length;i<s;++i)t.addRange(e[i])}else document.selection&&e.select&&e.select()},is_touchscreen:function(){return"ontouchstart"in window},handle_broken_images:function(e){$(e).find("img").on("error",function(e){$(e.currentTarget).addClass("no-image")})},scroll_to_bottom:function(e){var t=$(e);t.scrollTop(t[0].scrollHeight)},file_to_base64:function(e){return new Promise(function(t){var i=new FileReader;i.onload=function(){t(i.result)},i.readAsDataURL(e)})},scroll_to_section:function(e){setTimeout(function(){var t=$('a:contains("'+e+'")');t.length&&(t.parent().hasClass("collapsed")&&t.click(),frappe.ui.scroll(t.parent().parent()))},200)},pixel_to_inches:function(e){var t=$('<div id="dpi" style="height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;"></div>');t.appendTo(document.body);var i=e/document.getElementById("dpi").offsetWidth;return t.remove(),i}},frappe.ellipsis=function(e,t){return t||(t=20),(e=cstr(e)).length>t&&(e=e.substr(0,t)+"..."),e},frappe.run_serially=function(e){var t=Promise.resolve();return e.forEach(function(e){e&&(t=t.then?t.then(e):Promise.resolve())}),t},frappe.load_image=function(e,t,i,s){void 0===s&&(s=function(){});var n=new Image;n.onload=function(){t(this)},n.onerror=i,s(n),n.src=e},frappe.timeout=function(e){return new Promise(function(t){setTimeout(function(){return t()},1e3*e)})},frappe.scrub=function(e,t){return void 0===t&&(t="_"),e.replace(/ /g,t).toLowerCase()},frappe.get_modal=function(e,t){return $('<div class="modal fade" style="overflow: auto;" tabindex="-1">\n\t\t<div class="modal-dialog">\n\t\t\t<div class="modal-content">\n\t\t\t\t<div class="modal-header">\n\t\t\t\t\t<div class="flex justify-between">\n\t\t\t\t\t\t<div class="fill-width flex">\n\t\t\t\t\t\t\t<span class="indicator hidden"></span>\n\t\t\t\t\t\t\t<h4 class="modal-title" style="font-weight: bold;">'+e+'</h4>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class="text-right buttons">\n\t\t\t\t\t\t\t\t<button type="button" class="btn btn-default btn-sm btn-modal-minimize hide">\n\t\t\t\t\t\t\t\t\t<i class="octicon octicon-chevron-down" style="padding: 1px 0px;"></i>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button type="button" class="btn btn-default btn-sm btn-modal-close" data-dismiss="modal">\n\t\t\t\t\t\t\t\t\t<i class="octicon octicon-x visible-xs" style="padding: 1px 0px;"></i>\n\t\t\t\t\t\t\t\t\t<span class="hidden-xs">'+__("Close")+'</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button type="button" class="btn btn-primary btn-sm hide">\n\t\t\t\t\t\t\t\t\t'+__("Confirm")+'\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="modal-body ui-front">'+t+"</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>")},frappe.is_online=function(){return 1==frappe.boot.developer_mode||(!("onLine"in navigator)||navigator.onLine)},$(window).on("online",function(){frappe.show_alert({indicator:"green",message:__("You are connected to internet.")})}),$(window).on("offline",function(){frappe.show_alert({indicator:"orange",message:__("Connection lost. Some features might not work.")})}),frappe.provide("frappe.form.formatters"),frappe.form.link_formatters={},frappe.form.formatters={_right:function(e,t){return t&&(t.inline||t.only_value)?e:"<div style='text-align: right'>"+e+"</div>"},Data:function(e){return null==e?"":e},Select:function(e){return __(frappe.form.formatters.Data(e))},Float:function(e,t,i,s){var n=t.precision||cint(frappe.boot.sysdefaults&&frappe.boot.sysdefaults.float_precision)||null;if(t.options&&t.options.trim())return t.precision=n,frappe.form.formatters.Currency(e,t,i,s);if(!(i||{}).always_show_decimals&&!is_null(e)){var a=cstr(e).split(".");null!=a[1]&&0!==cint(a[1])||(n=0)}return frappe.form.formatters._right(null==e||""===e?"":format_number(e,null,n),i)},Int:function(e,t,i){return frappe.form.formatters._right(null==e?"":cint(e),i)},Percent:function(e,t,i){return frappe.form.formatters._right(flt(e,2)+"%",i)},Rating:function(e){return'<span class="rating">\n\t'+Array.from(new Array(5)).map(function(t,i){return'<i class="fa fa-fw fa-star '+(i<(e||0)?"star-click":"")+' star-icon" data-idx="'+(i+1)+'"></i>'}).join("")+"\n\t\t</span>"},Currency:function(e,t,i,s){var n=frappe.meta.get_field_currency(t,s),a=t.precision||cint(frappe.boot.sysdefaults.currency_precision)||2;if(a>2){var r=cstr(e).split("."),o=r.length>1?r[1]:"";if(o.length<3||o.length<a){var l=frappe.model.get_value(":Currency",n,"fraction_units")||100;o.length<cstr(l).length&&(a=cstr(l).length-1)}}return e=null==e||""===e?"":format_currency(e,n,a),i&&i.only_value?e:frappe.form.formatters._right(e,i)},Check:function(e){return e?'<i class="fa fa-check" style="margin-right: 3px;"></i>':'<i class="fa fa-square disabled-check"></i>'},Link:function(e,t,i,s){var n=t._options||t.options,a=e;return e&&e.match&&e.match(/^['"].*['"]$/)&&e.replace(/^.(.*).$/,"$1"),i&&(i.for_print||i.only_value)?e:(frappe.form.link_formatters[n]&&s&&n!==s.doctype&&(e=frappe.form.link_formatters[n](e,s)),e?"'"==e[0]&&"'"==e[e.length-1]?e.substring(1,e.length-1):t&&t.link_onclick?repl('<a onclick="%(onclick)s">%(value)s</a>',{onclick:t.link_onclick.replace(/"/g,"&quot;"),value:e}):t&&n?'<a class="grey"\n\t\t\t\thref="#Form/'+encodeURIComponent(n)+"/"+encodeURIComponent(a)+'"\n\t\t\t\tdata-doctype="'+n+'"\n\t\t\t\tdata-name="'+a+'">\n\t\t\t\t'+__(i&&i.label||e)+"</a>":e:"")},Date:function(e){return frappe.datetime.str_to_user?(e&&"Invalid date"===(e=frappe.datetime.str_to_user(e))&&(e=null),e||""):e},DateRange:function(e){return $.isArray(e)?__("{0} to {1}",[frappe.datetime.str_to_user(e[0]),frappe.datetime.str_to_user(e[1])]):e||""},Datetime:function(e){if(e){var t=moment(frappe.datetime.convert_to_user_tz(e));return frappe.boot.sysdefaults.time_zone&&(t=t.tz(frappe.boot.sysdefaults.time_zone)),t.format(frappe.boot.sysdefaults.date_format.toUpperCase()+", h:mm a z")}return""},Text:function(e){if(e){for(var t=["<p","<div","<br","<table"],i=!1,s=0;s<t.length;s++)if(e.match(t[s])){i=!0;break}i||(e=frappe.utils.replace_newlines(e))}return frappe.form.formatters.Data(e)},LikedBy:function(e){var t="";return $.each(JSON.parse(e||"[]"),function(e,i){i&&(t+=frappe.avatar(i))}),t},Tag:function(e){var t="";return $.each((e||"").split(","),function(e,i){i&&(t+='<span class="label label-info" \t\t\t\tstyle="margin-right: 7px; cursor: pointer;"\t\t\t\tdata-field="_user_tags" data-label="'+i+'">'+i+"</span>")}),t},Comment:function(e){return e},Assign:function(e){var t="";return $.each(JSON.parse(e||"[]"),function(e,i){i&&(t+='<span class="label label-warning" \t\t\t\tstyle="margin-right: 7px;"\t\t\t\tdata-field="_assign">'+i+"</span>")}),t},SmallText:function(e){return frappe.form.formatters.Text(e)},TextEditor:function(e){return frappe.form.formatters.Text(e)},Code:function(e){return"<pre>"+(null==e?"":$("<div>").text(e).html())+"</pre>"},WorkflowState:function(e){var t=frappe.get_doc("Workflow State",e);return t?repl("<span class='label label-%(style)s' \t\t\t\tdata-workflow-state='%(value)s'\t\t\t\tstyle='padding-bottom: 4px; cursor: pointer;'>\t\t\t\t<i class='fa fa-small fa-white fa-%(icon)s'></i> %(value)s</span>",{value:e,style:t.style.toLowerCase(),icon:t.icon}):"<span class='label'>"+e+"</span>"},Email:function(e){return $("<div></div>").text(e).html()},FileSize:function(e){return e>1048576?e=flt(flt(e)/1048576,1)+"M":e>1024&&(e=flt(flt(e)/1024,1)+"K"),e},TableMultiSelect:function(e,t,i){e=e||[];var s=frappe.get_meta(t.options).fields.find(function(e){return"Link"===e.fieldtype});return e.map(function(e){var t=e[s.fieldname];return frappe.format(t,s,i,e)}).join(", ")}},frappe.form.get_formatter=function(e){return e||(e="Data"),frappe.form.formatters[e.replace(/ /g,"")]||frappe.form.formatters.Data},frappe.format=function(e,t,i,s){t||(t={fieldtype:"Data"});var n=t.fieldtype||"Data";"Dynamic Link"===n&&(n="Link",t._options=s?s[t.options]:null);var a=(t.formatter||frappe.form.get_formatter(n))(e,t,i,s);return"string"==typeof a&&(a=frappe.dom.remove_script_and_style(a)),a},frappe.get_format_helper=function(e){var t={get_formatted:function(t){var i=frappe.meta.get_docfield(e.doctype,t);return i||console.log("fieldname not found: "+t),frappe.format(e[t],i,{inline:1},e)}};return $.extend(t,e),t};var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(e){var t=/xyz/.test(function(){})?/\b_super\b/:/.*/;function i(){}i.extend=function(e){var s=this.prototype,n=Object.create(s);for(var a in e)n[a]="function"==typeof e[a]&&"function"==typeof s[a]&&t.test(e[a])?function(e,t){return function(){var i=this._super;this._super=s[e];var n=t.apply(this,arguments);return this._super=i,n}}(a,e[a]):e[a];var r="function"==typeof n.init?n.hasOwnProperty("init")?n.init:function(){s.init.apply(this,arguments)}:function(){};return r.prototype=n,n.constructor=r,r.extend=i.extend,r},e.Class=i}(commonjsGlobal),frappe.ui.form.Layout=Class.extend({init:function(e){this.views={},this.pages=[],this.sections=[],this.fields_list=[],this.fields_dict={},$.extend(this,e)},make:function(){!this.parent&&this.body&&(this.parent=this.body),this.wrapper=$('<div class="form-layout">').appendTo(this.parent),this.message=$('<div class="form-message text-muted small hidden"></div>').appendTo(this.wrapper),this.fields||(this.fields=this.get_doctype_fields()),this.setup_tabbing(),this.render()},show_empty_form_message:function(){this.wrapper.find(".frappe-control:visible").length||this.wrapper.find(".section-head.collapsed").length||this.show_message(__("This form does not have any input"))},get_doctype_fields:function(){var e=[{parent:this.frm.doctype,fieldtype:"Data",fieldname:"__newname",reqd:1,hidden:1,label:__("Name"),get_status:function(e){return e.frm&&e.frm.is_new()&&e.frm.meta.autoname&&["prompt","name"].includes(e.frm.meta.autoname.toLowerCase())?"Write":"None"}}];return e=e.concat(frappe.meta.sort_docfields(frappe.meta.docfield_map[this.doctype]))},show_message:function(e,t){this.message_color&&this.message.removeClass(this.message_color),this.message_color=t&&["yellow","blue"].includes(t)?t:"blue",e?("<"!==e.substr(0,1)&&(e="<div>"+e+"</div>"),this.message.removeClass("hidden").addClass(this.message_color),$(e).appendTo(this.message)):this.message.empty().addClass("hidden")},render:function(e){var t=this,i=e||this.fields;this.section=null,this.column=null,this.with_dashboard&&this.setup_dashboard_section(),this.no_opening_section()&&this.make_section(),$.each(i,function(e,i){switch(i.fieldtype){case"Fold":t.make_page(i);break;case"Section Break":t.make_section(i);break;case"Column Break":t.make_column(i);break;default:t.make_field(i)}})},no_opening_section:function(){return this.fields[0]&&"Section Break"!=this.fields[0].fieldtype||!this.fields.length},setup_dashboard_section:function(){this.no_opening_section()&&this.fields.unshift({fieldtype:"Section Break"}),this.fields.unshift({fieldtype:"Section Break",fieldname:"_form_dashboard",label:__("Dashboard"),cssClass:"form-dashboard",collapsible:1})},replace_field:function(e,t,i){if(t.fieldname=e,this.fields_dict[e]&&this.fields_dict[e].df){var s=this.init_field(t,i);this.fields_dict[e].$wrapper.remove(),this.fields_list.splice(this.fields_dict[e],1,s),this.fields_dict[e]=s,this.frm&&(s.perm=this.frm.perm),this.section.fields_list.splice(this.section.fields_dict[e],1,s),this.section.fields_dict[e]=s,this.refresh_fields([t])}},make_field:function(e,t,i){!this.section&&this.make_section(),!this.column&&this.make_column();var s=this.init_field(e,i);this.fields_list.push(s),this.fields_dict[e.fieldname]=s,this.frm&&(s.perm=this.frm.perm),this.section.fields_list.push(s),this.section.fields_dict[e.fieldname]=s,s.section=this.section},init_field:function(e,t){void 0===t&&(t=!1);var i=frappe.ui.form.make_control({df:e,doctype:this.doctype,parent:this.column.wrapper.get(0),frm:this.frm,render_input:t,doc:this.doc});return i.layout=this,i},make_page:function(e){var t=this,i=$('<div class="form-clickable-section text-center">\t\t\t\t<a class="btn-fold h6 text-muted">'+__("Show more details")+"</a>\t\t\t</div>").appendTo(this.wrapper);this.page=$('<div class="form-page second-page hide"></div>').appendTo(this.wrapper),this.fold_btn=i.find(".btn-fold").on("click",function(){var e=$(this).parent().next();e.hasClass("hide")?($(this).removeClass("btn-fold").html(__("Hide details")),e.removeClass("hide"),frappe.utils.scroll_to($(this),!0,30),t.folded=!1):($(this).addClass("btn-fold").html(__("Show more details")),e.addClass("hide"),t.folded=!0)}),this.section=null,this.folded=!0},unfold:function(){this.fold_btn.trigger("click")},make_section:function(e){this.section=new frappe.ui.form.Section(this,e),e&&(this.fields_dict[e.fieldname]=this.section,this.fields_list.push(this.section)),this.column=null},make_column:function(e){this.column=new frappe.ui.form.Column(this.section,e),e&&e.fieldname&&this.fields_list.push(this.column)},refresh:function(e){e&&(this.doc=e),this.frm&&this.wrapper.find(".empty-form-alert").remove(),this.attach_doc_and_docfields(!0),this.frm&&this.frm.wrapper&&$(this.frm.wrapper).trigger("refresh-fields"),this.refresh_dependency(),this.refresh_sections(),this.frm&&this.refresh_section_collapse()},refresh_sections:function(){var e=0;this.wrapper.find(".form-section:not(.hide-control)").each(function(){var t=$(this).removeClass("empty-section").removeClass("visible-section").removeClass("shaded-section");t.find(".frappe-control:not(.hide-control)").length||t.hasClass("form-dashboard")?(t.addClass("visible-section"),e%2&&t.addClass("shaded-section"),e++):t.addClass("empty-section")})},refresh_fields:function(e){var t=e.map(function(e){if(e.fieldname)return e.fieldname});this.fields_list.map(function(e){t.includes(e.df.fieldname)&&(e.refresh(),e.df.default&&e.set_input(e.df.default))})},add_fields:function(e){this.render(e),this.refresh_fields(e)},refresh_section_collapse:function(){if(this.doc)for(var e=0;e<this.sections.length;e++){var t=this.sections[e],i=t.df;if(i&&i.collapsible){var s=!0;i.collapsible_depends_on&&(s=!this.evaluate_depends_on_value(i.collapsible_depends_on)),s&&t.has_missing_mandatory()&&(s=!1),"_form_dashboard"===i.fieldname&&(s="yes"===localStorage.getItem("collapseFormDashboard")),t.collapse(s)}}},attach_doc_and_docfields:function(e){for(var t=this,i=0,s=this.fields_list.length;i<s;i++){var n=this.fields_list[i];t.doc&&(n.doc=t.doc,n.doctype=t.doc.doctype,n.docname=t.doc.name,n.df=frappe.meta.get_docfield(t.doc.doctype,n.df.fieldname,t.frm?t.frm.doc.name:t.doc.name)||n.df,t.frm&&(n.perm=t.frm.perm)),e&&n.df&&n.refresh&&n.refresh()}},refresh_section_count:function(){this.wrapper.find(".section-count-label:visible").each(function(e){$(this).html(e+1)})},setup_tabbing:function(){var e=this;this.wrapper.on("keydown",function(t){if(9==t.which){var i=$(t.target),s=i.attr("data-doctype"),n=i.attr("data-fieldname");if(s)return e.handle_tab(s,n,t.shiftKey)}})},handle_tab:function(e,t,i){var s=null,n=null,a=this.fields_list,r=!1;if(e!=this.doctype){if(!(s=this.get_open_grid_row())||!s.layout)return;a=s.layout.fields_list}for(var o=0,l=a.length;o<l;o++){if(a[o].df.fieldname==t){if(i){n?this.set_focus(n):$(this.primary_button).focus();break}if(o<l-1&&(r=this.focus_on_next_field(o,a)),r)break}this.is_visible(a[o])&&(n=a[o])}return r||(s?s.doc.idx==s.grid.grid_rows.length?s.toggle_view(!1,function(){s.grid.frm.layout.handle_tab(s.grid.df.parent,s.grid.df.fieldname)}):s.grid.grid_rows[s.doc.idx].toggle_view(!0):$(this.primary_button).focus()),!1},focus_on_next_field:function(e,t){for(var i=e+1,s=t.length;i<s;i++){var n=t[i];if(this.is_visible(n)){if("Table"===n.df.fieldtype)return n.grid.grid_rows&&n.grid.grid_rows.length||n.grid.add_new_row(),n.grid.grid_rows[0].show_form(),!0;if(!in_list(frappe.model.no_value_type,n.df.fieldtype))return this.set_focus(n),!0}}},is_visible:function(e){return"Write"===e.disp_status&&e.$wrapper&&e.$wrapper.is(":visible")},set_focus:function(e){"Table"==e.df.fieldtype?e.grid.grid_rows.length?e.grid.grid_rows[0].toggle_view(!0):e.grid.add_new_row(1):e.editor?e.editor.set_focus():e.$input&&e.$input.focus()},get_open_grid_row:function(){return $(".grid-row-open").data("grid_row")},refresh_dependency:function(){var e=!1;for(var t in this.fields_list){(s=this.fields_list[t]).dependencies_clear=!0,s.df.depends_on&&(e=!0)}if(e){for(var i=this.fields_list.length-1;i>=0;i--){var s;(s=this.fields_list[i]).guardian_has_value=!0,s.df.depends_on&&(s.guardian_has_value=this.evaluate_depends_on_value(s.df.depends_on),s.guardian_has_value?s.df.hidden_due_to_dependency&&(s.df.hidden_due_to_dependency=!1,s.refresh()):s.df.hidden_due_to_dependency||(s.df.hidden_due_to_dependency=!0,s.refresh()))}this.refresh_section_count()}},evaluate_depends_on_value:function(expression){var out=null,doc=this.doc;if(!doc&&this.get_values)var doc=this.get_values(!0);if(doc){var parent=this.frm?this.frm.doc:this.doc||null;if("boolean"==typeof expression)out=expression;else if("function"==typeof expression)out=expression(doc);else if("eval:"==expression.substr(0,5))try{out=eval(expression.substr(5)),parent&&parent.istable&&expression.includes("is_submittable")&&(out=!0)}catch(e){frappe.throw(__('Invalid "depends_on" expression'))}else if("fn:"==expression.substr(0,3)&&this.frm)out=this.frm.script_manager.trigger(expression.substr(3),this.doctype,this.docname);else{var value=doc[expression];out=$.isArray(value)?!!value.length:!!value}return out}}}),frappe.ui.form.Section=Class.extend({init:function(e,t){this.layout=e,this.df=t||{},this.fields_list=[],this.fields_dict={},this.make(),this.row={wrapper:this.wrapper},this.df.collapsible&&"_form_dashboard"!==this.df.fieldname&&this.collapse(!0),this.refresh()},make:function(){this.layout.page||(this.layout.page=$('<div class="form-page"></div>').appendTo(this.layout.wrapper)),this.wrapper=$('<div class="row form-section">').appendTo(this.layout.page),this.layout.sections.push(this),this.df&&(this.df.label&&this.make_head(),this.df.description&&$('<div class="col-sm-12 small text-muted form-section-description">'+__(this.df.description)+"</div>").appendTo(this.wrapper),this.df.cssClass&&this.wrapper.addClass(this.df.cssClass)),this.body=$('<div class="section-body">').appendTo(this.wrapper)},make_head:function(){var e=this;this.df.collapsible?(this.head=$('<div class="section-head"><a class="h6 uppercase">'+__(this.df.label)+'</a><span class="octicon octicon-chevron-down collapse-indicator"></span></div>').appendTo(this.wrapper),this.collapse_link=this.head.on("click",function(){e.collapse()}),this.indicator=this.head.find(".collapse-indicator")):$('<div class="col-sm-12"><h6 class="form-section-heading uppercase">'+__(this.df.label)+"</h6></div>").appendTo(this.wrapper)},refresh:function(){if(this.df){var e=this.df.hidden||this.df.hidden_due_to_dependency;!e&&this.layout&&this.layout.frm&&!this.layout.frm.get_perm(this.df.permlevel||0,"read")&&(e=!0),this.wrapper.toggleClass("hide-control",!!e)}},collapse:function(e){this.head&&this.body&&(void 0===e&&(e=!this.body.hasClass("hide")),"_form_dashboard"===this.df.fieldname&&localStorage.setItem("collapseFormDashboard",e?"yes":"no"),this.body.toggleClass("hide",e),this.head.toggleClass("collapsed",e),this.indicator.toggleClass("octicon-chevron-down",e),this.indicator.toggleClass("octicon-chevron-up",!e),this.fields_list.forEach(function(e){"Signature"==e.df.fieldtype&&e.refresh()}))},is_collapsed:function(){return this.body.hasClass("hide")},has_missing_mandatory:function(){for(var e=!1,t=0,i=this.fields_list.length;t<i;t++){var s=this.fields_list[t].df;if(s.reqd&&null==this.layout.doc[s.fieldname]){e=!0;break}}return e}}),frappe.ui.form.Column=Class.extend({init:function(e,t){t||(t={}),this.df=t,this.section=e,this.make(),this.resize_all_columns()},make:function(){this.wrapper=$('<div class="form-column">\t\t\t<form>\t\t\t</form>\t\t</div>').appendTo(this.section.body).find("form").on("submit",function(){return!1}),this.df.label&&$('<label class="control-label">'+__(this.df.label)+"</label>").appendTo(this.wrapper)},resize_all_columns:function(){var e=cint(12/this.section.wrapper.find(".form-column").length);this.section.wrapper.find(".form-column").removeClass().addClass("form-column").addClass("col-sm-"+e)},refresh:function(){this.section.refresh()}}),frappe.provide("frappe.ui"),frappe.ui.FieldGroup=frappe.ui.form.Layout.extend({init:function(e){$.extend(this,e),this.dirty=!1,this._super(),$.each(this.fields||[],function(e,t){!t.fieldname&&t.label&&(t.fieldname=t.label.replace(/ /g,"_").toLowerCase())}),this.values&&this.set_values(this.values)},make:function(){var e=this,t=this;this.fields&&(this._super(),this.refresh(),$.each(this.fields_list,function(e,i){if(i.df.default){var s=i.df.default;"Today"==s&&"Date"==i.df.fieldtype&&(s=frappe.datetime.get_today()),i.set_input(s),t.refresh_dependency()}}),this.no_submit_on_enter||this.catch_enter_as_submit(),$(this.wrapper).find("input, select").on("change",function(){e.dirty=!0,frappe.run_serially([function(){return frappe.timeout(.1)},function(){return t.refresh_dependency()}])}))},first_button:!1,focus_on_first_input:function(){this.no_focus||$.each(this.fields_list,function(e,t){if(!in_list(["Date","Datetime","Time","Check"],t.df.fieldtype)&&t.set_focus)return t.set_focus(),!1})},catch_enter_as_submit:function(){var e=this;$(this.body).find('input[type="text"], input[type="password"], select').keypress(function(t){13==t.which&&e.has_primary_action&&(t.preventDefault(),e.get_primary_btn().trigger("click"))})},get_input:function(e){var t=this.fields_dict[e];return $(t.txt?t.txt:t.input)},get_field:function(e){return this.fields_dict[e]},get_values:function(e){var t={},i=[];for(var s in this.fields_dict){var n=this.fields_dict[s];if(n.get_value){var a=n.get_value();n.df.reqd&&is_null(a)&&i.push(__(n.df.label)),is_null(a)||(t[n.df.fieldname]=a)}}return i.length&&!e?(frappe.msgprint({title:__("Missing Values Required"),message:__("Following fields have missing values:")+"<br><br><ul><li>"+i.join("<li>")+"</ul>",indicator:"orange"}),null):t},get_value:function(e){var t=this.fields_dict[e];return t&&(t.get_value?t.get_value():null)},set_value:function(e,t){var i=this;return new Promise(function(s){var n=i.fields_dict[e];n?n.set_value(t).then(function(){n.set_input(t),i.refresh_dependency(),s()}):s()})},set_input:function(e,t){return this.set_value(e,t)},set_values:function(e){for(var t in e)this.fields_dict[t]&&this.set_value(t,e[t])},clear:function(){for(var e in this.fields_dict){var t=this.fields_dict[e];t&&t.set_input&&t.set_input(t.df.default||"")}},set_df_property:function(e,t,i){var s=this.get_field(e);s.df[t]=i,s.refresh()}}),frappe.ui.form.LinkSelector=Class.extend({init:function(e){$.extend(this,e);var t=this;"[Select]"!=this.doctype?frappe.model.with_doctype(this.doctype,function(e){t.make()}):this.make()},make:function(){var e=this;this.start=0,this.dialog=new frappe.ui.Dialog({title:__("Select {0}",["[Select]"==this.doctype?__("value"):__(this.doctype)]),fields:[{fieldtype:"Data",fieldname:"txt",label:__("Beginning with"),description:__("You can use wildcard %")},{fieldtype:"HTML",fieldname:"results"},{fieldtype:"Button",fieldname:"more",label:__("More"),click:function(){e.start+=20,e.search()}}],primary_action_label:__("Search"),primary_action:function(){e.start=0,e.search()}}),this.txt&&this.dialog.fields_dict.txt.set_input(this.txt),this.dialog.get_input("txt").on("keypress",function(t){13===t.which&&(e.start=0,e.search())}),this.dialog.show(),this.search()},search:function(){var e={txt:this.dialog.fields_dict.txt.get_value(),searchfield:"name",start:this.start},t=this;this.target.set_custom_query&&this.target.set_custom_query(e),this.target.is_grid&&this.target.fieldinfo[this.fieldname]&&this.target.fieldinfo[this.fieldname].get_query&&$.extend(e,this.target.fieldinfo[this.fieldname].get_query(cur_frm.doc)),frappe.link_search(this.doctype,e,function(i){var s=t.dialog.fields_dict.results.$wrapper;(0===e.start&&s.empty(),i.values.length?$.each(i.values,function(e,i){$(repl('<div class="row link-select-row">\t\t\t\t\t\t<div class="col-xs-4">\t\t\t\t\t\t\t<b><a href="#">%(name)s</a></b></div>\t\t\t\t\t\t<div class="col-xs-8">\t\t\t\t\t\t\t<span class="text-muted">%(values)s</span></div>\t\t\t\t\t\t</div>',{name:i[0],values:i.splice(1).join(", ")})).appendTo(s).find("a").attr("data-value",i[0]).click(function(){var e=$(this).attr("data-value");return t.target.is_grid?t.set_in_grid(e):(t.target.doctype?t.target.parse_validate_and_set_in_model(e):(t.target.set_input(e),t.target.$input.trigger("change")),t.dialog.hide()),!1})}):$('<p><br><span class="text-muted">'+__("No Results")+"</span>"+(frappe.model.can_create(t.doctype)?'<br><br><a class="new-doc btn btn-default btn-sm">'+__("Create a new {0}",[__(t.doctype)])+"</a>":"")+"</p>").appendTo(s).find(".new-doc").click(function(){frappe.new_doc(t.doctype)}),i.values.length<20)&&t.dialog.fields_dict.more.$wrapper.hide()},this.dialog.get_primary_btn())},set_in_grid:function(e){var t=this,i=!1,s=null;if(this.qty_fieldname)frappe.prompt({fieldname:"qty",fieldtype:"Float",label:"Qty",default:1,reqd:1},function(n){$.each(t.target.frm.doc[t.target.df.fieldname]||[],function(s,a){if(a[t.fieldname]===e)return frappe.model.set_value(a.doctype,a.name,t.qty_fieldname,n.qty),frappe.show_alert(__("Added {0} ({1})",[e,a[t.qty_fieldname]])),i=!0,!1}),i||frappe.run_serially([function(){s=t.target.add_new_row()},function(){return frappe.timeout(.1)},function(){return frappe.model.set_value(s.doctype,s.name,t.fieldname,e)},function(){return frappe.timeout(.5)},function(){return frappe.model.set_value(s.doctype,s.name,t.qty_fieldname,n.qty)},function(){return frappe.show_alert(__("Added {0} ({1})",[e,n.qty]))}])},__("Set Quantity"),__("Set"));else if(t.dynamic_link_field){s=t.target.add_new_row();frappe.model.set_value(s.doctype,s.name,t.dynamic_link_field,t.dynamic_link_reference),frappe.model.set_value(s.doctype,s.name,t.fieldname,e),frappe.show_alert(__("{0} {1} added",[t.dynamic_link_reference,e]))}else{s=t.target.add_new_row();frappe.model.set_value(s.doctype,s.name,t.fieldname,e),frappe.show_alert(__("{0} added",[e]))}}}),frappe.link_search=function(e,t,i,s){t||(t={txt:""}),t.doctype=e,t.searchfield||(t.searchfield="name"),frappe.call({method:"frappe.desk.search.search_widget",type:"GET",args:t,callback:function(e){i&&i(e)},btn:s})},frappe.ui.form.MultiSelectDialog=Class.extend({init:function(e){$.extend(this,e);var t=this;"[Select]"!=this.doctype?frappe.model.with_doctype(this.doctype,function(e){t.make()}):this.make()},make:function(){var e=this;this.page_length=20,this.start=0;var t=[{fieldtype:"Data",label:__("Search Term"),fieldname:"search_term"},{fieldtype:"Column Break"}],i=0;if(this.date_field||(this.date_field="transaction_date"),$.isArray(this.setters))for(var s=0,n=this.setters;s<n.length;s+=1){var a=n[s];t.push(a,{fieldtype:"Column Break"})}else Object.keys(this.setters).forEach(function(s){t.push({fieldtype:e.target.fields_dict[s].df.fieldtype,label:e.target.fields_dict[s].df.label,fieldname:s,options:e.target.fields_dict[s].df.options,default:e.setters[s]}),i++<Object.keys(e.setters).length&&t.push({fieldtype:"Column Break"})});t=t.concat([{fieldname:"date_range",label:__("Date Range"),fieldtype:"DateRange"},{fieldtype:"Section Break"},{fieldtype:"HTML",fieldname:"results_area"},{fieldtype:"Button",fieldname:"more_btn",label:__("More"),click:function(){e.start+=20,frappe.flags.auto_scroll=!0,e.get_results()}}]);var r=this.doctype.endsWith("y")?this.doctype.slice(0,-1)+"ies":this.doctype+"s";this.dialog=new frappe.ui.Dialog({title:__("Select {0}",["[Select]"==this.doctype?__("value"):__(r)]),fields:t,primary_action_label:__("Get Items"),secondary_action_label:__("Make {0}",[e.doctype]),primary_action:function(){e.action(e.get_checked_values(),e.args)},secondary_action:function(t){if(t){if(frappe.route_options={},$.isArray(e.setters))for(var i=0,s=e.setters;i<s.length;i+=1){var n=s[i];frappe.route_options[n.fieldname]=e.dialog.fields_dict[n.fieldname].get_value()||void 0}else Object.keys(e.setters).forEach(function(t){frappe.route_options[t]=e.dialog.fields_dict[t].get_value()||void 0});frappe.new_doc(e.doctype,!0)}}}),this.$parent=$(this.dialog.body),this.$wrapper=this.dialog.fields_dict.results_area.$wrapper.append('<div class="results"\n\t\t\tstyle="border: 1px solid #d1d8dd; border-radius: 3px; height: 300px; overflow: auto;"></div>'),this.$results=this.$wrapper.find(".results"),this.$results.append(this.make_list_row()),this.args={},this.bind_events(),this.get_results(),this.dialog.show()},bind_events:function(){var e=this,t=this;this.$results.on("click",".list-item-container",function(e){$(e.target).is(":checkbox")||$(e.target).is("a")||$(this).find(":checkbox").trigger("click")}),this.$results.on("click",".list-item--head :checkbox",function(t){e.$results.find(".list-item-container .list-row-check").prop("checked",$(t.target).is(":checked"))}),this.$parent.find(".input-with-feedback").on("change",function(t){frappe.flags.auto_scroll=!1,e.get_results()}),this.$parent.find('[data-fieldname="date_range"]').on("blur",function(t){frappe.flags.auto_scroll=!1,e.get_results()}),this.$parent.find('[data-fieldname="search_term"]').on("input",function(i){var s=$(e);clearTimeout(s.data("timeout")),s.data("timeout",setTimeout(function(){frappe.flags.auto_scroll=!1,t.empty_list(),t.get_results()},300))})},get_checked_values:function(){return this.$results.find(".list-item-container").map(function(){if($(this).find(".list-row-check:checkbox:checked").length>0)return $(this).attr("data-item-name")}).get()},make_list_row:function(e){void 0===e&&(e={});var t=this,i=0===Object.keys(e).length,s="",n=["name"];if($.isArray(this.setters))for(var a=0,r=this.setters;a<r.length;a+=1){var o=r[a];n.push(o.fieldname)}else n=n.concat(Object.keys(this.setters));n.push("Date"),n.forEach(function(n){s+='<div class="list-item__content ellipsis">\n\t\t\t\t'+(i?'<span class="ellipsis">'+__(frappe.model.unscrub(n))+"</span>":"name"!==n?'<span class="ellipsis">'+__(e[n])+"</span>":'<a href="#Form/'+t.doctype+"/"+e[n]+'" class="list-id ellipsis">\n\t\t\t\t\t\t\t'+__(e[n])+"</a>")+"\n\t\t\t</div>"});var l=$('<div class="list-item">\n\t\t\t<div class="list-item__content" style="flex: 0 0 10px;">\n\t\t\t\t<input type="checkbox" class="list-row-check" data-item-name="'+e.name+'" '+(e.checked?"checked":"")+">\n\t\t\t</div>\n\t\t\t"+s+"\n\t\t</div>");return i?l.addClass("list-item--head"):l=$('<div class="list-item-container" data-item-name="'+e.name+'"></div>').append(l),l},render_result_list:function(e,t){void 0===t&&(t=0);var i=this,s=i.dialog.fields_dict.more_btn.$wrapper;frappe.flags.auto_scroll||this.empty_list(),s.hide(),0!==e.length&&(t&&s.show(),e.forEach(function(e){i.$results.append(i.make_list_row(e))}),frappe.flags.auto_scroll&&this.$results.animate({scrollTop:i.$results.prop("scrollHeight")},500))},empty_list:function(){this.$results.find(".list-item-container").remove()},get_results:function(){var e=this,t=this.get_query?this.get_query().filters:{},i=[e.date_field];if($.isArray(this.setters))for(var s=0,n=this.setters;s<n.length;s+=1){var a=n[s];t[a.fieldname]=e.dialog.fields_dict[a.fieldname].get_value()||void 0,e.args[a.fieldname]=t[a.fieldname],i.push(a.fieldname)}else Object.keys(this.setters).forEach(function(s){t[s]=e.dialog.fields_dict[s].get_value()||void 0,e.args[s]=t[s],i.push(s)});var r=this.dialog.fields_dict.date_range.get_value();r&&(t[this.date_field]=["between",r]);var o={doctype:e.doctype,txt:e.dialog.fields_dict.search_term.get_value(),filters:t,filter_fields:i,start:this.start,page_length:this.page_length+1,query:this.get_query?this.get_query().query:"",as_dict:1};frappe.call({type:"GET",method:"frappe.desk.search.search_widget",no_spinner:!0,args:o,callback:function(t){var i=[],s=0;t.values.length&&(t.values.length>e.page_length&&(t.values.pop(),s=1),t.values.forEach(function(t){e.date_field in t&&(t.Date=t[e.date_field]),t.checked=0,t.parsed_date=Date.parse(t.Date),i.push(t)}),i.map(function(e){e.Date=frappe.format(e.Date,{fieldtype:"Date"})}),i.sort(function(e,t){return e.parsed_date-t.parsed_date}),e.start<1&&1===t.values.length&&(i[0].checked=1)),e.render_result_list(i,s)}})}}),frappe.provide("frappe.ui"),window.cur_dialog=null,frappe.ui.open_dialogs=[],frappe.ui.Dialog=class extends frappe.ui.FieldGroup{constructor(e){super(),this.display=!1,this.is_dialog=!0,$.extend(this,{animate:!0,size:null},e),this.make()}make(){var e=this;this.$wrapper=frappe.get_modal("",""),this.static&&(this.$wrapper.modal({backdrop:"static",keyboard:!1}),this.get_close_btn().hide()),this.wrapper=this.$wrapper.find(".modal-dialog").get(0),"small"==this.size?$(this.wrapper).addClass("modal-sm"):"large"==this.size&&$(this.wrapper).addClass("modal-lg"),this.make_head(),this.modal_body=this.$wrapper.find(".modal-body"),this.$body=$("<div></div>").appendTo(this.modal_body),this.body=this.$body.get(0),this.$message=$('<div class="hide modal-message"></div>').appendTo(this.modal_body),this.header=this.$wrapper.find(".modal-header"),this.buttons=this.header.find(".buttons"),this.set_indicator(),super.make(),this.action=this.action||{primary:{},secondary:{}},(this.primary_action||this.action.primary&&this.action.primary.onsubmit)&&this.set_primary_action(this.primary_action_label||this.action.primary.label||__("Submit"),this.primary_action||this.action.primary.onsubmit),this.secondary_action&&this.set_secondary_action(this.secondary_action),(this.secondary_action_label||this.action.secondary&&this.action.secondary.label)&&this.get_close_btn().html(this.secondary_action_label||this.action.secondary.label),this.minimizable&&(this.header.find(".modal-title").click(function(){return e.toggle_minimize()}),this.get_minimize_btn().removeClass("hide").on("click",function(){return e.toggle_minimize()}));var t=this;this.$wrapper.on("hide.bs.modal",function(){t.display=!1,t.secondary_action&&t.secondary_action(),frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]===t&&(frappe.ui.open_dialogs.pop(),frappe.ui.open_dialogs.length?window.cur_dialog=frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]:window.cur_dialog=null),t.onhide&&t.onhide(),t.on_hide&&t.on_hide()}).on("shown.bs.modal",function(){t.display=!0,window.cur_dialog=t,frappe.ui.open_dialogs.push(t),t.focus_on_first_input(),t.on_page_show&&t.on_page_show(),$(document).trigger("frappe.ui.Dialog:shown")}).on("scroll",function(){var e=$("input:focus");e.length&&["Date","Datetime","Time"].includes(e.attr("data-fieldtype"))&&e.blur()})}get_primary_btn(){return this.$wrapper.find(".modal-header .btn-primary")}get_minimize_btn(){return this.$wrapper.find(".modal-header .btn-modal-minimize")}set_message(e){this.$message.removeClass("hide"),this.$body.addClass("hide"),this.$message.text(e)}clear_message(){this.$message.addClass("hide"),this.$body.removeClass("hide")}clear(){super.clear(),this.clear_message()}set_primary_action(e,t){this.has_primary_action=!0;var i=this;return this.get_primary_btn().removeClass("hide").html(e).click(function(){i.primary_action_fulfilled=!0;var e=i.get_values();e&&t&&t.apply(i,[e])})}set_secondary_action(e){this.get_close_btn().on("click",e)}disable_primary_action(){this.get_primary_btn().addClass("disabled")}enable_primary_action(){this.get_primary_btn().removeClass("disabled")}make_head(){this.set_title(this.title)}set_title(e){this.$wrapper.find(".modal-title").html(e)}set_indicator(){this.indicator&&this.header.find(".indicator").removeClass().addClass("indicator "+this.indicator)}show(){return this.animate?this.$wrapper.addClass("fade"):this.$wrapper.removeClass("fade"),this.$wrapper.modal("show"),this.clear_message(),this.primary_action_fulfilled=!1,this.is_visible=!0,this}hide(){this.$wrapper.modal("hide"),this.is_visible=!1}get_close_btn(){return this.$wrapper.find(".btn-modal-close")}no_cancel(){this.get_close_btn().toggle(!1)}cancel(){this.get_close_btn().trigger("click")}toggle_minimize(){var e=this.$wrapper.closest(".modal").toggleClass("modal-minimize");e.attr("tabindex")?e.removeAttr("tabindex"):e.attr("tabindex",-1),this.get_minimize_btn().find("i").toggleClass("octicon-chevron-down").toggleClass("octicon-chevron-up"),this.is_minimized=!this.is_minimized,this.on_minimize_toggle&&this.on_minimize_toggle(this.is_minimized),this.header.find(".modal-title").toggleClass("cursor-pointer")}}}();
//# sourceMappingURL=dialog.min.js.map
