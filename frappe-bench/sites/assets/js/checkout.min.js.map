{"version":3,"file":"checkout.min.js","sources":["../../../apps/frappe/frappe/public/js/integrations/razorpay.js"],"sourcesContent":["/* HOW-TO\n\nRazorpay Payment\n\n1. \tInclude checkout script in your code\n\t<script type=\"text/javascript\" src=\"/assets/js/checkout.min.js\"></script>\n\n2.\tCreate the Order controller in your backend\n\tdef get_razorpay_order(self):\n\t\tcontroller = get_payment_gateway_controller(\"Razorpay\")\n\n\t\tpayment_details = {\n\t\t\t\"amount\": 300,\n\t\t\t...\n\t\t\t\"reference_doctype\": \"Conference Participant\",\n\t\t\t\"reference_docname\": self.name,\n\t\t\t...\n\t\t\t\"receipt\": self.name\n\t\t}\n\n\t\treturn controller.create_order(**payment_details)\n\n3. \tInititate the payment in client using checkout API\n\tfunction make_payment(ticket) {\n\t\tvar options = {\n\t\t\t\"name\": \"<CHECKOUT MODAL TITLE>\",\n\t\t\t\"description\": \"<CHECKOUT MODAL DESCRIPTION>\",\n\t\t\t\"image\": \"<CHECKOUT MODAL LOGO>\",\n\t\t    \"prefill\": {\n\t\t\t\t\"name\": \"<CUSTOMER NAME>\",\n\t\t\t\t\"email\": \"<CUSTOMER EMAIL>\",\n\t\t\t\t\"contact\": \"<CUSTOMER PHONE>\"\n\t\t    },\n\t\t    \"theme\": {\n\t\t\t\t\"color\": \"<MODAL COLOR>\"\n\t\t    },\n\t\t    \"doctype\": \"<REFERENCE DOCTYPE>\",\n\t\t    \"docname\": \"<REFERENCE DOCNAME\"\n\t\t};\n\n\t\trazorpay = new frappe.checkout.razorpay(options)\n\t\trazorpay.on_open = () => {\n\t\t\t<SCRIPT TO RUN WHEN MODAL OPENS>\n\t\t}\n\t\trazorpay.on_success = () => {\n\t\t\t<SCRIPT TO RUN ON PAYMENT SUCCESS>\n\t\t}\n\t\trazorpay.on_fail = () => {\n\t\t\t<SCRIPT TO RUN ON PAYMENT FAILURE>\n\t\t}\n\t\trazorpay.init() // Creates the order and opens the modal\n\t}\n*/\n\nfrappe.provide(\"frappe.checkout\");\n\nfrappe.require('https://checkout.razorpay.com/v1/checkout.js').then(() => {\n\tfrappe.checkout.razorpay = class RazorpayCheckout {\n\t\tconstructor(opts) {\n\t\t\tObject.assign(this, opts);\n\t\t}\n\n\t\tinit() {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.get_key(),\n\t\t\t\t() => this.make_order(),\n\t\t\t\t() => this.prepare_options(),\n\t\t\t\t() => this.setup_handler(),\n\t\t\t\t() => this.show()\n\t\t\t]);\n\t\t}\n\n\t\tshow() {\n\t\t\tthis.razorpay = new Razorpay(this.options);\n\t\t\tthis.razorpay.once('ready', (response) => {\n\t\t\t\tthis.on_open && this.on_open(response);\n\t\t\t})\n\t\t\tthis.razorpay.open();\n\t\t}\n\n\t\tget_key() {\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tfrappe.call(\"frappe.integrations.doctype.razorpay_settings.razorpay_settings.get_api_key\").then(res => {\n\t\t\t\t\tthis.key = res.message;\n\t\t\t\t\tresolve(true);\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\n\t\tmake_order() {\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tfrappe.call(\"frappe.integrations.doctype.razorpay_settings.razorpay_settings.get_order\", {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\tdocname: this.docname\n\t\t\t\t}).then(res => {\n\t\t\t\t\tthis.order = res.message;\n\t\t\t\t\tresolve(true);\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\n\t\torder_success(response) {\n\t\t\tfrappe.call(\"frappe.integrations.doctype.razorpay_settings.razorpay_settings.order_payment_success\", {\n\t\t\t\tintegration_request: this.order.integration_request,\n\t\t\t\tparams: {\n\t\t\t\t\trazorpay_payment_id: response.razorpay_payment_id,\n\t\t\t\t\trazorpay_order_id: response.razorpay_order_id,\n\t\t\t\t\trazorpay_signature: response.razorpay_signature\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\torder_fail(response) {\n\t\t\tfrappe.call( \"frappe.integrations.doctype.razorpay_settings.razorpay_settings.order_payment_failure\", {\n\t\t\t\tintegration_request: this.order.integration_request,\n\t\t\t\tparams: response\n\t\t\t})\n\t\t}\n\n\t\tprepare_options() {\n\t\t\tthis.options = {\n\t\t\t\t\"key\": this.key,\n\t\t\t\t\"amount\": this.order.amount_due,\n\t\t\t\t\"currency\": this.order.currency,\n\t\t\t\t\"name\": this.name,\n\t\t\t\t\"description\": this.description,\n\t\t\t\t\"image\": this.image,\n\t\t\t\t\"order_id\": this.order.id,\n\t\t\t\t\"prefill\": this.prefill,\n\t\t\t\t\"theme\": this.theme,\n\t\t\t\t\"modal\": this.modal\n\t\t\t};\n\t\t}\n\n\t\tsetup_handler() {\n\t\t\tthis.options.handler = (response) => {\n\t\t\t\tif (response.error) {\n\t\t\t\t\tthis.order_fail(response);\n\t\t\t\t\tthis.on_fail && this.on_fail(response);\n\t\t\t\t}\n\t\t\t\telse if (response.razorpay_payment_id) {\n\t\t\t\t\tthis.order_success(response);\n\t\t\t\t\tthis.on_success && this.on_success(response);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});"],"names":["frappe","provide","require","then","checkout","razorpay","[object Object]","opts","Object","assign","this","run_serially","get_key","make_order","prepare_options","setup_handler","show","Razorpay","options","once","response","on_open","open","Promise","resolve","call","res","key","message","doctype","docname","order","integration_request","params","razorpay_payment_id","razorpay_order_id","razorpay_signature","amount","amount_due","currency","name","description","image","order_id","id","prefill","theme","modal","handler","error","order_fail","on_fail","order_success","on_success"],"mappings":"yBAsDAA,OAAOC,QAAQ,mBAEfD,OAAOE,QAAQ,gDAAgDC,gBAC9DH,OAAOI,SAASC,SAAW,MAC1BC,YAAYC,GACXC,OAAOC,OAAOC,KAAMH,GAGrBD,kBACCN,OAAOW,aAAa,mBACbD,EAAKE,6BACLF,EAAKG,gCACLH,EAAKI,qCACLJ,EAAKK,mCACLL,EAAKM,UAIbV,kBACCI,KAAKL,SAAW,IAAIY,SAASP,KAAKQ,SAClCR,KAAKL,SAASc,KAAK,iBAAUC,GAC5BV,EAAKW,SAAWX,EAAKW,QAAQD,KAE9BV,KAAKL,SAASiB,OAGfhB,qBACC,OAAO,IAAIiB,iBAAQC,GAClBxB,OAAOyB,KAAK,+EAA+EtB,cAAKuB,GAC/FhB,EAAKiB,IAAMD,EAAIE,QACfJ,GAAQ,OAKXlB,wBACC,OAAO,IAAIiB,iBAAQC,GAClBxB,OAAOyB,KAAK,4EAA6E,CACxFI,QAASnB,EAAKmB,QACdC,QAASpB,EAAKoB,UACZ3B,cAAKuB,GACPhB,EAAKqB,MAAQL,EAAIE,QACjBJ,GAAQ,OAKXlB,cAAcc,GACbpB,OAAOyB,KAAK,wFAAyF,CACpGO,oBAAqBtB,KAAKqB,MAAMC,oBAChCC,OAAQ,CACPC,oBAAqBd,EAASc,oBAC9BC,kBAAmBf,EAASe,kBAC5BC,mBAAoBhB,EAASgB,sBAKhC9B,WAAWc,GACVpB,OAAOyB,KAAM,wFAAyF,CACrGO,oBAAqBtB,KAAKqB,MAAMC,oBAChCC,OAAQb,IAIVd,kBACCI,KAAKQ,QAAU,CACdS,IAAOjB,KAAKiB,IACZU,OAAU3B,KAAKqB,MAAMO,WACrBC,SAAY7B,KAAKqB,MAAMQ,SACvBC,KAAQ9B,KAAK8B,KACbC,YAAe/B,KAAK+B,YACpBC,MAAShC,KAAKgC,MACdC,SAAYjC,KAAKqB,MAAMa,GACvBC,QAAWnC,KAAKmC,QAChBC,MAASpC,KAAKoC,MACdC,MAASrC,KAAKqC,OAIhBzC,2BACCI,KAAKQ,QAAQ8B,iBAAW5B,GACnBA,EAAS6B,OACZvC,EAAKwC,WAAW9B,GAChBV,EAAKyC,SAAWzC,EAAKyC,QAAQ/B,IAErBA,EAASc,sBACjBxB,EAAK0C,cAAchC,GACnBV,EAAK2C,YAAc3C,EAAK2C,WAAWjC"}