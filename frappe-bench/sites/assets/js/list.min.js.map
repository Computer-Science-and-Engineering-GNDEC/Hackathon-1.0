{"version":3,"file":"list.min.js","sources":["../../../apps/frappe/frappe/public/js/frappe/model/indicator.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/filter.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/filter_list.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/field_select.js","../../../apps/frappe/frappe/public/js/frappe/ui/tags.js","../../../apps/frappe/frappe/public/js/frappe/ui/tag_editor.js","../../../apps/frappe/frappe/public/js/frappe/ui/like.js","../../../apps/frappe/frappe/public/js/frappe/list/base_list.js","../../../apps/frappe/frappe/public/js/frappe/list/bulk_operations.js","../../../apps/frappe/frappe/public/js/frappe/list/list_view.js","../../../apps/frappe/frappe/public/js/frappe/list/list_factory.js","../../../apps/frappe/frappe/public/js/frappe/list/list_filter.js","../../../apps/frappe/frappe/public/js/frappe/views/file/file_view.js","../../../apps/frappe/frappe/public/js/frappe/views/interaction.js","../../../apps/frappe/frappe/public/js/frappe/list/list_sidebar.js","../../../apps/frappe/frappe/public/js/frappe/list/list_sidebar_group_by.js","../../../apps/frappe/frappe/public/js/frappe/views/gantt/gantt_view.js","../../../apps/frappe/frappe/public/js/frappe/views/calendar/calendar.js","../../../apps/frappe/frappe/public/js/frappe/views/image/image_view.js","../../../apps/frappe/frappe/public/js/frappe/views/kanban/kanban_view.js","../../../apps/frappe/frappe/public/js/frappe/views/inbox/inbox_view.js","../../../apps/frappe/frappe/public/js/frappe/views/treeview.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n\nfrappe.has_indicator = function(doctype) {\n\t// returns true if indicator is present\n\tif(frappe.model.is_submittable(doctype)) {\n\t\treturn true;\n\t} else if((frappe.listview_settings[doctype] || {}).get_indicator\n\t\t|| frappe.workflow.get_state_fieldname(doctype)) {\n\t\treturn true;\n\t} else if(frappe.meta.has_field(doctype, 'enabled')\n\t\t|| frappe.meta.has_field(doctype, 'disabled')) {\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nfrappe.get_indicator = function(doc, doctype) {\n\tif(doc.__unsaved) {\n\t\treturn [__(\"Not Saved\"), \"orange\"];\n\t}\n\n\tif(!doctype) doctype = doc.doctype;\n\n\tvar workflow = frappe.workflow.workflows[doctype];\n\tvar without_workflow = workflow ? workflow['override_status'] : true;\n\n\tvar settings = frappe.listview_settings[doctype] || {};\n\n\tvar is_submittable = frappe.model.is_submittable(doctype),\n\t\tworkflow_fieldname = frappe.workflow.get_state_fieldname(doctype);\n\n\t// workflow\n\tif(workflow_fieldname && !without_workflow) {\n\t\tvar value = doc[workflow_fieldname];\n\t\tif(value) {\n\t\t\tvar colour = \"\";\n\n\t\t\tif(locals[\"Workflow State\"][value] && locals[\"Workflow State\"][value].style) {\n\t\t\t\tvar colour = {\n\t\t\t\t\t\"Success\": \"green\",\n\t\t\t\t\t\"Warning\": \"orange\",\n\t\t\t\t\t\"Danger\": \"red\",\n\t\t\t\t\t\"Primary\": \"blue\",\n\t\t\t\t\t\"Inverse\": \"black\",\n\t\t\t\t\t\"Info\": \"light-blue\",\n\t\t\t\t}[locals[\"Workflow State\"][value].style];\n\t\t\t}\n\t\t\tif(!colour) colour = \"darkgrey\";\n\n\t\t\treturn [__(value), colour, workflow_fieldname + ',=,' + value];\n\t\t}\n\t}\n\n\t// draft if document is submittable\n\tif(is_submittable && doc.docstatus==0 && !settings.has_indicator_for_draft) {\n\t\treturn [__(\"Draft\"), \"red\", \"docstatus,=,0\"];\n\t}\n\n\t// cancelled\n\tif(is_submittable && doc.docstatus==2 && !settings.has_indicator_for_cancelled) {\n\t\treturn [__(\"Cancelled\"), \"red\", \"docstatus,=,2\"];\n\t}\n\n\tif(settings.get_indicator) {\n\t\tvar indicator = settings.get_indicator(doc);\n\t\tif(indicator) return indicator;\n\t}\n\n\t// if submittable\n\tif(is_submittable && doc.docstatus==1) {\n\t\treturn [__(\"Submitted\"), \"blue\", \"docstatus,=,1\"];\n\t}\n\n\t// based on status\n\tif(doc.status) {\n\t\treturn [__(doc.status), frappe.utils.guess_colour(doc.status)];\n\t}\n\n\t// based on enabled\n\tif(frappe.meta.has_field(doctype, 'enabled')) {\n\t\tif(doc.enabled) {\n\t\t\treturn [__('Enabled'), 'blue', 'enabled,=,1'];\n\t\t} else {\n\t\t\treturn [__('Disabled'), 'grey', 'enabled,=,0'];\n\t\t}\n\t}\n\n\t// based on disabled\n\tif(frappe.meta.has_field(doctype, 'disabled')) {\n\t\tif(doc.disabled) {\n\t\t\treturn [__('Disabled'), 'grey', 'disabled,=,1'];\n\t\t} else {\n\t\t\treturn [__('Enabled'), 'blue', 'disabled,=,0'];\n\t\t}\n\t}\n}\n","frappe.ui.Filter = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tif (this.value === null || this.value === undefined) {\n\t\t\tthis.value = '';\n\t\t}\n\n\t\tthis.utils = frappe.ui.filter_utils;\n\t\tthis.conditions = [\n\t\t\t['=', __('Equals')],\n\t\t\t['!=', __('Not Equals')],\n\t\t\t['like', __('Like')],\n\t\t\t['not like', __('Not Like')],\n\t\t\t['in', __('In')],\n\t\t\t['not in', __('Not In')],\n\t\t\t['is', __('Is')],\n\t\t\t['>', '>'],\n\t\t\t['<', '<'],\n\t\t\t['>=', '>='],\n\t\t\t['<=', '<='],\n\t\t\t['Between', __('Between')],\n\t\t\t['Previous', __('Previous')],\n\t\t\t['Next', __('Next')],\n\t\t];\n\n\t\tthis.nested_set_conditions = [\n\t\t\t['descendants of', __('Descendants Of')],\n\t\t\t['not descendants of', __('Not Descendants Of')],\n\t\t\t['ancestors of', __('Ancestors Of')],\n\t\t\t['not ancestors of', __('Not Ancestors Of')],\n\t\t];\n\n\t\tthis.conditions.push(...this.nested_set_conditions);\n\n\t\tthis.invalid_condition_map = {\n\t\t\tDate: ['like', 'not like'],\n\t\t\tDatetime: ['like', 'not like'],\n\t\t\tData: ['Between', 'Previous', 'Next'],\n\t\t\tSelect: ['like', 'not like', 'Between', 'Previous', 'Next'],\n\t\t\tLink: ['Between', 'Previous', 'Next', '>', '<', '>=', '<='],\n\t\t\tCurrency: ['Between', 'Previous', 'Next'],\n\t\t\tColor: ['Between', 'Previous', 'Next'],\n\t\t\tCheck: this.conditions.map((c) => c[0]).filter((c) => c !== '='),\n\t\t};\n\t\tthis.make();\n\t\tthis.make_select();\n\t\tthis.set_events();\n\t\tthis.setup();\n\t}\n\n\tmake() {\n\t\tthis.filter_edit_area = $(\n\t\t\tfrappe.render_template('edit_filter', {\n\t\t\t\tconditions: this.conditions,\n\t\t\t})\n\t\t).appendTo(this.parent.find('.filter-edit-area'));\n\t}\n\n\tmake_select() {\n\t\tthis.fieldselect = new frappe.ui.FieldSelect({\n\t\t\tparent: this.filter_edit_area.find('.fieldname-select-area'),\n\t\t\tdoctype: this.parent_doctype,\n\t\t\tfilter_fields: this.filter_fields,\n\t\t\tselect: (doctype, fieldname) => {\n\t\t\t\tthis.set_field(doctype, fieldname);\n\t\t\t},\n\t\t});\n\n\t\tif (this.fieldname) {\n\t\t\tthis.fieldselect.set_value(this.doctype, this.fieldname);\n\t\t}\n\t}\n\n\tset_events() {\n\t\tthis.filter_edit_area.find('a.remove-filter').on('click', () => {\n\t\t\tthis.remove();\n\t\t});\n\n\t\tthis.filter_edit_area.find('.set-filter-and-run').on('click', () => {\n\t\t\tthis.filter_edit_area.removeClass('new-filter');\n\t\t\tthis.on_change();\n\t\t\tthis.update_filter_tag();\n\t\t});\n\n\t\tthis.filter_edit_area.find('.condition').change(() => {\n\t\t\tif (!this.field) return;\n\n\t\t\tlet condition = this.get_condition();\n\t\t\tlet fieldtype = null;\n\n\t\t\tif (['in', 'like', 'not in', 'not like'].includes(condition)) {\n\t\t\t\tfieldtype = 'Data';\n\t\t\t\tthis.add_condition_help(condition);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t['Select', 'MultiSelect'].includes(this.field.df.fieldtype) &&\n\t\t\t\t['in', 'not in'].includes(condition)\n\t\t\t) {\n\t\t\t\tfieldtype = 'MultiSelect';\n\t\t\t}\n\n\t\t\tthis.set_field(\n\t\t\t\tthis.field.df.parent,\n\t\t\t\tthis.field.df.fieldname,\n\t\t\t\tfieldtype,\n\t\t\t\tcondition\n\t\t\t);\n\t\t});\n\t}\n\n\tsetup() {\n\t\tconst fieldname = this.fieldname || 'name';\n\t\t// set the field\n\t\treturn this.set_values(this.doctype, fieldname, this.condition, this.value);\n\t}\n\n\tsetup_state(is_new) {\n\t\tlet promise = Promise.resolve();\n\t\tif (is_new) {\n\t\t\tthis.filter_edit_area.addClass('new-filter');\n\t\t} else {\n\t\t\tpromise = this.update_filter_tag();\n\t\t}\n\n\t\tif (this.hidden) {\n\t\t\tpromise.then(() => this.$filter_tag.hide());\n\t\t}\n\t}\n\n\tfreeze() {\n\t\tthis.update_filter_tag();\n\t}\n\n\tupdate_filter_tag() {\n\t\tif (this._filter_value_set) {\n\t\t\treturn this._filter_value_set.then(() => {\n\t\t\t\t!this.$filter_tag ? this.make_tag() : this.set_filter_button_text();\n\t\t\t\tthis.filter_edit_area.hide();\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t}\n\n\tremove() {\n\t\tthis.filter_edit_area.remove();\n\t\tthis.$filter_tag && this.$filter_tag.remove();\n\t\tthis.field = null;\n\t\tthis.on_change(true);\n\t}\n\n\tset_values(doctype, fieldname, condition, value) {\n\t\t// presents given (could be via tags!)\n\t\tif (this.set_field(doctype, fieldname) === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.field.df.original_type === 'Check') {\n\t\t\tvalue = value == 1 ? 'Yes' : 'No';\n\t\t}\n\t\tif (condition) this.set_condition(condition, true);\n\n\t\t// set value can be asynchronous, so update_filter_tag should happen after field is set\n\t\tthis._filter_value_set = Promise.resolve();\n\n\t\tif (['in', 'not in'].includes(condition) && Array.isArray(value)) {\n\t\t\tvalue = value.join(',');\n\t\t}\n\n\t\tif (Array.isArray(value)) {\n\t\t\tthis._filter_value_set = this.field.set_value(value);\n\t\t} else if (value !== undefined || value !== null) {\n\t\t\tthis._filter_value_set = this.field.set_value((value + '').trim());\n\t\t}\n\t\treturn this._filter_value_set;\n\t}\n\n\tset_field(doctype, fieldname, fieldtype, condition) {\n\t\t// set in fieldname (again)\n\t\tlet cur = {};\n\t\tif (this.field) for (let k in this.field.df) cur[k] = this.field.df[k];\n\n\t\tlet original_docfield = (this.fieldselect.fields_by_name[doctype] || {})[\n\t\t\tfieldname\n\t\t];\n\n\t\tif (!original_docfield) {\n\t\t\tconsole.warn(`Field ${fieldname} is not selectable.`);\n\t\t\tthis.remove();\n\t\t\treturn false;\n\t\t}\n\n\t\tlet df = copy_dict(original_docfield);\n\n\t\t// filter field shouldn't be read only or hidden\n\t\tdf.read_only = 0;\n\t\tdf.hidden = 0;\n\t\tdf.is_filter = true;\n\n\t\tlet c = condition ? condition : this.utils.get_default_condition(df);\n\t\tthis.set_condition(c);\n\n\t\tthis.utils.set_fieldtype(df, fieldtype, this.get_condition());\n\n\t\t// called when condition is changed,\n\t\t// don't change if all is well\n\t\tif (\n\t\t\tthis.field &&\n\t\t\tcur.fieldname == fieldname &&\n\t\t\tdf.fieldtype == cur.fieldtype &&\n\t\t\tdf.parent == cur.parent &&\n\t\t\tdf.options == cur.options\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\t// clear field area and make field\n\t\tthis.fieldselect.selected_doctype = doctype;\n\t\tthis.fieldselect.selected_fieldname = fieldname;\n\n\t\tthis.make_field(df, cur.fieldtype);\n\t}\n\n\tmake_field(df, old_fieldtype) {\n\t\tlet old_text = this.field ? this.field.get_value() : null;\n\t\tthis.hide_invalid_conditions(df.fieldtype, df.original_type);\n\t\tthis.toggle_nested_set_conditions(df);\n\t\tlet field_area = this.filter_edit_area\n\t\t\t.find('.filter-field')\n\t\t\t.empty()\n\t\t\t.get(0);\n\t\tlet f = frappe.ui.form.make_control({\n\t\t\tdf: df,\n\t\t\tparent: field_area,\n\t\t\tonly_input: true,\n\t\t});\n\t\tf.refresh();\n\n\t\tthis.field = f;\n\t\tif (old_text && f.fieldtype === old_fieldtype) {\n\t\t\tthis.field.set_value(old_text);\n\t\t}\n\n\t\t// run on enter\n\t\t$(this.field.wrapper)\n\t\t\t.find(':input')\n\t\t\t.keydown((e) => {\n\t\t\t\tif (e.which == 13 && this.field.df.fieldtype !== 'MultiSelect') {\n\t\t\t\t\tthis.on_change();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tget_value() {\n\t\treturn [\n\t\t\tthis.fieldselect.selected_doctype,\n\t\t\tthis.field.df.fieldname,\n\t\t\tthis.get_condition(),\n\t\t\tthis.get_selected_value(),\n\t\t\tthis.hidden,\n\t\t];\n\t}\n\tget_selected_value() {\n\t\treturn this.utils.get_selected_value(this.field, this.get_condition());\n\t}\n\n\tget_condition() {\n\t\treturn this.filter_edit_area.find('.condition').val();\n\t}\n\n\tset_condition(condition, trigger_change = false) {\n\t\tlet $condition_field = this.filter_edit_area.find('.condition');\n\t\t$condition_field.val(condition);\n\t\tif (trigger_change) $condition_field.change();\n\t}\n\n\tmake_tag() {\n\t\tthis.$filter_tag = this.get_filter_tag_element().insertAfter(\n\t\t\tthis.parent.find('.active-tag-filters .clear-filters')\n\t\t);\n\t\tthis.set_filter_button_text();\n\t\tthis.bind_tag();\n\t}\n\n\tbind_tag() {\n\t\tthis.$filter_tag.find('.remove-filter').on('click', this.remove.bind(this));\n\n\t\tlet filter_button = this.$filter_tag.find('.toggle-filter');\n\t\tfilter_button.on('click', () => {\n\t\t\tfilter_button\n\t\t\t\t.closest('.tag-filters-area')\n\t\t\t\t.find('.filter-edit-area')\n\t\t\t\t.show();\n\t\t\tthis.filter_edit_area.toggle();\n\t\t});\n\t}\n\n\tset_filter_button_text() {\n\t\tthis.$filter_tag.find('.toggle-filter').html(this.get_filter_button_text());\n\t}\n\n\tget_filter_button_text() {\n\t\tlet value = this.utils.get_formatted_value(\n\t\t\tthis.field,\n\t\t\tthis.get_selected_value()\n\t\t);\n\t\treturn `${__(this.field.df.label)} ${__(this.get_condition())} ${__(\n\t\t\tvalue\n\t\t)}`;\n\t}\n\n\tget_filter_tag_element() {\n\t\treturn $(`<div class=\"filter-tag btn-group\">\n\t\t\t<button class=\"btn btn-default btn-xs toggle-filter\"\n\t\t\t\ttitle=\"${__('Edit Filter')}\">\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-default btn-xs remove-filter\"\n\t\t\t\ttitle=\"${__('Remove Filter')}\">\n\t\t\t\t<i class=\"fa fa-remove text-muted\"></i>\n\t\t\t</button>\n\t\t</div>`);\n\t}\n\n\tadd_condition_help(condition) {\n\t\tlet $desc = this.field.desc_area;\n\t\tif (!$desc) {\n\t\t\t$desc = $('<div class=\"text-muted small\">').appendTo(this.field.wrapper);\n\t\t}\n\t\t// set description\n\t\t$desc.html(\n\t\t\t(in_list(['in', 'not in'], condition) === 'in'\n\t\t\t\t? __('values separated by commas')\n\t\t\t\t: __('use % as wildcard')) + '</div>'\n\t\t);\n\t}\n\n\thide_invalid_conditions(fieldtype, original_type) {\n\t\tlet invalid_conditions =\n\t\t\tthis.invalid_condition_map[original_type] ||\n\t\t\tthis.invalid_condition_map[fieldtype] ||\n\t\t\t[];\n\n\t\tfor (let condition of this.conditions) {\n\t\t\tthis.filter_edit_area\n\t\t\t\t.find(`.condition option[value=\"${condition[0]}\"]`)\n\t\t\t\t.toggle(!invalid_conditions.includes(condition[0]));\n\t\t}\n\t}\n\n\ttoggle_nested_set_conditions(df) {\n\t\tlet show_condition =\n\t\t\tdf.fieldtype === 'Link' &&\n\t\t\tfrappe.boot.nested_set_doctypes.includes(df.options);\n\t\tthis.nested_set_conditions.forEach((condition) => {\n\t\t\tthis.filter_edit_area\n\t\t\t\t.find(`.condition option[value=\"${condition[0]}\"]`)\n\t\t\t\t.toggle(show_condition);\n\t\t});\n\t}\n};\n\nfrappe.ui.filter_utils = {\n\tget_formatted_value(field, value) {\n\t\tif (field.df.fieldname === 'docstatus') {\n\t\t\tvalue = { 0: 'Draft', 1: 'Submitted', 2: 'Cancelled' }[value] || value;\n\t\t} else if (field.df.original_type === 'Check') {\n\t\t\tvalue = { 0: 'No', 1: 'Yes' }[cint(value)];\n\t\t}\n\t\treturn frappe.format(value, field.df, { only_value: 1 });\n\t},\n\n\tget_selected_value(field, condition) {\n\t\tlet val = field.get_value();\n\n\t\tif (typeof val === 'string') {\n\t\t\tval = strip(val);\n\t\t}\n\n\t\tif (condition == 'is' && !val) {\n\t\t\tval = field.df.options[0].value;\n\t\t}\n\n\t\tif (field.df.original_type == 'Check') {\n\t\t\tval = val == 'Yes' ? 1 : 0;\n\t\t}\n\n\t\tif (condition.indexOf('like', 'not like') !== -1) {\n\t\t\t// automatically append wildcards\n\t\t\tif (val && !(val.startsWith('%') || val.endsWith('%'))) {\n\t\t\t\tval = '%' + val + '%';\n\t\t\t}\n\t\t} else if (in_list(['in', 'not in'], condition)) {\n\t\t\tif (val) {\n\t\t\t\tval = val.split(',').map((v) => strip(v));\n\t\t\t}\n\t\t}\n\t\tif (val === '%') {\n\t\t\tval = '';\n\t\t}\n\n\t\treturn val;\n\t},\n\n\tget_default_condition(df) {\n\t\tif (df.fieldtype == 'Data') {\n\t\t\treturn 'like';\n\t\t} else if (df.fieldtype == 'Date' || df.fieldtype == 'Datetime') {\n\t\t\treturn 'Between';\n\t\t} else {\n\t\t\treturn '=';\n\t\t}\n\t},\n\n\tset_fieldtype(df, fieldtype, condition) {\n\t\t// reset\n\t\tif (df.original_type) df.fieldtype = df.original_type;\n\t\telse df.original_type = df.fieldtype;\n\n\t\tdf.description = '';\n\t\tdf.reqd = 0;\n\t\tdf.ignore_link_validation = true;\n\n\t\t// given\n\t\tif (fieldtype) {\n\t\t\tdf.fieldtype = fieldtype;\n\t\t\treturn;\n\t\t}\n\n\t\t// scrub\n\t\tif (df.fieldname == 'docstatus') {\n\t\t\tdf.fieldtype = 'Select',\n\t\t\tdf.options = [\n\t\t\t\t{ value: 0, label: __('Draft') },\n\t\t\t\t{ value: 1, label: __('Submitted') },\n\t\t\t\t{ value: 2, label: __('Cancelled') },\n\t\t\t];\n\t\t} else if (df.fieldtype == 'Check') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = 'No\\nYes';\n\t\t} else if (\n\t\t\t[\n\t\t\t\t'Text',\n\t\t\t\t'Small Text',\n\t\t\t\t'Text Editor',\n\t\t\t\t'Code',\n\t\t\t\t'Tag',\n\t\t\t\t'Comments',\n\t\t\t\t'Dynamic Link',\n\t\t\t\t'Read Only',\n\t\t\t\t'Assign',\n\t\t\t].indexOf(df.fieldtype) != -1\n\t\t) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t} else if (\n\t\t\tdf.fieldtype == 'Link' &&\n\t\t\t[\n\t\t\t\t'=',\n\t\t\t\t'!=',\n\t\t\t\t'descendants of',\n\t\t\t\t'ancestors of',\n\t\t\t\t'not descendants of',\n\t\t\t\t'not ancestors of',\n\t\t\t].indexOf(condition) == -1\n\t\t) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t}\n\t\tif (\n\t\t\tdf.fieldtype === 'Data' &&\n\t\t\t(df.options || '').toLowerCase() === 'email'\n\t\t) {\n\t\t\tdf.options = null;\n\t\t}\n\t\tif (\n\t\t\tcondition == 'Between' &&\n\t\t\t(df.fieldtype == 'Date' || df.fieldtype == 'Datetime')\n\t\t) {\n\t\t\tdf.fieldtype = 'DateRange';\n\t\t}\n\t\tif (\n\t\t\t['Previous', 'Next'].includes(condition) &&\n\t\t\t['Date', 'Datetime', 'DateRange', 'Select'].includes(df.fieldtype)\n\t\t) {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = this.get_relative_timespan_options();\n\t\t}\n\n\t\tif (condition === 'is') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = [\n\t\t\t\t{ label: __('Set'), value: 'set' },\n\t\t\t\t{ label: __('Not Set'), value: 'not set' },\n\t\t\t];\n\t\t}\n\t},\n\n\tget_relative_timespan_options() {\n\t\treturn [\n\t\t\t{\n\t\t\t\tlabel: __('1 week'),\n\t\t\t\tvalue: '1 week',\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('1 month'),\n\t\t\t\tvalue: '1 month',\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('3 months'),\n\t\t\t\tvalue: '3 months',\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('6 months'),\n\t\t\t\tvalue: '6 months',\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('1 year'),\n\t\t\t\tvalue: '1 year',\n\t\t\t},\n\t\t];\n\t},\n};\n","frappe.ui.FilterGroup = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.wrapper = this.parent;\n\t\tthis.filters = [];\n\t\tthis.make();\n\t\twindow.fltr = this;\n\t}\n\n\tmake() {\n\t\tthis.wrapper.append(this.get_container_template());\n\t\tthis.set_events();\n\t}\n\n\ttoggle_clear_filter() {\n\t\tlet clear_filter_button = this.wrapper.find('.clear-filters');\n\n\t\tif (this.filters.length == 0) {\n\t\t\tclear_filter_button.hide();\n\t\t} else {\n\t\t\tclear_filter_button.show();\n\t\t}\n\t}\n\tset_events() {\n\t\tthis.wrapper.find('.add-filter').on('click', () => {\n\t\t\tthis.add_filter(this.doctype, 'name')\n\t\t\t\t.then(this.toggle_clear_filter());\n\n\t\t});\n\t\tthis.wrapper.find('.clear-filters').on('click', () => {\n\t\t\tthis.clear_filters();\n\t\t});\n\t}\n\n\tadd_filters(filters) {\n\t\tlet promises = [];\n\n\t\tfor (const filter of filters) {\n\t\t\tpromises.push(() => this.add_filter(...filter));\n\t\t}\n\n\t\tpromises.push(() => this.toggle_clear_filter());\n\n\t\treturn frappe.run_serially(promises);\n\t}\n\n\tadd_filter(doctype, fieldname, condition, value, hidden) {\n\t\tif (!fieldname) return Promise.resolve();\n\t\t// adds a new filter, returns true if filter has been added\n\n\t\t// {}: Add in page filter by fieldname if exists ('=' => 'like')\n\n\t\tif(!this.validate_args(doctype, fieldname)) return false;\n\t\tconst is_new_filter = arguments.length < 2;\n\t\tif (is_new_filter && this.wrapper.find(\".new-filter:visible\").length) {\n\t\t\t// only allow 1 new filter at a time!\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\tlet args = [doctype, fieldname, condition, value, hidden];\n\t\t\tconst promise = this.push_new_filter(args, is_new_filter);\n\t\t\treturn (promise && promise.then) ? promise : Promise.resolve();\n\t\t}\n\t}\n\n\tvalidate_args(doctype, fieldname) {\n\n\t\tif(doctype && fieldname\n\t\t\t&& !frappe.meta.has_field(doctype, fieldname)\n\t\t\t&& !frappe.model.std_fields_list.includes(fieldname)) {\n\n\t\t\tfrappe.throw(__(`Invalid filter: \"${[fieldname.bold()]}\"`));\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpush_new_filter(args, is_new_filter=false) {\n\t\t// args: [doctype, fieldname, condition, value]\n\t\tif(this.filter_exists(args)) return;\n\n\t\t// {}: Clear page filter fieldname field\n\n\t\tlet filter = this._push_new_filter(...args);\n\n\t\tif (filter && filter.value) {\n\t\t\tfilter.setup_state(is_new_filter);\n\t\t\treturn filter._filter_value_set; // internal promise\n\t\t}\n\t}\n\n\t_push_new_filter(doctype, fieldname, condition, value, hidden = false) {\n\t\tlet args = {\n\t\t\tparent: this.wrapper,\n\t\t\tparent_doctype: this.doctype,\n\t\t\tdoctype: doctype,\n\t\t\tfieldname: fieldname,\n\t\t\tcondition: condition,\n\t\t\tvalue: value,\n\t\t\thidden: hidden,\n\t\t\ton_change: (update) => {\n\t\t\t\tif(update) this.update_filters();\n\t\t\t\tthis.on_change();\n\t\t\t},\n\t\t\tfilter_items: (doctype, fieldname) => {\n\t\t\t\treturn !this.filter_exists([doctype, fieldname]);\n\t\t\t}\n\t\t};\n\t\tlet filter = new frappe.ui.Filter(args);\n\t\tthis.filters.push(filter);\n\t\treturn filter;\n\t}\n\n\tfilter_exists(filter_value) {\n\t\t// filter_value of form: [doctype, fieldname, condition, value]\n\t\tlet exists = false;\n\t\tthis.filters.filter(f => f.field).map(f => {\n\t\t\tlet f_value = f.get_value();\n\t\t\tif (filter_value.length === 2) {\n\t\t\t\texists = filter_value[0] === f_value[0] && filter_value[1] === f_value[1];\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet value = filter_value[3];\n\t\t\tlet equal = frappe.utils.arrays_equal;\n\n\t\t\tif(equal(f_value.slice(0, 4), filter_value.slice(0, 4)) || (Array.isArray(value) && equal(value, f_value[3]))) {\n\t\t\t\texists = true;\n\t\t\t}\n\t\t});\n\t\treturn exists;\n\t}\n\n\tget_filters() {\n\t\treturn this.filters.filter(f => f.field).map(f => {\n\t\t\treturn f.get_value();\n\t\t});\n\t\t// {}: this.list.update_standard_filters(values);\n\t}\n\n\tupdate_filters() {\n\t\tthis.filters = this.filters.filter(f => f.field); // remove hidden filters\n\t\tthis.toggle_clear_filter();\n\t}\n\n\tclear_filters() {\n\t\tthis.filters.map(f => f.remove(true));\n\t\t// {}: Clear page filters, .date-range-picker (called list run())\n\t\tthis.filters = [];\n\t}\n\n\tget_filter(fieldname) {\n\t\treturn this.filters.filter(f => {\n\t\t\treturn (f.field && f.field.df.fieldname==fieldname);\n\t\t})[0];\n\t}\n\n\tget_container_template() {\n\t\treturn $(`<div class=\"tag-filters-area\">\n\t\t\t<div class=\"active-tag-filters\">\n\t\t\t\t<button class=\"btn btn-default btn-xs filter-button text-muted add-filter\">\n\t\t\t\t\t${__(\"Add Filter\")}\n\t\t\t\t</button><button class=\"btn btn-default btn-xs filter-button text-muted clear-filters\" style=\"display: none;\">\n\t\t\t\t\t${__(\"Clear Filters\")}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"filter-edit-area\"></div>`);\n\t}\n};\n","// <select> widget with all fields of a doctype as options\nfrappe.ui.FieldSelect = Class.extend({\n\t// opts parent, doctype, filter_fields, with_blank, select\n\tinit(opts) {\n\t\tvar me = this;\n\t\t$.extend(this, opts);\n\t\tthis.fields_by_name = {};\n\t\tthis.options = [];\n\t\tthis.$input = $('<input class=\"form-control\">')\n\t\t\t.appendTo(this.parent)\n\t\t\t.on(\"click\", function () { $(this).select(); });\n\t\tthis.select_input = this.$input.get(0);\n\t\tthis.awesomplete = new Awesomplete(this.select_input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: me.options,\n\t\t\titem(item) {\n\t\t\t\treturn $(repl('<li class=\"filter-field-select\"><p>%(label)s</p></li>', item))\n\t\t\t\t\t.data(\"item.autocomplete\", item)\n\t\t\t\t\t.get(0);\n\t\t\t}\n\t\t});\n\t\tthis.$input.on(\"awesomplete-select\", function(e) {\n\t\t\tvar o = e.originalEvent;\n\t\t\tvar value = o.text.value;\n\t\t\tvar item = me.awesomplete.get_item(value);\n\t\t\tme.selected_doctype = item.doctype;\n\t\t\tme.selected_fieldname = item.fieldname;\n\t\t\tif(me.select) me.select(item.doctype, item.fieldname);\n\t\t});\n\t\tthis.$input.on(\"awesomplete-selectcomplete\", function(e) {\n\t\t\tvar o = e.originalEvent;\n\t\t\tvar value = o.text.value;\n\t\t\tvar item = me.awesomplete.get_item(value);\n\t\t\tme.$input.val(item.label);\n\t\t});\n\n\t\tif(this.filter_fields) {\n\t\t\tfor(var i in this.filter_fields)\n\t\t\t\tthis.add_field_option(this.filter_fields[i]);\n\t\t} else {\n\t\t\tthis.build_options();\n\t\t}\n\t\tthis.set_value(this.doctype, \"name\");\n\t},\n\tget_value() {\n\t\treturn this.selected_doctype ? this.selected_doctype + \".\" + this.selected_fieldname : null;\n\t},\n\tval(value) {\n\t\tif(value===undefined) {\n\t\t\treturn this.get_value();\n\t\t} else {\n\t\t\tthis.set_value(value);\n\t\t}\n\t},\n\tclear() {\n\t\tthis.selected_doctype = null;\n\t\tthis.selected_fieldname = null;\n\t\tthis.$input.val(\"\");\n\t},\n\tset_value(doctype, fieldname) {\n\t\tvar me = this;\n\t\tthis.clear();\n\t\tif(!doctype) return;\n\n\t\t// old style\n\t\tif(doctype.indexOf(\".\")!==-1) {\n\t\t\tvar parts = doctype.split(\".\");\n\t\t\tdoctype = parts[0];\n\t\t\tfieldname = parts[1];\n\t\t}\n\n\t\t$.each(this.options, function(i, v) {\n\t\t\tif(v.doctype===doctype && v.fieldname===fieldname) {\n\t\t\t\tme.selected_doctype = doctype;\n\t\t\t\tme.selected_fieldname = fieldname;\n\t\t\t\tme.$input.val(v.label);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t},\n\tbuild_options() {\n\t\tvar me = this;\n\t\tme.table_fields = [];\n\t\tvar std_filters = $.map(frappe.model.std_fields, function(d) {\n\t\t\tvar opts = {parent: me.doctype};\n\t\t\tif(d.fieldname==\"name\") opts.options = me.doctype;\n\t\t\treturn $.extend(copy_dict(d), opts);\n\t\t});\n\n\t\t// add parenttype column\n\t\tvar doctype_obj = locals['DocType'][me.doctype];\n\t\tif(doctype_obj && cint(doctype_obj.istable)) {\n\t\t\tstd_filters = std_filters.concat([{\n\t\t\t\tfieldname: 'parent',\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: 'Parent',\n\t\t\t\tparent: me.doctype,\n\t\t\t}]);\n\t\t}\n\n\t\t// blank\n\t\tif(this.with_blank) {\n\t\t\tthis.options.push({\n\t\t\t\tlabel:\"\",\n\t\t\t\tvalue:\"\",\n\t\t\t});\n\t\t}\n\n\t\t// main table\n\t\tvar main_table_fields = std_filters.concat(frappe.meta.docfield_list[me.doctype]);\n\t\t$.each(frappe.utils.sort(main_table_fields, \"label\", \"string\"), function(i, df) {\n\t\t\t// show fields where user has read access and if report hide flag is not set\n\t\t\tif(frappe.perm.has_perm(me.doctype, df.permlevel, \"read\"))\n\t\t\t\tme.add_field_option(df);\n\t\t});\n\n\t\t// child tables\n\t\t$.each(me.table_fields, function(i, table_df) {\n\t\t\tif(table_df.options) {\n\t\t\t\tlet child_table_fields = [].concat(frappe.meta.docfield_list[table_df.options]);\n\n\t\t\t\tif (table_df.fieldtype === \"Table MultiSelect\") {\n\t\t\t\t\tconst link_field = frappe.meta.get_docfields(table_df.options)\n\t\t\t\t\t\t.find(df => df.fieldtype === 'Link');\n\t\t\t\t\tchild_table_fields = link_field ? [link_field] : [];\n\t\t\t\t}\n\n\t\t\t\t$.each(frappe.utils.sort(child_table_fields, \"label\", \"string\"), function(i, df) {\n\t\t\t\t\t// show fields where user has read access and if report hide flag is not set\n\t\t\t\t\tif(frappe.perm.has_perm(me.doctype, df.permlevel, \"read\"))\n\t\t\t\t\t\tme.add_field_option(df);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tadd_field_option(df) {\n\t\tlet me = this;\n\n\t\tif (df.fieldname == 'docstatus' && !frappe.model.is_submittable(me.doctype))\n\t\t\treturn;\n\n\t\tif (frappe.model.table_fields.includes(df.fieldtype)) {\n\t\t\tme.table_fields.push(df);\n\t\t\treturn;\n\t\t}\n\n\t\tlet label = null;\n\t\tlet table = null;\n\n\t\tif(me.doctype && df.parent==me.doctype) {\n\t\t\tlabel = __(df.label);\n\t\t\ttable = me.doctype;\n\t\t} else {\n\t\t\tlabel = __(df.label) + ' (' + __(df.parent) + ')';\n\t\t\ttable = df.parent;\n\t\t}\n\n\t\tif(frappe.model.no_value_type.indexOf(df.fieldtype) == -1 &&\n\t\t\t!(me.fields_by_name[df.parent] && me.fields_by_name[df.parent][df.fieldname])) {\n\t\t\tthis.options.push({\n\t\t\t\tlabel: label,\n\t\t\t\tvalue: table + \".\" + df.fieldname,\n\t\t\t\tfieldname: df.fieldname,\n\t\t\t\tdoctype: df.parent\n\t\t\t});\n\t\t\tif(!me.fields_by_name[df.parent]) me.fields_by_name[df.parent] = {};\n\t\t\tme.fields_by_name[df.parent][df.fieldname] = df;\n\t\t}\n\t},\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.Tags = class {\n\tconstructor({\n\t\tparent, placeholder, tagsList,\n\t\tonTagAdd,\n\t\tonTagRemove,\n\t\tonTagClick,\n\t\tonChange\n\t}) {\n\t\tthis.tagsList = tagsList || [];\n\t\tthis.onTagAdd = onTagAdd;\n\t\tthis.onTagRemove = onTagRemove;\n\t\tthis.onTagClick = onTagClick;\n\t\tthis.onChange = onChange;\n\n\t\tthis.setup(parent, placeholder);\n\t}\n\n\tsetup(parent, placeholder) {\n\t\tthis.$wrapper = $(`<div class=\"tags-wrapper\"></div>`).appendTo(parent);\n\t\tthis.$ul = $(`<ul class=\"tags-list\"></ul>`).appendTo(this.$wrapper);\n\t\tthis.$input = $(`<input class=\"tags-input\"></input>`);\n\n\t\tthis.$inputWrapper = this.getListElement(this.$input);\n\t\tthis.$placeholder = this.getListElement($(`<span class=\"tags-placeholder text-muted\">${placeholder}</span>`));\n\t\tthis.$inputWrapper.appendTo(this.$ul);\n\t\tthis.$placeholder.appendTo(this.$ul);\n\n\t\tthis.deactivate();\n\t\tthis.bind();\n\t\tthis.boot();\n\t}\n\n\tbind() {\n\t\tthis.$input.keypress((e) => {\n\t\t\tif(e.which == 13 || e.keyCode == 13) {\n\t\t\t\tconst tagValue = frappe.utils.xss_sanitise(this.$input.val());\n\t\t\t\tthis.addTag(tagValue);\n\t\t\t\tthis.$input.val('');\n\t\t\t}\n\t\t});\n\n\t\tthis.$input.on('blur', () => {\n\t\t\tthis.deactivate();\n\t\t});\n\n\t\tthis.$placeholder.on('click', () => {\n\t\t\tthis.activate();\n\t\t\tthis.$input.focus(); // focus only when clicked\n\t\t});\n\t}\n\n\tboot() {\n\t\tthis.addTags(this.tagsList);\n\t}\n\n\tactivate() {\n\t\tthis.$placeholder.hide();\n\t\tthis.$inputWrapper.show();\n\t}\n\n\tdeactivate() {\n\t\tthis.$inputWrapper.hide();\n\t\tthis.$placeholder.show();\n\t}\n\n\taddTag(label) {\n\t\tif(label && label!== '' && !this.tagsList.includes(label)) {\n\t\t\tlet $tag = this.getTag(label);\n\t\t\tthis.getListElement($tag).insertBefore(this.$inputWrapper);\n\t\t\tthis.tagsList.push(label);\n\t\t\tthis.onTagAdd && this.onTagAdd(label);\n\t\t}\n\t}\n\n\tremoveTag(label) {\n\t\tlabel = frappe.utils.xss_sanitise(label);\n\t\tif(this.tagsList.includes(label)) {\n\t\t\tthis.tagsList.splice(this.tagsList.indexOf(label), 1);\n\t\t\tthis.onTagRemove && this.onTagRemove(label);\n\t\t}\n\t}\n\n\taddTags(labels) {\n\t\tlabels.map(this.addTag.bind(this));\n\t}\n\n\tclearTags() {\n\t\tthis.$ul.find('.frappe-tag').remove();\n\t\tthis.tagsList = [];\n\t}\n\n\tgetListElement($element, className) {\n\t\tlet $li = $(`<li class=\"tags-list-item ${className}\"></li>`);\n\t\t$element.appendTo($li);\n\t\treturn $li;\n\t}\n\n\tgetTag(label) {\n\t\tlet $tag = $(`<div class=\"frappe-tag btn-group\" data-tag-label=\"${label}\">\n\t\t\t<button class=\"btn btn-default btn-xs toggle-tag\"\n\t\t\t\ttitle=\"${ __(\"toggle Tag\") }\"\n\t\t\t\tdata-tag-label=\"${label}\">#${label}\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-default btn-xs remove-tag\"\n\t\t\t\ttitle=\"${ __(\"Remove Tag\") }\"\n\t\t\t\tdata-tag-label=\"${label}\">\n\t\t\t\t<i class=\"fa fa-remove text-muted\"></i>\n\t\t\t</button></div>`);\n\n\t\tlet $searchTag = $tag.find(\".toggle-tag\");\n\t\tlet $removeTag = $tag.find(\".remove-tag\");\n\n\t\t$searchTag.on(\"click\", () => {\n\t\t\tfrappe.searchdialog.search.init_search(\"#\".concat($searchTag.attr('data-tag-label')), \"tags\");\n\t\t});\n\n\t\t$removeTag.on(\"click\", () => {\n\t\t\tthis.removeTag($removeTag.attr('data-tag-label'));\n\t\t\t$removeTag.closest('.tags-list-item').remove();\n\t\t});\n\n\t\tif(this.onTagClick) {\n\t\t\tlet $toggle_tag = $tag.find(\".toggle-tag\");\n\t\t\t$toggle_tag.on(\"click\", () => {\n\t\t\t\tthis.onTagClick($toggle_tag.attr('data-tag-label'));\n\t\t\t});\n\t\t}\n\n\t\treturn $tag;\n\t}\n}\n","frappe.ui.TagEditor = Class.extend({\n\tinit: function(opts) {\n\t\t/* docs:\n\t\tArguments\n\n\t\t- parent\n\t\t- user_tags\n\t\t- doctype\n\t\t- docname\n\t\t*/\n\t\t$.extend(this, opts);\n\n\t\tthis.setup_tags();\n\n\t\tif (!this.user_tags) {\n\t\t\tthis.user_tags = \"\";\n\t\t}\n\t\tthis.initialized = true;\n\t\tthis.refresh(this.user_tags);\n\t},\n\tsetup_tags: function() {\n\t\tvar me = this;\n\n\t\t// hidden form, does not have parent\n\t\tif (!this.parent) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.wrapper = $('<div class=\"tag-line\" style=\"position: relative\">').appendTo(this.parent);\n\t\tif(!this.wrapper.length) return;\n\n\t\tthis.tags = new frappe.ui.Tags({\n\t\t\tparent: this.wrapper,\n\t\t\tplaceholder: __(\"Add a tag ...\"),\n\t\t\tonTagAdd: (tag) => {\n\t\t\t\tif(me.initialized && !me.refreshing) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"frappe.desk.doctype.tag.tag.add_tag\",\n\t\t\t\t\t\targs: me.get_args(tag),\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tvar user_tags = me.user_tags ? me.user_tags.split(\",\") : [];\n\t\t\t\t\t\t\tuser_tags.push(tag)\n\t\t\t\t\t\t\tme.user_tags = user_tags.join(\",\");\n\t\t\t\t\t\t\tme.on_change && me.on_change(me.user_tags);\n\t\t\t\t\t\t\tfrappe.tags.utils.fetch_tags();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonTagRemove: (tag) => {\n\t\t\t\tif(!me.refreshing) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"frappe.desk.doctype.tag.tag.remove_tag\",\n\t\t\t\t\t\targs: me.get_args(tag),\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tvar user_tags = me.user_tags.split(\",\");\n\t\t\t\t\t\t\tuser_tags.splice(user_tags.indexOf(tag), 1);\n\t\t\t\t\t\t\tme.user_tags = user_tags.join(\",\");\n\t\t\t\t\t\t\tme.on_change && me.on_change(me.user_tags);\n\t\t\t\t\t\t\tfrappe.tags.utils.fetch_tags();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.setup_awesomplete();\n\t\tthis.setup_complete = true;\n\t},\n\tsetup_awesomplete: function() {\n\t\tvar me = this;\n\t\tvar $input = this.wrapper.find(\"input.tags-input\");\n\t\tvar input = $input.get(0);\n\t\tthis.awesomplete = new Awesomplete(input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tlist: []\n\t\t});\n\t\t$input.on(\"awesomplete-open\", function(e){\n\t\t\t$input.attr('state', 'open');\n\t\t});\n\t\t$input.on(\"awesomplete-close\", function(e){\n\t\t\t$input.attr('state', 'closed');\n\t\t});\n\t\t$input.on(\"input\", function(e) {\n\t\t\tvar value = e.target.value;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.doctype.tag.tag.get_tags\",\n\t\t\t\targs:{\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\ttxt: value.toLowerCase(),\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.awesomplete.list = r.message;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t$input.on(\"focus\", function(e) {\n\t\t\tif($input.attr('state') != 'open') {\n\t\t\t\t$input.trigger(\"input\");\n\t\t\t}\n\t\t});\n\t},\n\tget_args: function(tag) {\n\t\treturn {\n\t\t\ttag: tag,\n\t\t\tdt: this.frm.doctype,\n\t\t\tdn: this.frm.docname,\n\t\t}\n\t},\n\trefresh: function(user_tags) {\n\t\tvar me = this;\n\t\tif (!this.initialized || !this.setup_complete || this.refreshing) return;\n\n\t\tme.refreshing = true;\n\t\ttry {\n\t\t\tme.tags.clearTags();\n\t\t\tif(user_tags) {\n\t\t\t\tme.user_tags = user_tags;\n\t\t\t\tme.tags.addTags(user_tags.split(','));\n\t\t\t}\n\t\t} catch(e) {\n\t\t\tme.refreshing = false;\n\t\t\t// wtf bug\n\t\t\tsetTimeout( function() { me.refresh(); }, 100);\n\t\t}\n\t\tme.refreshing = false;\n\n\t}\n})\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.is_liked = function(doc) {\n\tvar liked = frappe.ui.get_liked_by(doc);\n\treturn liked.indexOf(frappe.session.user)===-1 ? false : true;\n}\n\nfrappe.ui.get_liked_by = function(doc) {\n\tvar liked = doc._liked_by;\n\tif(liked) {\n\t\tliked = JSON.parse(liked);\n\t}\n\n\treturn liked || [];\n}\n\nfrappe.ui.toggle_like = function($btn, doctype, name, callback) {\n\tvar add = $btn.hasClass(\"not-liked\") ? \"Yes\" : \"No\";\n\t// disable click\n\t$btn.css('pointer-events', 'none');\n\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.like.toggle_like\",\n\t\tquiet: true,\n\t\targs: {\n\t\t\tdoctype: doctype,\n\t\t\tname: name,\n\t\t\tadd: add,\n\t\t},\n\t\tcallback: function(r) {\n\t\t\t// renable click\n\t\t\t$btn.css('pointer-events', 'auto');\n\n\t\t\tif(!r.exc) {\n\t\t\t\t// update in all local-buttons\n\t\t\t\tvar action_buttons = $('.like-action[data-name=\"'+ name.replace(/\"/g, '\\\"')\n\t\t\t\t\t+'\"][data-doctype=\"'+ doctype.replace(/\"/g, '\\\"')+'\"]');\n\n\t\t\t\tif(add===\"Yes\") {\n\t\t\t\t\taction_buttons.removeClass(\"not-liked text-extra-muted\");\n\t\t\t\t} else {\n\t\t\t\t\taction_buttons.addClass(\"not-liked text-extra-muted\");\n\t\t\t\t}\n\n\t\t\t\t// update in locals (form)\n\t\t\t\tvar doc = locals[doctype] && locals[doctype][name];\n\t\t\t\tif(doc) {\n\t\t\t\t\tvar liked_by = JSON.parse(doc._liked_by || \"[]\"),\n\t\t\t\t\t\tidx = liked_by.indexOf(frappe.session.user);\n\t\t\t\t\tif(add===\"Yes\") {\n\t\t\t\t\t\tif(idx===-1)\n\t\t\t\t\t\t\tliked_by.push(frappe.session.user);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(idx!==-1) {\n\t\t\t\t\t\t\tliked_by = liked_by.slice(0,idx).concat(liked_by.slice(idx+1))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdoc._liked_by = JSON.stringify(liked_by);\n\t\t\t\t}\n\n\t\t\t\tif(callback) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nfrappe.ui.click_toggle_like = function() {\n\tvar $btn = $(this);\n\tvar $count = $btn.siblings(\".likes-count\");\n\tvar not_liked = $btn.hasClass(\"not-liked\");\n\tvar doctype = $btn.attr(\"data-doctype\");\n\tvar name = $btn.attr(\"data-name\");\n\n\tfrappe.ui.toggle_like($btn, doctype, name, function() {\n\t\tif (not_liked) {\n\t\t\t$count.text(cint($count.text()) + 1);\n\t\t} else {\n\t\t\t$count.text(cint($count.text()) - 1);\n\t\t}\n\t});\n\n\treturn false;\n}\n\nfrappe.ui.setup_like_popover = ($parent, selector, check_not_liked=true) => {\n\tif (frappe.dom.is_touchscreen()) {\n\t\treturn;\n\t}\n\n\t$parent.on('mouseover', selector, function() {\n\t\tconst target_element = $(this);\n\t\ttarget_element.popover({\n\t\t\tanimation: true,\n\t\t\tplacement: 'right',\n\t\t\ttrigger: 'manual',\n\t\t\ttemplate:`<div class=\"liked-by-popover popover\">\n\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t<div class=\"popover-content\"></div>\n\t\t\t</div>`,\n\t\t\tcontent: () => {\n\t\t\t\tlet liked_by = target_element.attr('data-liked-by');\n\t\t\t\tliked_by = liked_by ? decodeURI(liked_by) : '[]';\n\t\t\t\tliked_by = JSON.parse(liked_by);\n\n\t\t\t\tconst user = frappe.session.user;\n\t\t\t\t// hack\n\t\t\t\tif (check_not_liked) {\n\t\t\t\t\tif (target_element.find(\".not-liked\").length) {\n\t\t\t\t\t\tif (liked_by.indexOf(user)!==-1) {\n\t\t\t\t\t\t\tliked_by.splice(liked_by.indexOf(user), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (liked_by.indexOf(user)===-1) {\n\t\t\t\t\t\t\tliked_by.push(user);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!liked_by.length) {\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\n\t\t\t\tlet liked_by_list = $(`<ul class=\"list-unstyled\"></ul>`);\n\n\t\t\t\t// to show social profile of the user\n\t\t\t\tlet link_base = '#social/profile/';\n\n\t\t\t\tliked_by.forEach(user => {\n\t\t\t\t\t// append user list item\n\t\t\t\t\tliked_by_list.append(`\n\t\t\t\t\t\t<li data-user=${user}>${frappe.avatar(user)}\n\t\t\t\t\t\t\t<span>${frappe.user.full_name(user)}</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t`);\n\t\t\t\t});\n\n\t\t\t\tliked_by_list.children('li').click(ev => {\n\t\t\t\t\tlet user = ev.currentTarget.dataset.user;\n\t\t\t\t\ttarget_element.popover('hide');\n\t\t\t\t\tfrappe.set_route(link_base + user);\n\t\t\t\t});\n\n\t\t\t\treturn liked_by_list;\n\t\t\t},\n\t\t\thtml: true,\n\t\t\tcontainer: 'body'\n\t\t});\n\n\t\ttarget_element.popover('show');\n\n\t\t$(\".popover\").on(\"mouseleave\", () => {\n\t\t\ttarget_element.popover('hide');\n\t\t});\n\n\t\ttarget_element.on('mouseout', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!$('.popover:hover').length) {\n\t\t\t\t\ttarget_element.popover('hide');\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t});\n\t});\n\n};\n","frappe.provide('frappe.views');\n\nfrappe.views.BaseList = class BaseList {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t}\n\n\tshow() {\n\t\tfrappe.run_serially([\n\t\t\t() => this.init(),\n\t\t\t() => this.before_refresh(),\n\t\t\t() => this.refresh()\n\t\t]);\n\t}\n\n\tinit() {\n\n\t\tif (this.init_promise) return this.init_promise;\n\n\t\tlet tasks = [\n\t\t\tthis.setup_defaults,\n\t\t\tthis.set_stats,\n\t\t\tthis.setup_fields,\n\t\t\t// make view\n\t\t\tthis.setup_page,\n\t\t\tthis.setup_side_bar,\n\t\t\tthis.setup_main_section,\n\t\t\tthis.setup_view,\n\t\t].map(fn => fn.bind(this));\n\n\t\tthis.init_promise = frappe.run_serially(tasks);\n\t\treturn this.init_promise;\n\t}\n\n\tsetup_defaults() {\n\t\tthis.page_name = frappe.get_route_str();\n\t\tthis.page_title = this.page_title || __(this.doctype);\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tthis.settings = frappe.listview_settings[this.doctype] || {};\n\t\tthis.user_settings = frappe.get_user_settings(this.doctype);\n\n\t\tthis.start = 0;\n\t\tthis.page_length = 20;\n\t\tthis.data = [];\n\t\tthis.method = 'frappe.desk.reportview.get';\n\n\t\tthis.can_create = frappe.model.can_create(this.doctype);\n\t\tthis.can_write = frappe.model.can_write(this.doctype);\n\n\t\tthis.fields = [];\n\t\tthis.filters = [];\n\t\tthis.sort_by = 'modified';\n\t\tthis.sort_order = 'desc';\n\n\t\t// Setup buttons\n\t\tthis.primary_action = null;\n\t\tthis.secondary_action = {\n\t\t\tlabel: __('Refresh'),\n\t\t\taction: () => this.refresh()\n\t\t};\n\n\t\tthis.menu_items = [{\n\t\t\tlabel: __('Refresh'),\n\t\t\taction: () => this.refresh(),\n\t\t\tclass: 'visible-xs'\n\t\t}];\n\t}\n\n\tsetup_fields() {\n\t\tthis.set_fields();\n\t\tthis.build_fields();\n\t}\n\n\tset_fields() {\n\t\tlet fields = [].concat(\n\t\t\tfrappe.model.std_fields_list,\n\t\t\tthis.meta.title_field\n\t\t);\n\n\t\tfields.forEach(f => this._add_field(f));\n\t}\n\n\tget_fields_in_list_view() {\n\t\treturn this.meta.fields.filter(df => {\n\t\t\treturn frappe.model.is_value_type(df.fieldtype) && (\n\t\t\t\tdf.in_list_view\n\t\t\t\t&& frappe.perm.has_perm(this.doctype, df.permlevel, 'read')\n\t\t\t) || (\n\t\t\t\tdf.fieldtype === 'Currency'\n\t\t\t\t&& df.options\n\t\t\t\t&& !df.options.includes(':')\n\t\t\t) || (\n\t\t\t\tdf.fieldname === 'status'\n\t\t\t);\n\t\t});\n\t}\n\n\tbuild_fields() {\n\t\t// fill in missing doctype\n\t\tthis.fields = this.fields.map(f => {\n\t\t\tif (typeof f === 'string') {\n\t\t\t\tf = [f, this.doctype];\n\t\t\t}\n\t\t\treturn f;\n\t\t});\n\t\t// remove null or undefined values\n\t\tthis.fields = this.fields.filter(Boolean);\n\t\t//de-duplicate\n\t\tthis.fields = this.fields.uniqBy(f => f[0] + f[1]);\n\t}\n\n\t_add_field(fieldname, doctype) {\n\t\tif (!fieldname) return;\n\n\t\tif (!doctype) doctype = this.doctype;\n\n\t\tif (typeof fieldname === 'object') {\n\t\t\t// df is passed\n\t\t\tconst df = fieldname;\n\t\t\tfieldname = df.fieldname;\n\t\t\tdoctype = df.parent;\n\t\t}\n\n\t\tif (!this.fields) this.fields = [];\n\n\t\tconst is_valid_field = frappe.model.std_fields_list.includes(fieldname)\n\t\t\t|| frappe.meta.has_field(doctype, fieldname)\n\t\t\t|| fieldname === '_seen';\n\n\t\tif (!is_valid_field) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fields.push([fieldname, doctype]);\n\t}\n\n\tset_stats() {\n\t\tthis.stats = ['_user_tags'];\n\t\t// add workflow field (as priority)\n\t\tthis.workflow_state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\t\tif (this.workflow_state_fieldname) {\n\t\t\tif (!frappe.workflow.workflows[this.doctype]['override_status']) {\n\t\t\t\tthis._add_field(this.workflow_state_fieldname);\n\t\t\t}\n\t\t\tthis.stats.push(this.workflow_state_fieldname);\n\t\t}\n\t}\n\n\tsetup_page() {\n\t\tthis.page = this.parent.page;\n\t\tthis.$page = $(this.parent);\n\t\tthis.page.page_form.removeClass('row').addClass('flex');\n\t\tthis.setup_page_head();\n\t}\n\n\tsetup_page_head() {\n\t\tthis.set_title();\n\t\tthis.set_menu_items();\n\t\tthis.set_breadcrumbs();\n\t}\n\n\tset_title() {\n\t\tthis.page.set_title(this.page_title);\n\t}\n\n\tset_menu_items() {\n\t\tconst $secondary_action = this.page.set_secondary_action(\n\t\t\tthis.secondary_action.label,\n\t\t\tthis.secondary_action.action,\n\t\t\tthis.secondary_action.icon\n\t\t);\n\t\tif (!this.secondary_action.icon) {\n\t\t\t$secondary_action.addClass('hidden-xs');\n\t\t} else {\n\t\t\t$secondary_action.addClass('visible-xs');\n\t\t}\n\n\t\tthis.menu_items.map(item => {\n\t\t\tif (item.condition && item.condition() === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst $item = this.page.add_menu_item(item.label, item.action, item.standard, item.shortcut);\n\t\t\tif (item.class) {\n\t\t\t\t$item && $item.addClass(item.class);\n\t\t\t}\n\t\t});\n\t}\n\n\tset_breadcrumbs() {\n\t\tfrappe.breadcrumbs.add(this.meta.module, this.doctype);\n\t}\n\n\tsetup_side_bar() {\n\t\tthis.list_sidebar = new frappe.views.ListSidebar({\n\t\t\tdoctype: this.doctype,\n\t\t\tstats: this.stats,\n\t\t\tparent: this.$page.find('.layout-side-section'),\n\t\t\t// set_filter: this.set_filter.bind(this),\n\t\t\tpage: this.page,\n\t\t\tlist_view: this\n\t\t});\n\t}\n\n\ttoggle_side_bar() {\n\t\tlet show_sidebar = JSON.parse(localStorage.show_sidebar || 'true');\n\t\tshow_sidebar = !show_sidebar;\n\t\tlocalStorage.show_sidebar = show_sidebar;\n\t\tthis.show_or_hide_sidebar();\n\t}\n\n\tshow_or_hide_sidebar() {\n\t\tlet show_sidebar = JSON.parse(localStorage.show_sidebar || 'true');\n\t\t$(document.body).toggleClass('no-list-sidebar', !show_sidebar);\n\t}\n\n\tsetup_main_section() {\n\t\treturn frappe.run_serially([\n\t\t\tthis.setup_list_wrapper,\n\t\t\tthis.show_or_hide_sidebar,\n\t\t\tthis.setup_filter_area,\n\t\t\tthis.setup_sort_selector,\n\t\t\tthis.setup_result_area,\n\t\t\tthis.setup_no_result_area,\n\t\t\tthis.setup_freeze_area,\n\t\t\tthis.setup_paging_area\n\t\t].map(fn => fn.bind(this)));\n\t}\n\n\tsetup_list_wrapper() {\n\t\tthis.$frappe_list = $('<div class=\"frappe-list\">').appendTo(this.page.main);\n\t}\n\n\tsetup_filter_area() {\n\t\tthis.filter_area = new FilterArea(this);\n\n\t\tif (this.filters && this.filters.length > 0) {\n\t\t\treturn this.filter_area.set(this.filters);\n\t\t}\n\t}\n\n\tsetup_sort_selector() {\n\t\tthis.sort_selector = new frappe.ui.SortSelector({\n\t\t\tparent: this.filter_area.$filter_list_wrapper,\n\t\t\tdoctype: this.doctype,\n\t\t\targs: {\n\t\t\t\tsort_by: this.sort_by,\n\t\t\t\tsort_order: this.sort_order\n\t\t\t},\n\t\t\tonchange: this.on_sort_change.bind(this)\n\t\t});\n\t}\n\n\ton_sort_change() {\n\t\tthis.refresh();\n\t}\n\n\tsetup_result_area() {\n\t\tthis.$result = $(`<div class=\"result\">`);\n\t\tthis.$frappe_list.append(this.$result);\n\t}\n\n\tsetup_no_result_area() {\n\t\tthis.$no_result = $(`\n\t\t\t<div class=\"no-result text-muted flex justify-center align-center\">\n\t\t\t\t${this.get_no_result_message()}\n\t\t\t</div>\n\t\t`).hide();\n\t\tthis.$frappe_list.append(this.$no_result);\n\t}\n\n\tsetup_freeze_area() {\n\t\tthis.$freeze = $('<div class=\"freeze\"></div>').hide();\n\t\tthis.$frappe_list.append(this.$freeze);\n\t}\n\n\tget_no_result_message() {\n\t\treturn __('Nothing to show');\n\t}\n\n\tsetup_paging_area() {\n\t\tconst paging_values = [20, 100, 500];\n\t\tthis.$paging_area = $(\n\t\t\t`<div class=\"list-paging-area level\">\n\t\t\t\t<div class=\"level-left\">\n\t\t\t\t\t<div class=\"btn-group\">\n\t\t\t\t\t\t${paging_values.map(value => `\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-default btn-sm btn-paging\"\n\t\t\t\t\t\t\t\tdata-value=\"${value}\">\n\t\t\t\t\t\t\t\t${value}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t`).join('')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-right\">\n\t\t\t\t\t<button class=\"btn btn-default btn-more btn-sm\">\n\t\t\t\t\t\t${__(\"More\")}...\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t).hide();\n\t\tthis.$frappe_list.append(this.$paging_area);\n\n\t\t// set default paging btn active\n\t\tthis.$paging_area\n\t\t\t.find(`.btn-paging[data-value=\"${this.page_length}\"]`)\n\t\t\t.addClass('btn-info');\n\n\t\tthis.$paging_area.on('click', '.btn-paging, .btn-more', e => {\n\t\t\tconst $this = $(e.currentTarget);\n\n\t\t\tif ($this.is('.btn-paging')) {\n\t\t\t\t// set active button\n\t\t\t\tthis.$paging_area.find('.btn-paging').removeClass('btn-info');\n\t\t\t\t$this.addClass('btn-info');\n\n\t\t\t\tthis.start = 0;\n\t\t\t\tthis.page_length = $this.data().value;\n\t\t\t\tthis.refresh();\n\t\t\t} else if ($this.is('.btn-more')) {\n\t\t\t\tthis.start = this.start + this.page_length;\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t});\n\t}\n\n\tget_fields() {\n\t\t// convert [fieldname, Doctype] => tabDoctype.fieldname\n\t\treturn this.fields.map(f => frappe.model.get_full_column_name(f[0], f[1]));\n\t}\n\n\tsetup_view() {\n\t\t// for child classes\n\t}\n\n\tget_filters_for_args() {\n\t\t// filters might have a fifth param called hidden,\n\t\t// we don't want to pass that server side\n\t\treturn this.filter_area\n\t\t\t? this.filter_area.get().map(filter => filter.slice(0, 4))\n\t\t\t: [];\n\t}\n\n\tget_args() {\n\t\treturn {\n\t\t\tdoctype: this.doctype,\n\t\t\tfields: this.get_fields(),\n\t\t\tfilters: this.get_filters_for_args(),\n\t\t\torder_by: this.sort_selector.get_sql_string(),\n\t\t\tstart: this.start,\n\t\t\tpage_length: this.page_length,\n\t\t\tview: this.view\n\t\t};\n\t}\n\n\tget_call_args() {\n\t\tconst args = this.get_args();\n\t\treturn {\n\t\t\tmethod: this.method,\n\t\t\targs: args,\n\t\t\tfreeze: this.freeze_on_refresh || false,\n\t\t\tfreeze_message: this.freeze_message || (__('Loading') + '...')\n\t\t};\n\t}\n\n\tbefore_refresh() {\n\t\t// modify args here just before making the request\n\t\t// see list_view.js\n\t}\n\n\trefresh() {\n\t\tthis.freeze(true);\n\t\t// fetch data from server\n\t\treturn frappe.call(this.get_call_args()).then(r => {\n\t\t\t// render\n\t\t\tthis.prepare_data(r);\n\t\t\tthis.toggle_result_area();\n\t\t\tthis.before_render();\n\t\t\tthis.render();\n\t\t\tthis.after_render();\n\t\t\tthis.freeze(false);\n\t\t\tif (this.settings.refresh) {\n\t\t\t\tthis.settings.refresh(this);\n\t\t\t}\n\t\t});\n\t}\n\n\tprepare_data(r) {\n\t\tlet data = r.message || {};\n\t\tdata = !Array.isArray(data) ? frappe.utils.dict(data.keys, data.values) : data;\n\n\t\tif (this.start === 0) {\n\t\t\tthis.data = data;\n\t\t} else {\n\t\t\tthis.data = this.data.concat(data);\n\t\t}\n\n\t\tthis.data = this.data.uniqBy(d => d.name);\n\t}\n\n\tfreeze() {\n\t\t// show a freeze message while data is loading\n\t}\n\n\tbefore_render() {\n\n\t}\n\n\tafter_render() {\n\n\t}\n\n\trender() {\n\t\t// for child classes\n\t}\n\n\ton_filter_change() {\n\t\t// fired when filters are added or removed\n\t}\n\n\ttoggle_result_area() {\n\t\tthis.$result.toggle(this.data.length > 0);\n\t\tthis.$paging_area.toggle(this.data.length > 0);\n\t\tthis.$no_result.toggle(this.data.length == 0);\n\n\t\tconst show_more = (this.start + this.page_length) <= this.data.length;\n\t\tthis.$paging_area.find('.btn-more')\n\t\t\t.toggle(show_more);\n\t}\n\n\tcall_for_selected_items(method, args = {}) {\n\t\targs.names = this.get_checked_items(true);\n\n\t\tfrappe.call({\n\t\t\tmethod: method,\n\t\t\targs: args,\n\t\t\tfreeze: true,\n\t\t\tcallback: r => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\nclass FilterArea {\n\tconstructor(list_view) {\n\t\tthis.list_view = list_view;\n\t\tthis.standard_filters_wrapper = this.list_view.page.page_form;\n\t\tthis.$filter_list_wrapper = $('<div class=\"filter-list\">').appendTo(this.list_view.$frappe_list);\n\t\tthis.trigger_refresh = true;\n\t\tthis.setup();\n\t}\n\n\tsetup() {\n\t\tthis.make_standard_filters();\n\t\tthis.make_filter_list();\n\t}\n\n\tget() {\n\t\tlet filters = this.filter_list.get_filters();\n\t\tlet standard_filters = this.get_standard_filters();\n\n\t\treturn filters\n\t\t\t.concat(standard_filters)\n\t\t\t.uniqBy(JSON.stringify);\n\t}\n\n\tset(filters) {\n\t\t// use to method to set filters without triggering refresh\n\t\tthis.trigger_refresh = false;\n\t\treturn this.add(filters, false)\n\t\t\t.then(() => {\n\t\t\t\tthis.trigger_refresh = true;\n\t\t\t});\n\t}\n\n\tadd(filters, refresh = true) {\n\t\tif (!filters || Array.isArray(filters) && filters.length === 0)\n\t\t\treturn Promise.resolve();\n\n\t\tif (typeof filters[0] === 'string') {\n\t\t\t// passed in the format of doctype, field, condition, value\n\t\t\tconst filter = Array.from(arguments);\n\t\t\tfilters = [filter];\n\t\t}\n\n\t\tfilters = filters.filter(f => {\n\t\t\treturn !this.exists(f);\n\t\t});\n\n\t\tconst { non_standard_filters, promise } = this.set_standard_filter(filters);\n\n\t\treturn promise\n\t\t\t.then(() => {\n\t\t\t\treturn non_standard_filters.length > 0 &&\n\t\t\t\t\tthis.filter_list.add_filters(non_standard_filters);\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\trefresh && this.list_view.refresh();\n\t\t\t});\n\t}\n\n\trefresh_list_view() {\n\t\tif (this.trigger_refresh) {\n\t\t\tthis.list_view.start = 0;\n\t\t\tthis.list_view.refresh();\n\t\t\tthis.list_view.on_filter_change();\n\t\t}\n\t}\n\n\texists(f) {\n\t\tlet exists = false;\n\t\t// check in standard filters\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tif (f[2] === '=' && f[1] in fields_dict) {\n\t\t\tconst value = fields_dict[f[1]].get_value();\n\t\t\tif (value) {\n\t\t\t\texists = true;\n\t\t\t}\n\t\t}\n\n\t\t// check in filter area\n\t\tif (!exists) {\n\t\t\texists = this.filter_list.filter_exists(f);\n\t\t}\n\n\t\treturn exists;\n\t}\n\n\tset_standard_filter(filters) {\n\t\tif (filters.length === 0) {\n\t\t\treturn {\n\t\t\t\tnon_standard_filters: [],\n\t\t\t\tpromise: Promise.resolve()\n\t\t\t};\n\t\t}\n\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\n\t\tlet out = filters.reduce((out, filter) => {\n\t\t\t// eslint-disable-next-line\n\t\t\tconst [dt, fieldname, condition, value] = filter;\n\t\t\tout.promise = out.promise || Promise.resolve();\n\t\t\tout.non_standard_filters = out.non_standard_filters || [];\n\n\t\t\tif (fields_dict[fieldname] && (condition === '=' || condition === \"like\")) {\n\t\t\t\t// standard filter\n\t\t\t\tout.promise = out.promise.then(\n\t\t\t\t\t() => fields_dict[fieldname].set_value(value)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// filter out non standard filters\n\t\t\t\tout.non_standard_filters.push(filter);\n\t\t\t}\n\t\t\treturn out;\n\t\t}, {});\n\n\t\treturn out;\n\t}\n\n\tremove(fieldname) {\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\n\t\tif (fieldname in fields_dict) {\n\t\t\treturn fields_dict[fieldname].set_value('');\n\t\t}\n\n\t\tlet filter = this.filter_list.get_filter(fieldname);\n\t\tif (filter) filter.remove();\n\t\treturn Promise.resolve();\n\t}\n\n\tclear(refresh = true) {\n\t\tif (!refresh) {\n\t\t\tthis.trigger_refresh = false;\n\t\t}\n\n\t\tthis.filter_list.clear_filters();\n\n\t\tconst promises = [];\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tfor (let key in fields_dict) {\n\t\t\tconst field = this.list_view.page.fields_dict[key];\n\t\t\tpromises.push(() => field.set_value(''));\n\t\t}\n\t\treturn frappe.run_serially(promises)\n\t\t\t.then(() => {\n\t\t\t\tthis.trigger_refresh = true;\n\t\t\t});\n\t}\n\n\tmake_standard_filters() {\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: 'Name',\n\t\t\t\tcondition: 'like',\n\t\t\t\tfieldname: 'name',\n\t\t\t\tonchange: () => this.refresh_list_view()\n\t\t\t}\n\t\t];\n\n\t\tif(this.list_view.custom_filter_configs) {\n\t\t\tthis.list_view.custom_filter_configs.forEach(config => {\n\t\t\t\tconfig.onchange = () => this.refresh_list_view();\n\t\t\t});\n\n\t\t\tfields = fields.concat(this.list_view.custom_filter_configs);\n\t\t}\n\n\t\tconst doctype_fields = this.list_view.meta.fields;\n\t\tconst title_field = this.list_view.meta.title_field;\n\n\t\tfields = fields.concat(doctype_fields.filter(\n\t\t\tdf => (df.fieldname === title_field) || (df.in_standard_filter && frappe.model.is_value_type(df.fieldtype))\n\t\t).map(df => {\n\t\t\tlet options = df.options;\n\t\t\tlet condition = '=';\n\t\t\tlet fieldtype = df.fieldtype;\n\t\t\tif (['Text', 'Small Text', 'Text Editor', 'HTML Editor', 'Data', 'Code', 'Read Only'].includes(fieldtype)) {\n\t\t\t\tfieldtype = 'Data';\n\t\t\t\tcondition = 'like';\n\t\t\t}\n\t\t\tif (df.fieldtype == \"Select\" && df.options) {\n\t\t\t\toptions = df.options.split(\"\\n\");\n\t\t\t\tif (options.length > 0 && options[0] != \"\") {\n\t\t\t\t\toptions.unshift(\"\");\n\t\t\t\t\toptions = options.join(\"\\n\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet default_value = (fieldtype === 'Link') ? frappe.defaults.get_user_default(options) : null;\n\t\t\tif (['__default', '__global'].includes(default_value)) {\n\t\t\t\tdefault_value = null;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tfieldtype: fieldtype,\n\t\t\t\tlabel: __(df.label),\n\t\t\t\toptions: options,\n\t\t\t\tfieldname: df.fieldname,\n\t\t\t\tcondition: condition,\n\t\t\t\tdefault: default_value,\n\t\t\t\tonchange: () => this.refresh_list_view(),\n\t\t\t\tignore_link_validation: fieldtype === 'Dynamic Link',\n\t\t\t\tis_filter: 1,\n\t\t\t};\n\t\t}));\n\n\t\tfields.map(df => this.list_view.page.add_field(df));\n\t}\n\n\tget_standard_filters() {\n\t\tconst filters = [];\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tfor (let key in fields_dict) {\n\t\t\tlet field = fields_dict[key];\n\t\t\tlet value = field.get_value();\n\t\t\tif (value) {\n\t\t\t\tif (field.df.condition === 'like' && !value.includes('%')) {\n\t\t\t\t\tvalue = '%' + value + '%';\n\t\t\t\t}\n\t\t\t\tfilters.push([\n\t\t\t\t\tthis.list_view.doctype,\n\t\t\t\t\tfield.df.fieldname,\n\t\t\t\t\tfield.df.condition || '=',\n\t\t\t\t\tvalue\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tmake_filter_list() {\n\t\tthis.filter_list = new frappe.ui.FilterGroup({\n\t\t\tbase_list: this.list_view,\n\t\t\tparent: this.$filter_list_wrapper,\n\t\t\tdoctype: this.list_view.doctype,\n\t\t\tdefault_filters: [],\n\t\t\ton_change: () => this.refresh_list_view()\n\t\t});\n\t}\n\n\tis_being_edited() {\n\t\t// returns true if user is currently editing filters\n\t\treturn this.filter_list &&\n\t\t\tthis.filter_list.wrapper.find('.filter-box:visible').length > 0;\n\t}\n}\n\n// utility function to validate view modes\nfrappe.views.view_modes = ['List', 'Gantt', 'Kanban', 'Calendar', 'Image', 'Inbox', 'Report'];\nfrappe.views.is_valid = view_mode => frappe.views.view_modes.includes(view_mode);\n","export default class BulkOperations {\n\tconstructor({ doctype }) {\n\t\tif (!doctype) frappe.throw(__('Doctype required'));\n\t\tthis.doctype = doctype;\n\t}\n\n\tprint(docs) {\n\t\tconst print_settings = frappe.model.get_doc(':Print Settings', 'Print Settings');\n\t\tconst allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tconst is_submittable = frappe.model.is_submittable(this.doctype);\n\t\tconst allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\tconst valid_docs = docs.filter(doc => {\n\t\t\treturn !is_submittable || doc.docstatus === 1 ||\n\t\t\t\t(allow_print_for_cancelled && doc.docstatus == 2) ||\n\t\t\t\t(allow_print_for_draft && doc.docstatus == 0) ||\n\t\t\t\tfrappe.user.has_role('Administrator');\n\t\t}).map(doc => doc.name);\n\n\t\tconst invalid_docs = docs.filter(doc => !valid_docs.includes(doc.name));\n\n\t\tif (invalid_docs.length > 0) {\n\t\t\tfrappe.msgprint(__('You selected Draft or Cancelled documents'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (valid_docs.length > 0) {\n\t\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('Print Documents'),\n\t\t\t\tfields: [{\n\t\t\t\t\t'fieldtype': 'Check',\n\t\t\t\t\t'label': __('With Letterhead'),\n\t\t\t\t\t'fieldname': 'with_letterhead'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Select',\n\t\t\t\t\t'label': __('Print Format'),\n\t\t\t\t\t'fieldname': 'print_sel',\n\t\t\t\t\toptions: frappe.meta.get_print_formats(this.doctype)\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\tdialog.set_primary_action(__('Print'), args => {\n\t\t\t\tif (!args) return;\n\t\t\t\tconst default_print_format = frappe.get_meta(this.doctype).default_print_format;\n\t\t\t\tconst with_letterhead = args.with_letterhead ? 1 : 0;\n\t\t\t\tconst print_format = args.print_sel ? args.print_sel : default_print_format;\n\t\t\t\tconst json_string = JSON.stringify(valid_docs);\n\n\t\t\t\tconst w = window.open('/api/method/frappe.utils.print_format.download_multi_pdf?' +\n\t\t\t\t\t'doctype=' + encodeURIComponent(this.doctype) +\n\t\t\t\t\t'&name=' + encodeURIComponent(json_string) +\n\t\t\t\t\t'&format=' + encodeURIComponent(print_format) +\n\t\t\t\t\t'&no_letterhead=' + (with_letterhead ? '0' : '1'));\n\t\t\t\tif (!w) {\n\t\t\t\t\tfrappe.msgprint(__('Please enable pop-ups'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdialog.show();\n\t\t} else {\n\t\t\tfrappe.msgprint(__('Select atleast 1 record for printing'));\n\t\t}\n\t}\n\n\tdelete(docnames, done = null) {\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: 'frappe.desk.reportview.delete_items',\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\titems: docnames,\n\t\t\t\t\tdoctype: this.doctype\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tlet failed = r.message;\n\t\t\t\tif (!failed) failed = [];\n\n\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\tfrappe.throw(__('Cannot delete {0}', [failed.map(f => f.bold()).join(', ')]));\n\t\t\t\t}\n\t\t\t\tif (failed.length < docnames.length) {\n\t\t\t\t\tfrappe.utils.play_sound('delete');\n\t\t\t\t\tif (done) done();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tassign(docnames, done) {\n\t\tif (docnames.length > 0) {\n\t\t\tconst assign_to = new frappe.ui.form.AssignToDialog({\n\t\t\t\tobj: this,\n\t\t\t\tmethod: 'frappe.desk.form.assign_to.add_multiple',\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tdocname: docnames,\n\t\t\t\tbulk_assign: true,\n\t\t\t\tre_assign: true,\n\t\t\t\tcallback: done\n\t\t\t});\n\t\t\tassign_to.dialog.clear();\n\t\t\tassign_to.dialog.show();\n\t\t} else {\n\t\t\tfrappe.msgprint(__('Select records for assignment'));\n\t\t}\n\t}\n\n\tapply_assignment_rule(docnames, done) {\n\t\tif (docnames.length > 0) {\n\t\t\tfrappe.call('frappe.automation.doctype.assignment_rule.assignment_rule.bulk_apply', {\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tdocnames: docnames\n\t\t\t}).then(() => done());\n\t\t}\n\t}\n\n\tsubmit_or_cancel(docnames, action='submit', done=null) {\n\t\taction = action.toLowerCase();\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: 'frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs',\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\taction: action,\n\t\t\t\t\tdocnames: docnames\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tlet failed = r.message;\n\t\t\t\tif (!failed) failed = [];\n\n\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\tfrappe.throw(__('Cannot {0} {1}', [action, failed.map(f => f.bold()).join(', ')]));\n\t\t\t\t}\n\t\t\t\tif (failed.length < docnames.length) {\n\t\t\t\t\tfrappe.utils.play_sound(action);\n\t\t\t\t\tif (done) done();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tedit(docnames, field_mappings, done) {\n\t\tlet field_options = Object.keys(field_mappings).sort();\n\t\tconst status_regex = /status/i;\n\n\t\tconst default_field = field_options.find(value => status_regex.test(value));\n\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Edit'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Select',\n\t\t\t\t\t'options': field_options,\n\t\t\t\t\t'default': default_field,\n\t\t\t\t\t'label': __('Field'),\n\t\t\t\t\t'fieldname': 'field',\n\t\t\t\t\t'reqd': 1,\n\t\t\t\t\t'onchange': () => {\n\t\t\t\t\t\tset_value_field(dialog);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t\t'label': __('Value'),\n\t\t\t\t\t'fieldname': 'value',\n\t\t\t\t\t'reqd': 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: ({ value }) => {\n\t\t\t\tconst fieldname = field_mappings[dialog.get_value('field')].fieldname;\n\t\t\t\tdialog.disable_primary_action();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tdocnames: docnames,\n\t\t\t\t\t\taction: 'update',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t[fieldname]: value\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(r => {\n\t\t\t\t\tlet failed = r.message || [];\n\n\t\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\t\tdialog.enable_primary_action();\n\t\t\t\t\t\tfrappe.throw(__('Cannot update {0}', [failed.map(f => f.bold ? f.bold() : f).join(', ')]));\n\t\t\t\t\t}\n\t\t\t\t\tdone();\n\t\t\t\t\tdialog.hide();\n\t\t\t\t\tfrappe.show_alert(__('Updated successfully'));\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Update')\n\t\t});\n\n\t\tif (default_field) set_value_field(dialog); // to set `Value` df based on default `Field`\n\n\t\tfunction set_value_field(dialogObj) {\n\t\t\tconst new_df = Object.assign({},\n\t\t\t\tfield_mappings[dialogObj.get_value('field')]);\n\t\t\t/* if the field label has status in it and\n\t\t\tif it has select fieldtype with no default value then\n\t\t\tset a default value from the available option. */\n\t\t\tif(new_df.label.match(status_regex) &&\n\t\t\t\tnew_df.fieldtype === 'Select' && !new_df.default) {\n\t\t\t\tlet options = [];\n\t\t\t\tif(typeof new_df.options===\"string\") {\n\t\t\t\t\toptions = new_df.options.split(\"\\n\");\n\t\t\t\t}\n\t\t\t\t//set second option as default if first option is an empty string\n\t\t\t\tnew_df.default = options[0] || options[1];\n\t\t\t}\n\t\t\tnew_df.label = __('Value');\n\t\t\tnew_df.reqd = 1;\n\t\t\tdelete new_df.depends_on;\n\t\t\tdialogObj.replace_field('value', new_df);\n\t\t}\n\n\t\tdialog.refresh();\n\t\tdialog.show();\n\t}\n}\n","import BulkOperations from \"./bulk_operations\";\n\nfrappe.provide('frappe.views');\n\nfrappe.views.ListView = class ListView extends frappe.views.BaseList {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tconst doctype = route[1];\n\n\t\tif (route.length === 2) {\n\t\t\t// List/{doctype} => List/{doctype}/{last_view} or List\n\t\t\tconst user_settings = frappe.get_user_settings(doctype);\n\t\t\tconst last_view = user_settings.last_view;\n\t\t\tfrappe.set_route('List', doctype, frappe.views.is_valid(last_view) ? last_view : 'List');\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tconstructor(opts) {\n\t\tsuper(opts);\n\t\tthis.show();\n\t}\n\n\thas_permissions() {\n\t\tconst can_read = frappe.perm.has_perm(this.doctype, 0, 'read');\n\t\treturn can_read;\n\t}\n\n\tshow() {\n\t\tthis.parent.disable_scroll_to_top = true;\n\n\t\tif (!this.has_permissions()) {\n\t\t\tfrappe.set_route('');\n\t\t\tfrappe.msgprint(__(`Not permitted to view ${this.doctype}`));\n\t\t\treturn;\n\t\t}\n\n\t\tsuper.show();\n\t}\n\n\tget view_name() {\n\t\treturn 'List';\n\t}\n\n\tget view_user_settings() {\n\t\treturn this.user_settings[this.view_name] || {};\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\n\t\tthis.view = 'List';\n\t\t// initialize with saved order by\n\t\tthis.sort_by = this.view_user_settings.sort_by || 'modified';\n\t\tthis.sort_order = this.view_user_settings.sort_order || 'desc';\n\n\t\t// set filters from user_settings or list_settings\n\t\tif (this.view_user_settings.filters && this.view_user_settings.filters.length) {\n\t\t\t// Priority 1: user_settings\n\t\t\tconst saved_filters = this.view_user_settings.filters;\n\t\t\tthis.filters = this.validate_filters(saved_filters);\n\t\t} else {\n\t\t\t// Priority 2: filters in listview_settings\n\t\t\tthis.filters = (this.settings.filters || []).map(f => {\n\t\t\t\tif (f.length === 3) {\n\t\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t\t}\n\t\t\t\treturn f;\n\t\t\t});\n\t\t}\n\n\t\t// build menu items\n\t\tthis.menu_items = this.menu_items.concat(this.get_menu_items());\n\n\t\tif (this.view_user_settings.filters && this.view_user_settings.filters.length) {\n\t\t\t// Priority 1: saved filters\n\t\t\tconst saved_filters = this.view_user_settings.filters;\n\t\t\tthis.filters = this.validate_filters(saved_filters);\n\t\t} else {\n\t\t\t// Priority 2: filters in listview_settings\n\t\t\tthis.filters = (this.settings.filters || []).map(f => {\n\t\t\t\tif (f.length === 3) {\n\t\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t\t}\n\t\t\t\treturn f;\n\t\t\t});\n\t\t}\n\n\t\tthis.patch_refresh_and_load_lib();\n\t\treturn this.get_list_view_settings();\n\t}\n\n\tget_list_view_settings() {\n\t\treturn frappe.call(\"frappe.desk.listview.get_list_settings\", {doctype: this.doctype})\n\t\t\t.then(doc => this.list_view_settings = doc.message || {});\n\t}\n\n\ton_sort_change(sort_by, sort_order) {\n\t\tthis.sort_by = sort_by;\n\t\tthis.sort_order = sort_order;\n\t\tsuper.on_sort_change();\n\t}\n\n\tvalidate_filters(filters) {\n\t\tconst valid_fields = this.meta.fields.map(df => df.fieldname);\n\t\treturn filters\n\t\t\t.filter(f => valid_fields.includes(f[1]))\n\t\t\t.uniqBy(f => f[1]);\n\t}\n\n\tsetup_page() {\n\t\tthis.parent.list_view = this;\n\t\tsuper.setup_page();\n\t}\n\n\tsetup_page_head() {\n\t\tsuper.setup_page_head();\n\t\tthis.set_primary_action();\n\t\tthis.set_actions_menu_items();\n\t}\n\n\tset_actions_menu_items() {\n\t\tthis.actions_menu_items = this.get_actions_menu_items();\n\t\tthis.workflow_action_menu_items = this.get_workflow_action_menu_items();\n\t\tthis.workflow_action_items = {};\n\n\t\tconst actions = this.actions_menu_items.concat(this.workflow_action_menu_items);\n\t\tactions.map(item => {\n\t\t\tconst $item = this.page.add_actions_menu_item(item.label, item.action, item.standard);\n\t\t\tif (item.class) {\n\t\t\t\t$item.addClass(item.class);\n\t\t\t}\n\t\t\tif (item.is_workflow_action && $item) {\n\t\t\t\t// can be used to dynamically show or hide action\n\t\t\t\tthis.workflow_action_items[item.name] = $item;\n\t\t\t}\n\t\t});\n\t}\n\n\tshow_restricted_list_indicator_if_applicable() {\n\t\tconst match_rules_list = frappe.perm.get_match_rules(this.doctype);\n\t\tif (match_rules_list.length) {\n\t\t\tthis.restricted_list = $(`<button class=\"restricted-list form-group\">${__('Restricted')}</button>`)\n\t\t\t\t.prepend('<span class=\"octicon octicon-lock\"></span>')\n\t\t\t\t.click(() => this.show_restrictions(match_rules_list))\n\t\t\t\t.appendTo(this.page.page_form);\n\t\t}\n\t}\n\n\tshow_restrictions(match_rules_list=[]) {\n\t\tfrappe.msgprint(frappe.render_template('list_view_permission_restrictions', {\n\t\t\tcondition_list: match_rules_list\n\t\t}), __('Restrictions'));\n\t}\n\n\tset_fields() {\n\t\tlet fields = [].concat(\n\t\t\tfrappe.model.std_fields_list,\n\t\t\tthis.get_fields_in_list_view(),\n\t\t\t[this.meta.title_field, this.meta.image_field],\n\t\t\t(this.settings.add_fields || []),\n\t\t\tthis.meta.track_seen ? '_seen' : null,\n\t\t\tthis.sort_by,\n\t\t\t'enabled',\n\t\t\t'disabled',\n\t\t\t'color'\n\t\t);\n\n\t\tfields.forEach(f => this._add_field(f));\n\n\t\tthis.fields.forEach(f => {\n\t\t\tconst df = frappe.meta.get_docfield(f[1], f[0]);\n\t\t\tif (df && df.fieldtype === 'Currency' && df.options && !df.options.includes(':')) {\n\t\t\t\tthis._add_field(df.options);\n\t\t\t}\n\t\t});\n\t}\n\n\tpatch_refresh_and_load_lib() {\n\t\t// throttle refresh for 1s\n\t\tthis.refresh = this.refresh.bind(this);\n\t\tthis.refresh = frappe.utils.throttle(this.refresh, 1000);\n\t\tthis.load_lib = new Promise(resolve => {\n\t\t\tif (this.required_libs) {\n\t\t\t\tfrappe.require(this.required_libs, resolve);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t\t// call refresh every 5 minutes\n\t\tconst interval = 5 * 60 * 1000;\n\t\tsetInterval(() => {\n\t\t\t// don't call if route is different\n\t\t\tif (frappe.get_route_str() === this.page_name) {\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t}, interval);\n\t}\n\n\tset_primary_action() {\n\t\tif (this.can_create) {\n\t\t\tthis.page.set_primary_action(__('New'), () => {\n\t\t\t\tif (this.settings.primary_action) {\n\t\t\t\t\tthis.settings.primary_action();\n\t\t\t\t} else {\n\t\t\t\t\tthis.make_new_doc();\n\t\t\t\t}\n\t\t\t}, 'octicon octicon-plus');\n\t\t} else {\n\t\t\tthis.page.clear_primary_action();\n\t\t}\n\t}\n\n\tmake_new_doc() {\n\t\tconst doctype = this.doctype;\n\t\tconst options = {};\n\t\tthis.filter_area.get().forEach(f => {\n\t\t\tif (f[2] === \"=\" && frappe.model.is_non_std_field(f[1])) {\n\t\t\t\toptions[f[1]] = f[3];\n\t\t\t}\n\t\t});\n\t\tfrappe.new_doc(doctype, options);\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_columns();\n\t\tthis.render_header();\n\t\tthis.render_skeleton();\n\t\tthis.setup_events();\n\t\tthis.settings.onload && this.settings.onload(this);\n\t\tthis.show_restricted_list_indicator_if_applicable();\n\n\t}\n\n\tsetup_freeze_area() {\n\t\tthis.$freeze =\n\t\t\t$(`<div class=\"freeze flex justify-center align-center text-muted\">${__('Loading')}...</div>`)\n\t\t\t\t.hide();\n\t\tthis.$result.append(this.$freeze);\n\t}\n\n\tsetup_columns() {\n\t\t// setup columns for list view\n\t\tthis.columns = [];\n\n\t\tconst get_df = frappe.meta.get_docfield.bind(null, this.doctype);\n\n\t\t// 1st column: title_field or name\n\t\tif (this.meta.title_field) {\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Subject',\n\t\t\t\tdf: get_df(this.meta.title_field)\n\t\t\t});\n\t\t} else {\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Subject',\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Name'),\n\t\t\t\t\tfieldname: 'name'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// 2nd column: Status indicator\n\t\tif (frappe.has_indicator(this.doctype)) {\n\t\t\t// indicator\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Status'\n\t\t\t});\n\t\t}\n\n\t\tconst fields_in_list_view = this.get_fields_in_list_view();\n\t\t// Add rest from in_list_view docfields\n\t\tthis.columns = this.columns.concat(\n\t\t\tfields_in_list_view\n\t\t\t\t.filter(df => {\n\t\t\t\t\tif (frappe.has_indicator(this.doctype) && df.fieldname === 'status') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (!df.in_list_view) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn df.fieldname !== this.meta.title_field;\n\t\t\t\t})\n\t\t\t\t.map(df => ({\n\t\t\t\t\ttype: 'Field',\n\t\t\t\t\tdf\n\t\t\t\t}))\n\t\t);\n\n\t\t// limit max to 8 columns\n\t\t// Screen with low density no of columns 4\n\t\t// Screen with medium density no of columns 6\n\t\t// Screen with high density no of columns 8\n\t\tlet column_count = 6;\n\n\t\tif (window.innerWidth <= 1200) {\n\t\t\tcolumn_count = 4;\n\t\t} else if (window.innerWidth > 1440) {\n\t\t\tcolumn_count = 8;\n\t\t}\n\n\t\tthis.columns = this.columns.slice(0, column_count);\n\t}\n\n\tget_no_result_message() {\n\t\tconst new_button = this.can_create ?\n\t\t\t`<p><button class=\"btn btn-primary btn-sm btn-new-doc\">\n\t\t\t\t${__('Create a new {0}', [__(this.doctype)])}\n\t\t\t</button></p>` : '';\n\n\t\treturn `<div class=\"msg-box no-border\">\n\t\t\t<p>${__('No {0} found', [__(this.doctype)])}</p>\n\t\t\t${new_button}\n\t\t</div>`;\n\t}\n\n\tfreeze() {\n\t\tif (this.list_view_settings && !this.list_view_settings.disable_count) {\n\t\t\tthis.$result.find('.list-count').html(`<span>${__('Refreshing')}...</span>`);\n\t\t}\n\t}\n\n\tget_args() {\n\t\tconst args = super.get_args();\n\n\t\treturn Object.assign(args, {\n\t\t\twith_comment_count: true\n\t\t});\n\t}\n\n\tbefore_refresh() {\n\t\tif (frappe.route_options) {\n\t\t\tthis.filters = this.parse_filters_from_route_options();\n\t\t\tfrappe.route_options = null;\n\n\t\t\tif (this.filters.length > 0) {\n\t\t\t\treturn this.filter_area.clear(false)\n\t\t\t\t\t.then(() => this.filter_area.set(this.filters));\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tparse_filters_from_settings() {\n\t\treturn (this.settings.filters || []).map(f => {\n\t\t\tif (f.length === 3) {\n\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t}\n\t\t\treturn f;\n\t\t});\n\t}\n\n\ttoggle_result_area() {\n\t\tsuper.toggle_result_area();\n\t\tthis.toggle_actions_menu_button(\n\t\t\tthis.$result.find('.list-row-check:checked').length > 0\n\t\t);\n\t}\n\n\ttoggle_actions_menu_button(toggle) {\n\t\tif (toggle) {\n\t\t\tthis.page.show_actions_menu();\n\t\t\tthis.page.clear_primary_action();\n\t\t\tthis.toggle_workflow_actions();\n\t\t} else {\n\t\t\tthis.page.hide_actions_menu();\n\t\t\tthis.set_primary_action();\n\t\t}\n\t}\n\n\trender_header() {\n\t\tif (this.$result.find('.list-row-head').length === 0) {\n\t\t\t// append header once\n\t\t\tthis.$result.prepend(this.get_header_html());\n\t\t}\n\t}\n\n\trender_skeleton() {\n\t\tconst $row = this.get_list_row_html_skeleton('<div><input type=\"checkbox\" /></div>');\n\t\tthis.$result.append($row);\n\t}\n\n\tbefore_render() {\n\t\tthis.settings.before_render && this.settings.before_render();\n\t\tfrappe.model.user_settings.save(this.doctype, 'last_view', this.view_name);\n\t\tthis.save_view_user_settings({\n\t\t\tfilters: this.filter_area.get(),\n\t\t\tsort_by: this.sort_selector.sort_by,\n\t\t\tsort_order: this.sort_selector.sort_order\n\t\t});\n\t}\n\n\tafter_render() {\n\t\tthis.list_sidebar.reload_stats();\n\t}\n\n\trender() {\n\t\tthis.render_list();\n\t\tthis.on_row_checked();\n\t\tthis.render_count();\n\t\tthis.render_tags();\n\t}\n\n\trender_list() {\n\t\t// clear rows\n\t\tthis.$result.find('.list-row-container').remove();\n\t\tif (this.data.length > 0) {\n\t\t\t// append rows\n\t\t\tthis.$result.append(\n\t\t\t\tthis.data.map((doc, i) => {\n\t\t\t\t\tdoc._idx = i;\n\t\t\t\t\treturn this.get_list_row_html(doc);\n\t\t\t\t}).join('')\n\t\t\t);\n\t\t}\n\t}\n\n\trender_count() {\n\t\tif (!this.list_view_settings.disable_count) {\n\t\t\tthis.get_count_str().then(str => {\n\t\t\t\tthis.$result.find('.list-count').html(`<span>${str}</span>`);\n\t\t\t});\n\t\t}\n\t}\n\n\trender_tags() {\n\t\tconst $list_rows = this.$result.find('.list-row-container');\n\n\t\tthis.data.forEach((d, i) => {\n\t\t\tlet tag_html = $(`<div class='tag-row'>\n\t\t\t\t<div class='list-tag hidden-xs'></div>\n\t\t\t</div>`).appendTo($list_rows.get(i));\n\n\t\t\t// add tags\n\t\t\tlet tag_editor = new frappe.ui.TagEditor({\n\t\t\t\tparent: tag_html.find('.list-tag'),\n\t\t\t\tfrm: {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\tdocname: d.name\n\t\t\t\t},\n\t\t\t\tlist_sidebar: this.list_sidebar,\n\t\t\t\tuser_tags: d._user_tags,\n\t\t\t\ton_change: (user_tags) => {\n\t\t\t\t\td._user_tags = user_tags;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttag_editor.wrapper.on('click', '.tagit-label', (e) => {\n\t\t\t\tconst $this = $(e.currentTarget);\n\t\t\t\tthis.filter_area.add(this.doctype, '_user_tags', '=', $this.text());\n\t\t\t});\n\t\t});\n\t}\n\n\tget_header_html() {\n\t\tconst subject_field = this.columns[0].df;\n\t\tlet subject_html = `\n\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t<span class=\"level-item list-liked-by-me\">\n\t\t\t\t<i class=\"octicon octicon-heart text-extra-muted\" title=\"${__(\"Likes\")}\"></i>\n\t\t\t</span>\n\t\t\t<span class=\"level-item\">${__(subject_field.label)}</span>\n\t\t`;\n\t\tconst $columns = this.columns.map(col => {\n\t\t\tlet classes = [\n\t\t\t\t'list-row-col ellipsis',\n\t\t\t\tcol.type == 'Subject' ? 'list-subject level' : 'hidden-xs',\n\t\t\t\tfrappe.model.is_numeric_field(col.df) ? 'text-right' : ''\n\t\t\t].join(' ');\n\n\t\t\treturn `\n\t\t\t\t<div class=\"${classes}\">\n\t\t\t\t\t${col.type === 'Subject' ? subject_html : `\n\t\t\t\t\t<span>${__(col.df && col.df.label || col.type)}</span>`}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}).join('');\n\n\t\treturn this.get_header_html_skeleton($columns, '<span class=\"list-count\"></span>');\n\t}\n\n\tget_header_html_skeleton(left = '', right = '') {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div class=\"level-left list-header-subject\">\n\t\t\t\t\t${left}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-left checkbox-actions\">\n\t\t\t\t\t<div class=\"level list-subject\">\n\t\t\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t\t\t\t<span class=\"level-item list-header-meta\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-right\">\n\t\t\t\t\t${right}\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tget_left_html(doc) {\n\t\treturn this.columns.map(col => this.get_column_html(col, doc)).join('');\n\t}\n\n\tget_right_html(doc) {\n\t\treturn this.get_meta_html(doc);\n\t}\n\n\tget_list_row_html(doc) {\n\t\treturn this.get_list_row_html_skeleton(this.get_left_html(doc),\n\t\t\tthis.get_right_html(doc));\n\t}\n\n\tget_list_row_html_skeleton(left = '', right = '') {\n\t\treturn `\n\t\t\t<div class=\"list-row-container\" tabindex=\"1\">\n\t\t\t\t<div class=\"level list-row small\">\n\t\t\t\t\t<div class=\"level-left ellipsis\">\n\t\t\t\t\t\t${left}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"level-right text-muted ellipsis\">\n\t\t\t\t\t\t${right}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_column_html(col, doc) {\n\t\tif (col.type === 'Status') {\n\t\t\treturn `\n\t\t\t\t<div class=\"list-row-col hidden-xs ellipsis\">\n\t\t\t\t\t${this.get_indicator_html(doc)}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst df = col.df || {};\n\t\tconst label = df.label;\n\t\tconst fieldname = df.fieldname;\n\t\tconst value = doc[fieldname] || '';\n\n\t\tconst format = () => {\n\t\t\tif (df.fieldtype === 'Code') {\n\t\t\t\treturn value;\n\t\t\t} else if (df.fieldtype === 'Percent') {\n\t\t\t\treturn `<div class=\"progress level\" style=\"margin: 0px;\">\n\t\t\t\t\t\t<div class=\"progress-bar progress-bar-success\" role=\"progressbar\"\n\t\t\t\t\t\t\taria-valuenow=\"${value}\"\n\t\t\t\t\t\t\taria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: ${Math.round(value)}%;\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn frappe.format(value, df, null, doc);\n\t\t\t}\n\t\t};\n\n\t\tconst field_html = () => {\n\t\t\tlet html;\n\t\t\tlet _value;\n\t\t\t// listview_setting formatter\n\t\t\tif (this.settings.formatters && this.settings.formatters[fieldname]) {\n\t\t\t\t_value = this.settings.formatters[fieldname](value, df, doc);\n\t\t\t} else {\n\t\t\t\tlet strip_html_required = df.fieldtype == 'Text Editor'\n\t\t\t\t\t|| (df.fetch_from && ['Text', 'Small Text'].includes(df.fieldtype));\n\t\t\t\tif (strip_html_required) {\n\t\t\t\t\t_value = strip_html(value);\n\t\t\t\t} else {\n\t\t\t\t\t_value = typeof value === 'string' ? frappe.utils.escape_html(value) : value;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (df.fieldtype === 'Image') {\n\t\t\t\thtml = df.options ?\n\t\t\t\t\t`<img src=\"${doc[df.options]}\" style=\"max-height: 30px; max-width: 100%;\">` :\n\t\t\t\t\t`<div class=\"missing-image small\">\n\t\t\t\t\t\t<span class=\"octicon octicon-circle-slash\"></span>\n\t\t\t\t\t</div>`;\n\t\t\t} else if (df.fieldtype === 'Select') {\n\t\t\t\thtml = `<span class=\"filterable indicator ${frappe.utils.guess_colour(_value)} ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${__(_value)}\n\t\t\t\t</span>`;\n\t\t\t} else if (df.fieldtype === 'Link') {\n\t\t\t\thtml = `<a class=\"filterable text-muted ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${_value}\n\t\t\t\t</a>`;\n\t\t\t} else if (['Text Editor', 'Text', 'Small Text', 'HTML Editor'].includes(df.fieldtype)) {\n\t\t\t\thtml = `<span class=\"text-muted ellipsis\">\n\t\t\t\t\t${_value}\n\t\t\t\t</span>`;\n\t\t\t} else {\n\t\t\t\thtml = `<a class=\"filterable text-muted ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${format()}\n\t\t\t\t</a>`;\n\t\t\t}\n\n\t\t\treturn `<span class=\"ellipsis\"\n\t\t\t\ttitle=\"${__(label)}: ${escape(_value)}\">\n\t\t\t\t${html}\n\t\t\t</span>`;\n\t\t};\n\n\t\tconst class_map = {\n\t\t\tSubject: 'list-subject level',\n\t\t\tField: 'hidden-xs'\n\t\t};\n\t\tconst css_class = [\n\t\t\t'list-row-col ellipsis',\n\t\t\tclass_map[col.type],\n\t\t\tfrappe.model.is_numeric_field(df) ? 'text-right' : ''\n\t\t].join(' ');\n\n\t\tconst html_map = {\n\t\t\tSubject: this.get_subject_html(doc),\n\t\t\tField: field_html()\n\t\t};\n\t\tconst column_html = html_map[col.type];\n\n\t\treturn `\n\t\t\t<div class=\"${css_class}\">\n\t\t\t\t${column_html}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_meta_html(doc) {\n\t\tlet html = '';\n\t\tif (!this.settings.hide_name_column && doc[this.meta.title_field || ''] !== doc.name) {\n\t\t\thtml += `\n\t\t\t\t<div class=\"level-item hidden-xs hidden-sm ellipsis\">\n\t\t\t\t\t<a class=\"text-muted ellipsis\" href=\"${this.get_form_link(doc)}\">\n\t\t\t\t\t\t${doc.name}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.settings.button && this.settings.button.show(doc)) {\n\t\t\thtml += `\n\t\t\t\t<div class=\"level-item hidden-xs\">\n\t\t\t\t\t<button class=\"btn btn-action btn-default btn-xs\"\n\t\t\t\t\t\tdata-name=\"${doc.name}\" data-idx=\"${doc._idx}\"\n\t\t\t\t\t\ttitle=\"${this.settings.button.get_description(doc)}\">\n\t\t\t\t\t\t${this.settings.button.get_label(doc)}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst modified = comment_when(doc.modified, true);\n\n\t\tconst last_assignee = JSON.parse(doc._assign || '[]').slice(-1)[0];\n\t\tconst assigned_to = last_assignee ?\n\t\t\t`<span class=\"filterable\"\n\t\t\t\tdata-filter=\"_assign,like,%${last_assignee}%\">\n\t\t\t\t${frappe.avatar(last_assignee)}\n\t\t\t</span>` :\n\t\t\t`<span class=\"avatar avatar-small avatar-empty\"></span>`;\n\n\t\tconst comment_count =\n\t\t\t`<span class=\"${!doc._comment_count ? 'text-extra-muted' : ''} comment-count\">\n\t\t\t\t<i class=\"octicon octicon-comment-discussion\"></i>\n\t\t\t\t${doc._comment_count > 99 ? \"99+\" : doc._comment_count}\n\t\t\t</span>`;\n\n\t\thtml += `\n\t\t\t<div class=\"level-item hidden-xs list-row-activity\">\n\t\t\t\t${modified}\n\t\t\t\t${assigned_to}\n\t\t\t\t${comment_count}\n\t\t\t</div>\n\t\t\t<div class=\"level-item visible-xs text-right\">\n\t\t\t\t${this.get_indicator_dot(doc)}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn html;\n\t}\n\n\tget_count_str() {\n\t\tlet current_count = this.data.length;\n\t\tlet count_without_children = this.data.uniqBy(d => d.name).length;\n\n\t\treturn frappe.db.count(this.doctype, {\n\t\t\tfilters: this.get_filters_for_args()\n\t\t}).then(total_count => {\n\t\t\tthis.total_count = total_count || current_count;\n\t\t\tlet str = __('{0} of {1}', [current_count, this.total_count]);\n\t\t\tif (count_without_children !== current_count) {\n\t\t\t\tstr = __('{0} of {1} ({2} rows with children)', [count_without_children, this.total_count, current_count]);\n\t\t\t}\n\t\t\treturn str;\n\t\t});\n\t}\n\n\tget_form_link(doc) {\n\t\tif (this.settings.get_form_link) {\n\t\t\treturn this.settings.get_form_link(doc);\n\t\t}\n\t\tconst docname = doc.name.match(/[%'\"\\s]/)\n\t\t\t? encodeURIComponent(doc.name)\n\t\t\t: doc.name;\n\n\t\treturn '#Form/' + this.doctype + '/' + docname;\n\t}\n\n\tget_seen_class(doc) {\n\t\treturn JSON.parse(doc._seen || '[]').includes(frappe.session.user)\n\t\t\t? ''\n\t\t\t: 'bold';\n\t}\n\n\tget_subject_html(doc) {\n\t\tlet user = frappe.session.user;\n\t\tlet subject_field = this.columns[0].df;\n\t\tlet value = doc[subject_field.fieldname] || doc.name;\n\t\tlet subject = strip_html(value.toString());\n\t\tlet escaped_subject = frappe.utils.escape_html(subject);\n\n\t\tconst liked_by = JSON.parse(doc._liked_by || '[]');\n\t\tlet heart_class = liked_by.includes(user) ?\n\t\t\t'liked-by' : 'text-extra-muted not-liked';\n\n\t\tconst seen = this.get_seen_class(doc);\n\n\t\tlet subject_html = `\n\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${escape(doc.name)}\">\n\t\t\t<span class=\"level-item\" style=\"margin-bottom: 1px;\">\n\t\t\t\t<i class=\"octicon octicon-heart like-action ${heart_class}\"\n\t\t\t\t\tdata-name=\"${doc.name}\" data-doctype=\"${this.doctype}\"\n\t\t\t\t\tdata-liked-by=\"${encodeURI(doc._liked_by) || '[]'}\"\n\t\t\t\t>\n\t\t\t\t</i>\n\t\t\t\t<span class=\"likes-count\">\n\t\t\t\t\t${ liked_by.length > 99 ? __(\"99\") + '+' : __(liked_by.length || '')}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span class=\"level-item ${seen} ellipsis\" title=\"${escaped_subject}\">\n\t\t\t\t<a class=\"ellipsis\" href=\"${this.get_form_link(doc)}\" title=\"${escaped_subject}\" data-doctype=\"${this.doctype}\" data-name=\"${doc.name}\">\n\t\t\t\t${subject}\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t`;\n\n\t\treturn subject_html;\n\t}\n\n\tget_indicator_html(doc) {\n\t\tconst indicator = frappe.get_indicator(doc, this.doctype);\n\t\tif (indicator) {\n\t\t\treturn `<span class=\"indicator ${indicator[1]} filterable\"\n\t\t\t\tdata-filter='${indicator[2]}'>\n\t\t\t\t${__(indicator[0])}\n\t\t\t<span>`;\n\t\t}\n\t\treturn '';\n\t}\n\n\tget_indicator_dot(doc) {\n\t\tconst indicator = frappe.get_indicator(doc, this.doctype);\n\t\tif (!indicator) return '';\n\t\treturn `<span class='indicator ${indicator[1]}' title='${__(indicator[0])}'></span>`;\n\t}\n\n\tsetup_events() {\n\t\tthis.setup_filterable();\n\t\tthis.setup_list_click();\n\t\tthis.setup_tag_event();\n\t\tthis.setup_new_doc_event();\n\t\tthis.setup_check_events();\n\t\tthis.setup_like();\n\t\tthis.setup_realtime_updates();\n\t\tthis.setup_action_handler();\n\t\tthis.setup_keyboard_navigation();\n\t}\n\n\tsetup_keyboard_navigation() {\n\t\tlet focus_first_row = () => {\n\t\t\tthis.$result.find('.list-row-container:first').focus();\n\t\t};\n\t\tlet focus_next = () => {\n\t\t\t$(document.activeElement).next().focus();\n\t\t};\n\t\tlet focus_prev = () => {\n\t\t\t$(document.activeElement).prev().focus();\n\t\t};\n\t\tlet list_row_focused = () => {\n\t\t\treturn $(document.activeElement).is('.list-row-container');\n\t\t};\n\t\tlet check_row = ($row) => {\n\t\t\tlet $input = $row.find('input[type=checkbox]');\n\t\t\t$input.click();\n\t\t};\n\t\tlet get_list_row_if_focused = () =>\n\t\t\tlist_row_focused() ? $(document.activeElement) : null;\n\n\t\tlet is_current_page = () => this.page.wrapper.is(':visible');\n\t\tlet is_input_focused = () => $(document.activeElement).is('input');\n\n\t\tlet handle_navigation = (direction) => {\n\t\t\tif (!is_current_page() || is_input_focused()) return false;\n\n\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\tif ($list_row) {\n\t\t\t\tdirection === 'down' ? focus_next() : focus_prev();\n\t\t\t} else {\n\t\t\t\tfocus_first_row();\n\t\t\t}\n\t\t};\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'down',\n\t\t\taction: () => handle_navigation('down'),\n\t\t\tdescription: __('Navigate list down'),\n\t\t\tpage: this.page\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'up',\n\t\t\taction: () => handle_navigation('up'),\n\t\t\tdescription: __('Navigate list up'),\n\t\t\tpage: this.page\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'shift+down',\n\t\t\taction: () => {\n\t\t\t\tif (!is_current_page() || is_input_focused()) return false;\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tcheck_row($list_row);\n\t\t\t\tfocus_next();\n\t\t\t},\n\t\t\tdescription: __('Select multiple list items'),\n\t\t\tpage: this.page\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'shift+up',\n\t\t\taction: () => {\n\t\t\t\tif (!is_current_page() || is_input_focused()) return false;\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tcheck_row($list_row);\n\t\t\t\tfocus_prev();\n\t\t\t},\n\t\t\tdescription: __('Select multiple list items'),\n\t\t\tpage: this.page\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'enter',\n\t\t\taction: () => {\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tif ($list_row) {\n\t\t\t\t\t$list_row.find('a[data-name]')[0].click();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tdescription: __('Open list item'),\n\t\t\tpage: this.page\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'space',\n\t\t\taction: () => {\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tif ($list_row) {\n\t\t\t\t\tcheck_row($list_row);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tdescription: __('Select list item'),\n\t\t\tpage: this.page\n\t\t});\n\t}\n\n\tsetup_filterable() {\n\t\t// filterable events\n\t\tthis.$result.on('click', '.filterable', e => {\n\t\t\tif (e.metaKey || e.ctrlKey) return;\n\t\t\te.stopPropagation();\n\t\t\tconst $this = $(e.currentTarget);\n\t\t\tconst filters = $this.attr('data-filter').split('|');\n\n\t\t\tconst filters_to_apply = filters.map(f => {\n\t\t\t\tf = f.split(',');\n\t\t\t\tif (f[2] === 'Today') {\n\t\t\t\t\tf[2] = frappe.datetime.get_today();\n\t\t\t\t} else if (f[2] == 'User') {\n\t\t\t\t\tf[2] = frappe.session.user;\n\t\t\t\t}\n\t\t\t\treturn [this.doctype, f[0], f[1], f.slice(2).join(',')];\n\t\t\t});\n\t\t\tthis.filter_area.add(filters_to_apply);\n\t\t});\n\t}\n\n\tsetup_list_click() {\n\t\tthis.$result.on('click', '.list-row, .image-view-header', (e) => {\n\t\t\tconst $target = $(e.target);\n\t\t\t// tick checkbox if Ctrl/Meta key is pressed\n\t\t\tif (e.ctrlKey || e.metaKey && !$target.is('a')) {\n\t\t\t\tconst $list_row = $(e.currentTarget);\n\t\t\t\tconst $check = $list_row.find('.list-row-checkbox');\n\t\t\t\t$check.prop('checked', !$check.prop('checked'));\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.on_row_checked();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// don't open form when checkbox, like, filterable are clicked\n\t\t\tif ($target.hasClass('filterable') ||\n\t\t\t\t$target.hasClass('octicon-heart') ||\n\t\t\t\t$target.is(':checkbox') ||\n\t\t\t\t$target.is('a')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// open form\n\t\t\tconst $row = $(e.currentTarget);\n\t\t\tconst link = $row.find('.list-subject a').get(0);\n\t\t\tif (link) {\n\t\t\t\twindow.location.href = link.href;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_action_handler() {\n\t\tthis.$result.on('click', '.btn-action', (e) => {\n\t\t\tconst $button = $(e.currentTarget);\n\t\t\tconst doc = this.data[$button.attr('data-idx')];\n\t\t\tthis.settings.button.action(doc);\n\t\t\te.stopPropagation();\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tsetup_check_events() {\n\t\tthis.$result.on('change', 'input[type=checkbox]', e => {\n\t\t\tconst $target = $(e.currentTarget);\n\n\t\t\tif ($target.is('.list-header-subject .list-check-all')) {\n\t\t\t\tconst $check = this.$result.find('.checkbox-actions .list-check-all');\n\t\t\t\t$check.prop('checked', $target.prop('checked'));\n\t\t\t\t$check.trigger('change');\n\t\t\t} else if ($target.is('.checkbox-actions .list-check-all')) {\n\t\t\t\tconst $check = this.$result.find('.list-header-subject .list-check-all');\n\t\t\t\t$check.prop('checked', $target.prop('checked'));\n\n\t\t\t\tthis.$result.find('.list-row-checkbox')\n\t\t\t\t\t.prop('checked', $target.prop('checked'));\n\t\t\t}\n\n\t\t\tthis.on_row_checked();\n\t\t});\n\n\t\tthis.$result.on('click', '.list-row-checkbox', e => {\n\t\t\tconst $target = $(e.currentTarget);\n\n\t\t\t// shift select checkboxes\n\t\t\tif (e.shiftKey && this.$checkbox_cursor && !$target.is(this.$checkbox_cursor)) {\n\t\t\t\tconst name_1 = this.$checkbox_cursor.data().name;\n\t\t\t\tconst name_2 = $target.data().name;\n\t\t\t\tconst index_1 = this.data.findIndex(d => d.name === name_1);\n\t\t\t\tconst index_2 = this.data.findIndex(d => d.name === name_2);\n\t\t\t\tlet [min_index, max_index] = [index_1, index_2];\n\n\t\t\t\tif (min_index > max_index) {\n\t\t\t\t\t[min_index, max_index] = [max_index, min_index];\n\t\t\t\t}\n\n\t\t\t\tlet docnames = this.data.slice(min_index + 1, max_index).map(d => d.name);\n\t\t\t\tconst selector = docnames.map(name => `.list-row-checkbox[data-name=\"${name}\"]`).join(',');\n\t\t\t\tthis.$result.find(selector).prop('checked', true);\n\t\t\t}\n\n\t\t\tthis.$checkbox_cursor = $target;\n\t\t});\n\t}\n\n\tsetup_like() {\n\t\tthis.$result.on('click', '.like-action', frappe.ui.click_toggle_like);\n\t\tthis.$result.on('click', '.list-liked-by-me', e => {\n\t\t\tconst $this = $(e.currentTarget);\n\t\t\t$this.toggleClass('active');\n\n\t\t\tif ($this.hasClass('active')) {\n\t\t\t\tthis.filter_area.add(this.doctype, '_liked_by', 'like', '%' + frappe.session.user + '%');\n\t\t\t} else {\n\t\t\t\tthis.filter_area.remove('_liked_by');\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.setup_like_popover(this.$result, '.liked-by');\n\t}\n\n\tsetup_new_doc_event() {\n\t\tthis.$no_result.find('.btn-new-doc').click(() => {\n\t\t\tif (this.settings.primary_action) {\n\t\t\t\tthis.settings.primary_action();\n\t\t\t} else {\n\t\t\t\tthis.make_new_doc();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_tag_event() {\n\t\tthis.list_sidebar.parent.on('click', '.list-tag-preview', () => {\n\t\t\tthis.toggle_tags();\n\t\t});\n\t}\n\n\tsetup_realtime_updates() {\n\t\tif (this.list_view_settings && this.list_view_settings.disable_auto_refresh) {\n\t\t\treturn;\n\t\t}\n\t\tfrappe.realtime.on('list_update', data => {\n\t\t\tif (this.filter_area.is_being_edited()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { doctype, name } = data;\n\t\t\tif (doctype !== this.doctype) return;\n\n\t\t\t// filters to get only the doc with this name\n\t\t\tconst call_args = this.get_call_args();\n\t\t\tcall_args.args.filters.push([this.doctype, 'name', '=', name]);\n\t\t\tcall_args.args.start = 0;\n\n\t\t\tfrappe.call(call_args)\n\t\t\t\t.then(({ message }) => {\n\t\t\t\t\tif (!message) return;\n\t\t\t\t\tconst data = frappe.utils.dict(message.keys, message.values);\n\t\t\t\t\tif (!(data && data.length)) {\n\t\t\t\t\t\t// this doc was changed and should not be visible\n\t\t\t\t\t\t// in the listview according to filters applied\n\t\t\t\t\t\t// let's remove it manually\n\t\t\t\t\t\tthis.data = this.data.filter(d => d.name !== name);\n\t\t\t\t\t\tthis.render_list();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst datum = data[0];\n\t\t\t\t\tconst index = this.data.findIndex(d => d.name === datum.name);\n\n\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\t// append new data\n\t\t\t\t\t\tthis.data.push(datum);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// update this data in place\n\t\t\t\t\t\tthis.data[index] = datum;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.data.sort((a, b) => {\n\t\t\t\t\t\tconst a_value = a[this.sort_by] || '';\n\t\t\t\t\t\tconst b_value = b[this.sort_by] || '';\n\n\t\t\t\t\t\tlet return_value = 0;\n\t\t\t\t\t\tif (a_value > b_value) {\n\t\t\t\t\t\t\treturn_value = 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (b_value > a_value) {\n\t\t\t\t\t\t\treturn_value = -1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.sort_order === 'desc') {\n\t\t\t\t\t\t\treturn_value = -return_value;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn return_value;\n\t\t\t\t\t});\n\t\t\t\t\tthis.toggle_result_area();\n\t\t\t\t\tthis.render_list();\n\t\t\t\t\tif (this.$checks && this.$checks.length) {\n\t\t\t\t\t\tthis.set_rows_as_checked();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t}\n\n\tset_rows_as_checked() {\n\t\t$.each(this.$checks, (i, el) => {\n\t\t\tlet docname = $(el).attr('data-name');\n\t\t\tthis.$result.find(`.list-row-checkbox[data-name='${docname}']`).prop('checked', true);\n\t\t});\n\t\tthis.on_row_checked();\n\t}\n\n\ton_row_checked() {\n\t\tthis.$list_head_subject = this.$list_head_subject || this.$result.find('header .list-header-subject');\n\t\tthis.$checkbox_actions = this.$checkbox_actions || this.$result.find('header .checkbox-actions');\n\n\t\tthis.$checks = this.$result.find('.list-row-checkbox:checked');\n\n\t\tthis.$list_head_subject.toggle(this.$checks.length === 0);\n\t\tthis.$checkbox_actions.toggle(this.$checks.length > 0);\n\n\t\tif (this.$checks.length === 0) {\n\t\t\tthis.$list_head_subject.find('.list-check-all').prop('checked', false);\n\t\t} else {\n\t\t\tthis.$checkbox_actions.find('.list-header-meta').html(\n\t\t\t\t__('{0} items selected', [this.$checks.length])\n\t\t\t);\n\t\t\tthis.$checkbox_actions.show();\n\t\t\tthis.$list_head_subject.hide();\n\t\t}\n\t\tthis.toggle_actions_menu_button(this.$checks.length > 0);\n\t}\n\n\ttoggle_tags() {\n\t\tthis.$result.toggleClass('tags-shown');\n\t}\n\n\tget_checked_items(only_docnames) {\n\t\tconst docnames = Array.from(this.$checks || [])\n\t\t\t.map(check => cstr(unescape($(check).data().name)));\n\n\t\tif (only_docnames) return docnames;\n\n\t\treturn this.data.filter(d => docnames.includes(d.name));\n\t}\n\n\tsave_view_user_settings(obj) {\n\t\treturn frappe.model.user_settings.save(this.doctype, this.view_name, obj);\n\t}\n\n\ton_update() {\n\n\t}\n\n\tget_share_url() {\n\t\tconst query_params = this.get_filters_for_args().map(filter => {\n\t\t\tfilter[3] = encodeURIComponent(filter[3]);\n\t\t\tif (filter[2] === '=') {\n\t\t\t\treturn `${filter[1]}=${filter[3]}`;\n\t\t\t}\n\t\t\treturn [filter[1], '=', JSON.stringify([filter[2], filter[3]])].join('');\n\t\t}).join('&');\n\n\t\tlet full_url = window.location.href;\n\t\tif (query_params) {\n\t\t\tfull_url += '?' + query_params;\n\t\t}\n\t\treturn full_url;\n\t}\n\n\tshare_url() {\n\t\tconst d = new frappe.ui.Dialog({\n\t\t\ttitle: __('Share URL'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Code',\n\t\t\t\t\tfieldname: 'url',\n\t\t\t\t\tlabel: 'URL',\n\t\t\t\t\tdefault: this.get_share_url(),\n\t\t\t\t\tread_only: 1\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t\td.show();\n\t}\n\n\tget_menu_items() {\n\t\tconst doctype = this.doctype;\n\t\tconst items = [];\n\n\t\tif (frappe.model.can_import(doctype)) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('Import'),\n\t\t\t\taction: () => frappe.set_route('List', 'Data Import', {\n\t\t\t\t\treference_doctype: doctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.model.can_set_user_permissions(doctype)) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('User Permissions'),\n\t\t\t\taction: () => frappe.set_route('List', 'User Permission', {\n\t\t\t\t\tallow: doctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.user_roles.includes('System Manager')) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('Role Permissions Manager'),\n\t\t\t\taction: () => frappe.set_route('permission-manager', {\n\t\t\t\t\tdoctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\n\t\t\titems.push({\n\t\t\t\tlabel: __('Customize'),\n\t\t\t\taction: () => {\n\t\t\t\t\tif (!this.meta) return;\n\t\t\t\t\tif (this.meta.custom) {\n\t\t\t\t\t\tfrappe.set_route('Form', 'DocType', doctype);\n\t\t\t\t\t} else if (!this.meta.custom) {\n\t\t\t\t\t\tfrappe.set_route('Form', 'Customize Form', {\n\t\t\t\t\t\t\tdoc_type: doctype\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true,\n\t\t\t\tshortcut: 'Ctrl+J',\n\t\t\t});\n\t\t}\n\n\t\titems.push({\n\t\t\tlabel: __('Toggle Sidebar'),\n\t\t\taction: () => this.toggle_side_bar(),\n\t\t\tstandard: true,\n\t\t\tshortcut: 'Ctrl+K',\n\t\t});\n\n\t\titems.push({\n\t\t\tlabel: __('Share URL'),\n\t\t\taction: () => this.share_url(),\n\t\t\tstandard: true,\n\t\t\tshortcut: 'Ctrl+L',\n\t\t});\n\n\t\tif (frappe.user.has_role('System Manager') && frappe.boot.developer_mode === 1) {\n\t\t\t// edit doctype\n\t\t\titems.push({\n\t\t\t\tlabel: __('Edit DocType'),\n\t\t\t\taction: () => frappe.set_route('Form', 'DocType', doctype),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.user.has_role('System Manager')) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('Settings'),\n\t\t\t\taction: () => this.show_list_settings(),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\t\treturn items;\n\t}\n\n\tshow_list_settings() {\n\t\tfrappe.model.with_doctype(\"List View Setting\", () => {\n\t\t\tlet d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Settings\"),\n\t\t\t\tfields: frappe.get_meta(\"List View Setting\").fields\n\t\t\t});\n\t\t\td.set_values(this.list_view_settings);\n\t\t\td.show();\n\t\t\td.set_primary_action(__('Save'), () => {\n\t\t\t\tlet values = d.get_values();\n\t\t\t\tfrappe.call(\"frappe.desk.listview.set_list_settings\", {doctype: this.doctype, values: values});\n\t\t\t\tObject.assign(this.list_view_settings, values);\n\t\t\t\td.hide();\n\t\t\t});\n\t\t});\n\t}\n\n\tget_workflow_action_menu_items() {\n\t\tconst workflow_actions = [];\n\t\tif (frappe.model.has_workflow(this.doctype)) {\n\t\t\tconst actions = frappe.workflow.get_all_transition_actions(this.doctype);\n\t\t\tactions.forEach(action => {\n\t\t\t\tworkflow_actions.push({\n\t\t\t\t\tlabel: __(action),\n\t\t\t\t\tname: action,\n\t\t\t\t\taction: () => {\n\t\t\t\t\t\tfrappe.xcall('frappe.model.workflow.bulk_workflow_approval', {\n\t\t\t\t\t\t\tdocnames: this.get_checked_items(true),\n\t\t\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\t\t\taction: action\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tis_workflow_action: true\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn workflow_actions;\n\t}\n\n\ttoggle_workflow_actions() {\n\t\tif (!frappe.model.has_workflow(this.doctype)) return;\n\t\tconst checked_items = this.get_checked_items();\n\t\tfrappe.xcall('frappe.model.workflow.get_common_transition_actions', {\n\t\t\tdocs: checked_items,\n\t\t\tdoctype: this.doctype\n\t\t}).then(actions => {\n\t\t\tObject.keys(this.workflow_action_items).forEach((key) => {\n\t\t\t\tthis.workflow_action_items[key].toggle(actions.includes(key));\n\t\t\t});\n\t\t});\n\t}\n\n\tget_actions_menu_items() {\n\t\tconst doctype = this.doctype;\n\t\tconst actions_menu_items = [];\n\t\tconst bulk_operations = new BulkOperations({ doctype: this.doctype });\n\n\t\tconst is_field_editable = (field_doc) => {\n\t\t\treturn field_doc.fieldname && frappe.model.is_value_type(field_doc)\n\t\t\t\t&& field_doc.fieldtype !== 'Read Only' && !field_doc.hidden && !field_doc.read_only;\n\t\t};\n\n\t\tconst has_editable_fields = (doctype) => {\n\t\t\treturn frappe.meta.get_docfields(doctype).some(field_doc => is_field_editable(field_doc));\n\t\t};\n\n\t\tconst has_submit_permission = (doctype) => {\n\t\t\treturn frappe.perm.has_perm(doctype, 0, 'submit');\n\t\t};\n\n\t\t// utility\n\t\tconst bulk_assignment = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Assign To'),\n\t\t\t\taction: () => bulk_operations.assign(this.get_checked_items(true), this.refresh),\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_assignment_rule = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Apply Assignment Rule'),\n\t\t\t\taction: () => bulk_operations.apply_assignment_rule(this.get_checked_items(true), this.refresh),\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_printing = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: () => bulk_operations.print(this.get_checked_items()),\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_delete = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Delete'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true).map(docname => docname.toString());\n\t\t\t\t\tfrappe.confirm(__('Delete {0} items permanently?', [docnames.length]),\n\t\t\t\t\t\t() => bulk_operations.delete(docnames, this.refresh));\n\t\t\t\t},\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_cancel = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Cancel'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\t\t\t\t\tif (docnames.length > 0) {\n\t\t\t\t\t\tfrappe.confirm(__('Cancel {0} documents?', [docnames.length]),\n\t\t\t\t\t\t\t() => bulk_operations.submit_or_cancel(docnames, 'cancel', this.refresh));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_submit = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Submit'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\t\t\t\t\tif (docnames.length > 0) {\n\t\t\t\t\t\tfrappe.confirm(__('Submit {0} documents?', [docnames.length]),\n\t\t\t\t\t\t\t() => bulk_operations.submit_or_cancel(docnames, 'submit', this.refresh));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_edit = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Edit'),\n\t\t\t\taction: () => {\n\t\t\t\t\tlet field_mappings = {};\n\n\t\t\t\t\tfrappe.meta.get_docfields(doctype).forEach(field_doc => {\n\t\t\t\t\t\tif (is_field_editable(field_doc)) {\n\t\t\t\t\t\t\tfield_mappings[field_doc.label] = Object.assign({}, field_doc);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\n\t\t\t\t\tbulk_operations.edit(docnames, field_mappings, this.refresh);\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\t// bulk edit\n\t\tif (has_editable_fields(doctype)) {\n\t\t\tactions_menu_items.push(bulk_edit());\n\t\t}\n\n\t\t// bulk assignment\n\t\tactions_menu_items.push(bulk_assignment());\n\n\t\tactions_menu_items.push(bulk_assignment_rule());\n\n\t\t// bulk printing\n\t\tif (frappe.model.can_print(doctype)) {\n\t\t\tactions_menu_items.push(bulk_printing());\n\t\t}\n\n\t\t// bulk submit\n\t\tif (frappe.model.is_submittable(doctype) && has_submit_permission(doctype) && !(frappe.model.has_workflow(doctype))) {\n\t\t\tactions_menu_items.push(bulk_submit());\n\t\t}\n\n\t\t// bulk cancel\n\t\tif (frappe.model.can_cancel(doctype) && !(frappe.model.has_workflow(doctype))) {\n\t\t\tactions_menu_items.push(bulk_cancel());\n\t\t}\n\n\t\t// bulk delete\n\t\tif (frappe.model.can_delete(doctype)) {\n\t\t\tactions_menu_items.push(bulk_delete());\n\t\t}\n\n\t\treturn actions_menu_items;\n\t}\n\n\tparse_filters_from_route_options() {\n\t\tconst filters = [];\n\n\t\tfor (let field in frappe.route_options) {\n\n\t\t\tlet doctype = null;\n\t\t\tlet value = frappe.route_options[field];\n\n\t\t\tlet value_array;\n\t\t\tif ($.isArray(value) && value[0].startsWith('[') && value[0].endsWith(']')) {\n\t\t\t\tvalue_array = [];\n\t\t\t\tfor(var i=0; i<value.length; i++) {\n\t\t\t\t\tvalue_array.push(JSON.parse(value[i]));\n\t\t\t\t}\n\t\t\t} else if (typeof value === 'string' && value.startsWith('[') && value.endsWith(']')) {\n\t\t\t\tvalue = JSON.parse(value);\n\t\t\t}\n\n\t\t\t// if `Child DocType.fieldname`\n\t\t\tif (field.includes('.')) {\n\t\t\t\tdoctype = field.split('.')[0];\n\t\t\t\tfield = field.split('.')[1];\n\t\t\t}\n\n\t\t\t// find the table in which the key exists\n\t\t\t// for example the filter could be {\"item_code\": \"X\"}\n\t\t\t// where item_code is in the child table.\n\n\t\t\t// we can search all tables for mapping the doctype\n\t\t\tif (!doctype) {\n\t\t\t\tdoctype = frappe.meta.get_doctype_for_field(this.doctype, field);\n\t\t\t}\n\n\t\t\tif (doctype) {\n\t\t\t\tif (value_array) {\n\t\t\t\t\tfor(var j=0; j<value_array.length; j++){\n\t\t\t\t\t\tif ($.isArray(value_array[j])) {\n\t\t\t\t\t\t\tfilters.push([doctype, field, value_array[j][0], value_array[j][1]]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfilters.push([doctype, field, \"=\", value_array[j]]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if ($.isArray(value)) {\n\t\t\t\t\tfilters.push([doctype, field, value[0], value[1]]);\n\t\t\t\t} else {\n\t\t\t\t\tfilters.push([doctype, field, \"=\", value]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tstatic trigger_list_update(data) {\n\t\tconst doctype = data.doctype;\n\t\tif (!doctype) return;\n\t\tfrappe.provide('frappe.views.trees');\n\n\t\t// refresh tree view\n\t\tif (frappe.views.trees[doctype]) {\n\t\t\tfrappe.views.trees[doctype].tree.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\t// refresh list view\n\t\tconst page_name = frappe.get_route_str();\n\t\tconst list_view = frappe.views.list_view[page_name];\n\t\tlist_view && list_view.on_update(data);\n\t}\n};\n\n$(document).on('save', (event, doc) => {\n\tfrappe.views.ListView.trigger_list_update(doc);\n});\n\nfrappe.get_list_view = (doctype) => {\n\tlet route = `List/${doctype}/List`;\n\treturn frappe.views.list_view[route];\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.views.list_view');\n\nwindow.cur_list = null;\nfrappe.views.ListFactory = class ListFactory extends frappe.views.Factory {\n\tmake (route) {\n\t\tvar me = this;\n\t\tvar doctype = route[1];\n\n\t\tfrappe.model.with_doctype(doctype, function () {\n\t\t\tif (locals['DocType'][doctype].issingle) {\n\t\t\t\tfrappe.set_re_route('Form', doctype);\n\t\t\t} else {\n\t\t\t\t// List / Gantt / Kanban / etc\n\t\t\t\t// File is a special view\n\t\t\t\tconst view_name = doctype !== 'File' ? route[2] : 'File';\n\t\t\t\tlet view_class = frappe.views[view_name + 'View'];\n\t\t\t\tif (!view_class) view_class = frappe.views.ListView;\n\n\t\t\t\tif (view_class && view_class.load_last_view && view_class.load_last_view()) {\n\t\t\t\t\t// view can have custom routing logic\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfrappe.provide('frappe.views.list_view.' + doctype);\n\t\t\t\tconst page_name = frappe.get_route_str();\n\n\t\t\t\tif (!frappe.views.list_view[page_name]) {\n\t\t\t\t\tfrappe.views.list_view[page_name] = new view_class({\n\t\t\t\t\t\tdoctype: doctype,\n\t\t\t\t\t\tparent: me.make_page(true, page_name)\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.container.change_to(page_name);\n\t\t\t\t}\n\t\t\t\tme.set_cur_list();\n\t\t\t}\n\t\t});\n\t}\n\n\tshow() {\n\t\tif(this.re_route_to_view()) {\n\t\t\treturn;\n\t\t}\n\t\tthis.set_module_breadcrumb();\n\t\tsuper.show();\n\t\tthis.set_cur_list();\n\t\tcur_list && cur_list.show();\n\t}\n\n\tre_route_to_view() {\n\t\tvar route = frappe.get_route();\n\t\tvar doctype = route[1];\n\t\tvar last_route = frappe.route_history.slice(-2)[0];\n\t\tif (route[0] === 'List' && route.length === 2 && frappe.views.list_view[doctype]) {\n\t\t\tif(last_route && last_route[0]==='List' && last_route[1]===doctype) {\n\t\t\t\t// last route same as this route, so going back.\n\t\t\t\t// this happens because #List/Item will redirect to #List/Item/List\n\t\t\t\t// while coming from back button, the last 2 routes will be same, so\n\t\t\t\t// we know user is coming in the reverse direction (via back button)\n\n\t\t\t\t// example:\n\t\t\t\t// Step 1: #List/Item redirects to #List/Item/List\n\t\t\t\t// Step 2: User hits \"back\" comes back to #List/Item\n\t\t\t\t// Step 3: Now we cannot send the user back to #List/Item/List so go back one more step\n\t\t\t\twindow.history.go(-1);\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tset_module_breadcrumb() {\n\t\tif (frappe.route_history.length > 1) {\n\t\t\tvar prev_route = frappe.route_history[frappe.route_history.length - 2];\n\t\t\tif (prev_route[0] === 'modules') {\n\t\t\t\tvar doctype = frappe.get_route()[1],\n\t\t\t\t\tmodule = prev_route[1];\n\t\t\t\tif (frappe.module_links[module] && frappe.module_links[module].includes(doctype)) {\n\t\t\t\t\t// save the last page from the breadcrumb was accessed\n\t\t\t\t\tfrappe.breadcrumbs.set_doctype_module(doctype, module);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tset_cur_list() {\n\t\tvar route = frappe.get_route();\n\t\tvar page_name = frappe.get_route_str();\n\t\tcur_list = frappe.views.list_view[page_name];\n\t\tif (cur_list && cur_list.doctype !== route[1]) {\n\t\t\t// changing...\n\t\t\twindow.cur_list = null;\n\t\t}\n\t}\n}\n","frappe.provide('frappe.ui');\n\nexport default class ListFilter {\n\tconstructor({ wrapper, doctype }) {\n\t\tObject.assign(this, arguments[0]);\n\t\tthis.can_add_global = frappe.user.has_role(['System Manager', 'Administrator']);\n\t\tthis.filters = [];\n\t\tthis.make();\n\t\tthis.bind();\n\t\tthis.refresh();\n\t}\n\n\tmake() {\n\t\t// init dom\n\t\tthis.wrapper.html('<li class=\"input-area\"></li>');\n\t\tthis.$input_area = this.wrapper.find('.input-area');\n\t\tthis.$list_filters = this.wrapper.find('.list-filters');\n\n\t\tthis.filter_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: __('Save Filter').toUpperCase(),\n\t\t\t\tplaceholder: __('Filter Name'),\n\t\t\t\tinput_class: 'input-xs'\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1,\n\t\t});\n\n\t\t$(this.filter_input.label_area).css('font-size', 10);\n\n\t\tthis.is_global_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Check',\n\t\t\t\tlabel: __('Is Global')\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1\n\t\t});\n\n\t}\n\n\tbind() {\n\t\tthis.bind_save_filter();\n\t\tthis.bind_click_filter();\n\t\tthis.bind_remove_filter();\n\t}\n\n\trefresh() {\n\t\tthis.get_list_filters()\n\t\t\t.then(() => {\n\t\t\t\tconst html = this.filters.map(filter => this.filter_template(filter));\n\t\t\t\tthis.wrapper.find('.list-link').remove();\n\t\t\t\tthis.wrapper.append(html);\n\t\t\t});\n\t\tthis.is_global_input.toggle(false);\n\t\tthis.filter_input.set_description('');\n\t}\n\n\tfilter_template(filter) {\n\t\treturn `<li class=\"list-link\" data-name=\"${filter.name}\">\n\t\t\t<a style=\"max-width: 90%;\">${filter.filter_name}</a>\n\t\t\t<a class=\"text-muted pull-right\"><span class=\"remove octicon octicon-x\"></span></a>\n\t\t</li>`;\n\t}\n\n\tbind_click_filter() {\n\t\tthis.wrapper.on('click', '.list-link', e => {\n\t\t\tconst name = $(e.currentTarget).attr('data-name');\n\t\t\tthis.list_view.filter_area.clear()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.list_view.filter_area.add(this.get_filters_values(name));\n\t\t\t\t});\n\t\t});\n\t}\n\n\tbind_remove_filter() {\n\t\tthis.wrapper.on('click', '.list-link .remove', e => {\n\t\t\tconst $li = $(e.currentTarget).closest('.list-link')\n\t\t\tconst name = $li.attr('data-name');\n\t\t\t$li.remove();\n\t\t\tthis.remove_filter(name)\n\t\t\t\t.then(() => this.refresh());\n\t\t});\n\t}\n\n\tbind_save_filter() {\n\t\tthis.filter_input.$input.keydown(frappe.utils.debounce(e => {\n\t\t\tconst value = this.filter_input.get_value();\n\t\t\tconst has_value = Boolean(value);\n\n\t\t\tif (e.which === frappe.ui.keyCode['ENTER']) {\n\t\t\t\tif (!has_value || this.filter_name_exists(value)) return;\n\n\t\t\t\tthis.filter_input.set_value('');\n\t\t\t\tthis.save_filter(value)\n\t\t\t\t\t.then(() => this.refresh());\n\t\t\t} else {\n\t\t\t\tlet help_text = __('Press Enter to save');\n\n\t\t\t\tif (this.filter_name_exists(value)) {\n\t\t\t\t\thelp_text = __('Duplicate Filter Name');\n\t\t\t\t}\n\n\t\t\t\tthis.filter_input.set_description(has_value ? help_text : '');\n\n\t\t\t\tif (this.can_add_global) {\n\t\t\t\t\tthis.is_global_input.toggle(has_value);\n\t\t\t\t}\n\t\t\t}\n\t\t}, 300));\n\t}\n\n\tsave_filter(filter_name) {\n\t\treturn frappe.db.insert({\n\t\t\tdoctype: 'List Filter',\n\t\t\treference_doctype: this.list_view.doctype,\n\t\t\tfilter_name,\n\t\t\tfor_user: this.is_global_input.get_value() ? '' : frappe.session.user,\n\t\t\tfilters: JSON.stringify(this.get_current_filters())\n\t\t});\n\t}\n\n\tremove_filter(name) {\n\t\tif (!name) return;\n\t\treturn frappe.db.delete_doc('List Filter', name);\n\t}\n\n\tget_filters_values(name) {\n\t\tconst filter = this.filters.find(filter => filter.name === name);\n\t\treturn  JSON.parse(filter.filters || '[]');\n\t}\n\n\tget_current_filters() {\n\t\treturn this.list_view.filter_area.get();\n\t}\n\n\tfilter_name_exists(filter_name) {\n\t\treturn (this.filters || []).find(f => f.filter_name === filter_name);\n\t}\n\n\tget_list_filters() {\n\t\treturn frappe.db.get_list('List Filter', {\n\t\t\tfields: ['name', 'filter_name', 'for_user', 'filters'],\n\t\t\tfilters: { reference_doctype: this.list_view.doctype },\n\t\t\tor_filters: [['for_user', '=', frappe.session.user], ['for_user', '=', '']]\n\t\t}).then((filters) => {\n\t\t\tthis.filters = filters || [];\n\t\t});\n\t}\n}\n","frappe.provide('frappe.views');\n\nfrappe.views.FileView = class FileView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 2) {\n\t\t\tconst view_user_settings = frappe.get_user_settings('File', 'File');\n\t\t\tfrappe.set_route('List', 'File', view_user_settings.last_folder || frappe.boot.home_folder);\n\t\t\treturn true;\n\t\t}\n\t\treturn redirect_to_home_if_invalid_route();\n\t}\n\n\tget view_name() {\n\t\treturn 'File';\n\t}\n\n\tshow() {\n\t\tif (!redirect_to_home_if_invalid_route()) {\n\t\t\tsuper.show();\n\t\t}\n\t}\n\n\tsetup_view() {\n\t\tthis.render_header();\n\t\tthis.setup_events();\n\t}\n\n\tset_breadcrumbs() {\n\t\tconst route = frappe.get_route();\n\t\troute.splice(-1);\n\t\tconst last_folder = route[route.length - 1];\n\t\tif (last_folder === 'File') return;\n\n\t\tfrappe.breadcrumbs.add({\n\t\t\ttype: 'Custom',\n\t\t\tlabel: __('Home'),\n\t\t\troute: '#List/File/Home'\n\t\t});\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.page_title = __('File Manager');\n\n\t\t\t\tconst route = frappe.get_route();\n\t\t\t\tthis.current_folder = route.slice(2).join('/');\n\t\t\t\tthis.filters = [['File', 'folder', '=', this.current_folder, true]];\n\t\t\t\tthis.order_by = this.view_user_settings.order_by || 'file_name asc';\n\n\t\t\t\tthis.menu_items = this.menu_items.concat(this.file_menu_items());\n\t\t\t});\n\t}\n\n\tfile_menu_items() {\n\t\tconst items = [\n\t\t\t{\n\t\t\t\tlabel: __('Home'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.set_route('List', 'File', 'Home');\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Cut'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.file_manager.cut(this.get_checked_items(), this.current_folder);\n\t\t\t\t},\n\t\t\t\tclass: 'cut-menu-button hide'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Paste'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.file_manager.paste(this.current_folder);\n\t\t\t\t},\n\t\t\t\tclass: 'paste-menu-button hide'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('New Folder'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.prompt(__('Name'), (values) => {\n\t\t\t\t\t\tif((values.value.indexOf(\"/\") > -1)) {\n\t\t\t\t\t\t\tfrappe.throw(__(\"Folder name should not include '/' (slash)\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst data =  {\n\t\t\t\t\t\t\tfile_name: values.value,\n\t\t\t\t\t\t\tfolder: this.current_folder\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"frappe.core.doctype.file.file.create_new_folder\",\n\t\t\t\t\t\t\targs: data\n\t\t\t\t\t\t});\n\t\t\t\t\t}, __('Enter folder name'), __('Create'));\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Toggle Grid View'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.views.FileView.grid_view = !frappe.views.FileView.grid_view;\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Import Zip'),\n\t\t\t\taction: () => {\n\t\t\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\t\t\tfolder: this.current_folder,\n\t\t\t\t\t\trestrictions: {\n\t\t\t\t\t\t\tallowed_file_types: ['.zip']\n\t\t\t\t\t\t},\n\t\t\t\t\t\ton_success: file => {\n\t\t\t\t\t\t\tfrappe.show_alert(__('Unzipping files...'));\n\t\t\t\t\t\t\tfrappe.call('frappe.core.doctype.file.file.unzip_file', { name: file.name })\n\t\t\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\t\t\tfrappe.show_alert(__('Unzipped {0} files', [r.message]));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\treturn items;\n\t}\n\n\tset_fields() {\n\t\tthis.fields = this.meta.fields\n\t\t\t.filter(df => frappe.model.is_value_type(df.fieldtype) && !df.hidden)\n\t\t\t.map(df => df.fieldname)\n\t\t\t.concat(['name', 'modified', 'creation']);\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\n\t\tthis.data = this.data.map(d => this.prepare_datum(d));\n\n\t\t// Bring folders to the top\n\t\tconst { sort_by } = this.sort_selector;\n\t\tif (sort_by === 'file_name') {\n\t\t\tthis.data.sort((a, b) => {\n\t\t\t\tif (a.is_folder && !b.is_folder) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif (!a.is_folder &&b.is_folder) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t});\n\t\t}\n\t}\n\n\tprepare_datum(d) {\n\t\tlet icon_class = '';\n\t\tif (d.is_folder) {\n\t\t\ticon_class = \"octicon octicon-file-directory\";\n\t\t} else if (frappe.utils.is_image_file(d.file_name)) {\n\t\t\ticon_class = \"octicon octicon-file-media\";\n\t\t} else {\n\t\t\ticon_class = 'octicon octicon-file-text';\n\t\t}\n\n\t\tlet title = d.file_name || d.file_url;\n\t\ttitle = title.slice(0, 60);\n\t\td._title = title;\n\t\td.icon_class = icon_class;\n\n\t\td.subject_html = `\n\t\t\t<i class=\"${icon_class} text-muted\" style=\"width: 16px;\"></i>\n\t\t\t<span>${title}</span>\n\t\t\t${d.is_private ? '<i class=\"fa fa-lock fa-fw text-warning\"></i>' : ''}\n\t\t`;\n\t\treturn d;\n\t}\n\n\tbefore_render() {\n\t\tsuper.before_render();\n\t\tfrappe.model.user_settings.save('File', 'grid_view', frappe.views.FileView.grid_view);\n\t\tthis.save_view_user_settings({\n\t\t\tlast_folder: this.current_folder,\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.$result.removeClass('file-grid');\n\t\tif (frappe.views.FileView.grid_view) {\n\t\t\tthis.render_grid_view();\n\t\t} else {\n\t\t\tsuper.render();\n\t\t}\n\t}\n\n\trender_grid_view() {\n\t\tlet html = '';\n\n\t\thtml = this.data.map(d => {\n\t\t\treturn `\n\t\t\t\t<a href=\"${this.get_route_url(d)}\">\n\t\t\t\t\t<div class=\"file-wrapper padding flex small\">\n\t\t\t\t\t\t<div class=\"file-icon text-muted\">\n\t\t\t\t\t\t\t<span class=\"${d.icon_class} mega-octicon\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"file-title ellipsis\">${d._title}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t`;\n\t\t}).join('');\n\t\tthis.$result.addClass('file-grid');\n\t\tthis.$result.html(html);\n\t}\n\n\tget_breadcrumbs_html() {\n\t\tconst route = frappe.get_route();\n\t\tconst folders = route.slice(2);\n\n\t\treturn folders\n\t\t\t.map((folder, i) => {\n\t\t\t\tif (i === folders.length - 1) {\n\t\t\t\t\treturn `<span>${folder}</span>`;\n\t\t\t\t}\n\t\t\t\tconst route = folders.reduce((acc, curr, j) => {\n\t\t\t\t\tif (j <= i) {\n\t\t\t\t\t\tacc += '/' + curr;\n\t\t\t\t\t}\n\t\t\t\t\treturn acc;\n\t\t\t\t}, '#List/File');\n\n\t\t\t\treturn `<a href=\"${route}\">${folder}</a>`;\n\t\t\t})\n\t\t\t// only show last 3 breadcrumbs\n\t\t\t.slice(-3)\n\t\t\t.join('&nbsp;/&nbsp;');\n\t}\n\n\tget_header_html() {\n\t\tconst breadcrumbs_html = this.get_breadcrumbs_html();\n\n\t\tlet subject_html = `\n\t\t\t<div class=\"list-row-col list-subject level\">\n\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t\t<span class=\"level-item\">${breadcrumbs_html}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs\">\n\t\t\t\t<span>${__('Size')}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs\">\n\t\t\t\t<span>${__('Created')}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.get_header_html_skeleton(subject_html, '<span class=\"list-count\"></span>');\n\t}\n\n\tget_route_url(file) {\n\t\treturn file.is_folder ? '#List/File/' + file.name : this.get_form_link(file);\n\t}\n\n\tget_left_html(file) {\n\t\tfile = this.prepare_datum(file);\n\t\tconst file_size = file.file_size ? frappe.form.formatters.FileSize(file.file_size) : '';\n\t\tconst route_url = this.get_route_url(file);\n\n\t\tlet created_on;\n\t\tconst [date] = file.creation.split(' ');\n\t\tif (date === frappe.datetime.now_date()) {\n\t\t\tcreated_on = comment_when(file.creation);\n\t\t} else {\n\t\t\tcreated_on = frappe.datetime.str_to_user(date);\n\t\t}\n\n\t\treturn `\n\t\t\t<div class=\"list-row-col ellipsis list-subject level\">\n\t\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${file.name}\">\n\t\t\t\t<span class=\"level-item  ellipsis\" title=\"${file.file_name}\">\n\t\t\t\t\t<a class=\"ellipsis\" href=\"${route_url}\" title=\"${file.file_name}\">\n\t\t\t\t\t\t${file.subject_html}\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs text-muted\">\n\t\t\t\t<span>${file_size}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs text-muted\">\n\t\t\t\t<span>${created_on}</span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_right_html(file) {\n\t\treturn `\n\t\t\t<div class=\"level-item list-row-activity\">\n\t\t\t\t${comment_when(file.modified)}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tsetup_events() {\n\t\tsuper.setup_events();\n\t\tthis.setup_drag_drop();\n\t}\n\n\tsetup_drag_drop() {\n\t\tthis.$result.on('dragenter dragover', false)\n\t\t\t.on('drop', e => {\n\t\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\n\t\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\t\tfolder: this.current_folder\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\ttoggle_result_area() {\n\t\tsuper.toggle_result_area();\n\t\tthis.toggle_cut_paste_buttons();\n\t}\n\n\ton_row_checked() {\n\t\tsuper.on_row_checked();\n\t\tthis.toggle_cut_paste_buttons();\n\t}\n\n\ttoggle_cut_paste_buttons() {\n\t\t// paste btn\n\t\tconst $paste_btn = this.page.menu_btn_group.find('.paste-menu-button');\n\t\tconst hide = !frappe.file_manager.can_paste ||\n\t\t\tfrappe.file_manager.old_folder === this.current_folder;\n\n\t\tif (hide) {\n\t\t\t$paste_btn.addClass('hide');\n\t\t} else {\n\t\t\t$paste_btn.removeClass('hide');\n\t\t}\n\n\t\t// cut btn\n\t\tconst $cut_btn = this.page.menu_btn_group.find('.cut-menu-button');\n\t\tif (this.$checks && this.$checks.length > 0) {\n\t\t\t$cut_btn.removeClass('hide');\n\t\t} else {\n\t\t\t$cut_btn.addClass('hide');\n\t\t}\n\t}\n};\n\nfrappe.views.FileView.grid_view = frappe.get_user_settings('File').grid_view || false;\n\nfunction redirect_to_home_if_invalid_route() {\n\tconst route = frappe.get_route();\n\tif (route[2] === 'List') {\n\t\t// if the user somehow redirects to List/File/List\n\t\t// redirect back to Home\n\t\tfrappe.set_route('List', 'File', 'Home');\n\t\treturn true;\n\t}\n\treturn false;\n}\n","// Copyright (c) 2018, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nfrappe.provide('frappe.views');\nfrappe.provide(\"frappe.interaction_settings\");\n\nfrappe.views.InteractionComposer = class InteractionComposer {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tlet me = this;\n\t\tme.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: (me.title || me.subject || __(\"New Activity\")),\n\t\t\tno_submit_on_enter: true,\n\t\t\tfields: me.get_fields(),\n\t\t\tprimary_action_label: __('Create'),\n\t\t\tprimary_action: function() {\n\t\t\t\tme.create_action();\n\t\t\t}\n\t\t});\n\n\t\t$(document).on(\"upload_complete\", function(event, attachment) {\n\t\t\tif(me.dialog.display) {\n\t\t\t\tlet wrapper = $(me.dialog.fields_dict.select_attachments.wrapper);\n\n\t\t\t\t// find already checked items\n\t\t\t\tlet checked_items = wrapper.find('[data-file-name]:checked').map(function() {\n\t\t\t\t\treturn $(this).attr(\"data-file-name\");\n\t\t\t\t});\n\n\t\t\t\t// reset attachment list\n\t\t\t\tme.render_attach();\n\n\t\t\t\t// check latest added\n\t\t\t\tchecked_items.push(attachment.name);\n\n\t\t\t\t$.each(checked_items, function(i, filename) {\n\t\t\t\t\twrapper.find('[data-file-name=\"'+ filename +'\"]').prop(\"checked\", true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tme.prepare();\n\t\tme.dialog.show();\n\t}\n\n\tget_fields() {\n\t\tlet me = this;\n\t\tlet interaction_docs = Object.keys(get_doc_mappings());\n\n\t\tlet fields = [\n\t\t\t{label:__(\"Reference\"), fieldtype:\"Select\",\n\t\t\t\tfieldname:\"interaction_type\", options: interaction_docs,\n\t\t\t\treqd: 1,\n\t\t\t\tonchange: () => {\n\t\t\t\t\tlet values = me.get_values();\n\t\t\t\t\tme.get_fields().forEach(field => {\n\t\t\t\t\t\tif (field.fieldname != \"interaction_type\") {\n\t\t\t\t\t\t\tme.dialog.set_df_property(field.fieldname, \"reqd\", 0);\n\t\t\t\t\t\t\tme.dialog.set_df_property(field.fieldname, \"hidden\", 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tme.set_reqd_hidden_fields(values);\n\t\t\t\t\tme.get_event_categories();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{label:__(\"Category\"), fieldtype:\"Select\",\n\t\t\t\tfieldname:\"category\", options: \"\", hidden: 1},\n\t\t\t{label:__(\"Public\"), fieldtype:\"Check\",\n\t\t\t\tfieldname:\"public\", default: \"1\"},\n\t\t\t{fieldtype: \"Column Break\"},\n\t\t\t{label:__(\"Date\"), fieldtype:\"Datetime\",\n\t\t\t\tfieldname:\"due_date\"},\n\t\t\t{label:__(\"Assigned To\"), fieldtype:\"Link\",\n\t\t\t\tfieldname:\"assigned_to\", options:\"User\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{label:__(\"Summary\"), fieldtype:\"Data\",\n\t\t\t\tfieldname:\"summary\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{fieldtype:\"Text Editor\", fieldname:\"description\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{label:__(\"Select Attachments\"), fieldtype:\"HTML\",\n\t\t\t\tfieldname:\"select_attachments\"}\n\t\t];\n\n\t\treturn fields;\n\n\t}\n\n\tget_event_categories() {\n\t\tlet me = this;\n\t\tfrappe.model.with_doctype('Event', () => {\n\t\t\tlet categories = frappe.meta.get_docfield(\"Event\", \"event_category\").options.split(\"\\n\");\n\t\t\tme.dialog.get_input(\"category\").empty().add_options(categories);\n\t\t});\n\t}\n\n\tprepare() {\n\t\tthis.setup_attach();\n\t}\n\n\tset_reqd_hidden_fields(values) {\n\t\tlet me = this;\n\t\tif (values&&\"interaction_type\" in values) {\n\t\t\tlet doc_mapping = get_doc_mappings();\n\t\t\tdoc_mapping[values.interaction_type][\"reqd_fields\"].forEach(value => {\n\t\t\t\tme.dialog.set_df_property(value, 'reqd', 1);\n\t\t\t});\n\n\t\t\tdoc_mapping[values.interaction_type][\"hidden_fields\"].forEach(value => {\n\t\t\t\tme.dialog.set_df_property(value, 'hidden', 1);\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_attach() {\n\t\tvar fields = this.dialog.fields_dict;\n\t\tvar attach = $(fields.select_attachments.wrapper);\n\n\t\tif (!this.attachments) {\n\t\t\tthis.attachments = [];\n\t\t}\n\n\t\tlet args = {\n\t\t\tfolder: 'Home/Attachments',\n\t\t\ton_success: attachment => this.attachments.push(attachment)\n\t\t};\n\n\t\tif (this.frm) {\n\t\t\targs = {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tdocname: this.frm.docname,\n\t\t\t\tfolder: 'Home/Attachments',\n\t\t\t\ton_success: attachment => {\n\t\t\t\t\tthis.frm.attachments.attachment_uploaded(attachment);\n\t\t\t\t\tthis.render_attach();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t$(\"<h6 class='text-muted add-attachment' style='margin-top: 12px; cursor:pointer;'>\"\n\t\t\t+__(\"Select Attachments\")+\"</h6><div class='attach-list'></div>\\\n\t\t\t<p class='add-more-attachments'>\\\n\t\t\t<a class='text-muted small'><i class='octicon octicon-plus' style='font-size: 12px'></i> \"\n\t\t\t+__(\"Add Attachment\")+\"</a></p>\").appendTo(attach.empty());\n\t\tattach\n\t\t\t.find(\".add-more-attachments a\")\n\t\t\t.on('click',() => new frappe.ui.FileUploader(args));\n\t\tthis.render_attach();\n\t}\n\n\trender_attach(){\n\t\tlet fields = this.dialog.fields_dict;\n\t\tlet attach = $(fields.select_attachments.wrapper).find(\".attach-list\").empty();\n\n\t\tlet files = [];\n\t\tif (this.attachments && this.attachments.length) {\n\t\t\tfiles = files.concat(this.attachments);\n\t\t}\n\t\tif (cur_frm) {\n\t\t\tfiles = files.concat(cur_frm.get_files());\n\t\t}\n\n\t\tif(files.length) {\n\t\t\t$.each(files, function(i, f) {\n\t\t\t\tif (!f.file_name) return;\n\t\t\t\tf.file_url = frappe.urllib.get_full_url(f.file_url);\n\n\t\t\t\t$(repl('<p class=\"checkbox\">'\n\t\t\t\t\t+\t'<label><span><input type=\"checkbox\" data-file-name=\"%(name)s\"></input></span>'\n\t\t\t\t\t+\t\t'<span class=\"small\">%(file_name)s</span>'\n\t\t\t\t\t+\t' <a href=\"%(file_url)s\" target=\"_blank\" class=\"text-muted small\">'\n\t\t\t\t\t+\t\t'<i class=\"fa fa-share\" style=\"vertical-align: middle; margin-left: 3px;\"></i>'\n\t\t\t\t\t+ '</label></p>', f))\n\t\t\t\t\t.appendTo(attach);\n\t\t\t});\n\t\t}\n\t}\n\n\tcreate_action() {\n\t\tlet me = this;\n\t\tlet btn = me.dialog.get_primary_btn();\n\n\t\tlet form_values = this.get_values();\n\t\tif(!form_values) return;\n\n\t\tlet selected_attachments =\n\t\t\t$.map($(me.dialog.wrapper).find(\"[data-file-name]:checked\"), function(element){\n\t\t\t\treturn $(element).attr(\"data-file-name\");\n\t\t\t});\n\n\t\tme.create_interaction(btn, form_values, selected_attachments);\n\t}\n\n\tget_values() {\n\t\tlet me = this;\n\t\tlet values = this.dialog.get_values(true);\n\t\tif (values) {\n\t\t\tvalues[\"reference_doctype\"] = me.frm.doc.doctype;\n\t\t\tvalues[\"reference_document\"] = me.frm.doc.name;\n\t\t}\n\n\t\treturn values;\n\t}\n\n\tcreate_interaction(btn, form_values, selected_attachments) {\n\t\tlet me = this;\n\t\tme.dialog.hide();\n\n\t\tlet field_map = get_doc_mappings();\n\t\tlet interaction_values = {};\n\t\tObject.keys(form_values).forEach(value => {\n\t\t\tinteraction_values[field_map[form_values.interaction_type][\"field_map\"][value]] = form_values[value];\n\t\t});\n\n\t\tif (\"event_type\" in interaction_values){\n\t\t\tinteraction_values[\"event_type\"] = (form_values.public == 1) ? \"Public\" : \"Private\";\n\t\t}\n\t\tif (interaction_values[\"doctype\"] == \"Event\") {\n\t\t\tinteraction_values[\"event_participants\"] = [{\"reference_doctype\": form_values.reference_doctype,\n\t\t\t\t\"reference_docname\": form_values.reference_document}];\n\t\t}\n\t\tif (!(\"owner\" in interaction_values)){\n\t\t\tinteraction_values[\"owner\"] = frappe.session.user;\n\t\t}\n\t\treturn frappe.call({\n\t\t\tmethod:\"frappe.client.insert\",\n\t\t\targs: { doc: interaction_values},\n\t\t\tbtn: btn,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"{0} created successfully\", [form_values.interaction_type]),\n\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t});\n\t\t\t\t\tif (\"assigned_to\" in form_values) {\n\t\t\t\t\t\tme.assign_document(r.message, form_values[\"assigned_to\"]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (selected_attachments) {\n\t\t\t\t\t\tme.add_attachments(r.message, selected_attachments);\n\t\t\t\t\t}\n\t\t\t\t\tif (cur_frm) {\n\t\t\t\t\t\t// clear input\n\t\t\t\t\t\tcur_frm.timeline.input && cur_frm.timeline.input.val(\"\");\n\t\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__(\"There were errors while creating the document. Please try again.\"));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\tassign_document(doc, assignee) {\n\t\tif (doc.doctype != \"ToDo\") {\n\t\t\tfrappe.call({\n\t\t\t\tmethod:'frappe.desk.form.assign_to.add',\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: doc.doctype,\n\t\t\t\t\tname: doc.name,\n\t\t\t\t\tassign_to: assignee,\n\t\t\t\t},\n\t\t\t\tcallback:function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"The document has been assigned to {0}\", [assignee]),\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"The document could not be correctly assigned\"),\n\t\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t}\n\n\tadd_attachments(doc, attachments) {\n\t\tfrappe.call({\n\t\t\tmethod:'frappe.utils.file_manager.add_attachments',\n\t\t\targs: {\n\t\t\t\tdoctype: doc.doctype,\n\t\t\t\tname: doc.name,\n\t\t\t\tattachments: JSON.stringify(attachments)\n\t\t\t},\n\t\t\tcallback:function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"The attachments could not be correctly linked to the new document\"),\n\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n};\n\nfunction get_doc_mappings() {\n\tconst doc_map = {\n\t\t\"Event\": {\n\t\t\t\"field_map\": {\n\t\t\t\t\"interaction_type\": \"doctype\",\n\t\t\t\t\"summary\": \"subject\",\n\t\t\t\t\"description\": \"description\",\n\t\t\t\t\"category\": \"event_category\",\n\t\t\t\t\"due_date\": \"starts_on\",\n\t\t\t\t\"public\": \"event_type\"\n\t\t\t},\n\t\t\t\"reqd_fields\": [\"summary\", \"due_date\"],\n\t\t\t\"hidden_fields\": []\n\t\t} ,\n\t\t\"ToDo\": {\n\t\t\t\"field_map\": {\n\t\t\t\t\"interaction_type\": \"doctype\",\n\t\t\t\t\"description\": \"description\",\n\t\t\t\t\"due_date\": \"date\",\n\t\t\t\t\"reference_doctype\": \"reference_type\",\n\t\t\t\t\"reference_document\": \"reference_name\",\n\t\t\t\t\"assigned_to\": \"owner\"\n\t\t\t},\n\t\t\t\"reqd_fields\": [\"description\"],\n\t\t\t\"hidden_fields\": [\"public\", \"category\"]\n\t\t}\n\t};\n\n\treturn doc_map;\n}","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport ListFilter from './list_filter';\nfrappe.provide('frappe.views');\n\n// opts:\n// stats = list of fields\n// doctype\n// parent\n// set_filter = function called on click\n\nfrappe.views.ListSidebar = class ListSidebar {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.cat_tags = [];\n\t}\n\n\tmake() {\n\t\tvar sidebar_content = frappe.render_template(\"list_sidebar\", { doctype: this.doctype });\n\n\t\tthis.sidebar = $('<div class=\"list-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.setup_reports();\n\t\tthis.setup_list_filter();\n\t\tthis.setup_views();\n\t\tthis.setup_kanban_boards();\n\t\tthis.setup_calendar_view();\n\t\tthis.setup_email_inbox();\n\t\tthis.setup_keyboard_shortcuts();\n\t\tthis.setup_list_group_by();\n\n\t\t// do not remove\n\t\t// used to trigger custom scripts\n\t\t$(document).trigger('list_sidebar_setup');\n\n\t\tif (this.list_view.list_view_settings && this.list_view.list_view_settings.disable_sidebar_stats) {\n\t\t\tthis.sidebar.find('.sidebar-stat').remove();\n\t\t} else {\n\t\t\tthis.sidebar.find('.list-stats').on('click', (e) => {\n\t\t\t\tthis.reload_stats();\n\t\t\t});\n\t\t}\n\n\t}\n\n\tsetup_views() {\n\t\tvar show_list_link = false;\n\n\t\tif (frappe.views.calendar[this.doctype]) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Calendar\"]').removeClass(\"hide\");\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Gantt\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\t\t//show link for kanban view\n\t\tthis.sidebar.find('.list-link[data-view=\"Kanban\"]').removeClass('hide');\n\t\tif (this.doctype === \"Communication\" && frappe.boot.email_accounts.length) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Inbox\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\n\t\tif (frappe.treeview_settings[this.doctype] || frappe.get_meta(this.doctype).is_tree) {\n\t\t\tthis.sidebar.find(\".tree-link\").removeClass(\"hide\");\n\t\t}\n\n\t\tthis.current_view = 'List';\n\t\tvar route = frappe.get_route();\n\t\tif (route.length > 2 && frappe.views.view_modes.includes(route[2])) {\n\t\t\tthis.current_view = route[2];\n\n\t\t\tif (this.current_view === 'Kanban') {\n\t\t\t\tthis.kanban_board = route[3];\n\t\t\t} else if (this.current_view === 'Inbox') {\n\t\t\t\tthis.email_account = route[3];\n\t\t\t}\n\t\t}\n\n\t\t// disable link for current view\n\t\tthis.sidebar.find('.list-link[data-view=\"' + this.current_view + '\"] a')\n\t\t\t.attr('disabled', 'disabled').addClass('disabled');\n\n\t\t//enable link for Kanban view\n\t\tthis.sidebar.find('.list-link[data-view=\"Kanban\"] a, .list-link[data-view=\"Inbox\"] a')\n\t\t\t.attr('disabled', null).removeClass('disabled');\n\n\t\t// show image link if image_view\n\t\tif (this.list_view.meta.image_field) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Image\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\n\t\tif (show_list_link) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"List\"]').removeClass('hide');\n\t\t}\n\t}\n\n\tsetup_reports() {\n\t\t// add reports linked to this doctype to the dropdown\n\t\tvar me = this;\n\t\tvar added = [];\n\t\tvar dropdown = this.page.sidebar.find('.reports-dropdown');\n\t\tvar divider = false;\n\n\t\tvar add_reports = function(reports) {\n\t\t\t$.each(reports, function(name, r) {\n\t\t\t\tif (!r.ref_doctype || r.ref_doctype == me.doctype) {\n\t\t\t\t\tvar report_type = r.report_type === 'Report Builder' ?\n\t\t\t\t\t\t`List/${r.ref_doctype}/Report` : 'query-report';\n\n\t\t\t\t\tvar route = r.route || report_type + '/' + (r.title || r.name);\n\n\t\t\t\t\tif (added.indexOf(route) === -1) {\n\t\t\t\t\t\t// don't repeat\n\t\t\t\t\t\tadded.push(route);\n\n\t\t\t\t\t\tif (!divider) {\n\t\t\t\t\t\t\tme.get_divider().appendTo(dropdown);\n\t\t\t\t\t\t\tdivider = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$('<li><a href=\"#' + route + '\">' +\n\t\t\t\t\t\t\t__(r.title || r.name) + '</a></li>').appendTo(dropdown);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// from reference doctype\n\t\tif (this.list_view.settings.reports) {\n\t\t\tadd_reports(this.list_view.settings.reports);\n\t\t}\n\n\t\t// Sort reports alphabetically\n\t\tvar reports = Object.values(frappe.boot.user.all_reports).sort((a,b) => a.title.localeCompare(b.title)) || [];\n\n\t\t// from specially tagged reports\n\t\tadd_reports(reports);\n\t}\n\n\tsetup_list_filter() {\n\t\tthis.list_filter = new ListFilter({\n\t\t\twrapper: this.page.sidebar.find('.list-filters'),\n\t\t\tdoctype: this.doctype,\n\t\t\tlist_view: this.list_view\n\t\t});\n\t}\n\n\tsetup_kanban_boards() {\n\t\tconst $dropdown = this.page.sidebar.find('.kanban-dropdown');\n\t\tfrappe.views.KanbanView.setup_dropdown_in_sidebar(this.doctype, $dropdown);\n\t}\n\n\tsetup_calendar_view() {\n\t\tconst doctype = this.doctype;\n\n\t\tfrappe.db.get_list('Calendar View', {\n\t\t\tfilters: {\n\t\t\t\treference_doctype: doctype\n\t\t\t}\n\t\t}).then(result => {\n\t\t\tif (!(Array.isArray(result) && result.length)) return;\n\t\t\tconst calendar_views = result;\n\t\t\tconst $link_calendar = this.sidebar.find('.list-link[data-view=\"Calendar\"]');\n\n\t\t\tlet default_link = '';\n\t\t\tif (frappe.views.calendar[this.doctype]) {\n\t\t\t\t// has standard calendar view\n\t\t\t\tdefault_link = `<li><a href=\"#List/${doctype}/Calendar/Default\">\n\t\t\t\t\t${ __(\"Default\") }</a></li>`;\n\t\t\t}\n\t\t\tconst other_links = calendar_views.map(\n\t\t\t\tcalendar_view => `<li><a href=\"#List/${doctype}/Calendar/${calendar_view.name}\">\n\t\t\t\t\t${ __(calendar_view.name) }</a>\n\t\t\t\t</li>`\n\t\t\t).join('');\n\n\t\t\tconst dropdown_html = `\n\t\t\t\t<div class=\"btn-group\">\n\t\t\t\t\t<a class=\"dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n\t\t\t\t\t\t${ __(\"Calendar\") } <span class=\"caret\"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<ul class=\"dropdown-menu calendar-dropdown\" style=\"max-height: 300px; overflow-y: auto;\">\n\t\t\t\t\t\t${default_link}\n\t\t\t\t\t\t${other_links}\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\t$link_calendar.removeClass('hide');\n\t\t\t$link_calendar.html(dropdown_html);\n\t\t});\n\t}\n\n\tsetup_email_inbox() {\n\t\t// get active email account for the user and add in dropdown\n\t\tif (this.doctype != \"Communication\")\n\t\t\treturn;\n\n\t\tlet $dropdown = this.page.sidebar.find('.email-account-dropdown');\n\t\tlet divider = false;\n\n\t\tif (has_common(frappe.user_roles, [\"System Manager\", \"Administrator\"])) {\n\t\t\t$(`<li class=\"new-email-account\"><a>${__(\"New Email Account\")}</a></li>`)\n\t\t\t\t.appendTo($dropdown);\n\t\t}\n\n\t\tlet accounts = frappe.boot.email_accounts;\n\t\taccounts.forEach((account) => {\n\t\t\tlet email_account = (account.email_id == \"All Accounts\") ? \"All Accounts\" : account.email_account;\n\t\t\tlet route = [\"List\", \"Communication\", \"Inbox\", email_account].join('/');\n\t\t\tlet display_name = [\"All Accounts\", \"Sent Mail\", \"Spam\", \"Trash\"].includes(account.email_id) ? __(account.email_id) : account.email_id;\n\t\t\t\n\t\t\tif (!divider) {\n\t\t\t\tthis.get_divider().appendTo($dropdown);\n\t\t\t\tdivider = true;\n\t\t\t}\n\t\t\t$(`<li><a href=\"#${route}\">${display_name}</a></li>`).appendTo($dropdown);\n\t\t\tif (account.email_id === \"Sent Mail\")\n\t\t\t\tdivider = false;\n\t\t});\n\n\t\t$dropdown.find('.new-email-account').click(function() {\n\t\t\tfrappe.new_doc(\"Email Account\");\n\t\t});\n\t}\n\n\tsetup_keyboard_shortcuts() {\n\t\tthis.sidebar.find('.list-link > a, .list-link > .btn-group > a').each((i, el) => {\n\t\t\tfrappe.ui.keys\n\t\t\t\t.get_shortcut_group(this.page)\n\t\t\t\t.add($(el));\n\t\t});\n\t}\n\n\tsetup_list_group_by() {\n\t\tthis.list_group_by = new frappe.views.ListGroupBy({\n\t\t\tdoctype: this.doctype,\n\t\t\tsidebar: this,\n\t\t\tlist_view: this.list_view,\n\t\t\tpage: this.page\n\t\t});\n\t}\n\n\tget_cat_tags() {\n\t\treturn this.cat_tags;\n\t}\n\n\tget_stats() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.desk.reportview.get_sidebar_stats',\n\t\t\ttype: 'GET',\n\t\t\targs: {\n\t\t\t\tstats: me.stats,\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\t// wait for list filter area to be generated before getting filters, or fallback to default filters\n\t\t\t\tfilters: (me.list_view.filter_area ? me.list_filter.get_current_filters() : me.default_filters) || []\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.render_stat(\"_user_tags\", (r.message.stats || {})[\"_user_tags\"]);\n\t\t\t\tlet stats_dropdown = me.sidebar.find('.list-stats-dropdown');\n\t\t\t\tfrappe.utils.setup_search(stats_dropdown, '.stat-link', '.stat-label');\n\t\t\t}\n\t\t});\n\t}\n\n\trender_stat(field, stat, tags) {\n\t\tvar me = this;\n\t\tvar sum = 0;\n\t\tvar stats = [];\n\t\tvar label = frappe.meta.docfield_map[this.doctype][field] ?\n\t\t\tfrappe.meta.docfield_map[this.doctype][field].label : field;\n\n\t\tstat = (stat || []).sort(function(a, b) {\n\t\t\treturn b[1] - a[1];\n\t\t});\n\t\t$.each(stat, function(i, v) {\n\t\t\tsum = sum + v[1];\n\t\t});\n\n\t\tif (tags) {\n\t\t\tfor (var t in tags) {\n\t\t\t\tvar nfound = -1;\n\t\t\t\tfor (var i in stat) {\n\t\t\t\t\tif (tags[t] === stat[i][0]) {\n\t\t\t\t\t\tstats.push(stat[i]);\n\t\t\t\t\t\tnfound = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (nfound < 0) {\n\t\t\t\t\tstats.push([tags[t], 0]);\n\t\t\t\t} else {\n\t\t\t\t\tme.tempstats[\"_user_tags\"].splice(nfound, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfield = \"_user_tags\";\n\t\t} else {\n\t\t\tstats = stat;\n\t\t}\n\t\tvar context = {\n\t\t\tfield: field,\n\t\t\tstat: stats,\n\t\t\tsum: sum,\n\t\t\tlabel: field === '_user_tags' ? (tags ? __(label) : __(\"Tags\")) : __(label),\n\t\t};\n\t\t$(frappe.render_template(\"list_sidebar_stat\", context))\n\t\t\t.on(\"click\", \".stat-link\", function() {\n\t\t\t\tvar fieldname = $(this).attr('data-field');\n\t\t\t\tvar label = $(this).attr('data-label');\n\t\t\t\tvar condition = \"like\";\n\t\t\t\tvar existing = me.list_view.filter_area.filter_list.get_filter(fieldname);\n\t\t\t\tif(existing) {\n\t\t\t\t\texisting.remove();\n\t\t\t\t}\n\t\t\t\tif (label == \"No Tags\") {\n\t\t\t\t\tlabel = \"%,%\";\n\t\t\t\t\tcondition = \"not like\";\n\t\t\t\t}\n\t\t\t\tme.list_view.filter_area.filter_list.add_filter(me.list_view.doctype, fieldname, condition, label)\n\t\t\t\t\t.then(function() {\n\t\t\t\t\t\tme.list_view.refresh();\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.appendTo(this.sidebar.find(\".list-stats-dropdown\"));\n\t}\n\n\tset_fieldtype(df) {\n\n\t\t// scrub\n\t\tif (df.fieldname == \"docstatus\") {\n\t\t\tdf.fieldtype = \"Select\",\n\t\t\tdf.options = [\n\t\t\t\t{ value: 0, label: \"Draft\" },\n\t\t\t\t{ value: 1, label: \"Submitted\" },\n\t\t\t\t{ value: 2, label: \"Cancelled\" },\n\t\t\t];\n\t\t} else if (df.fieldtype == 'Check') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = [{ value: 0, label: 'No' },\n\t\t\t\t{ value: 1, label: 'Yes' }\n\t\t\t];\n\t\t} else if (['Text', 'Small Text', 'Text Editor', 'Code', 'Tag', 'Comments',\n\t\t\t'Dynamic Link', 'Read Only', 'Assign'\n\t\t].indexOf(df.fieldtype) != -1) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t} else if (df.fieldtype == 'Link' && this.$w.find('.condition').val() != \"=\") {\n\t\t\tdf.fieldtype = 'Data';\n\t\t}\n\t\tif (df.fieldtype === \"Data\" && (df.options || \"\").toLowerCase() === \"email\") {\n\t\t\tdf.options = null;\n\t\t}\n\t}\n\n\treload_stats() {\n\t\tthis.sidebar.find(\".stat-link\").remove();\n\t\tthis.sidebar.find(\".stat-no-records\").remove();\n\t\tthis.get_stats();\n\t}\n\n\tget_divider() {\n\t\treturn $('<li role=\"separator\" class=\"divider\"></li>');\n\t}\n};\n","\nfrappe.provide('frappe.views');\n\nfrappe.views.ListGroupBy = class ListGroupBy {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make_wrapper();\n\n\t\tthis.user_settings = frappe.get_user_settings(this.doctype);\n\t\tthis.group_by_fields = ['assigned_to', 'owner'];\n\t\tif(this.user_settings.group_by_fields) {\n\t\t\tthis.group_by_fields = this.group_by_fields.concat(this.user_settings.group_by_fields);\n\t\t}\n\t\tthis.render_group_by_items();\n\t\tthis.make_group_by_fields_modal();\n\t\tthis.setup_dropdown();\n\t\tthis.setup_filter_by();\n\t}\n\n\tmake_group_by_fields_modal() {\n\t\tlet d = new frappe.ui.Dialog ({\n\t\t\ttitle: __(\"Select Filters\"),\n\t\t\tfields: this.get_group_by_dropdown_fields()\n\t\t});\n\n\t\td.set_primary_action(\"Save\", ({ group_by_fields }) => {\n\t\t\tfrappe.model.user_settings.save(this.doctype, 'group_by_fields', group_by_fields || null);\n\t\t\tthis.group_by_fields = group_by_fields ? ['assigned_to', 'owner', ...group_by_fields] : ['assigned_to', 'owner'];\n\t\t\tthis.render_group_by_items();\n\t\t\td.hide();\n\t\t});\n\n\t\td.$body.prepend(`<div class=\"filters-search\">\n\t\t\t<input type=\"text\" placeholder=\"${__('Search')}\" data-element=\"search\" class=\"form-control input-xs\">\n\t\t</div>`);\n\n\t\tthis.page.sidebar.find(\".add-list-group-by a\").on(\"click\", () => {\n\t\t\tfrappe.utils.setup_search(d.$body, '.unit-checkbox', '.label-area');\n\t\t\td.show();\n\t\t});\n\t}\n\n\tmake_wrapper() {\n\t\tthis.$wrapper = this.sidebar.sidebar.find('.list-group-by');\n\t\tlet html = `\n\t\t\t<li class=\"list-sidebar-label\">\n\t\t\t\t${__('Filter By')}\n\t\t\t</li>\n\t\t\t<div class=\"list-group-by-fields\">\n\t\t\t</div>\n\t\t\t<li class=\"add-list-group-by list-link\">\n\t\t\t\t<a class=\"add-group-by hidden-xs text-muted\">\n\t\t\t\t\t${__(\"Add Fields\")} <i class=\"octicon octicon-plus\" style=\"margin-left: 2px;\"></i>\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t`;\n\t\tthis.$wrapper.html(html);\n\t}\n\n\trender_group_by_items() {\n\t\tlet get_item_html = (fieldname) => {\n\t\t\tlet label, fieldtype;\n\t\t\tif (fieldname === 'assigned_to') {\n\t\t\t\tlabel = __('Assigned To');\n\t\t\t} else if (fieldname === 'owner') {\n\t\t\t\tlabel = __('Created By');\n\t\t\t} else {\n\t\t\t\tlabel = frappe.meta.get_label(this.doctype, fieldname);\n\t\t\t\tlet docfield = frappe.meta.get_docfield(this.doctype, fieldname);\n\t\t\t\tif (!docfield) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfieldtype = docfield.fieldtype;\n\t\t\t}\n\n\t\t\treturn `<li class=\"group-by-field list-link\">\n\t\t\t\t<div class=\"btn-group\">\n\t\t\t\t\t<a class = \"dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"\n\t\t\t\t\tdata-label=\"${label}\" data-fieldname=\"${fieldname}\" data-fieldtype=\"${fieldtype}\"\n\t\t\t\t\thref=\"#\" onclick=\"return false;\">\n\t\t\t\t\t\t${__(label)} <span class=\"caret\"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<ul class=\"dropdown-menu group-by-dropdown\" role=\"menu\">\n\t\t\t\t\t\t<li><div class=\"list-loading text-center group-by-loading text-muted\">\n\t\t\t\t\t\t\t${__(\"Loading...\")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</li>`;\n\t\t};\n\t\tlet html = this.group_by_fields.map(get_item_html).join('');\n\t\tthis.$wrapper.find('.list-group-by-fields').html(html);\n\t}\n\n\tsetup_dropdown() {\n\t\tthis.$wrapper.on('click', '.group-by-field', (e)=> {\n\t\t\tlet dropdown = $(e.currentTarget).find('.group-by-dropdown');\n\t\t\tlet fieldname = $(e.currentTarget).find('a').attr('data-fieldname');\n\t\t\tlet fieldtype = $(e.currentTarget).find('a').attr('data-fieldtype');\n\t\t\tthis.get_group_by_count(fieldname).then(field_count_list => {\n\t\t\t\tif (field_count_list.length) {\n\t\t\t\t\tthis.render_dropdown_items(field_count_list, fieldtype, dropdown);\n\t\t\t\t\tfrappe.utils.setup_search(dropdown, '.group-by-item', '.group-by-value', 'data-name');\n\t\t\t\t} else {\n\t\t\t\t\tdropdown.html(\n\t\t\t\t\t\t`<div class=\"list-loading text-center group-by-empty text-muted\">\n\t\t\t\t\t\t${__(\"No filters found\")}\n\t\t\t\t\t\t</div>`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_group_by_dropdown_fields() {\n\t\tlet group_by_fields = [];\n\t\tlet fields = this.list_view.meta.fields.filter((f)=> [\"Select\", \"Link\", \"Data\", \"Int\", \"Check\"].includes(f.fieldtype));\n\t\tgroup_by_fields.push({\n\t\t\tlabel: __(this.doctype),\n\t\t\tfieldname: 'group_by_fields',\n\t\t\tfieldtype: 'MultiCheck',\n\t\t\tcolumns: 2,\n\t\t\toptions: fields\n\t\t\t\t.map(df => ({\n\t\t\t\t\tlabel: __(df.label),\n\t\t\t\t\tvalue: df.fieldname,\n\t\t\t\t\tchecked: this.group_by_fields.includes(df.fieldname)\n\t\t\t\t}))\n\t\t});\n\t\treturn group_by_fields;\n\t}\n\n\tget_group_by_count(field) {\n\t\tlet current_filters = this.list_view.get_filters_for_args();\n\n\t\t// remove filter of the current field\n\t\tcurrent_filters =\n\t\t\tcurrent_filters.filter((f_arr) => !f_arr.includes(field === 'assigned_to' ? '_assign': field));\n\n\t\tlet args =  {\n\t\t\tdoctype: this.doctype,\n\t\t\tcurrent_filters: current_filters,\n\t\t\tfield: field,\n\t\t};\n\n\n\t\treturn frappe.call('frappe.desk.listview.get_group_by_count', args).then((r) => {\n\t\t\tlet field_counts = r.message || [];\n\t\t\tfield_counts = field_counts.filter(f => f.count !== 0);\n\t\t\tlet current_user = field_counts.find(f => f.name === frappe.session.user);\n\t\t\tfield_counts = field_counts.filter(f => !['Guest', 'Administrator', frappe.session.user].includes(f.name));\n\t\t\t// Set frappe.session.user on top of the list\n\t\t\tif (current_user) field_counts.unshift(current_user);\n\t\t\treturn field_counts;\n\t\t});\n\t}\n\n\trender_dropdown_items(fields, fieldtype, dropdown) {\n\t\tlet get_dropdown_html = (field) => {\n\t\t\tlet label = field.name == null ? __('Not Specified') : field.name;\n\t\t\tif (label === frappe.session.user) {\n\t\t\t\tlabel = __('Me');\n\t\t\t} else if (fieldtype && fieldtype == 'Check') {\n\t\t\t\tlabel = label == '0'? __('No'): __('Yes');\n\t\t\t}\n\t\t\tlet value = field.name == null ? '' : encodeURIComponent(field.name);\n\n\t\t\treturn `<li class=\"group-by-item\" data-value=\"${value}\">\n\t\t\t\t<a class=\"badge-hover\" href=\"#\" onclick=\"return false;\">\n\t\t\t\t\t<span class=\"group-by-value\" data-name=\"${field.name}\">${label}</span>\n\t\t\t\t\t<span class=\"badge pull-right group-by-count\">${field.count}</span>\n\t\t\t\t</a>\n\t\t\t</li>`;\n\t\t};\n\t\tlet standard_html = `\n\t\t\t<div class=\"dropdown-search\">\n\t\t\t\t<input type=\"text\" placeholder=\"${__('Search')}\" data-element=\"search\" class=\"dropdown-search-input form-control input-xs\">\n\t\t\t</div>\n\t\t`;\n\n\t\tlet dropdown_html = standard_html + fields.map(get_dropdown_html).join('');\n\t\tdropdown.html(dropdown_html);\n\t}\n\n\tsetup_filter_by() {\n\t\tthis.$wrapper.on('click', '.group-by-item', (e) => {\n\t\t\tlet $target = $(e.currentTarget);\n\t\t\tlet fieldname = $target.parents('.group-by-field').find('a').data('fieldname');\n\t\t\tlet value = typeof $target.data('value') === 'string'\n\t\t\t\t? decodeURIComponent($target.data('value').trim())\n\t\t\t\t: $target.data('value');\n\t\t\tfieldname = fieldname === 'assigned_to' ? '_assign': fieldname;\n\n\t\t\treturn this.list_view.filter_area.remove(fieldname)\n\t\t\t\t.then(() => {\n\t\t\t\t\tlet operator = '=';\n\t\t\t\t\tif (value === '') {\n\t\t\t\t\t\toperator = 'is';\n\t\t\t\t\t\tvalue = 'not set';\n\t\t\t\t\t}\n\t\t\t\t\tif (fieldname === '_assign') {\n\t\t\t\t\t\toperator = 'like';\n\t\t\t\t\t\tvalue = `%${value}%`;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.list_view.filter_area.add(this.doctype, fieldname, operator, value);\n\t\t\t\t});\n\t\t});\n\t}\n\n};\n","frappe.provide('frappe.views');\n\nfrappe.views.GanttView = class GanttView extends frappe.views.ListView {\n\tget view_name() {\n\t\treturn 'Gantt';\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.page_title = this.page_title + ' ' + __('Gantt');\n\t\t\t\tthis.calendar_settings = frappe.views.calendar[this.doctype] || {};\n\n\t\t\t\tif (typeof this.calendar_settings.gantt == 'object') {\n\t\t\t\t\tObject.assign(this.calendar_settings, this.calendar_settings.gantt);\n\t\t\t\t}\n\n\t\t\t\tif (this.calendar_settings.order_by) {\n\t\t\t\t\tthis.sort_by = this.calendar_settings.order_by;\n\t\t\t\t\tthis.sort_order = 'asc';\n\t\t\t\t} else {\n\t\t\t\t\tthis.sort_by = this.view_user_settings.sort_by || this.calendar_settings.field_map.start;\n\t\t\t\t\tthis.sort_order = this.view_user_settings.sort_order || 'asc';\n\t\t\t\t}\n\t\t\t})\n\t}\n\n\tsetup_view() {\n\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\t\tthis.prepare_tasks();\n\t}\n\n\tprepare_tasks() {\n\t\tvar me = this;\n\t\tvar meta = this.meta;\n\t\tvar field_map = this.calendar_settings.field_map;\n\n\t\tthis.tasks = this.data.map(function (item) {\n\t\t\t// set progress\n\t\t\tvar progress = 0;\n\t\t\tif (field_map.progress && $.isFunction(field_map.progress)) {\n\t\t\t\tprogress = field_map.progress(item);\n\t\t\t} else if (field_map.progress) {\n\t\t\t\tprogress = item[field_map.progress];\n\t\t\t}\n\n\t\t\t// title\n\t\t\tvar label;\n\t\t\tif (meta.title_field) {\n\t\t\t\tlabel = $.format(\"{0} ({1})\", [item[meta.title_field], item.name]);\n\t\t\t} else {\n\t\t\t\tlabel = item[field_map.title];\n\t\t\t}\n\n\t\t\tvar r = {\n\t\t\t\tstart: item[field_map.start],\n\t\t\t\tend: item[field_map.end],\n\t\t\t\tname: label,\n\t\t\t\tid: item[field_map.id || 'name'],\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\tprogress: progress,\n\t\t\t\tdependencies: item.depends_on_tasks || \"\"\n\t\t\t};\n\n\t\t\tif (item.color && frappe.ui.color.validate_hex(item.color)) {\n\t\t\t\tr['custom_class'] = 'color-' + item.color.substr(1);\n\t\t\t}\n\n\t\t\tif (item.is_milestone) {\n\t\t\t\tr['custom_class'] = 'bar-milestone';\n\t\t\t}\n\n\t\t\treturn r;\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.load_lib.then(() => {\n\t\t\tthis.render_gantt();\n\t\t});\n\t}\n\n\trender_header() {\n\n\t}\n\n\trender_gantt() {\n\t\tconst me = this;\n\t\tconst gantt_view_mode = this.view_user_settings.gantt_view_mode || 'Day';\n\t\tconst field_map = this.calendar_settings.field_map;\n\t\tconst date_format = 'YYYY-MM-DD';\n\n\t\tthis.$result.empty();\n\n\t\tthis.gantt = new Gantt(this.$result[0], this.tasks, {\n\t\t\tview_mode: gantt_view_mode,\n\t\t\tdate_format: \"YYYY-MM-DD\",\n\t\t\ton_click: task => {\n\t\t\t\tfrappe.set_route('Form', task.doctype, task.id);\n\t\t\t},\n\t\t\ton_date_change: (task, start, end) => {\n\t\t\t\tif (!me.can_write) return;\n\t\t\t\tfrappe.db.set_value(task.doctype, task.id, {\n\t\t\t\t\t[field_map.start]: moment(start).format(date_format),\n\t\t\t\t\t[field_map.end]: moment(end).format(date_format)\n\t\t\t\t});\n\t\t\t},\n\t\t\ton_progress_change: (task, progress) => {\n\t\t\t\tif (!me.can_write) return;\n\t\t\t\tvar progress_fieldname = 'progress';\n\n\t\t\t\tif ($.isFunction(field_map.progress)) {\n\t\t\t\t\tprogress_fieldname = null;\n\t\t\t\t} else if (field_map.progress) {\n\t\t\t\t\tprogress_fieldname = field_map.progress;\n\t\t\t\t}\n\n\t\t\t\tif (progress_fieldname) {\n\t\t\t\t\tfrappe.db.set_value(task.doctype, task.id, {\n\t\t\t\t\t\t[progress_fieldname]: parseInt(progress)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\ton_view_change: mode => {\n\t\t\t\t// save view mode\n\t\t\t\tme.save_view_user_settings({\n\t\t\t\t\tgantt_view_mode: mode\n\t\t\t\t});\n\t\t\t},\n\t\t\tcustom_popup_html: task => {\n\t\t\t\tvar item = me.get_item(task.id);\n\n\t\t\t\tvar html =\n\t\t\t\t\t`<div class=\"title\">${task.name}</div>\n\t\t\t\t\t<div class=\"subtitle\">${moment(task._start).format('MMM D')} - ${moment(task._end).format('MMM D')}</div>`;\n\n\t\t\t\t// custom html in doctype settings\n\t\t\t\tvar custom = me.settings.gantt_custom_popup_html;\n\t\t\t\tif (custom && $.isFunction(custom)) {\n\t\t\t\t\tvar ganttobj = task;\n\t\t\t\t\thtml = custom(ganttobj, item);\n\t\t\t\t}\n\t\t\t\treturn '<div class=\"details-container\">' + html + '</div>';\n\t\t\t}\n\t\t});\n\t\tthis.setup_view_mode_buttons();\n\t\tthis.set_colors();\n\t}\n\n\tsetup_view_mode_buttons() {\n\t\t// view modes (for translation) __(\"Day\"), __(\"Week\"), __(\"Month\"),\n\t\t//__(\"Half Day\"), __(\"Quarter Day\")\n\n\t\tlet $btn_group = this.$paging_area.find('.gantt-view-mode');\n\t\tif ($btn_group.length > 0) return;\n\n\t\tconst view_modes = this.gantt.options.view_modes || [];\n\t\tconst active_class = view_mode => this.gantt.view_is(view_mode) ? 'btn-info' : '';\n\t\tconst html =\n\t\t\t`<div class=\"btn-group gantt-view-mode\">\n\t\t\t\t${view_modes.map(value => `<button type=\"button\"\n\t\t\t\t\t\tclass=\"btn btn-default btn-sm btn-view-mode ${active_class(value)}\"\n\t\t\t\t\t\tdata-value=\"${value}\">\n\t\t\t\t\t\t${__(value)}\n\t\t\t\t\t</button>`).join('')}\n\t\t\t</div>`;\n\n\t\tthis.$paging_area.find('.level-left').append(html);\n\n\t\t// change view mode asynchronously\n\t\tconst change_view_mode = (value) => setTimeout(() => this.gantt.change_view_mode(value), 0);\n\n\t\tthis.$paging_area.on('click', '.btn-view-mode', e => {\n\t\t\tconst $btn = $(e.currentTarget);\n\t\t\tthis.$paging_area.find('.btn-view-mode').removeClass('btn-info');\n\t\t\t$btn.addClass('btn-info');\n\n\t\t\tconst value = $btn.data().value;\n\t\t\tchange_view_mode(value);\n\t\t});\n\t}\n\n\tset_colors() {\n\t\tconst classes = this.tasks\n\t\t\t.map(t => t.custom_class)\n\t\t\t.filter(c => c && c.startsWith('color-'));\n\n\t\tlet style = classes.map(c => {\n\t\t\tconst class_name = c.replace('#', '');\n\t\t\tconst bar_color = '#' + c.substr(6);\n\t\t\tconst progress_color = frappe.ui.color.get_contrast_color(bar_color);\n\t\t\treturn `\n\t\t\t\t.gantt .bar-wrapper.${class_name} .bar {\n\t\t\t\t\tfill: ${bar_color};\n\t\t\t\t}\n\t\t\t\t.gantt .bar-wrapper.${class_name} .bar-progress {\n\t\t\t\t\tfill: ${progress_color};\n\t\t\t\t}\n\t\t\t`;\n\t\t}).join(\"\");\n\n\t\tstyle = `<style>${style}</style>`;\n\t\tthis.$result.prepend(style);\n\t}\n\n\tget_item(name) {\n\t\treturn this.data.find(item => item.name === name);\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t\"assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.css\",\n\t\t\t\"assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.min.js\"\n\t\t];\n\t}\n};\n\n","// Copyright (c) 2018, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.views.calendar\");\nfrappe.provide(\"frappe.views.calendars\");\n\nfrappe.views.CalendarView = class CalendarView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 3) {\n\t\t\tconst doctype = route[1];\n\t\t\tconst user_settings = frappe.get_user_settings(doctype)['Calendar'] || {};\n\t\t\troute.push(user_settings.last_calendar || 'Default');\n\t\t\tfrappe.set_route(route);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\ttoggle_result_area() {}\n\n\tget view_name() {\n\t\treturn 'Calendar';\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.page_title = __('{0} Calendar', [this.page_title]);\n\t\t\t\tthis.calendar_settings = frappe.views.calendar[this.doctype] || {};\n\t\t\t\tthis.calendar_name = frappe.get_route()[3];\n\t\t\t});\n\t}\n\n\tsetup_view() {\n\n\t}\n\n\tbefore_render() {\n\t\tsuper.before_render();\n\t\tthis.save_view_user_settings({\n\t\t\tlast_calendar: this.calendar_name\n\t\t});\n\t}\n\n\trender() {\n\t\tif (this.calendar) {\n\t\t\tthis.calendar.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.load_lib\n\t\t\t.then(() => this.get_calendar_preferences())\n\t\t\t.then(options => {\n\t\t\t\tthis.calendar = new frappe.views.Calendar(options);\n\t\t\t});\n\t}\n\n\tget_calendar_preferences() {\n\t\tconst options = {\n\t\t\tdoctype: this.doctype,\n\t\t\tparent: this.$result,\n\t\t\tpage: this.page,\n\t\t\tlist_view: this\n\t\t};\n\t\tconst calendar_name = this.calendar_name;\n\n\t\treturn new Promise(resolve => {\n\t\t\tif (calendar_name === 'Default') {\n\t\t\t\tObject.assign(options, frappe.views.calendar[this.doctype]);\n\t\t\t\tresolve(options);\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doc('Calendar View', calendar_name, () => {\n\t\t\t\t\tconst doc = frappe.get_doc('Calendar View', calendar_name);\n\t\t\t\t\tObject.assign(options, {\n\t\t\t\t\t\tfield_map: {\n\t\t\t\t\t\t\tid: \"name\",\n\t\t\t\t\t\t\tstart: doc.start_date_field,\n\t\t\t\t\t\t\tend: doc.end_date_field,\n\t\t\t\t\t\t\ttitle: doc.subject_field\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresolve(options);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t'assets/frappe/js/lib/fullcalendar/fullcalendar.min.css',\n\t\t\t'assets/frappe/js/lib/fullcalendar/fullcalendar.min.js',\n\t\t\t'assets/frappe/js/lib/fullcalendar/locale-all.js'\n\t\t];\n\t}\n};\n\nfrappe.views.Calendar = Class.extend({\n\tinit: function(options) {\n\t\t$.extend(this, options);\n\t\tthis.get_default_options();\n\t},\n\tget_default_options: function() {\n\t\treturn new Promise ((resolve) => {\n\t\t\tlet defaultView = localStorage.getItem('cal_defaultView');\n\t\t\tlet weekends = localStorage.getItem('cal_weekends');\n\t\t\tlet defaults = {\n\t\t\t\t'defaultView': defaultView ? defaultView : \"month\",\n\t\t\t\t'weekends': weekends ? weekends : true\n\t\t\t};\n\t\t\tresolve(defaults);\n\t\t}).then(defaults => {\n\t\t\tthis.make_page();\n\t\t\tthis.setup_options(defaults);\n\t\t\tthis.make();\n\t\t\tthis.setup_view_mode_button(defaults);\n\t\t\tthis.bind();\n\t\t});\n\t},\n\tmake_page: function() {\n\t\tvar me = this;\n\n\t\t// add links to other calendars\n\t\tme.page.clear_user_actions();\n\t\t$.each(frappe.boot.calendars, function(i, doctype) {\n\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\tme.page.add_menu_item(__(doctype), function() {\n\t\t\t\t\tfrappe.set_route(\"List\", doctype, \"Calendar\");\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$(this.parent).on(\"show\", function() {\n\t\t\tme.$cal.fullCalendar(\"refetchEvents\");\n\t\t});\n\t},\n\n\tmake: function() {\n\t\tthis.$wrapper = this.parent;\n\t\tthis.$cal = $(\"<div>\").appendTo(this.$wrapper);\n\t\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.$wrapper,\n\t\t\t__(\"Select or drag across time slots to create a new event.\"));\n\t\tthis.footnote_area.css({\"border-top\": \"0px\"});\n\n\t\tthis.$cal.fullCalendar(this.cal_options);\n\t\tthis.set_css();\n\t},\n\tsetup_view_mode_button: function(defaults) {\n\t\tvar me = this;\n\t\t$(me.footnote_area).find('.btn-weekend').detach();\n\t\tlet btnTitle = (defaults.weekends) ? __('Hide Weekends') : __('Show Weekends');\n\t\tconst btn = `<button class=\"btn btn-default btn-xs btn-weekend\">${btnTitle}</button>`;\n\t\tme.footnote_area.append(btn);\n\t},\n\tset_localStorage_option: function(option, value) {\n\t\tlocalStorage.removeItem(option);\n\t\tlocalStorage.setItem(option, value);\n\t},\n\tbind: function() {\n\t\tconst me = this;\n\t\tlet btn_group = me.$wrapper.find(\".fc-button-group\");\n\t\tbtn_group.on(\"click\", \".btn\", function() {\n\t\t\tlet value = ($(this).hasClass('fc-agendaWeek-button')) ? 'agendaWeek' : (($(this).hasClass('fc-agendaDay-button')) ? 'agendaDay' : 'month');\n\t\t\tme.set_localStorage_option(\"cal_defaultView\", value);\n\t\t});\n\n\t\tme.$wrapper.on(\"click\", \".btn-weekend\", function() {\n\t\t\tme.cal_options.weekends = !me.cal_options.weekends;\n\t\t\tme.$cal.fullCalendar('option', 'weekends', me.cal_options.weekends);\n\t\t\tme.set_localStorage_option(\"cal_weekends\", me.cal_options.weekends);\n\t\t\tme.set_css();\n\t\t\tme.setup_view_mode_button(me.cal_options);\n\t\t});\n\t},\n\tset_css: function() {\n\t\t// flatify buttons\n\t\tthis.$wrapper.find(\"button.fc-state-default\")\n\t\t\t.removeClass(\"fc-state-default\")\n\t\t\t.addClass(\"btn btn-default\");\n\n\t\tthis.$wrapper.find(\".fc-button-group\").addClass(\"btn-group\");\n\n\t\tthis.$wrapper.find('.fc-prev-button span')\n\t\t\t.attr('class', '').addClass('fa fa-chevron-left');\n\t\tthis.$wrapper.find('.fc-next-button span')\n\t\t\t.attr('class', '').addClass('fa fa-chevron-right');\n\n\t\tvar btn_group = this.$wrapper.find(\".fc-button-group\");\n\t\tbtn_group.find(\".fc-state-active\").addClass(\"active\");\n\n\t\tbtn_group.find(\".btn\").on(\"click\", function() {\n\t\t\tbtn_group.find(\".btn\").removeClass(\"active\");\n\t\t\t$(this).addClass(\"active\");\n\t\t});\n\t},\n\tfield_map: {\n\t\t\"id\": \"name\",\n\t\t\"start\": \"start\",\n\t\t\"end\": \"end\",\n\t\t\"allDay\": \"all_day\",\n\t},\n\tcolor_map: {\n\t\t\"danger\": \"red\",\n\t\t\"success\": \"green\",\n\t\t\"warning\": \"orange\",\n\t\t\"default\": \"blue\"\n\t},\n\tget_system_datetime: function(date) {\n\t\tdate._offset = (moment(date).tz(frappe.sys_defaults.time_zone)._offset);\n\t\treturn frappe.datetime.convert_to_system_tz(date);\n\t},\n\tsetup_options: function(defaults) {\n\t\tvar me = this;\n\t\tthis.cal_options = {\n\t\t\tlocale: frappe.boot.user.language || \"en\",\n\t\t\theader: {\n\t\t\t\tleft: 'title',\n\t\t\t\tcenter: '',\n\t\t\t\tright: 'prev,today,next month,agendaWeek,agendaDay'\n\t\t\t},\n\t\t\teditable: true,\n\t\t\tselectable: true,\n\t\t\tselectHelper: true,\n\t\t\tforceEventDuration: true,\n\t\t\tdefaultView: defaults.defaultView,\n\t\t\tweekends: defaults.weekends,\n\t\t\tnowIndicator: true,\n\t\t\tevents: function(start, end, timezone, callback) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: me.get_events_method || \"frappe.desk.calendar.get_events\",\n\t\t\t\t\ttype: \"GET\",\n\t\t\t\t\targs: me.get_args(start, end),\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tvar events = r.message || [];\n\t\t\t\t\t\tevents = me.prepare_events(events);\n\t\t\t\t\t\tcallback(events);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\teventRender: function(event, element) {\n\t\t\t\telement.attr('title', event.tooltip);\n\t\t\t},\n\t\t\teventClick: function(event) {\n\t\t\t\t// edit event description or delete\n\t\t\t\tvar doctype = event.doctype || me.doctype;\n\t\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\t\tfrappe.set_route(\"Form\", doctype, event.name);\n\t\t\t\t}\n\t\t\t},\n\t\t\teventDrop: function(event, delta, revertFunc) {\n\t\t\t\tme.update_event(event, revertFunc);\n\t\t\t},\n\t\t\teventResize: function(event, delta, revertFunc) {\n\t\t\t\tme.update_event(event, revertFunc);\n\t\t\t},\n\t\t\tselect: function(startDate, endDate, jsEvent, view) {\n\t\t\t\tif (view.name===\"month\" && (endDate - startDate)===86400000) {\n\t\t\t\t\t// detect single day click in month view\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar event = frappe.model.get_new_doc(me.doctype);\n\n\t\t\t\tevent[me.field_map.start] = me.get_system_datetime(startDate);\n\n\t\t\t\tif(me.field_map.end)\n\t\t\t\t\tevent[me.field_map.end] = me.get_system_datetime(endDate);\n\n\t\t\t\tif(me.field_map.allDay) {\n\t\t\t\t\tvar all_day = (startDate._ambigTime && endDate._ambigTime) ? 1 : 0;\n\n\t\t\t\t\tevent[me.field_map.allDay] = all_day;\n\n\t\t\t\t\tif (all_day)\n\t\t\t\t\t\tevent[me.field_map.end] = me.get_system_datetime(moment(endDate).subtract(1, \"s\"));\n\t\t\t\t}\n\n\t\t\t\tfrappe.set_route(\"Form\", me.doctype, event.name);\n\t\t\t},\n\t\t\tdayClick: function(date, jsEvent, view) {\n\t\t\t\tif(view.name === 'month') {\n\t\t\t\t\tconst $date_cell = $('td[data-date=' + date.format('YYYY-MM-DD') + \"]\");\n\n\t\t\t\t\tif($date_cell.hasClass('date-clicked')) {\n\t\t\t\t\t\tme.$cal.fullCalendar('changeView', 'agendaDay');\n\t\t\t\t\t\tme.$cal.fullCalendar('gotoDate', date);\n\t\t\t\t\t\tme.$wrapper.find('.date-clicked').removeClass('date-clicked');\n\n\t\t\t\t\t\t// update \"active view\" btn\n\t\t\t\t\t\tme.$wrapper.find('.fc-month-button').removeClass('active');\n\t\t\t\t\t\tme.$wrapper.find('.fc-agendaDay-button').addClass('active');\n\t\t\t\t\t}\n\n\t\t\t\t\tme.$wrapper.find('.date-clicked').removeClass('date-clicked');\n\t\t\t\t\t$date_cell.addClass('date-clicked');\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tif(this.options) {\n\t\t\t$.extend(this.cal_options, this.options);\n\t\t}\n\t},\n\tget_args: function(start, end) {\n\t\tvar args = {\n\t\t\tdoctype: this.doctype,\n\t\t\tstart: this.get_system_datetime(start),\n\t\t\tend: this.get_system_datetime(end),\n\t\t\tfilters: this.list_view.filter_area.get(),\n\t\t\tfield_map: this.field_map\n\t\t};\n\t\treturn args;\n\t},\n\trefresh: function() {\n\t\tthis.$cal.fullCalendar('refetchEvents');\n\t},\n\tprepare_events: function(events) {\n\t\tvar me = this;\n\n\t\treturn (events || []).map(d => {\n\t\t\td.id = d.name;\n\t\t\td.editable = frappe.model.can_write(d.doctype || me.doctype);\n\n\t\t\t// do not allow submitted/cancelled events to be moved / extended\n\t\t\tif(d.docstatus && d.docstatus > 0) {\n\t\t\t\td.editable = false;\n\t\t\t}\n\n\t\t\t$.each(me.field_map, function(target, source) {\n\t\t\t\td[target] = d[source];\n\t\t\t});\n\n\t\t\tif(!me.field_map.allDay)\n\t\t\t\td.allDay = 1;\n\n\t\t\t// convert to user tz\n\t\t\td.start = frappe.datetime.convert_to_user_tz(d.start);\n\t\t\td.end = frappe.datetime.convert_to_user_tz(d.end);\n\n\t\t\t// show event on single day if start or end date is invalid\n\t\t\tif (!frappe.datetime.validate(d.start) && d.end) {\n\t\t\t\td.start = frappe.datetime.add_days(d.end, -1);\n\t\t\t}\n\n\t\t\tif (d.start && !frappe.datetime.validate(d.end)) {\n\t\t\t\td.end = frappe.datetime.add_days(d.start, 1);\n\t\t\t}\n\n\t\t\tme.fix_end_date_for_event_render(d);\n\t\t\tme.prepare_colors(d);\n\n\t\t\td.title = frappe.utils.html2text(d.title);\n\t\t\t\n\t\t\treturn d;\n\t\t});\n\t},\n\tprepare_colors: function(d) {\n\t\tlet color, color_name;\n\t\tif(this.get_css_class) {\n\t\t\tcolor_name = this.color_map[this.get_css_class(d)];\n\t\t\tcolor_name = frappe.ui.color.validate_hex(color_name) ?\n\t\t\t\tcolor_name : 'blue';\n\t\t\td.backgroundColor = frappe.ui.color.get(color_name, 'extra-light');\n\t\t\td.textColor = frappe.ui.color.get(color_name, 'dark');\n\t\t} else {\n\t\t\tcolor = d.color;\n\t\t\tif (!frappe.ui.color.validate_hex(color) || !color) {\n\t\t\t\tcolor = frappe.ui.color.get('blue', 'extra-light');\n\t\t\t}\n\t\t\td.backgroundColor = color;\n\t\t\td.textColor = frappe.ui.color.get_contrast_color(color);\n\t\t}\n\t\treturn d;\n\t},\n\tupdate_event: function(event, revertFunc) {\n\t\tvar me = this;\n\t\tfrappe.model.remove_from_locals(me.doctype, event.name);\n\t\treturn frappe.call({\n\t\t\tmethod: me.update_event_method || \"frappe.desk.calendar.update_event\",\n\t\t\targs: me.get_update_args(event),\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\tfrappe.show_alert(__(\"Unable to update event\"));\n\t\t\t\t\trevertFunc();\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function() {\n\t\t\t\trevertFunc();\n\t\t\t}\n\t\t});\n\t},\n\tget_update_args: function(event) {\n\t\tvar me = this;\n\t\tvar args = {\n\t\t\tname: event[this.field_map.id]\n\t\t};\n\n\t\targs[this.field_map.start] = me.get_system_datetime(event.start);\n\n\t\tif(this.field_map.allDay)\n\t\t\targs[this.field_map.allDay] = (event.start._ambigTime && event.end._ambigTime) ? 1 : 0;\n\n\t\tif(this.field_map.end) {\n\t\t\tif (!event.end) {\n\t\t\t\tevent.end = event.start.add(1, \"hour\");\n\t\t\t}\n\n\t\t\targs[this.field_map.end] = me.get_system_datetime(event.end);\n\n\t\t\tif (args[this.field_map.allDay]) {\n\t\t\t\targs[this.field_map.end] = me.get_system_datetime(moment(event.end).subtract(1, \"s\"));\n\t\t\t}\n\t\t}\n\n\t\targs.doctype = event.doctype || this.doctype;\n\n\t\treturn { args: args, field_map: this.field_map };\n\t},\n\n\tfix_end_date_for_event_render: function(event) {\n\t\tif (event.allDay) {\n\t\t\t// We use inclusive end dates. This workaround fixes the rendering of events\n\t\t\tevent.start = event.start ? $.fullCalendar.moment(event.start).stripTime() : null;\n\t\t\tevent.end = event.end ? $.fullCalendar.moment(event.end).add(1, \"day\").stripTime() : null;\n\t\t}\n\t}\n});\n","/**\n * frappe.views.ImageView\n */\nfrappe.provide(\"frappe.views\");\n\nfrappe.views.ImageView = class ImageView extends frappe.views.ListView {\n\tget view_name() {\n\t\treturn 'Image';\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.page_title = this.page_title + ' ' + __('Images');\n\t\t\t})\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_columns();\n\t\tthis.setup_check_events();\n\t}\n\n\tset_fields() {\n\t\tthis.fields = [\n\t\t\t'name',\n\t\t\t...this.get_fields_in_list_view().map((el)=> el.fieldname),\n\t\t\tthis.meta.title_field,\n\t\t\tthis.meta.image_field\n\t\t];\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\t\tthis.items = this.data.map(d => {\n\t\t\t// absolute url if cordova, else relative\n\t\t\td._image_url = this.get_image_url(d);\n\t\t\treturn d;\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.get_attached_images()\n\t\t\t.then(() => {\n\t\t\t\tthis.render_image_view();\n\n\t\t\t\tif (!this.gallery) {\n\t\t\t\t\tthis.setup_gallery();\n\t\t\t\t} else {\n\t\t\t\t\tthis.gallery.prepare_pswp_items(this.items, this.images_map);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\trender_image_view() {\n\t\tvar html = this.items.map(this.item_html.bind(this)).join(\"\");\n\n\t\tthis.$result.html(`\n\t\t\t${this.get_header_html()}\n\t\t\t<div class=\"image-view-container small\">\n\t\t\t\t${html}\n\t\t\t</div>\n\t\t`);\n\t}\n\n\titem_details_html(item) {\n\t\tconst info_fields = this.get_fields_in_list_view().map((el)=> el.fieldname)  || [];\n\t\tlet info_html = `<div><ul class=\"list-unstyled image-view-info\">`;\n\t\tinfo_fields.forEach((field, index) => {\n\t\t\tif (item[field]) {\n\t\t\t\tif (index == 0) info_html += `<li>${item[field]}</li>`;\n\t\t\t\telse info_html += `<li class=\"text-muted\">${item[field]}</li>`;\n\t\t\t}\n\t\t})\n\t\tinfo_html += `</ul></div>`;\n\t\treturn info_html;\n\t}\n\n\titem_html(item) {\n\t\titem._name = encodeURI(item.name);\n\t\tconst encoded_name = item._name;\n\t\tconst title = strip_html(item[this.meta.title_field || 'name']);\n\t\tconst _class = !item._image_url ? 'no-image' : '';\n\t\tconst _html = item._image_url ?\n\t\t\t`<img data-name=\"${encoded_name}\" src=\"${ item._image_url }\" alt=\"${ title }\">` :\n\t\t\t`<span class=\"placeholder-text\">\n\t\t\t\t${ frappe.get_abbr(title) }\n\t\t\t</span>`;\n\n\t\tlet details = this.item_details_html(item);\n\n\t\treturn `\n\t\t\t<div class=\"image-view-item\">\n\t\t\t\t<div class=\"image-view-header\">\n\t\t\t\t\t<div class=\"list-row-col list-subject ellipsis level\">\n\t\t\t\t\t\t${this.get_subject_html(item)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"image-view-body\">\n\t\t\t\t\t<a  data-name=\"${encoded_name}\"\n\t\t\t\t\t\ttitle=\"${encoded_name}\"\n\t\t\t\t\t\thref=\"${this.get_form_link(item)}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"image-field ${_class}\"\n\t\t\t\t\t\t\tdata-name=\"${encoded_name}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${_html}\n\t\t\t\t\t\t\t<button class=\"btn btn-default zoom-view\" data-name=\"${encoded_name}\">\n\t\t\t\t\t\t\t\t<i class=\"fa fa-search-plus\"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t${details}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_image_url(data) {\n\t\tvar url;\n\t\turl = data.image ? data.image : data[this.meta.image_field];\n\n\t\t// absolute url for mobile\n\t\tif (window.cordova && !frappe.utils.is_url(url)) {\n\t\t\turl = frappe.base_url + url;\n\t\t}\n\t\tif (url) {\n\t\t\treturn url;\n\t\t}\n\t\treturn null;\n\t}\n\n\tget_attached_images() {\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.core.doctype.file.file.get_attached_images',\n\t\t\targs: {\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tnames: this.items.map(i => i.name)\n\t\t\t}\n\t\t}).then(r => {\n\t\t\tthis.images_map = Object.assign(this.images_map || {}, r.message);\n\t\t});\n\t}\n\n\tget_header_html() {\n\t\treturn this.get_header_html_skeleton(`\n\t\t\t<div class=\"list-row-col list-subject level \">\n\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"Select All\">\n\t\t\t\t<span class=\"level-item list-liked-by-me\">\n\t\t\t\t\t<i class=\"octicon octicon-heart text-extra-muted\" title=\"Likes\"></i>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"level-item\"></span>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\tsetup_gallery() {\n\t\tvar me = this;\n\t\tthis.gallery = new frappe.views.GalleryView({\n\t\t\tdoctype: this.doctype,\n\t\t\titems: this.items,\n\t\t\twrapper: this.$result,\n\t\t\timages_map: this.images_map\n\t\t});\n\t\tthis.$result.on('click', '.btn.zoom-view', function (e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tvar name = $(this).data().name;\n\t\t\tname = decodeURIComponent(name);\n\t\t\tme.gallery.show(name);\n\t\t\treturn false;\n\t\t});\n\t}\n};\n\nfrappe.views.GalleryView = Class.extend({\n\tinit: function (opts) {\n\t\t$.extend(this, opts);\n\t\tvar me = this;\n\n\t\tthis.lib_ready = this.load_lib();\n\t\tthis.lib_ready.then(function () {\n\t\t\tme.prepare();\n\t\t});\n\t},\n\tprepare: function () {\n\t\t// keep only one pswp dom element\n\t\tthis.pswp_root = $('body > .pswp');\n\t\tif (this.pswp_root.length === 0) {\n\t\t\tvar pswp = frappe.render_template('photoswipe_dom');\n\t\t\tthis.pswp_root = $(pswp).appendTo('body');\n\t\t}\n\t},\n\tprepare_pswp_items: function (_items, _images_map) {\n\t\tvar me = this;\n\n\t\tif (_items) {\n\t\t\t// passed when more button clicked\n\t\t\tthis.items = this.items.concat(_items);\n\t\t\tthis.images_map = _images_map;\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tconst items = this.items.map(function (i) {\n\t\t\t\tconst query = 'img[data-name=\"' + i._name + '\"]';\n\t\t\t\tlet el = me.wrapper.find(query).get(0);\n\n\t\t\t\tlet width, height;\n\t\t\t\tif (el) {\n\t\t\t\t\twidth = el.naturalWidth;\n\t\t\t\t\theight = el.naturalHeight;\n\t\t\t\t}\n\n\t\t\t\tif (!el) {\n\t\t\t\t\tel = me.wrapper.find('.image-field[data-name=\"' + i._name + '\"]').get(0);\n\t\t\t\t\twidth = el.getBoundingClientRect().width;\n\t\t\t\t\theight = el.getBoundingClientRect().height;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsrc: i._image_url,\n\t\t\t\t\tmsrc: i._image_url,\n\t\t\t\t\tname: i.name,\n\t\t\t\t\tw: width,\n\t\t\t\t\th: height,\n\t\t\t\t\tel: el\n\t\t\t\t};\n\t\t\t});\n\t\t\tthis.pswp_items = items;\n\t\t\tresolve();\n\t\t});\n\t},\n\tshow: function (docname) {\n\t\tthis.lib_ready\n\t\t\t.then(() => this.prepare_pswp_items())\n\t\t\t.then(() => this._show(docname));\n\t},\n\t_show: function (docname) {\n\t\tconst me = this;\n\t\tconst items = this.pswp_items;\n\t\tconst item_index = items.findIndex(item => item.name === docname);\n\n\t\tvar options = {\n\t\t\tindex: item_index,\n\t\t\tgetThumbBoundsFn: function (index) {\n\t\t\t\tconst query = 'img[data-name=\"' + items[index]._name + '\"]';\n\t\t\t\tlet thumbnail = me.wrapper.find(query).get(0);\n\n\t\t\t\tif (!thumbnail) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n\t\t\t\t\trect = thumbnail.getBoundingClientRect();\n\n\t\t\t\treturn {\n\t\t\t\t\tx: rect.left,\n\t\t\t\t\ty: rect.top + pageYScroll,\n\t\t\t\t\tw: rect.width\n\t\t\t\t};\n\t\t\t},\n\t\t\thistory: false,\n\t\t\tshareEl: false,\n\t\t\tshowHideOpacity: true\n\t\t};\n\n\t\t// init\n\t\tthis.pswp = new PhotoSwipe(\n\t\t\tthis.pswp_root.get(0),\n\t\t\tPhotoSwipeUI_Default,\n\t\t\titems,\n\t\t\toptions\n\t\t);\n\t\tthis.browse_images();\n\t\tthis.pswp.init();\n\t},\n\tbrowse_images: function () {\n\t\tconst $more_items = this.pswp_root.find('.pswp__more-items');\n\t\tconst images_map = this.images_map;\n\t\tlet last_hide_timeout = null;\n\n\t\tthis.pswp.listen('afterChange', function () {\n\t\t\tconst images = images_map[this.currItem.name];\n\t\t\tif (!images || images.length === 1) {\n\t\t\t\t$more_items.html('');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thide_more_items_after_2s();\n\t\t\tconst html = images.map(img_html).join(\"\");\n\t\t\t$more_items.html(html);\n\t\t});\n\n\t\tthis.pswp.listen('beforeChange', hide_more_items);\n\t\tthis.pswp.listen('initialZoomOut', hide_more_items);\n\t\tthis.pswp.listen('destroy', () => {\n\t\t\t$(document).off('mousemove', hide_more_items_after_2s);\n\t\t});\n\n\t\t// Replace current image on click\n\t\t$more_items.on('click', '.pswp__more-item', (e) => {\n\t\t\tconst img_el = e.target;\n\t\t\tconst index = this.pswp.items.findIndex(i => i.name === this.pswp.currItem.name);\n\n\t\t\tthis.pswp.goTo(index);\n\t\t\tthis.pswp.items.splice(index, 1, {\n\t\t\t\tsrc: img_el.src,\n\t\t\t\tw: img_el.naturalWidth,\n\t\t\t\th: img_el.naturalHeight,\n\t\t\t\tname: this.pswp.currItem.name\n\t\t\t});\n\t\t\tthis.pswp.invalidateCurrItems();\n\t\t\tthis.pswp.updateSize(true);\n\t\t});\n\n\t\t// hide more-images 2s after mousemove\n\t\t$(document).on('mousemove', hide_more_items_after_2s);\n\n\t\tfunction hide_more_items_after_2s() {\n\t\t\tclearTimeout(last_hide_timeout);\n\t\t\tshow_more_items();\n\t\t\tlast_hide_timeout = setTimeout(hide_more_items, 2000);\n\t\t}\n\n\t\tfunction show_more_items() {\n\t\t\t$more_items.show();\n\t\t}\n\n\t\tfunction hide_more_items() {\n\t\t\t$more_items.hide();\n\t\t}\n\n\t\tfunction img_html(src) {\n\t\t\treturn `<div class=\"pswp__more-item\">\n\t\t\t\t<img src=\"${src}\">\n\t\t\t</div>`;\n\t\t}\n\t},\n\tload_lib: function () {\n\t\treturn new Promise(resolve => {\n\t\t\tvar asset_dir = 'assets/frappe/js/lib/photoswipe/';\n\t\t\tfrappe.require([\n\t\t\t\tasset_dir + 'photoswipe.css',\n\t\t\t\tasset_dir + 'default-skin.css',\n\t\t\t\tasset_dir + 'photoswipe.js',\n\t\t\t\tasset_dir + 'photoswipe-ui-default.js'\n\t\t\t], resolve);\n\t\t});\n\t}\n});","frappe.provide('frappe.views');\n\nfrappe.views.KanbanView = class KanbanView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 3) {\n\t\t\tconst doctype = route[1];\n\t\t\tconst user_settings = frappe.get_user_settings(doctype)['Kanban'] || {};\n\t\t\tif (!user_settings.last_kanban_board) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: __('Missing parameter Kanban Board Name')\n\t\t\t\t});\n\t\t\t\tfrappe.set_route('List', doctype, 'List');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\troute.push(user_settings.last_kanban_board);\n\t\t\tfrappe.set_route(route);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tget view_name() {\n\t\treturn 'Kanban';\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.board_name = frappe.get_route()[3];\n\t\t\t\tthis.page_title = __(this.board_name);\n\t\t\t\tthis.card_meta = this.get_card_meta();\n\n\t\t\t\tthis.menu_items.push({\n\t\t\t\t\tlabel: __('Save filters'),\n\t\t\t\t\taction: () => {\n\t\t\t\t\t\tthis.save_kanban_board_filters();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn this.get_board();\n\t\t\t});\n\t}\n\n\tget_board() {\n\t\treturn frappe.db.get_doc('Kanban Board', this.board_name)\n\t\t\t.then(board => {\n\t\t\t\tthis.board = board;\n\t\t\t\tthis.board.filters_array = JSON.parse(this.board.filters || '[]');\n\t\t\t\tthis.filters = this.board.filters_array;\n\t\t\t});\n\t}\n\n\tbefore_refresh() {\n\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_realtime_updates();\n\t}\n\n\tset_fields() {\n\t\tsuper.set_fields();\n\t\tthis._add_field(this.card_meta.title_field);\n\t}\n\n\tbefore_render() {\n\t\tfrappe.model.user_settings.save(this.doctype, 'last_view', this.view_name);\n\t\tthis.save_view_user_settings({\n\t\t\tlast_kanban_board: this.board_name\n\t\t});\n\t}\n\n\trender_list() {\n\n\t}\n\n\ton_filter_change() {\n\t\tif (JSON.stringify(this.board.filters_array) !== JSON.stringify(this.filter_area.get())) {\n\t\t\tthis.page.set_indicator(__('Not Saved'), 'orange');\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t}\n\n\tsave_kanban_board_filters() {\n\t\tconst filters = this.filter_area.get();\n\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.desk.doctype.kanban_board.kanban_board.save_filters',\n\t\t\targs: {\n\t\t\t\tboard_name: this.board_name,\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}).then(r => {\n\t\t\tif (r.exc) {\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: __('There was an error saving filters')\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfrappe.show_alert({\n\t\t\t\tindicator: 'green',\n\t\t\t\tmessage: __('Filters saved')\n\t\t\t});\n\n\t\t\tthis.board.filters_array = filters;\n\t\t\tthis.on_filter_change();\n\t\t});\n\t}\n\n\tget_fields() {\n\t\tthis.fields.push([this.board.field_name, this.board.reference_doctype]);\n\t\treturn super.get_fields();\n\t}\n\n\trender() {\n\t\tconst board_name = this.board_name;\n\t\tif (this.kanban && board_name === this.kanban.board_name) {\n\t\t\tthis.kanban.update(this.data);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.kanban = new frappe.views.KanbanBoard({\n\t\t\tdoctype: this.doctype,\n\t\t\tboard: this.board,\n\t\t\tboard_name: board_name,\n\t\t\tcards: this.data,\n\t\t\tcard_meta: this.card_meta,\n\t\t\twrapper: this.$result,\n\t\t\tcur_list: this,\n\t\t\tuser_settings: this.view_user_settings\n\t\t});\n\t}\n\n\tget_card_meta() {\n\t\tvar meta = frappe.get_meta(this.doctype);\n\t\tvar doc = frappe.model.get_new_doc(this.doctype);\n\t\tvar title_field = null;\n\t\tvar quick_entry = false;\n\n\t\tif (this.meta.title_field) {\n\t\t\ttitle_field = frappe.meta.get_field(this.doctype, this.meta.title_field);\n\t\t}\n\n\t\tthis.meta.fields.forEach((df) => {\n\t\t\tconst is_valid_field =\n\t\t\t\tin_list(['Data', 'Text', 'Small Text', 'Text Editor'], df.fieldtype)\n\t\t\t\t&& !df.hidden;\n\n\t\t\tif (is_valid_field && !title_field) {\n\t\t\t\t// can be mapped to textarea\n\t\t\t\ttitle_field = df;\n\t\t\t}\n\t\t});\n\n\t\t// quick entry\n\t\tvar mandatory = meta.fields.filter((df) => df.reqd && !doc[df.fieldname]);\n\n\t\tif (mandatory.some(df => frappe.model.table_fields.includes(df.fieldtype)) || mandatory.length > 1) {\n\t\t\tquick_entry = true;\n\t\t}\n\n\t\tif (!title_field) {\n\t\t\ttitle_field = frappe.meta.get_field(this.doctype, 'name');\n\t\t}\n\n\t\treturn {\n\t\t\tquick_entry: quick_entry,\n\t\t\ttitle_field: title_field\n\t\t};\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t'assets/frappe/js/lib/fluxify.min.js',\n\t\t\t'assets/frappe/js/frappe/views/kanban/kanban_board.js'\n\t\t];\n\t}\n};\n\n\nfrappe.views.KanbanView.setup_dropdown_in_sidebar = function(doctype, $dropdown) {\n\t// get kanban boards and append to dropdown\n\tget_kanban_boards()\n\t\t.then((kanban_boards) => {\n\t\t\tif (!kanban_boards) return;\n\n\t\t\t$('<li role=\"separator\" class=\"divider\"></li>').appendTo($dropdown);\n\n\t\t\tkanban_boards.forEach(board => {\n\t\t\t\tconst route = ['List', board.reference_doctype, 'Kanban', board.name].join('/');\n\n\t\t\t\t$(`<li>\n\t\t\t\t\t<a href=\"#${route}\">\n\t\t\t\t\t\t<span>${__(board.name)}</span>\n\t\t\t\t\t${board.private ? '<i class=\"fa fa-lock fa-fw text-warning\"></i>' : ''}\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t\t`).appendTo($dropdown);\n\t\t\t});\n\t\t});\n\n\t$dropdown.on('click', '.new-kanban-board', () => {\n\t\tconst dialog = new_kanban_dialog();\n\t\tdialog.show();\n\t});\n\n\tfunction make_kanban_board(board_name, field_name, project) {\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.doctype.kanban_board.kanban_board.quick_kanban_board',\n\t\t\targs: {\n\t\t\t\tdoctype,\n\t\t\t\tboard_name,\n\t\t\t\tfield_name,\n\t\t\t\tproject\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar kb = r.message;\n\t\t\t\tif (kb.filters) {\n\t\t\t\t\tfrappe.provide('frappe.kanban_filters');\n\t\t\t\t\tfrappe.kanban_filters[kb.kanban_board_name] = kb.filters;\n\t\t\t\t}\n\t\t\t\tfrappe.set_route('List', doctype, 'Kanban', kb.kanban_board_name);\n\t\t\t}\n\t\t});\n\t}\n\n\tlet dialog = null;\n\n\tfunction new_kanban_dialog() {\n\t\tif (dialog) return dialog;\n\n\t\tconst fields = get_fields_for_dialog();\n\n\t\tlet primary_action_label = fields.length > 1 ? __('Save') : '';\n\t\tlet primary_action = fields.length > 1 ?\n\t\t\t({ board_name, field_name, project }) => {\n\t\t\t\tmake_kanban_board(board_name, field_name, project)\n\t\t\t\t\t.then(() => dialog.hide(), (err) => frappe.msgprint(err));\n\t\t\t} : null;\n\n\t\tdialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('New Kanban Board'),\n\t\t\tfields,\n\t\t\tprimary_action_label,\n\t\t\tprimary_action\n\t\t});\n\t\treturn dialog;\n\t}\n\n\tfunction get_fields_for_dialog() {\n\n\t\tlet fields = [{\n\t\t\tfieldtype: 'Data',\n\t\t\tfieldname: 'board_name',\n\t\t\tlabel: __('Kanban Board Name'),\n\t\t\treqd: 1,\n\t\t\tdescription: ['Note', 'ToDo'].includes(doctype) ?\n\t\t\t\t__('This Kanban Board will be private') : ''\n\t\t}];\n\n\t\tif (doctype === 'Task') {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\tfieldname: 'project',\n\t\t\t\tlabel: __('Project'),\n\t\t\t\toptions: 'Project'\n\t\t\t});\n\t\t}\n\n\t\tconst select_fields =\n\t\t\tfrappe.get_meta(doctype).fields\n\t\t\t\t.filter(df => {\n\t\t\t\t\treturn df.fieldtype === 'Select' &&\n\t\t\t\t\t\tdf.fieldname !== 'kanban_column';\n\t\t\t\t});\n\n\t\tif (select_fields.length > 0) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\tfieldname: 'field_name',\n\t\t\t\tlabel: __('Columns based on'),\n\t\t\t\toptions: select_fields.map(df => ({label: df.label, value: df.fieldname})),\n\t\t\t\tdefault: select_fields[0],\n\t\t\t\treqd: 1,\n\t\t\t});\n\t\t} else {\n\t\t\tfields = [{\n\t\t\t\tfieldtype: 'HTML',\n\t\t\t\toptions: `\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p class=\"text-medium\">\n\t\t\t\t\t\t${__('No fields found that can be used as a Kanban Column. Use the Customize Form to add a Custom Field of type \"Select\".')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" href=\"#Form/Customize Form?doc_type=${doctype}\">\n\t\t\t\t\t\t\t${__('Customize Form')}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t`\n\t\t\t}];\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tfunction get_kanban_boards() {\n\t\treturn frappe.call('frappe.desk.doctype.kanban_board.kanban_board.get_kanban_boards', { doctype })\n\t\t\t.then(r => r.message);\n\t}\n};\n","/**\n * frappe.views.InboxView\n */\n\nfrappe.provide(\"frappe.views\");\n\nfrappe.views.InboxView = class InboxView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (!route[3] && frappe.boot.email_accounts.length) {\n\t\t\tlet email_account;\n\t\t\tif (frappe.boot.email_accounts[0].email_id == \"All Accounts\") {\n\t\t\t\temail_account = \"All Accounts\";\n\t\t\t} else {\n\t\t\t\temail_account = frappe.boot.email_accounts[0].email_account;\n\t\t\t}\n\t\t\tfrappe.set_route(\"List\", \"Communication\", \"Inbox\", email_account);\n\t\t\treturn true;\n\t\t} else if (!route[3] || (route[3] !== \"All Accounts\" && !is_valid(route[3]))) {\n\t\t\tfrappe.throw(__('No email account associated with the User. Please add an account under User > Email Inbox.'));\n\t\t}\n\t\treturn false;\n\n\t\tfunction is_valid(email_account) {\n\t\t\treturn frappe.boot.email_accounts.find(d => d.email_account === email_account);\n\t\t}\n\t}\n\n\tget view_name() {\n\t\treturn 'Inbox';\n\t}\n\n\tshow() {\n\t\tsuper.show();\n\t\t// save email account in user_settings\n\t\tthis.save_view_user_settings({\n\t\t\tlast_email_account: this.current_email_account\n\t\t});\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\n\t\t// initialize with saved order by\n\t\tthis.sort_by = this.view_user_settings.sort_by || 'communication_date';\n\t\tthis.sort_order = this.view_user_settings.sort_order || 'desc';\n\n\t\tthis.email_account = frappe.get_route()[3];\n\t\tthis.page_title = this.email_account;\n\t\tthis.filters = this.get_inbox_filters();\n\t}\n\n\tsetup_columns() {\n\t\t// setup columns for list view\n\t\tthis.columns = [];\n\t\tthis.columns.push({\n\t\t\ttype: 'Subject',\n\t\t\tdf: {\n\t\t\t\tlabel: __('Subject'),\n\t\t\t\tfieldname: 'subject'\n\t\t\t}\n\t\t});\n\t\tthis.columns.push({\n\t\t\ttype: 'Field',\n\t\t\tdf: {\n\t\t\t\tlabel: this.is_sent_emails ? __(\"To\") : __(\"From\"),\n\t\t\t\tfieldname: this.is_sent_emails ? 'recipients' : 'sender'\n\t\t\t}\n\t\t});\n\t}\n\n\tget_seen_class(doc) {\n\t\tconst seen =\n\t\t\tBoolean(doc.seen) || JSON.parse(doc._seen || '[]').includes(frappe.session.user)\n\t\t\t\t? ''\n\t\t\t\t: 'bold';\n\t\treturn seen;\n\t}\n\n\tget is_sent_emails() {\n\t\tconst f = this.filter_area.get()\n\t\t\t.find(filter => filter[1] === 'sent_or_received');\n\t\treturn f && f[3] === 'Sent';\n\t}\n\n\trender_header() {\n\t\tthis.$result.find('.list-row-head').remove();\n\t\tthis.$result.prepend(this.get_header_html());\n\t}\n\n\trender() {\n\t\tthis.setup_columns();\n\t\tthis.render_header();\n\t\tthis.render_list();\n\t\tthis.on_row_checked();\n\t\tthis.render_count();\n\t\tthis.render_tags();\n\t}\n\n\tget_meta_html(email) {\n\t\tconst attachment = email.has_attachment ?\n\t\t\t`<span class=\"fa fa-paperclip fa-large\" title=\"${__('Has Attachments')}\"></span>` : '';\n\n\t\tconst form_link = frappe.utils.get_form_link(email.reference_doctype, email.reference_name);\n\t\tconst link = email.reference_doctype && email.reference_doctype !== this.doctype ?\n\t\t\t`<a class=\"text-muted grey\" href=\"${form_link}\"\n\t\t\t\ttitle=\"${__('Linked with {0}', [email.reference_doctype])}\">\n\t\t\t\t<i class=\"fa fa-link fa-large\"></i>\n\t\t\t</a>` : '';\n\n\t\tconst communication_date = comment_when(email.communication_date, true);\n\t\tconst status =\n\t\t\temail.status == \"Closed\" ? `<span class=\"fa fa-check fa-large\" title=\"${__(email.status)}\"></span>` :\n\t\t\t\temail.status == \"Replied\" ? `<span class=\"fa fa-mail-reply fa-large\" title=\"${__(email.status)}\"></span>` :\n\t\t\t\t\t\"\";\n\n\t\treturn `\n\t\t\t<div class=\"level-item list-row-activity\">\n\t\t\t\t${link}\n\t\t\t\t${attachment}\n\t\t\t\t${status}\n\t\t\t\t${communication_date}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_inbox_filters() {\n\t\tvar email_account = this.email_account;\n\t\tvar default_filters = [\n\t\t\t[\"Communication\", \"communication_type\", \"=\", \"Communication\", true],\n\t\t\t[\"Communication\", \"communication_medium\", \"=\", \"Email\", true],\n\t\t];\n\t\tvar filters = [];\n\t\tif (email_account === \"Sent\") {\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"sent_or_received\", \"=\", \"Sent\", true],\n\t\t\t\t[\"Communication\", \"email_status\", \"not in\", \"Spam,Trash\", true],\n\t\t\t]);\n\t\t} else if (in_list([\"Spam\", \"Trash\"], email_account)) {\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"email_status\", \"=\", email_account, true],\n\t\t\t\t[\"Communication\", \"email_account\", \"in\", frappe.boot.all_accounts, true]\n\t\t\t]);\n\t\t} else {\n\t\t\tvar op = \"=\";\n\t\t\tif (email_account == \"All Accounts\") {\n\t\t\t\top = \"in\";\n\t\t\t\temail_account = frappe.boot.all_accounts;\n\t\t\t}\n\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"sent_or_received\", \"=\", \"Received\", true],\n\t\t\t\t[\"Communication\", \"status\", \"=\", \"Open\", true],\n\t\t\t\t[\"Communication\", \"email_account\", op, email_account, true],\n\t\t\t\t[\"Communication\", \"email_status\", \"not in\", \"Spam,Trash\", true],\n\t\t\t]);\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tget_no_result_message() {\n\t\tvar email_account = this.email_account;\n\t\tvar args;\n\t\tif (in_list([\"Spam\", \"Trash\"], email_account)) {\n\t\t\treturn __(\"No {0} mail\", [email_account]);\n\t\t} else if (!email_account && !frappe.boot.email_accounts.length) {\n\t\t\t// email account is not configured\n\t\t\targs = {\n\t\t\t\tdoctype: \"Email Account\",\n\t\t\t\tmsg: __(\"No Email Account\"),\n\t\t\t\tlabel: __(\"New Email Account\"),\n\t\t\t};\n\t\t} else {\n\t\t\t// no sent mail\n\t\t\targs = {\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tmsg: __(\"No Emails\"),\n\t\t\t\tlabel: __(\"Compose Email\")\n\t\t\t};\n\t\t}\n\n\t\tconst html = frappe.model.can_create(args.doctype) ?\n\t\t\t`<p>${args.msg}</p>\n\t\t\t<p>\n\t\t\t\t<button class=\"btn btn-primary btn-sm btn-new-doc\">\n\t\t\t\t\t${args.label}\n\t\t\t\t</button>\n\t\t\t</p>\n\t\t\t` :\n\t\t\t`<p>${ __(\"No Email Accounts Assigned\") }</p>`;\n\n\t\treturn `\n\t\t\t<div class=\"msg-box no-border\">\n\t\t\t\t${html}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tmake_new_doc() {\n\t\tif (!this.email_account && !frappe.boot.email_accounts.length) {\n\t\t\tfrappe.route_options = {\n\t\t\t\t'email_id': frappe.session.user_email\n\t\t\t};\n\t\t\tfrappe.new_doc('Email Account');\n\t\t} else {\n\t\t\tnew frappe.views.CommunicationComposer({\n\t\t\t\tdoc: {}\n\t\t\t});\n\t\t}\n\t}\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.treeview_settings\");\nfrappe.provide('frappe.views.trees');\nwindow.cur_tree = null;\n\nfrappe.views.TreeFactory = class TreeFactory extends frappe.views.Factory {\n\tmake(route) {\n\t\tfrappe.model.with_doctype(route[1], function() {\n\t\t\tvar options = {\n\t\t\t\tdoctype: route[1],\n\t\t\t\tmeta: frappe.get_meta(route[1])\n\t\t\t};\n\n\t\t\tif (!frappe.treeview_settings[route[1]] && !frappe.meta.get_docfield(route[1], \"is_group\")) {\n\t\t\t\tfrappe.msgprint(__(\"Tree view not available for {0}\", [route[1]] ));\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t$.extend(options, frappe.treeview_settings[route[1]] || {});\n\t\t\tfrappe.views.trees[options.doctype] = new frappe.views.TreeView(options);\n\t\t});\n\t}\n}\n\nfrappe.views.TreeView = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\n\t\tthis.opts = {};\n\t\tthis.opts.get_tree_root = true;\n\t\tthis.opts.show_expand_all = true;\n\t\t$.extend(this.opts, opts);\n\t\tthis.doctype = opts.doctype;\n\t\tthis.args = {doctype: me.doctype};\n\t\tthis.page_name = frappe.get_route_str();\n\t\tthis.get_tree_nodes =  me.opts.get_tree_nodes || \"frappe.desk.treeview.get_children\";\n\n\t\tthis.get_permissions();\n\t\tthis.make_page();\n\t\tthis.make_filters();\n\n\t\tif (me.opts.get_tree_root) {\n\t\t\tthis.get_root();\n\t\t}\n\n\t\tthis.onload();\n\t\tthis.set_menu_item();\n\t\tthis.set_primary_action();\n\t},\n\tget_permissions: function(){\n\t\tthis.can_read = frappe.model.can_read(this.doctype);\n\t\tthis.can_create = frappe.boot.user.can_create.indexOf(this.doctype) !== -1 ||\n\t\t\t\t\tfrappe.boot.user.in_create.indexOf(this.doctype) !== -1;\n\t\tthis.can_write = frappe.model.can_write(this.doctype);\n\t\tthis.can_delete = frappe.model.can_delete(this.doctype);\n\t},\n\tmake_page: function() {\n\t\tvar me = this;\n\t\tthis.parent = frappe.container.add_page(this.page_name);\n\t\tfrappe.ui.make_app_page({parent:this.parent, single_column:true});\n\n\t\tthis.page = this.parent.page;\n\t\tfrappe.container.change_to(this.page_name);\n\t\tfrappe.breadcrumbs.add(me.opts.breadcrumb || locals.DocType[me.doctype].module, me.doctype);\n\n\t\tthis.set_title();\n\n\t\tthis.page.main.css({\n\t\t\t\"min-height\": \"300px\",\n\t\t\t\"padding-bottom\": \"25px\"\n\t\t});\n\n\t\tif(this.opts.show_expand_all) {\n\t\t\tthis.page.add_inner_button(__('Expand All'), function() {\n\t\t\t\tme.tree.load_children(me.tree.root_node, true);\n\t\t\t});\n\t\t}\n\n\t\tif(this.opts.view_template) {\n\t\t\tvar row = $('<div class=\"row\"><div>').appendTo(this.page.main);\n\t\t\tthis.body = $('<div class=\"col-sm-6 col-xs-12\"></div>').appendTo(row);\n\t\t\tthis.node_view = $('<div class=\"col-sm-6 hidden-xs\"></div>').appendTo(row);\n\t\t} else {\n\t\t\tthis.body = this.page.main;\n\t\t}\n\t},\n\tset_title: function() {\n\t\tthis.page.set_title(this.opts.title || __('{0} Tree', [__(this.doctype)]));\n\t},\n\tonload: function() {\n\t\tvar me = this;\n\t\tthis.opts.onload && this.opts.onload(me);\n\t},\n\tmake_filters: function() {\n\t\tvar me = this;\n\t\tfrappe.treeview_settings.filters = []\n\t\t$.each(this.opts.filters || [], function(i, filter) {\n\t\t\tif (frappe.route_options && frappe.route_options[filter.fieldname]) {\n\t\t\t\tfilter.default = frappe.route_options[filter.fieldname];\n\t\t\t}\n\n\t\t\tif (!filter.disable_onchange) {\n\t\t\t\tfilter.change = function() {\n\t\t\t\t\tfilter.onchange && filter.onchange();\n\t\t\t\t\tvar val = this.get_value();\n\t\t\t\t\tme.args[filter.fieldname] = val;\n\t\t\t\t\tif (val) {\n\t\t\t\t\t\tme.root_label = val;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.root_label = me.opts.root_label;\n\t\t\t\t\t}\n\t\t\t\t\tme.set_title();\n\t\t\t\t\tme.make_tree();\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tme.page.add_field(filter);\n\n\t\t\tif (filter.default) {\n\t\t\t\t$(\"[data-fieldname='\"+filter.fieldname+\"']\").trigger(\"change\");\n\t\t\t}\n\t\t});\n\t},\n\tget_root: function() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: me.get_tree_nodes,\n\t\t\targs: me.args,\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tme.root_label = r.message[0][\"value\"];\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tmake_tree: function() {\n\t\t$(this.parent).find(\".tree\").remove();\n\n\t\tthis.tree = new frappe.ui.Tree({\n\t\t\tparent: this.body,\n\t\t\tlabel: this.args[this.opts.root_label] || this.root_label || this.opts.root_label,\n\t\t\texpandable: true,\n\n\t\t\targs: this.args,\n\t\t\tmethod: this.get_tree_nodes,\n\n\t\t\t// array of button props: {label, condition, click, btnClass}\n\t\t\ttoolbar: this.get_toolbar(),\n\n\t\t\tget_label: this.opts.get_label,\n\t\t\ton_render: this.opts.onrender,\n\t\t\ton_click: (node) => { this.select_node(node); },\n\t\t});\n\n\t\tcur_tree = this.tree;\n\t\tthis.post_render();\n\t},\n\n\tpost_render: function() {\n\t\tvar me = this;\n\t\tme.opts.post_render && me.opts.post_render(me);\n\t},\n\n\tselect_node: function(node) {\n\t\tvar me = this;\n\t\tif(this.opts.click) {\n\t\t\tthis.opts.click(node);\n\t\t}\n\t\tif(this.opts.view_template) {\n\t\t\tthis.node_view.empty();\n\t\t\t$(frappe.render_template(me.opts.view_template,\n\t\t\t\t{data:node.data, doctype:me.doctype})).appendTo(this.node_view);\n\t\t}\n\t},\n\tget_toolbar: function() {\n\t\tvar me = this;\n\n\t\tvar toolbar = [\n\t\t\t{\n\t\t\t\tlabel:__(me.can_write? \"Edit\": \"Details\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\treturn !node.is_root && me.can_read;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.set_route(\"Form\", me.doctype, node.label);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Add Child\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\treturn me.can_create && node.expandable && !node.hide_add;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tme.new_node();\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Rename\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\tlet allow_rename = true;\n\t\t\t\t\tif (me.doctype && frappe.get_meta(me.doctype)) {\n\t\t\t\t\t\tif(!frappe.get_meta(me.doctype).allow_rename) allow_rename = false;\n\t\t\t\t\t}\n\t\t\t\t\treturn !node.is_root && me.can_write && allow_rename;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.model.rename_doc(me.doctype, node.label, function(new_name) {\n\t\t\t\t\t\tnode.$tree_link.find('a').text(new_name);\n\t\t\t\t\t\tnode.label = new_name;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Delete\"),\n\t\t\t\tcondition: function(node) { return !node.is_root && me.can_delete; },\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.model.delete_doc(me.doctype, node.label, function() {\n\t\t\t\t\t\tnode.parent.remove();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t}\n\t\t]\n\n\t\tif(this.opts.toolbar && this.opts.extend_toolbar) {\n\t\t\ttoolbar = toolbar.filter(btn => {\n\t\t\t\treturn !me.opts.toolbar.find(d => d[\"label\"]==btn[\"label\"]);\n\t\t\t});\n\t\t\treturn toolbar.concat(this.opts.toolbar)\n\t\t} else if (this.opts.toolbar && !this.opts.extend_toolbar) {\n\t\t\treturn this.opts.toolbar\n\t\t} else {\n\t\t\treturn toolbar\n\t\t}\n\t},\n\tnew_node: function() {\n\t\tvar me = this;\n\t\tvar node = me.tree.get_selected_node();\n\n\t\tif(!(node && node.expandable)) {\n\t\t\tfrappe.msgprint(__(\"Select a group node first.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.prepare_fields();\n\n\t\t// the dialog\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __('New {0}',[__(me.doctype)]),\n\t\t\tfields: me.fields\n\t\t});\n\n\t\tvar args = $.extend({}, me.args);\n\t\targs[\"parent_\"+me.doctype.toLowerCase().replace(/ /g,'_')] = me.args[\"parent\"];\n\n\t\td.set_value(\"is_group\", 0);\n\t\td.set_values(args);\n\n\t\t// create\n\t\td.set_primary_action(__(\"Create New\"), function() {\n\t\t\tvar btn = this;\n\t\t\tvar v = d.get_values();\n\t\t\tif(!v) return;\n\n\t\t\tv.parent = node.label;\n\t\t\tv.doctype = me.doctype;\n\n\t\t\tif(node.is_root){\n\t\t\t\tv['is_root'] = node.is_root;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tv['is_root'] = false;\n\t\t\t}\n\n\t\t\td.hide();\n\t\t\tfrappe.dom.freeze(__('Creating {0}', [me.doctype]));\n\n\t\t\t$.extend(args, v)\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: me.opts.add_tree_node || \"frappe.desk.treeview.add_node\",\n\t\t\t\targs: args,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif(node.expanded) {\n\t\t\t\t\t\t\tme.tree.toggle_node(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.tree.load_children(node, true);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t\td.show();\n\t},\n\tprepare_fields: function(){\n\t\tvar me = this;\n\n\t\tthis.fields = [\n\t\t\t{fieldtype:'Check', fieldname:'is_group', label:__('Group Node'),\n\t\t\t\tdescription: __(\"Further nodes can be only created under 'Group' type nodes\")}\n\t\t]\n\n\t\tif (this.opts.fields) {\n\t\t\tthis.fields = this.opts.fields;\n\t\t}\n\n\t\tthis.ignore_fields = this.opts.ignore_fields || [];\n\n\t\tvar mandatory_fields = $.map(me.opts.meta.fields, function(d) {\n\t\t\treturn (d.reqd || d.bold && !d.read_only) ? d : null });\n\n\t\tvar opts_field_names = this.fields.map(function(d) {\n\t\t\treturn d.fieldname\n\t\t})\n\n\t\tmandatory_fields.map(function(d) {\n\t\t\tif($.inArray(d.fieldname, me.ignore_fields) === -1 && $.inArray(d.fieldname, opts_field_names) === -1) {\n\t\t\t\tme.fields.push(d)\n\t\t\t}\n\t\t})\n\t},\n\tprint_tree: function() {\n\t\tif(!frappe.model.can_print(this.doctype)) {\n\t\t\tfrappe.msgprint(__(\"You are not allowed to print this report\"));\n\t\t\treturn false;\n\t\t}\n\t\tvar tree = $(\".tree:visible\").html();\n\t\tvar me = this;\n\t\tfrappe.ui.get_print_settings(false, function(print_settings) {\n\t\t\tvar title =  __(me.docname || me.doctype);\n\t\t\tfrappe.render_tree({title: title, tree: tree, print_settings:print_settings});\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.core.doctype.access_log.access_log.make_access_log\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.doctype,\n\t\t\t\t\treport_name: me.page_name,\n\t\t\t\t\tpage: tree,\n\t\t\t\t\tmethod: 'Print'\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tset_primary_action: function(){\n\t\tvar me = this;\n\t\tif (!this.opts.disable_add_node && this.can_create) {\n\t\t\tme.page.set_primary_action(__(\"New\"), function() {\n\t\t\t\tme.new_node();\n\t\t\t}, \"octicon octicon-plus\")\n\t\t}\n\t},\n\tset_menu_item: function(){\n\t\tvar me = this;\n\n\t\tthis.menu_items = [\n\t\t\t{\n\t\t\t\tlabel: __('View List'),\n\t\t\t\taction: function() {\n\t\t\t\t\tfrappe.set_route('List', me.doctype);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: function() {\n\t\t\t\t\tme.print_tree();\n\t\t\t\t}\n\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Refresh'),\n\t\t\t\taction: function() {\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\n\t\tif (me.opts.menu_items) {\n\t\t\tme.menu_items.push.apply(me.menu_items, me.opts.menu_items)\n\t\t}\n\n\t\t$.each(me.menu_items, function(i, menu_item){\n\t\t\tvar has_perm = true;\n\t\t\tif(menu_item[\"condition\"]) {\n\t\t\t\thas_perm = eval(menu_item[\"condition\"]);\n\t\t\t}\n\n\t\t\tif (has_perm) {\n\t\t\t\tme.page.add_menu_item(menu_item[\"label\"], menu_item[\"action\"]);\n\t\t\t}\n\t\t});\n\t}\n});\n\n\n\n\n\n\n\n\n"],"names":["frappe","has_indicator","doctype","model","is_submittable","listview_settings","get_indicator","workflow","get_state_fieldname","meta","has_field","doc","__unsaved","__","workflows","without_workflow","settings","workflow_fieldname","value","colour","locals","style","Success","Warning","Danger","Primary","Inverse","Info","docstatus","has_indicator_for_draft","has_indicator_for_cancelled","indicator","status","utils","guess_colour","enabled","disabled","ui","Filter","[object Object]","opts","$","extend","this","undefined","filter_utils","conditions","nested_set_conditions","push","ref","invalid_condition_map","Date","Datetime","Data","Select","Link","Currency","Color","Check","map","c","filter","make","make_select","set_events","setup","filter_edit_area","render_template","appendTo","parent","find","fieldselect","FieldSelect","parent_doctype","filter_fields","select","fieldname","set_field","set_value","on","remove","removeClass","on_change","update_filter_tag","change","field","let","condition","get_condition","fieldtype","includes","add_condition_help","df","const","set_values","is_new","promise","Promise","resolve","addClass","hidden","then","$filter_tag","hide","_filter_value_set","set_filter_button_text","make_tag","original_type","set_condition","Array","isArray","join","trim","cur","k","original_docfield","fields_by_name","console","warn","copy_dict","read_only","is_filter","get_default_condition","set_fieldtype","options","selected_doctype","selected_fieldname","make_field","old_fieldtype","old_text","get_value","hide_invalid_conditions","toggle_nested_set_conditions","field_area","empty","get","f","form","make_control","only_input","refresh","wrapper","keydown","e","which","get_selected_value","val","trigger_change","$condition_field","get_filter_tag_element","insertAfter","bind_tag","bind","filter_button","closest","show","toggle","html","get_filter_button_text","get_formatted_value","label","$desc","desc_area","in_list","invalid_conditions","show_condition","boot","nested_set_doctypes","forEach","0","1","2","cint","format","only_value","strip","indexOf","startsWith","endsWith","split","v","description","reqd","ignore_link_validation","toLowerCase","get_relative_timespan_options","FilterGroup","filters","window","fltr","append","get_container_template","clear_filter_button","length","add_filter","toggle_clear_filter","clear_filters","promises","run_serially","validate_args","is_new_filter","arguments","args","push_new_filter","std_fields_list","throw","bold","filter_exists","_push_new_filter","setup_state","update","update_filters","filter_items","filter_value","exists","f_value","equal","arrays_equal","slice","Class","init","me","$input","select_input","awesomplete","Awesomplete","minChars","maxItems","autoFirst","list","item","repl","data","originalEvent","text","get_item","i","add_field_option","build_options","clear","parts","each","table_fields","std_filters","std_fields","d","doctype_obj","istable","concat","with_blank","main_table_fields","docfield_list","sort","perm","has_perm","permlevel","table_df","child_table_fields","link_field","get_docfields","table","no_value_type","Tags","tagsList","onTagAdd","onTagRemove","onTagClick","onChange","placeholder","$wrapper","$ul","$inputWrapper","getListElement","$placeholder","deactivate","keypress","keyCode","tagValue","xss_sanitise","addTag","activate","focus","addTags","$tag","getTag","insertBefore","splice","labels","$element","className","$li","$searchTag","$removeTag","searchdialog","search","init_search","attr","removeTag","$toggle_tag","TagEditor","setup_tags","user_tags","initialized","tags","tag","refreshing","call","method","get_args","callback","r","fetch_tags","setup_awesomplete","setup_complete","input","target","frm","txt","message","trigger","dt","dn","docname","clearTags","setTimeout","is_liked","get_liked_by","session","user","liked","_liked_by","JSON","parse","toggle_like","$btn","name","add","hasClass","css","quiet","exc","action_buttons","replace","liked_by","idx","stringify","click_toggle_like","$count","siblings","not_liked","setup_like_popover","$parent","selector","check_not_liked","dom","is_touchscreen","target_element","popover","animation","placement","template","content","decodeURI","liked_by_list","avatar","full_name","children","click","ev","currentTarget","dataset","set_route","container","provide","views","BaseList","Object","assign","before_refresh","init_promise","tasks","setup_defaults","set_stats","setup_fields","setup_page","setup_side_bar","setup_main_section","setup_view","fn","page_name","get_route_str","page_title","get_meta","user_settings","get_user_settings","start","page_length","can_create","can_write","fields","sort_by","sort_order","primary_action","secondary_action","action","menu_items","class","set_fields","build_fields","title_field","_add_field","is_value_type","in_list_view","Boolean","uniqBy","stats","workflow_state_fieldname","page","$page","page_form","setup_page_head","set_title","set_menu_items","set_breadcrumbs","$secondary_action","set_secondary_action","icon","$item","add_menu_item","standard","shortcut","breadcrumbs","module","list_sidebar","ListSidebar","list_view","show_sidebar","localStorage","show_or_hide_sidebar","document","body","toggleClass","setup_list_wrapper","setup_filter_area","setup_sort_selector","setup_result_area","setup_no_result_area","setup_freeze_area","setup_paging_area","$frappe_list","main","filter_area","FilterArea","set","sort_selector","SortSelector","$filter_list_wrapper","onchange","on_sort_change","$result","$no_result","get_no_result_message","$freeze","$paging_area","$this","is","get_full_column_name","get_fields","get_filters_for_args","order_by","get_sql_string","view","freeze","freeze_on_refresh","freeze_message","get_call_args","prepare_data","toggle_result_area","before_render","render","after_render","dict","keys","values","show_more","names","get_checked_items","standard_filters_wrapper","trigger_refresh","make_standard_filters","make_filter_list","filter_list","get_filters","standard_filters","get_standard_filters","from","set_standard_filter","non_standard_filters","add_filters","on_filter_change","fields_dict","reduce","out","get_filter","key","refresh_list_view","custom_filter_configs","config","doctype_fields","in_standard_filter","unshift","default_value","defaults","get_user_default","default","add_field","base_list","default_filters","view_modes","is_valid","view_mode","BulkOperations","docs","print_settings","get_doc","allow_print_for_draft","allow_print_for_cancelled","valid_docs","has_role","msgprint","dialog","Dialog","title","get_print_formats","set_primary_action","default_print_format","with_letterhead","print_format","print_sel","json_string","open","encodeURIComponent","docnames","done","items","failed","_server_messages","play_sound","assign_to","AssignToDialog","obj","bulk_assign","re_assign","field_mappings","field_options","status_regex","default_field","test","set_value_field","disable_primary_action","enable_primary_action","show_alert","primary_action_label","dialogObj","new_df","match","depends_on","replace_field","ListView","route","get_route","last_view","super","disable_scroll_to_top","has_permissions","view_name","view_user_settings","saved_filters","validate_filters","get_menu_items","patch_refresh_and_load_lib","get_list_view_settings","list_view_settings","valid_fields","set_actions_menu_items","actions_menu_items","get_actions_menu_items","workflow_action_menu_items","get_workflow_action_menu_items","workflow_action_items","add_actions_menu_item","is_workflow_action","match_rules_list","get_match_rules","restricted_list","prepend","show_restrictions","condition_list","get_fields_in_list_view","image_field","add_fields","track_seen","get_docfield","throttle","load_lib","required_libs","require","setInterval","make_new_doc","clear_primary_action","is_non_std_field","new_doc","setup_columns","render_header","render_skeleton","setup_events","onload","show_restricted_list_indicator_if_applicable","columns","get_df","type","fields_in_list_view","column_count","innerWidth","new_button","disable_count","with_comment_count","route_options","parse_filters_from_route_options","toggle_actions_menu_button","show_actions_menu","toggle_workflow_actions","hide_actions_menu","get_header_html","$row","get_list_row_html_skeleton","save","save_view_user_settings","reload_stats","render_list","on_row_checked","render_count","render_tags","_idx","get_list_row_html","get_count_str","str","$list_rows","tag_html","_user_tags","subject_field","subject_html","$columns","col","is_numeric_field","get_header_html_skeleton","left","right","get_column_html","get_meta_html","get_left_html","get_right_html","get_indicator_html","Subject","Field","get_subject_html","_value","formatters","fetch_from","strip_html","escape_html","Math","round","escape","field_html","hide_name_column","get_form_link","button","get_description","get_label","modified","comment_when","last_assignee","_assign","_comment_count","get_indicator_dot","current_count","count_without_children","db","count","total_count","_seen","subject","toString","escaped_subject","heart_class","seen","get_seen_class","encodeURI","setup_filterable","setup_list_click","setup_tag_event","setup_new_doc_event","setup_check_events","setup_like","setup_realtime_updates","setup_action_handler","setup_keyboard_navigation","focus_next","activeElement","next","focus_prev","prev","check_row","get_list_row_if_focused","is_current_page","is_input_focused","handle_navigation","direction","add_shortcut","$list_row","metaKey","ctrlKey","stopPropagation","filters_to_apply","datetime","get_today","$target","$check","prop","preventDefault","link","location","href","$button","shiftKey","$checkbox_cursor","name_1","name_2","findIndex","min_index","max_index","toggle_tags","disable_auto_refresh","realtime","is_being_edited","call_args","datum","index","a","b","a_value","b_value","return_value","$checks","set_rows_as_checked","el","$list_head_subject","$checkbox_actions","only_docnames","check","cstr","unescape","query_params","full_url","get_share_url","can_import","reference_doctype","can_set_user_permissions","allow","user_roles","custom","doc_type","toggle_side_bar","share_url","developer_mode","show_list_settings","with_doctype","get_values","workflow_actions","has_workflow","get_all_transition_actions","xcall","checked_items","actions","bulk_operations","is_field_editable","field_doc","some","has_editable_fields","edit","apply_assignment_rule","can_print","print","has_submit_permission","confirm","submit_or_cancel","can_cancel","can_delete","delete","value_array","get_doctype_for_field","j","trees","tree","on_update","event","trigger_list_update","get_list_view","cur_list","ListFactory","Factory","issingle","set_re_route","view_class","load_last_view","change_to","make_page","set_cur_list","re_route_to_view","set_module_breadcrumb","last_route","route_history","history","go","prev_route","module_links","set_doctype_module","ListFilter","can_add_global","$input_area","$list_filters","filter_input","toUpperCase","input_class","render_input","label_area","is_global_input","bind_save_filter","bind_click_filter","bind_remove_filter","get_list_filters","filter_template","set_description","get_filters_values","remove_filter","debounce","has_value","filter_name_exists","save_filter","help_text","filter_name","insert","for_user","get_current_filters","delete_doc","get_list","or_filters","redirect_to_home_if_invalid_route","get_doc_mappings","Event","field_map","interaction_type","summary","category","due_date","public","reqd_fields","hidden_fields","ToDo","reference_document","assigned_to","cat_tags","sidebar_content","sidebar","setup_reports","setup_list_filter","setup_views","setup_kanban_boards","setup_calendar_view","setup_email_inbox","setup_keyboard_shortcuts","setup_list_group_by","disable_sidebar_stats","show_list_link","calendar","email_accounts","treeview_settings","is_tree","current_view","kanban_board","email_account","added","dropdown","divider","add_reports","reports","ref_doctype","report_type","get_divider","all_reports","localeCompare","list_filter","$dropdown","KanbanView","setup_dropdown_in_sidebar","result","calendar_views","$link_calendar","default_link","other_links","calendar_view","dropdown_html","has_common","account","email_id","display_name","get_shortcut_group","list_group_by","ListGroupBy","render_stat","stats_dropdown","setup_search","stat","sum","docfield_map","t","nfound","tempstats","context","existing","$w","get_stats","make_wrapper","group_by_fields","render_group_by_items","make_group_by_fields_modal","setup_dropdown","setup_filter_by","get_group_by_dropdown_fields","$body","docfield","get_group_by_count","field_count_list","render_dropdown_items","checked","current_filters","f_arr","field_counts","current_user","parents","decodeURIComponent","operator","GanttView","calendar_settings","gantt","prepare_tasks","progress","isFunction","end","id","dependencies","depends_on_tasks","color","validate_hex","substr","is_milestone","render_gantt","gantt_view_mode","Gantt","date_format","on_click","task","on_date_change","moment","on_progress_change","progress_fieldname","parseInt","on_view_change","mode","custom_popup_html","_start","_end","gantt_custom_popup_html","setup_view_mode_buttons","set_colors","view_is","change_view_mode","custom_class","class_name","bar_color","get_contrast_color","CalendarView","last_calendar","calendar_name","get_calendar_preferences","Calendar","with_doc","start_date_field","end_date_field","get_default_options","defaultView","getItem","weekends","setup_options","setup_view_mode_button","clear_user_actions","calendars","can_read","$cal","fullCalendar","footnote_area","set_footnote","border-top","cal_options","set_css","detach","btn","set_localStorage_option","option","removeItem","setItem","btn_group","allDay","color_map","danger","success","warning","get_system_datetime","date","_offset","tz","sys_defaults","time_zone","convert_to_system_tz","locale","language","header","center","editable","selectable","selectHelper","forceEventDuration","nowIndicator","events","timezone","get_events_method","prepare_events","eventRender","element","tooltip","eventClick","eventDrop","delta","revertFunc","update_event","eventResize","startDate","endDate","jsEvent","get_new_doc","all_day","_ambigTime","subtract","dayClick","$date_cell","source","convert_to_user_tz","validate","add_days","fix_end_date_for_event_render","prepare_colors","html2text","color_name","get_css_class","backgroundColor","textColor","remove_from_locals","update_event_method","get_update_args","error","stripTime","ImageView","_image_url","get_image_url","get_attached_images","render_image_view","gallery","prepare_pswp_items","images_map","setup_gallery","item_html","info_fields","info_html","_name","encoded_name","_class","_html","get_abbr","details","item_details_html","url","image","cordova","is_url","base_url","GalleryView","lib_ready","prepare","pswp_root","pswp","_items","_images_map","width","height","query","naturalWidth","naturalHeight","getBoundingClientRect","src","msrc","w","h","pswp_items","_show","getThumbBoundsFn","thumbnail","pageYScroll","pageYOffset","documentElement","scrollTop","rect","x","y","top","shareEl","showHideOpacity","PhotoSwipe","PhotoSwipeUI_Default","browse_images","$more_items","last_hide_timeout","hide_more_items_after_2s","clearTimeout","hide_more_items","img_html","listen","images","currItem","off","img_el","goTo","invalidateCurrItems","updateSize","asset_dir","last_kanban_board","board_name","card_meta","get_card_meta","save_kanban_board_filters","get_board","board","filters_array","set_indicator","clear_indicator","field_name","kanban","KanbanBoard","cards","quick_entry","get_field","mandatory","kanban_boards","private","new_kanban_dialog","select_fields","get_fields_for_dialog","project","kb","kanban_filters","kanban_board_name","make_kanban_board","err","InboxView","last_email_account","current_email_account","get_inbox_filters","is_sent_emails","email","attachment","has_attachment","form_link","reference_name","communication_date","all_accounts","op","msg","CommunicationComposer","user_email","FileView","last_folder","home_folder","current_folder","file_menu_items","file_manager","cut","paste","prompt","file_name","folder","grid_view","FileUploader","restrictions","allowed_file_types","on_success","file","prepare_datum","is_folder","icon_class","is_image_file","file_url","_title","is_private","render_grid_view","get_route_url","folders","acc","curr","breadcrumbs_html","get_breadcrumbs_html","created_on","file_size","FileSize","route_url","creation","now_date","str_to_user","setup_drag_drop","dataTransfer","files","toggle_cut_paste_buttons","$paste_btn","menu_btn_group","can_paste","old_folder","$cut_btn","cur_tree","TreeFactory","TreeView","get_tree_root","show_expand_all","get_tree_nodes","get_permissions","make_filters","get_root","set_menu_item","in_create","add_page","make_app_page","single_column","breadcrumb","DocType","min-height","padding-bottom","add_inner_button","load_children","root_node","view_template","row","node_view","disable_onchange","root_label","make_tree","Tree","expandable","toolbar","get_toolbar","on_render","onrender","node","select_node","post_render","is_root","hide_add","new_node","btnClass","allow_rename","rename_doc","new_name","$tree_link","extend_toolbar","get_selected_node","prepare_fields","add_tree_node","expanded","toggle_node","always","unfreeze","ignore_fields","mandatory_fields","opts_field_names","inArray","print_tree","get_print_settings","render_tree","report_name","disable_add_node","apply","menu_item","eval","InteractionComposer","no_submit_on_enter","create_action","display","select_attachments","render_attach","filename","interaction_docs","set_df_property","set_reqd_hidden_fields","get_event_categories","categories","get_input","add_options","setup_attach","doc_mapping","attach","attachments","attachment_uploaded","cur_frm","get_files","urllib","get_full_url","get_primary_btn","form_values","selected_attachments","create_interaction","interaction_values","reference_docname","assign_document","add_attachments","timeline","reload_doc","assignee"],"mappings":"0tCAEAA,OAAOC,cAAgB,SAASC,GAE/B,QAAGF,OAAOG,MAAMC,eAAeF,SAEpBF,OAAOK,kBAAkBH,IAAY,IAAII,gBAChDN,OAAOO,SAASC,oBAAoBN,QAE9BF,OAAOS,KAAKC,UAAUR,EAAS,aACrCF,OAAOS,KAAKC,UAAUR,EAAS,eAMpCF,OAAOM,cAAgB,SAASK,EAAKT,GACpC,GAAGS,EAAIC,UACN,MAAO,CAACC,GAAG,aAAc,UAGtBX,IAASA,EAAUS,EAAIT,SAE3B,IAAIK,EAAWP,OAAOO,SAASO,UAAUZ,GACrCa,GAAmBR,GAAWA,EAA0B,gBAExDS,EAAWhB,OAAOK,kBAAkBH,IAAY,GAEhDE,EAAiBJ,OAAOG,MAAMC,eAAeF,GAChDe,EAAqBjB,OAAOO,SAASC,oBAAoBN,GAG1D,GAAGe,IAAuBF,EAAkB,CAC3C,IAAIG,EAAQP,EAAIM,GAChB,GAAGC,EAAO,CACT,IAAIC,EAAS,GAEb,GAAGC,OAAO,kBAAkBF,IAAUE,OAAO,kBAAkBF,GAAOG,MACjEF,EAAS,CACZG,QAAW,QACXC,QAAW,SACXC,OAAU,MACVC,QAAW,OACXC,QAAW,QACXC,KAAQ,cACPP,OAAO,kBAAkBF,GAAOG,OAInC,OAFIF,IAAQA,EAAS,YAEd,CAACN,GAAGK,GAAQC,EAAQF,EAAqB,MAAQC,IAK1D,GAAGd,GAAiC,GAAfO,EAAIiB,YAAiBZ,EAASa,wBAClD,MAAO,CAAChB,GAAG,SAAU,MAAO,iBAI7B,GAAGT,GAAiC,GAAfO,EAAIiB,YAAiBZ,EAASc,4BAClD,MAAO,CAACjB,GAAG,aAAc,MAAO,iBAGjC,GAAGG,EAASV,cAAe,CAC1B,IAAIyB,EAAYf,EAASV,cAAcK,GACvC,GAAGoB,EAAW,OAAOA,EAItB,OAAG3B,GAAiC,GAAfO,EAAIiB,UACjB,CAACf,GAAG,aAAc,OAAQ,iBAI/BF,EAAIqB,OACC,CAACnB,GAAGF,EAAIqB,QAAShC,OAAOiC,MAAMC,aAAavB,EAAIqB,SAIpDhC,OAAOS,KAAKC,UAAUR,EAAS,WAC9BS,EAAIwB,QACC,CAACtB,GAAG,WAAY,OAAQ,eAExB,CAACA,GAAG,YAAa,OAAQ,eAK/Bb,OAAOS,KAAKC,UAAUR,EAAS,YAC9BS,EAAIyB,SACC,CAACvB,GAAG,YAAa,OAAQ,gBAEzB,CAACA,GAAG,WAAY,OAAQ,qBAJjC,GCxFDb,OAAOqC,GAAGC,OAAS,MAClBC,YAAYC,SACXC,EAAEC,OAAOC,KAAMH,GACI,OAAfG,KAAKzB,YAAiC0B,IAAfD,KAAKzB,QAC/ByB,KAAKzB,MAAQ,IAGdyB,KAAKV,MAAQjC,OAAOqC,GAAGQ,aACvBF,KAAKG,WAAa,CACjB,CAAC,IAAKjC,GAAG,WACT,CAAC,KAAMA,GAAG,eACV,CAAC,OAAQA,GAAG,SACZ,CAAC,WAAYA,GAAG,aAChB,CAAC,KAAMA,GAAG,OACV,CAAC,SAAUA,GAAG,WACd,CAAC,KAAMA,GAAG,OACV,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,UAAWA,GAAG,YACf,CAAC,WAAYA,GAAG,aAChB,CAAC,OAAQA,GAAG,UAGb8B,KAAKI,sBAAwB,CAC5B,CAAC,iBAAkBlC,GAAG,mBACtB,CAAC,qBAAsBA,GAAG,uBAC1B,CAAC,eAAgBA,GAAG,iBACpB,CAAC,mBAAoBA,GAAG,yBAGzB8B,KAAKG,YAAWE,WAAKC,EAAGN,KAAKI,uBAE7BJ,KAAKO,sBAAwB,CAC5BC,KAAM,CAAC,OAAQ,YACfC,SAAU,CAAC,OAAQ,YACnBC,KAAM,CAAC,UAAW,WAAY,QAC9BC,OAAQ,CAAC,OAAQ,WAAY,UAAW,WAAY,QACpDC,KAAM,CAAC,UAAW,WAAY,OAAQ,IAAK,IAAK,KAAM,MACtDC,SAAU,CAAC,UAAW,WAAY,QAClCC,MAAO,CAAC,UAAW,WAAY,QAC/BC,MAAOf,KAAKG,WAAWa,aAAKC,UAAMA,EAAE,KAAIC,gBAAQD,SAAY,MAANA,KAEvDjB,KAAKmB,OACLnB,KAAKoB,cACLpB,KAAKqB,aACLrB,KAAKsB,QAGN1B,OACCI,KAAKuB,iBAAmBzB,EACvBzC,OAAOmE,gBAAgB,cAAe,CACrCrB,WAAYH,KAAKG,cAEjBsB,SAASzB,KAAK0B,OAAOC,KAAK,sBAG7B/B,yBACCI,KAAK4B,YAAc,IAAIvE,OAAOqC,GAAGmC,YAAY,CAC5CH,OAAQ1B,KAAKuB,iBAAiBI,KAAK,0BACnCpE,QAASyC,KAAK8B,eACdC,cAAe/B,KAAK+B,cACpBC,gBAASzE,EAAS0E,GACjBjC,EAAKkC,UAAU3E,EAAS0E,MAItBjC,KAAKiC,WACRjC,KAAK4B,YAAYO,UAAUnC,KAAKzC,QAASyC,KAAKiC,WAIhDrC,wBACCI,KAAKuB,iBAAiBI,KAAK,mBAAmBS,GAAG,mBAChDpC,EAAKqC,WAGNrC,KAAKuB,iBAAiBI,KAAK,uBAAuBS,GAAG,mBACpDpC,EAAKuB,iBAAiBe,YAAY,cAClCtC,EAAKuC,YACLvC,EAAKwC,sBAGNxC,KAAKuB,iBAAiBI,KAAK,cAAcc,kBACxC,GAAKzC,EAAK0C,MAAV,CAEAC,IAAIC,EAAY5C,EAAK6C,gBACjBC,EAAY,KAEZ,CAAC,KAAM,OAAQ,SAAU,YAAYC,SAASH,KACjDE,EAAY,OACZ9C,EAAKgD,mBAAmBJ,IAIxB,CAAC,SAAU,eAAeG,SAAS/C,EAAK0C,MAAMO,GAAGH,YACjD,CAAC,KAAM,UAAUC,SAASH,KAE1BE,EAAY,eAGb9C,EAAKkC,UACJlC,EAAK0C,MAAMO,GAAGvB,OACd1B,EAAK0C,MAAMO,GAAGhB,UACda,EACAF,MAKHhD,QACCsD,IAAMjB,EAAYjC,KAAKiC,WAAa,OAEpC,OAAOjC,KAAKmD,WAAWnD,KAAKzC,QAAS0E,EAAWjC,KAAK4C,UAAW5C,KAAKzB,OAGtEqB,YAAYwD,cACPC,EAAUC,QAAQC,UAClBH,EACHpD,KAAKuB,iBAAiBiC,SAAS,cAE/BH,EAAUrD,KAAKwC,oBAGZxC,KAAKyD,QACRJ,EAAQK,uBAAW1D,EAAK2D,YAAYC,SAItChE,SACCI,KAAKwC,oBAGN5C,+BACC,OAAII,KAAK6D,kBACD7D,KAAK6D,kBAAkBH,gBAC5B1D,EAAK2D,YAAgC3D,EAAK8D,yBAAvB9D,EAAK+D,WACzB/D,EAAKuB,iBAAiBqC,SAGhBN,QAAQC,UAIjB3D,SACCI,KAAKuB,iBAAiBc,SACtBrC,KAAK2D,aAAe3D,KAAK2D,YAAYtB,SACrCrC,KAAK0C,MAAQ,KACb1C,KAAKuC,WAAU,GAGhB3C,WAAWrC,EAAS0E,EAAWW,EAAWrE,GAEzC,IAA2C,IAAvCyB,KAAKkC,UAAU3E,EAAS0E,GAqB5B,MAjBoC,UAAhCjC,KAAK0C,MAAMO,GAAGe,gBACjBzF,EAAiB,GAATA,EAAa,MAAQ,MAE1BqE,GAAW5C,KAAKiE,cAAcrB,GAAW,GAG7C5C,KAAK6D,kBAAoBP,QAAQC,UAE7B,CAAC,KAAM,UAAUR,SAASH,IAAcsB,MAAMC,QAAQ5F,KACzDA,EAAQA,EAAM6F,KAAK,MAGhBF,MAAMC,QAAQ5F,GACjByB,KAAK6D,kBAAoB7D,KAAK0C,MAAMP,UAAU5D,QAC1B0B,IAAV1B,GAAiC,OAAVA,IACjCyB,KAAK6D,kBAAoB7D,KAAK0C,MAAMP,WAAW5D,EAAQ,IAAI8F,SAErDrE,KAAK6D,kBAGbjE,UAAUrC,EAAS0E,EAAWa,EAAWF,GAExCD,IAAI2B,EAAM,GACV,GAAItE,KAAK0C,MAAO,IAAKC,IAAI4B,KAAKvE,KAAK0C,MAAMO,GAAIqB,EAAIC,GAAKvE,KAAK0C,MAAMO,GAAGsB,GAEpE5B,IAAI6B,GAAqBxE,KAAK4B,YAAY6C,eAAelH,IAAY,IACpE0E,GAGD,IAAKuC,EAGJ,OAFAE,QAAQC,cAAc1C,yBACtBjC,KAAKqC,UACE,EAGRM,IAAIM,EAAK2B,UAAUJ,GAGnBvB,EAAG4B,UAAY,EACf5B,EAAGQ,OAAS,EACZR,EAAG6B,WAAY,EAEfnC,IAAI1B,EAAI2B,GAAwB5C,KAAKV,MAAMyF,sBAAsB9B,GACjEjD,KAAKiE,cAAchD,GAEnBjB,KAAKV,MAAM0F,cAAc/B,EAAIH,EAAW9C,KAAK6C,iBAK5C7C,KAAK0C,OACL4B,EAAIrC,WAAaA,GACjBgB,EAAGH,WAAawB,EAAIxB,WACpBG,EAAGvB,QAAU4C,EAAI5C,QACjBuB,EAAGgC,SAAWX,EAAIW,UAMnBjF,KAAK4B,YAAYsD,iBAAmB3H,EACpCyC,KAAK4B,YAAYuD,mBAAqBlD,EAEtCjC,KAAKoF,WAAWnC,EAAIqB,EAAIxB,YAGzBlD,WAAWqD,EAAIoC,cACVC,EAAWtF,KAAK0C,MAAQ1C,KAAK0C,MAAM6C,YAAc,KACrDvF,KAAKwF,wBAAwBvC,EAAGH,UAAWG,EAAGe,eAC9ChE,KAAKyF,6BAA6BxC,GAClCN,IAAI+C,EAAa1F,KAAKuB,iBACpBI,KAAK,iBACLgE,QACAC,IAAI,GACFC,EAAIxI,OAAOqC,GAAGoG,KAAKC,aAAa,CACnC9C,GAAIA,EACJvB,OAAQgE,EACRM,YAAY,IAEbH,EAAEI,UAEFjG,KAAK0C,MAAQmD,EACTP,GAAYO,EAAE/C,YAAcuC,GAC/BrF,KAAK0C,MAAMP,UAAUmD,GAItBxF,EAAEE,KAAK0C,MAAMwD,SACXvE,KAAK,UACLwE,iBAASC,GACM,IAAXA,EAAEC,OAA2C,gBAA5BrG,EAAK0C,MAAMO,GAAGH,WAClC9C,EAAKuC,cAKT3C,YACC,MAAO,CACNI,KAAK4B,YAAYsD,iBACjBlF,KAAK0C,MAAMO,GAAGhB,UACdjC,KAAK6C,gBACL7C,KAAKsG,qBACLtG,KAAKyD,QAGP7D,qBACC,OAAOI,KAAKV,MAAMgH,mBAAmBtG,KAAK0C,MAAO1C,KAAK6C,iBAGvDjD,gBACC,OAAOI,KAAKuB,iBAAiBI,KAAK,cAAc4E,MAGjD3G,cAAcgD,EAAW4D,mBAAiB,GACzC7D,IAAI8D,EAAmBzG,KAAKuB,iBAAiBI,KAAK,cAClD8E,EAAiBF,IAAI3D,GACjB4D,GAAgBC,EAAiBhE,SAGtC7C,WACCI,KAAK2D,YAAc3D,KAAK0G,yBAAyBC,YAChD3G,KAAK0B,OAAOC,KAAK,uCAElB3B,KAAK8D,yBACL9D,KAAK4G,WAGNhH,sBACCI,KAAK2D,YAAYhC,KAAK,kBAAkBS,GAAG,QAASpC,KAAKqC,OAAOwE,KAAK7G,OAErE2C,IAAImE,EAAgB9G,KAAK2D,YAAYhC,KAAK,kBAC1CmF,EAAc1E,GAAG,mBAChB0E,EACEC,QAAQ,qBACRpF,KAAK,qBACLqF,OACFhH,EAAKuB,iBAAiB0F,WAIxBrH,yBACCI,KAAK2D,YAAYhC,KAAK,kBAAkBuF,KAAKlH,KAAKmH,0BAGnDvH,yBACC+C,IAAIpE,EAAQyB,KAAKV,MAAM8H,oBACtBpH,KAAK0C,MACL1C,KAAKsG,sBAEN,OAAUpI,GAAG8B,KAAK0C,MAAMO,GAAGoE,WAAUnJ,GAAG8B,KAAK6C,qBAAoB3E,GAChEK,GAIFqB,yBACC,OAAOE,oHAEI5B,GAAG,kHAGHA,GAAG,qGAMf0B,mBAAmBgD,GAClBD,IAAI2E,EAAQtH,KAAK0C,MAAM6E,UAClBD,IACJA,EAAQxH,EAAE,kCAAkC2B,SAASzB,KAAK0C,MAAMwD,UAGjEoB,EAAMJ,MACqC,OAAzCM,QAAQ,CAAC,KAAM,UAAW5E,GACxB1E,GAAG,8BACHA,GAAG,sBAAwB,UAIhC0B,wBAAwBkD,EAAWkB,GAMlC,IALArB,IAAI8E,EACHzH,KAAKO,sBAAsByD,IAC3BhE,KAAKO,sBAAsBuC,IAC3B,SAEqB9C,KAAKG,2BAAY,CAAlCwC,IAAIC,OACR5C,KAAKuB,iBACHI,iCAAiCiB,EAAU,SAC3CqE,QAAQQ,EAAmB1E,SAASH,EAAU,MAIlDhD,6BAA6BqD,cACxByE,EACc,SAAjBzE,EAAGH,WACHzF,OAAOsK,KAAKC,oBAAoB7E,SAASE,EAAGgC,SAC7CjF,KAAKI,sBAAsByH,iBAASjF,GACnC5C,EAAKuB,iBACHI,iCAAiCiB,EAAU,SAC3CqE,OAAOS,OAKZrK,OAAOqC,GAAGQ,aAAe,CACxBkH,6BAAoB1E,EAAOnE,GAM1B,MAL2B,cAAvBmE,EAAMO,GAAGhB,UACZ1D,EAAQ,CAAEuJ,EAAG,QAASC,EAAG,YAAaC,EAAG,aAAczJ,IAAUA,EAC5B,UAA3BmE,EAAMO,GAAGe,gBACnBzF,EAAQ,CAAEuJ,EAAG,KAAMC,EAAG,OAAQE,KAAK1J,KAE7BlB,OAAO6K,OAAO3J,EAAOmE,EAAMO,GAAI,CAAEkF,WAAY,KAGrD7B,4BAAmB5D,EAAOE,GACzBD,IAAI4D,EAAM7D,EAAM6C,YA4BhB,MA1BmB,iBAARgB,IACVA,EAAM6B,MAAM7B,IAGI,MAAb3D,GAAsB2D,IACzBA,EAAM7D,EAAMO,GAAGgC,QAAQ,GAAG1G,OAGG,SAA1BmE,EAAMO,GAAGe,gBACZuC,EAAa,OAAPA,EAAe,EAAI,IAGqB,IAA3C3D,EAAUyF,QAAQ,OAAQ,aAEzB9B,GAASA,EAAI+B,WAAW,MAAQ/B,EAAIgC,SAAS,OAChDhC,EAAM,IAAMA,EAAM,KAETiB,QAAQ,CAAC,KAAM,UAAW5E,IAChC2D,IACHA,EAAMA,EAAIiC,MAAM,KAAKxH,aAAKyH,UAAML,MAAMK,MAG5B,MAARlC,IACHA,EAAM,IAGAA,GAGRxB,+BAAsB9B,GACrB,MAAoB,QAAhBA,EAAGH,UACC,OACmB,QAAhBG,EAAGH,WAAuC,YAAhBG,EAAGH,UAChC,UAEA,KAITkC,uBAAc/B,EAAIH,EAAWF,GAExBK,EAAGe,cAAef,EAAGH,UAAYG,EAAGe,cACnCf,EAAGe,cAAgBf,EAAGH,UAE3BG,EAAGyF,YAAc,GACjBzF,EAAG0F,KAAO,EACV1F,EAAG2F,wBAAyB,EAGxB9F,EACHG,EAAGH,UAAYA,GAKI,aAAhBG,EAAGhB,WACNgB,EAAGH,UAAY,SACfG,EAAGgC,QAAU,CACZ,CAAE1G,MAAO,EAAG8I,MAAOnJ,GAAG,UACtB,CAAEK,MAAO,EAAG8I,MAAOnJ,GAAG,cACtB,CAAEK,MAAO,EAAG8I,MAAOnJ,GAAG,gBAEG,SAAhB+E,EAAGH,WACbG,EAAGH,UAAY,SACfG,EAAGgC,QAAU,YAYe,GAV5B,CACC,OACA,aACA,cACA,OACA,MACA,WACA,eACA,YACA,UACCoD,QAAQpF,EAAGH,WAEbG,EAAGH,UAAY,OAEC,QAAhBG,EAAGH,YAQsB,GAPzB,CACC,IACA,KACA,iBACA,eACA,qBACA,oBACCuF,QAAQzF,KAEVK,EAAGH,UAAY,QAGE,SAAjBG,EAAGH,WACkC,WAApCG,EAAGgC,SAAW,IAAI4D,gBAEnB5F,EAAGgC,QAAU,MAGA,WAAbrC,GACiB,QAAhBK,EAAGH,WAAuC,YAAhBG,EAAGH,YAE9BG,EAAGH,UAAY,aAGf,CAAC,WAAY,QAAQC,SAASH,IAC9B,CAAC,OAAQ,WAAY,YAAa,UAAUG,SAASE,EAAGH,aAExDG,EAAGH,UAAY,SACfG,EAAGgC,QAAUjF,KAAK8I,iCAGD,OAAdlG,IACHK,EAAGH,UAAY,SACfG,EAAGgC,QAAU,CACZ,CAAEoC,MAAOnJ,GAAG,OAAQK,MAAO,OAC3B,CAAE8I,MAAOnJ,GAAG,WAAYK,MAAO,eAKlCuK,yCACC,MAAO,CACN,CACCzB,MAAOnJ,GAAG,UACVK,MAAO,UAER,CACC8I,MAAOnJ,GAAG,WACVK,MAAO,WAER,CACC8I,MAAOnJ,GAAG,YACVK,MAAO,YAER,CACC8I,MAAOnJ,GAAG,YACVK,MAAO,YAER,CACC8I,MAAOnJ,GAAG,UACVK,MAAO,aCpgBXlB,OAAOqC,GAAGqJ,YAAc,MACvBnJ,YAAYC,GACXC,EAAEC,OAAOC,KAAMH,GACfG,KAAKkG,QAAUlG,KAAK0B,OACpB1B,KAAKgJ,QAAU,GACfhJ,KAAKmB,OACL8H,OAAOC,KAAOlJ,KAGfJ,OACCI,KAAKkG,QAAQiD,OAAOnJ,KAAKoJ,0BACzBpJ,KAAKqB,aAGNzB,sBACC+C,IAAI0G,EAAsBrJ,KAAKkG,QAAQvE,KAAK,kBAEjB,GAAvB3B,KAAKgJ,QAAQM,OAChBD,EAAoBzF,OAEpByF,EAAoBrC,OAGtBpH,wBACCI,KAAKkG,QAAQvE,KAAK,eAAeS,GAAG,mBACnCpC,EAAKuJ,WAAWvJ,EAAKzC,QAAS,QAC5BmG,KAAK1D,EAAKwJ,yBAGbxJ,KAAKkG,QAAQvE,KAAK,kBAAkBS,GAAG,mBACtCpC,EAAKyJ,kBAIP7J,YAAYoJ,GAGX,eAFIU,EAAW,gBAEVxG,IAAMhC,OACVwI,EAASrJ,+BAAWL,GAAKuJ,iBAAWjJ,EAAGY,YADnB8H,sBAMrB,OAFAU,EAASrJ,uBAAWL,EAAKwJ,wBAElBnM,OAAOsM,aAAaD,GAG5B9J,WAAWrC,EAAS0E,EAAWW,EAAWrE,EAAOkF,GAChD,IAAKxB,EAAW,OAAOqB,QAAQC,UAK/B,IAAIvD,KAAK4J,cAAcrM,EAAS0E,GAAY,OAAO,EACnDiB,IAAM2G,EAAgBC,UAAUR,OAAS,EACzC,GAAIO,GAAiB7J,KAAKkG,QAAQvE,KAAK,uBAAuB2H,OAE7D,OAAOhG,QAAQC,UAEfZ,IAAIoH,EAAO,CAACxM,EAAS0E,EAAWW,EAAWrE,EAAOkF,GAC5CJ,EAAUrD,KAAKgK,gBAAgBD,EAAMF,GAC3C,OAAQxG,GAAWA,EAAQK,KAAQL,EAAUC,QAAQC,UAIvD3D,cAAcrC,EAAS0E,GAEtB,QAAG1E,GAAW0E,IACT5E,OAAOS,KAAKC,UAAUR,EAAS0E,KAC/B5E,OAAOG,MAAMyM,gBAAgBlH,SAASd,MAE1C5E,OAAO6M,MAAMhM,wBAAwB+D,EAAUkI,eACxC,GAKTvK,gBAAgBmK,EAAMF,SAErB,mBAFmC,IAEhC7J,KAAKoK,cAAcL,GAAtB,CAIApH,IAAIzB,KAASlB,MAAKqK,uBAAiB/J,EAAGyJ,GAEtC,OAAI7I,GAAUA,EAAO3C,OACpB2C,EAAOoJ,YAAYT,GACZ3I,EAAO2C,wBAFf,GAMDjE,iBAAiBrC,EAAS0E,EAAWW,EAAWrE,EAAOkF,8BAAS,GAC/Dd,IAAIoH,EAAO,CACVrI,OAAQ1B,KAAKkG,QACbpE,eAAgB9B,KAAKzC,QACrBA,QAASA,EACT0E,UAAWA,EACXW,UAAWA,EACXrE,MAAOA,EACPkF,OAAQA,EACRlB,mBAAYgI,GACRA,GAAQvK,EAAKwK,iBAChBxK,EAAKuC,aAENkI,sBAAelN,EAAS0E,GACvB,OAAQjC,EAAKoK,cAAc,CAAC7M,EAAS0E,MAGnCf,EAAS,IAAI7D,OAAOqC,GAAGC,OAAOoK,GAElC,OADA/J,KAAKgJ,QAAQ3I,KAAKa,GACXA,EAGRtB,cAAc8K,GAEb/H,IAAIgI,GAAS,EAeb,OAdA3K,KAAKgJ,QAAQ9H,gBAAO2E,UAAKA,EAAEnD,QAAO1B,aAAI6E,GACrClD,IAAIiI,EAAU/E,EAAEN,YAChB,GAA4B,IAAxBmF,EAAapB,OAAjB,CAKA3G,IAAIpE,EAAQmM,EAAa,GACrBG,EAAQxN,OAAOiC,MAAMwL,cAEtBD,EAAMD,EAAQG,MAAM,EAAG,GAAIL,EAAaK,MAAM,EAAG,KAAQ7G,MAAMC,QAAQ5F,IAAUsM,EAAMtM,EAAOqM,EAAQ,OACxGD,GAAS,QARTA,EAASD,EAAa,KAAOE,EAAQ,IAAMF,EAAa,KAAOE,EAAQ,KAWlED,EAGR/K,cACC,OAAOI,KAAKgJ,QAAQ9H,gBAAO2E,UAAKA,EAAEnD,QAAO1B,aAAI6E,GAC5C,OAAOA,EAAEN,cAKX3F,iBACCI,KAAKgJ,QAAUhJ,KAAKgJ,QAAQ9H,gBAAO2E,UAAKA,EAAEnD,QAC1C1C,KAAKwJ,sBAGN5J,gBACCI,KAAKgJ,QAAQhI,aAAI6E,UAAKA,EAAExD,QAAO,KAE/BrC,KAAKgJ,QAAU,GAGhBpJ,WAAWqC,GACV,OAAOjC,KAAKgJ,QAAQ9H,gBAAO2E,GAC1B,OAAQA,EAAEnD,OAASmD,EAAEnD,MAAMO,GAAGhB,WAAWA,IACvC,GAGJrC,yBACC,OAAOE,4KAGF5B,GAAG,qJAEHA,GAAG,8GCjKVb,OAAOqC,GAAGmC,YAAcmJ,MAAMjL,OAAO,CAEpCkL,cAAKpL,GACJ,IAAIqL,EAAKlL,KAkCT,GAjCAF,EAAEC,OAAOC,KAAMH,GACfG,KAAKyE,eAAiB,GACtBzE,KAAKiF,QAAU,GACfjF,KAAKmL,OAASrL,EAAE,gCACd2B,SAASzB,KAAK0B,QACdU,GAAG,QAAS,WAActC,EAAEE,MAAMgC,WACpChC,KAAKoL,aAAepL,KAAKmL,OAAOvF,IAAI,GACpC5F,KAAKqL,YAAc,IAAIC,YAAYtL,KAAKoL,aAAc,CACrDG,SAAU,EACVC,SAAU,GACVC,WAAW,EACXC,KAAMR,EAAGjG,QACT0G,cAAKA,GACJ,OAAO7L,EAAE8L,KAAK,wDAAyDD,IACrEE,KAAK,oBAAqBF,GAC1B/F,IAAI,MAGR5F,KAAKmL,OAAO/I,GAAG,qBAAsB,SAASgE,GAC7C,IACI7H,EADI6H,EAAE0F,cACIC,KAAKxN,MACfoN,EAAOT,EAAGG,YAAYW,SAASzN,GACnC2M,EAAGhG,iBAAmByG,EAAKpO,QAC3B2N,EAAG/F,mBAAqBwG,EAAK1J,UAC1BiJ,EAAGlJ,QAAQkJ,EAAGlJ,OAAO2J,EAAKpO,QAASoO,EAAK1J,aAE5CjC,KAAKmL,OAAO/I,GAAG,6BAA8B,SAASgE,GACrD,IACI7H,EADI6H,EAAE0F,cACIC,KAAKxN,MACfoN,EAAOT,EAAGG,YAAYW,SAASzN,GACnC2M,EAAGC,OAAO5E,IAAIoF,EAAKtE,SAGjBrH,KAAK+B,cACP,IAAI,IAAIkK,KAAKjM,KAAK+B,cACjB/B,KAAKkM,iBAAiBlM,KAAK+B,cAAckK,SAE1CjM,KAAKmM,gBAENnM,KAAKmC,UAAUnC,KAAKzC,QAAS,SAE9BgI,qBACC,OAAOvF,KAAKkF,iBAAmBlF,KAAKkF,iBAAmB,IAAMlF,KAAKmF,mBAAqB,MAExFoB,aAAIhI,GACH,QAAW0B,IAAR1B,EACF,OAAOyB,KAAKuF,YAEZvF,KAAKmC,UAAU5D,IAGjB6N,iBACCpM,KAAKkF,iBAAmB,KACxBlF,KAAKmF,mBAAqB,KAC1BnF,KAAKmL,OAAO5E,IAAI,KAEjBpE,mBAAU5E,EAAS0E,GAClB,IAAIiJ,EAAKlL,KAET,GADAA,KAAKoM,QACD7O,EAAJ,CAGA,IAA2B,IAAxBA,EAAQ8K,QAAQ,KAAW,CAC7B,IAAIgE,EAAQ9O,EAAQiL,MAAM,KAC1BjL,EAAU8O,EAAM,GAChBpK,EAAYoK,EAAM,GAGnBvM,EAAEwM,KAAKtM,KAAKiF,QAAS,SAASgH,EAAGxD,GAChC,GAAGA,EAAElL,UAAUA,GAAWkL,EAAExG,YAAYA,EAIvC,OAHAiJ,EAAGhG,iBAAmB3H,EACtB2N,EAAG/F,mBAAqBlD,EACxBiJ,EAAGC,OAAO5E,IAAIkC,EAAEpB,QACT,MAIV8E,yBACC,IAAIjB,EAAKlL,KACTkL,EAAGqB,aAAe,GAClB,IAAIC,EAAc1M,EAAEkB,IAAI3D,OAAOG,MAAMiP,WAAY,SAASC,GACzD,IAAI7M,EAAO,CAAC6B,OAAQwJ,EAAG3N,SAEvB,MADgB,QAAbmP,EAAEzK,YAAmBpC,EAAKoF,QAAUiG,EAAG3N,SACnCuC,EAAEC,OAAO6E,UAAU8H,GAAI7M,KAI3B8M,EAAclO,OAAgB,QAAEyM,EAAG3N,SACpCoP,GAAe1E,KAAK0E,EAAYC,WAClCJ,EAAcA,EAAYK,OAAO,CAAC,CACjC5K,UAAW,SACXa,UAAW,OACXuE,MAAO,SACP3F,OAAQwJ,EAAG3N,YAKVyC,KAAK8M,YACP9M,KAAKiF,QAAQ5E,KAAK,CACjBgH,MAAM,GACN9I,MAAM,KAKR,IAAIwO,EAAoBP,EAAYK,OAAOxP,OAAOS,KAAKkP,cAAc9B,EAAG3N,UACxEuC,EAAEwM,KAAKjP,OAAOiC,MAAM2N,KAAKF,EAAmB,QAAS,UAAW,SAASd,EAAGhJ,GAExE5F,OAAO6P,KAAKC,SAASjC,EAAG3N,QAAS0F,EAAGmK,UAAW,SACjDlC,EAAGgB,iBAAiBjJ,KAItBnD,EAAEwM,KAAKpB,EAAGqB,aAAc,SAASN,EAAGoB,GACnC,GAAGA,EAASpI,QAAS,CACpBtC,IAAI2K,EAAqB,GAAGT,OAAOxP,OAAOS,KAAKkP,cAAcK,EAASpI,UAEtE,GAA2B,sBAAvBoI,EAASvK,UAAmC,CAC/CI,IAAMqK,EAAalQ,OAAOS,KAAK0P,cAAcH,EAASpI,SACpDtD,cAAKsB,SAAuB,SAAjBA,EAAGH,YAChBwK,EAAqBC,EAAa,CAACA,GAAc,GAGlDzN,EAAEwM,KAAKjP,OAAOiC,MAAM2N,KAAKK,EAAoB,QAAS,UAAW,SAASrB,EAAGhJ,GAEzE5F,OAAO6P,KAAKC,SAASjC,EAAG3N,QAAS0F,EAAGmK,UAAW,SACjDlC,EAAGgB,iBAAiBjJ,SAMzBiJ,0BAAiBjJ,GAChBN,IAAIuI,EAAKlL,KAET,GAAoB,aAAhBiD,EAAGhB,WAA6B5E,OAAOG,MAAMC,eAAeyN,EAAG3N,SAGnE,GAAIF,OAAOG,MAAM+O,aAAaxJ,SAASE,EAAGH,WACzCoI,EAAGqB,aAAalM,KAAK4C,OADtB,CAKAN,IAAI0E,EAAQ,KACRoG,EAAQ,KAETvC,EAAG3N,SAAW0F,EAAGvB,QAAQwJ,EAAG3N,SAC9B8J,EAAQnJ,GAAG+E,EAAGoE,OACdoG,EAAQvC,EAAG3N,UAEX8J,EAAQnJ,GAAG+E,EAAGoE,OAAS,KAAOnJ,GAAG+E,EAAGvB,QAAU,IAC9C+L,EAAQxK,EAAGvB,SAG4C,GAArDrE,OAAOG,MAAMkQ,cAAcrF,QAAQpF,EAAGH,YACtCoI,EAAGzG,eAAexB,EAAGvB,SAAWwJ,EAAGzG,eAAexB,EAAGvB,QAAQuB,EAAGhB,aAClEjC,KAAKiF,QAAQ5E,KAAK,CACjBgH,MAAOA,EACP9I,MAAOkP,EAAQ,IAAMxK,EAAGhB,UACxBA,UAAWgB,EAAGhB,UACd1E,QAAS0F,EAAGvB,SAETwJ,EAAGzG,eAAexB,EAAGvB,UAASwJ,EAAGzG,eAAexB,EAAGvB,QAAU,IACjEwJ,EAAGzG,eAAexB,EAAGvB,QAAQuB,EAAGhB,WAAagB,uuBCtKhD5F,OAAOqC,GAAGiO,KAAO,MAChB/N,YAAYU,wGAOXN,KAAK4N,SAAWA,GAAY,GAC5B5N,KAAK6N,SAAWA,EAChB7N,KAAK8N,YAAcA,EACnB9N,KAAK+N,WAAaA,EAClB/N,KAAKgO,SAAWA,EAEhBhO,KAAKsB,MAAMI,EAAQuM,GAGpBrO,MAAM8B,EAAQuM,GACbjO,KAAKkO,SAAWpO,EAAE,oCAAoC2B,SAASC,GAC/D1B,KAAKmO,IAAMrO,EAAE,+BAA+B2B,SAASzB,KAAKkO,UAC1DlO,KAAKmL,OAASrL,EAAE,sCAEhBE,KAAKoO,cAAgBpO,KAAKqO,eAAerO,KAAKmL,QAC9CnL,KAAKsO,aAAetO,KAAKqO,eAAevO,+CAA+CmO,cACvFjO,KAAKoO,cAAc3M,SAASzB,KAAKmO,KACjCnO,KAAKsO,aAAa7M,SAASzB,KAAKmO,KAEhCnO,KAAKuO,aACLvO,KAAK6G,OACL7G,KAAK2H,OAGN/H,kBACCI,KAAKmL,OAAOqD,kBAAUpI,GACrB,GAAc,IAAXA,EAAEC,OAA4B,IAAbD,EAAEqI,QAAe,CACpCvL,IAAMwL,EAAWrR,OAAOiC,MAAMqP,aAAa3O,EAAKmL,OAAO5E,OACvDvG,EAAK4O,OAAOF,GACZ1O,EAAKmL,OAAO5E,IAAI,OAIlBvG,KAAKmL,OAAO/I,GAAG,kBACdpC,EAAKuO,eAGNvO,KAAKsO,aAAalM,GAAG,mBACpBpC,EAAK6O,WACL7O,EAAKmL,OAAO2D,UAIdlP,OACCI,KAAK+O,QAAQ/O,KAAK4N,UAGnBhO,WACCI,KAAKsO,aAAa1K,OAClB5D,KAAKoO,cAAcpH,OAGpBpH,aACCI,KAAKoO,cAAcxK,OACnB5D,KAAKsO,aAAatH,OAGnBpH,OAAOyH,GACN,GAAGA,GAAkB,KAATA,IAAgBrH,KAAK4N,SAAS7K,SAASsE,GAAQ,CAC1D1E,IAAIqM,EAAOhP,KAAKiP,OAAO5H,GACvBrH,KAAKqO,eAAeW,GAAME,aAAalP,KAAKoO,eAC5CpO,KAAK4N,SAASvN,KAAKgH,GACnBrH,KAAK6N,UAAY7N,KAAK6N,SAASxG,IAIjCzH,UAAUyH,GACTA,EAAQhK,OAAOiC,MAAMqP,aAAatH,GAC/BrH,KAAK4N,SAAS7K,SAASsE,KACzBrH,KAAK4N,SAASuB,OAAOnP,KAAK4N,SAASvF,QAAQhB,GAAQ,GACnDrH,KAAK8N,aAAe9N,KAAK8N,YAAYzG,IAIvCzH,QAAQwP,GACPA,EAAOpO,IAAIhB,KAAK4O,OAAO/H,KAAK7G,OAG7BJ,YACCI,KAAKmO,IAAIxM,KAAK,eAAeU,SAC7BrC,KAAK4N,SAAW,GAGjBhO,eAAeyP,EAAUC,GACxB3M,IAAI4M,EAAMzP,+BAA+BwP,aAEzC,OADAD,EAAS5N,SAAS8N,GACXA,EAGR3P,OAAOyH,cACF2H,EAAOlP,uDAAuDuH,iFAEtDnJ,GAAG,4CACKmJ,QAAWA,gGAGnBnJ,GAAG,4CACKmJ,gFAIhBmI,EAAaR,EAAKrN,KAAK,eACvB8N,EAAaT,EAAKrN,KAAK,eAW3B,GATA6N,EAAWpN,GAAG,mBACb/E,OAAOqS,aAAaC,OAAOC,YAAY,IAAI/C,OAAO2C,EAAWK,KAAK,mBAAoB,UAGvFJ,EAAWrN,GAAG,mBACbpC,EAAK8P,UAAUL,EAAWI,KAAK,mBAC/BJ,EAAW1I,QAAQ,mBAAmB1E,WAGpCrC,KAAK+N,WAAY,CACnBpL,IAAIoN,EAAcf,EAAKrN,KAAK,eAC5BoO,EAAY3N,GAAG,mBACdpC,EAAK+N,WAAWgC,EAAYF,KAAK,qBAInC,OAAOb,ICnIT3R,OAAOqC,GAAGsQ,UAAYhF,MAAMjL,OAAO,CAClCkL,KAAM,SAASpL,GASdC,EAAEC,OAAOC,KAAMH,GAEfG,KAAKiQ,aAEAjQ,KAAKkQ,YACTlQ,KAAKkQ,UAAY,IAElBlQ,KAAKmQ,aAAc,EACnBnQ,KAAKiG,QAAQjG,KAAKkQ,YAEnBD,WAAY,WACX,IAAI/E,EAAKlL,KAGJA,KAAK0B,SAIV1B,KAAKkG,QAAUpG,EAAE,qDAAqD2B,SAASzB,KAAK0B,QAChF1B,KAAKkG,QAAQoD,SAEjBtJ,KAAKoQ,KAAO,IAAI/S,OAAOqC,GAAGiO,KAAK,CAC9BjM,OAAQ1B,KAAKkG,QACb+H,YAAa/P,GAAG,iBAChB2P,kBAAWwC,GACV,GAAGnF,EAAGiF,cAAgBjF,EAAGoF,WACxB,OAAOjT,OAAOkT,KAAK,CAClBC,OAAQ,sCACRzG,KAAMmB,EAAGuF,SAASJ,GAClBK,SAAU,SAASC,GAClB,IAAIT,EAAYhF,EAAGgF,UAAYhF,EAAGgF,UAAU1H,MAAM,KAAO,GACzD0H,EAAU7P,KAAKgQ,GACfnF,EAAGgF,UAAYA,EAAU9L,KAAK,KAC9B8G,EAAG3I,WAAa2I,EAAG3I,UAAU2I,EAAGgF,WAChC7S,OAAO+S,KAAK9Q,MAAMsR,iBAKtB9C,qBAAcuC,GACb,IAAInF,EAAGoF,WACN,OAAOjT,OAAOkT,KAAK,CAClBC,OAAQ,yCACRzG,KAAMmB,EAAGuF,SAASJ,GAClBK,SAAU,SAASC,GAClB,IAAIT,EAAYhF,EAAGgF,UAAU1H,MAAM,KACnC0H,EAAUf,OAAOe,EAAU7H,QAAQgI,GAAM,GACzCnF,EAAGgF,UAAYA,EAAU9L,KAAK,KAC9B8G,EAAG3I,WAAa2I,EAAG3I,UAAU2I,EAAGgF,WAChC7S,OAAO+S,KAAK9Q,MAAMsR,mBAMvB5Q,KAAK6Q,oBACL7Q,KAAK8Q,gBAAiB,KAEvBD,kBAAmB,WAClB,IAAI3F,EAAKlL,KACLmL,EAASnL,KAAKkG,QAAQvE,KAAK,oBAC3BoP,EAAQ5F,EAAOvF,IAAI,GACvB5F,KAAKqL,YAAc,IAAIC,YAAYyF,EAAO,CACzCxF,SAAU,EACVC,SAAU,GACVE,KAAM,KAEPP,EAAO/I,GAAG,mBAAoB,SAASgE,GACtC+E,EAAO0E,KAAK,QAAS,UAEtB1E,EAAO/I,GAAG,oBAAqB,SAASgE,GACvC+E,EAAO0E,KAAK,QAAS,YAEtB1E,EAAO/I,GAAG,QAAS,SAASgE,GAC3B,IAAI7H,EAAQ6H,EAAE4K,OAAOzS,MACrBlB,OAAOkT,KAAK,CACXC,OAAQ,uCACRzG,KAAK,CACJxM,QAAS2N,EAAG+F,IAAI1T,QAChB2T,IAAK3S,EAAMsK,eAEZ6H,SAAU,SAASC,GAClBzF,EAAGG,YAAYK,KAAOiF,EAAEQ,aAI3BhG,EAAO/I,GAAG,QAAS,SAASgE,GACA,QAAxB+E,EAAO0E,KAAK,UACd1E,EAAOiG,QAAQ,YAIlBX,SAAU,SAASJ,GAClB,MAAO,CACNA,IAAKA,EACLgB,GAAIrR,KAAKiR,IAAI1T,QACb+T,GAAItR,KAAKiR,IAAIM,UAGftL,QAAS,SAASiK,GACjB,IAAIhF,EAAKlL,KACT,GAAKA,KAAKmQ,aAAgBnQ,KAAK8Q,iBAAkB9Q,KAAKsQ,WAAtD,CAEApF,EAAGoF,YAAa,EAChB,IACCpF,EAAGkF,KAAKoB,YACLtB,IACFhF,EAAGgF,UAAYA,EACfhF,EAAGkF,KAAKrB,QAAQmB,EAAU1H,MAAM,OAEhC,MAAMpC,GACP8E,EAAGoF,YAAa,EAEhBmB,WAAY,WAAavG,EAAGjF,WAAc,KAE3CiF,EAAGoF,YAAa,MC1HlBjT,OAAOqC,GAAGgS,SAAW,SAAS1T,GAE7B,OAA6C,IADjCX,OAAOqC,GAAGiS,aAAa3T,GACtBqK,QAAQhL,OAAOuU,QAAQC,OAGrCxU,OAAOqC,GAAGiS,aAAe,SAAS3T,GACjC,IAAI8T,EAAQ9T,EAAI+T,UAKhB,OAJGD,IACFA,EAAQE,KAAKC,MAAMH,IAGbA,GAAS,IAGjBzU,OAAOqC,GAAGwS,YAAc,SAASC,EAAM5U,EAAS6U,EAAM1B,GACrD,IAAI2B,EAAMF,EAAKG,SAAS,aAAe,MAAQ,KAE/CH,EAAKI,IAAI,iBAAkB,QAE3BlV,OAAOkT,KAAK,CACXC,OAAQ,+BACRgC,OAAO,EACPzI,KAAM,CACLxM,QAASA,EACT6U,KAAMA,EACNC,IAAKA,GAEN3B,SAAU,SAASC,GAIlB,GAFAwB,EAAKI,IAAI,iBAAkB,SAEvB5B,EAAE8B,IAAK,CAEV,IAAIC,EAAiB5S,EAAE,2BAA4BsS,EAAKO,QAAQ,KAAM,KACpE,oBAAqBpV,EAAQoV,QAAQ,KAAM,KAAM,MAE1C,QAANN,EACFK,EAAepQ,YAAY,8BAE3BoQ,EAAelP,SAAS,8BAIzB,IAAIxF,EAAMS,OAAOlB,IAAYkB,OAAOlB,GAAS6U,GAC7C,GAAGpU,EAAK,CACP,IAAI4U,EAAWZ,KAAKC,MAAMjU,EAAI+T,WAAa,MAC1Cc,EAAMD,EAASvK,QAAQhL,OAAOuU,QAAQC,MAC9B,QAANQ,GACQ,IAAPQ,GACFD,EAASvS,KAAKhD,OAAOuU,QAAQC,OAEpB,IAAPgB,IACFD,EAAWA,EAAS7H,MAAM,EAAE8H,GAAKhG,OAAO+F,EAAS7H,MAAM8H,EAAI,KAG7D7U,EAAI+T,UAAYC,KAAKc,UAAUF,GAG7BlC,GACFA,SAOLrT,OAAOqC,GAAGqT,kBAAoB,WAC7B,IAAIZ,EAAOrS,EAAEE,MACTgT,EAASb,EAAKc,SAAS,gBACvBC,EAAYf,EAAKG,SAAS,aAC1B/U,EAAU4U,EAAKtC,KAAK,gBACpBuC,EAAOD,EAAKtC,KAAK,aAUrB,OARAxS,OAAOqC,GAAGwS,YAAYC,EAAM5U,EAAS6U,EAAM,WACtCc,EACHF,EAAOjH,KAAK9D,KAAK+K,EAAOjH,QAAU,GAElCiH,EAAOjH,KAAK9D,KAAK+K,EAAOjH,QAAU,MAI7B,GAGR1O,OAAOqC,GAAGyT,4BAAsBC,EAASC,EAAUC,mBAAgB,GAC9DjW,OAAOkW,IAAIC,kBAIfJ,EAAQhR,GAAG,YAAaiR,EAAU,WACjCnQ,IAAMuQ,EAAiB3T,EAAEE,MACzByT,EAAeC,QAAQ,CACtBC,WAAW,EACXC,UAAW,QACXxC,QAAS,SACTyC,SAAS,uIAITC,mBACCnR,IAAIiQ,EAAWa,EAAe5D,KAAK,iBACnC+C,EAAWA,EAAWmB,UAAUnB,GAAY,KAC5CA,EAAWZ,KAAKC,MAAMW,GAEtB1P,IAAM2O,EAAOxU,OAAOuU,QAAQC,KAc5B,GAZIyB,IACCG,EAAe9R,KAAK,cAAc2H,QACP,IAA1BsJ,EAASvK,QAAQwJ,IACpBe,EAASzD,OAAOyD,EAASvK,QAAQwJ,GAAO,IAGX,IAA1Be,EAASvK,QAAQwJ,IACpBe,EAASvS,KAAKwR,KAKZe,EAAStJ,OACb,MAAO,GAGR3G,IAAIqR,EAAgBlU,EAAE,mCAoBtB,OAfA8S,EAAS/K,iBAAQgK,GAEhBmC,EAAc7K,sCACG0I,MAAQxU,OAAO4W,OAAOpC,4BAC7BxU,OAAOwU,KAAKqC,UAAUrC,+CAKjCmC,EAAcG,SAAS,MAAMC,eAAMC,GAClC1R,IAAIkP,EAAOwC,EAAGC,cAAcC,QAAQ1C,KACpC4B,EAAeC,QAAQ,QACvBrW,OAAOmX,UAdQ,mBAcc3C,KAGvBmC,GAER9M,MAAM,EACNuN,UAAW,SAGZhB,EAAeC,QAAQ,QAEvB5T,EAAE,YAAYsC,GAAG,wBAChBqR,EAAeC,QAAQ,UAGxBD,EAAerR,GAAG,sBACjBqP,sBACM3R,EAAE,kBAAkBwJ,QACxBmK,EAAeC,QAAQ,SAEtB,yiDClKNrW,OAAOqX,QAAQ,gBAEfrX,OAAOsX,MAAMC,SAAW,MACvBhV,YAAYC,GACXgV,OAAOC,OAAO9U,KAAMH,GAGrBD,kBACCvC,OAAOsM,aAAa,mBACb3J,EAAKiL,0BACLjL,EAAK+U,oCACL/U,EAAKiG,aAIbrG,kBAEC,GAAII,KAAKgV,aAAc,OAAOhV,KAAKgV,aAEnCrS,IAAIsS,EAAQ,CACXjV,KAAKkV,eACLlV,KAAKmV,UACLnV,KAAKoV,aAELpV,KAAKqV,WACLrV,KAAKsV,eACLtV,KAAKuV,mBACLvV,KAAKwV,YACJxU,aAAIyU,UAAMA,EAAG5O,KAAK7G,KAGpB,OADAA,KAAKgV,aAAe3X,OAAOsM,aAAasL,GACjCjV,KAAKgV,aAGbpV,4BACCI,KAAK0V,UAAYrY,OAAOsY,gBACxB3V,KAAK4V,WAAa5V,KAAK4V,YAAc1X,GAAG8B,KAAKzC,SAC7CyC,KAAKlC,KAAOT,OAAOwY,SAAS7V,KAAKzC,SACjCyC,KAAK3B,SAAWhB,OAAOK,kBAAkBsC,KAAKzC,UAAY,GAC1DyC,KAAK8V,cAAgBzY,OAAO0Y,kBAAkB/V,KAAKzC,SAEnDyC,KAAKgW,MAAQ,EACbhW,KAAKiW,YAAc,GACnBjW,KAAK6L,KAAO,GACZ7L,KAAKwQ,OAAS,6BAEdxQ,KAAKkW,WAAa7Y,OAAOG,MAAM0Y,WAAWlW,KAAKzC,SAC/CyC,KAAKmW,UAAY9Y,OAAOG,MAAM2Y,UAAUnW,KAAKzC,SAE7CyC,KAAKoW,OAAS,GACdpW,KAAKgJ,QAAU,GACfhJ,KAAKqW,QAAU,WACfrW,KAAKsW,WAAa,OAGlBtW,KAAKuW,eAAiB,KACtBvW,KAAKwW,iBAAmB,CACvBnP,MAAOnJ,GAAG,WACVuY,yBAAczW,EAAKiG,YAGpBjG,KAAK0W,WAAa,CAAC,CAClBrP,MAAOnJ,GAAG,WACVuY,yBAAczW,EAAKiG,WACnB0Q,MAAO,eAIT/W,eACCI,KAAK4W,aACL5W,KAAK6W,eAGNjX,wBACc,GAAGiN,OACfxP,OAAOG,MAAMyM,gBACbjK,KAAKlC,KAAKgZ,aAGJjP,iBAAQhC,UAAK7F,EAAK+W,WAAWlR,KAGrCjG,qCACC,OAAOI,KAAKlC,KAAKsY,OAAOlV,gBAAO+B,GAC9B,OAAO5F,OAAOG,MAAMwZ,cAAc/T,EAAGH,YACpCG,EAAGgU,cACA5Z,OAAO6P,KAAKC,SAASnN,EAAKzC,QAAS0F,EAAGmK,UAAW,SAEnC,aAAjBnK,EAAGH,WACAG,EAAGgC,UACFhC,EAAGgC,QAAQlC,SAAS,MAEP,WAAjBE,EAAGhB,YAKNrC,0BAECI,KAAKoW,OAASpW,KAAKoW,OAAOpV,aAAI6E,GAI7B,MAHiB,iBAANA,IACVA,EAAI,CAACA,EAAG7F,EAAKzC,UAEPsI,IAGR7F,KAAKoW,OAASpW,KAAKoW,OAAOlV,OAAOgW,SAEjClX,KAAKoW,OAASpW,KAAKoW,OAAOe,gBAAOtR,UAAKA,EAAE,GAAKA,EAAE,KAGhDjG,WAAWqC,EAAW1E,GACrB,GAAK0E,EAAL,CAIA,GAFK1E,IAASA,EAAUyC,KAAKzC,SAEJ,iBAAd0E,EAAwB,CAElCiB,IAAMD,EAAKhB,EACXA,EAAYgB,EAAGhB,UACf1E,EAAU0F,EAAGvB,OAGT1B,KAAKoW,SAAQpW,KAAKoW,OAAS,KAET/Y,OAAOG,MAAMyM,gBAAgBlH,SAASd,IACzD5E,OAAOS,KAAKC,UAAUR,EAAS0E,IACjB,UAAdA,IAMJjC,KAAKoW,OAAO/V,KAAK,CAAC4B,EAAW1E,KAG9BqC,YACCI,KAAKoX,MAAQ,CAAC,cAEdpX,KAAKqX,yBAA2Bha,OAAOO,SAASC,oBAAoBmC,KAAKzC,SACrEyC,KAAKqX,2BACHha,OAAOO,SAASO,UAAU6B,KAAKzC,SAA0B,iBAC7DyC,KAAK+W,WAAW/W,KAAKqX,0BAEtBrX,KAAKoX,MAAM/W,KAAKL,KAAKqX,2BAIvBzX,aACCI,KAAKsX,KAAOtX,KAAK0B,OAAO4V,KACxBtX,KAAKuX,MAAQzX,EAAEE,KAAK0B,QACpB1B,KAAKsX,KAAKE,UAAUlV,YAAY,OAAOkB,SAAS,QAChDxD,KAAKyX,kBAGN7X,kBACCI,KAAK0X,YACL1X,KAAK2X,iBACL3X,KAAK4X,kBAGNhY,YACCI,KAAKsX,KAAKI,UAAU1X,KAAK4V,YAG1BhW,4BACOiY,EAAoB7X,KAAKsX,KAAKQ,qBACnC9X,KAAKwW,iBAAiBnP,MACtBrH,KAAKwW,iBAAiBC,OACtBzW,KAAKwW,iBAAiBuB,MAElB/X,KAAKwW,iBAAiBuB,KAG1BF,EAAkBrU,SAAS,cAF3BqU,EAAkBrU,SAAS,aAK5BxD,KAAK0W,WAAW1V,aAAI2K,GACnB,IAAIA,EAAK/I,YAAkC,IAArB+I,EAAK/I,YAA3B,CAGAM,IAAM8U,EAAQhY,EAAKsX,KAAKW,cAActM,EAAKtE,MAAOsE,EAAK8K,OAAQ9K,EAAKuM,SAAUvM,EAAKwM,UAC/ExM,EAAKgL,OACRqB,GAASA,EAAMxU,SAASmI,EAAKgL,UAKhC/W,kBACCvC,OAAO+a,YAAY/F,IAAIrS,KAAKlC,KAAKua,OAAQrY,KAAKzC,SAG/CqC,iBACCI,KAAKsY,aAAe,IAAIjb,OAAOsX,MAAM4D,YAAY,CAChDhb,QAASyC,KAAKzC,QACd6Z,MAAOpX,KAAKoX,MACZ1V,OAAQ1B,KAAKuX,MAAM5V,KAAK,wBAExB2V,KAAMtX,KAAKsX,KACXkB,UAAWxY,OAIbJ,kBACC+C,IAAI8V,EAAezG,KAAKC,MAAMyG,aAAaD,cAAgB,QAC3DA,GAAgBA,EAChBC,aAAaD,aAAeA,EAC5BzY,KAAK2Y,uBAGN/Y,uBACC+C,IAAI8V,EAAezG,KAAKC,MAAMyG,aAAaD,cAAgB,QAC3D3Y,EAAE8Y,SAASC,MAAMC,YAAY,mBAAoBL,GAGlD7Y,gCACC,OAAOvC,OAAOsM,aAAa,CAC1B3J,KAAK+Y,mBACL/Y,KAAK2Y,qBACL3Y,KAAKgZ,kBACLhZ,KAAKiZ,oBACLjZ,KAAKkZ,kBACLlZ,KAAKmZ,qBACLnZ,KAAKoZ,kBACLpZ,KAAKqZ,mBACJrY,aAAIyU,UAAMA,EAAG5O,KAAK7G,MAGrBJ,qBACCI,KAAKsZ,aAAexZ,EAAE,6BAA6B2B,SAASzB,KAAKsX,KAAKiC,MAGvE3Z,oBAGC,GAFAI,KAAKwZ,YAAc,IAAIC,WAAWzZ,MAE9BA,KAAKgJ,SAAWhJ,KAAKgJ,QAAQM,OAAS,EACzC,OAAOtJ,KAAKwZ,YAAYE,IAAI1Z,KAAKgJ,SAInCpJ,sBACCI,KAAK2Z,cAAgB,IAAItc,OAAOqC,GAAGka,aAAa,CAC/ClY,OAAQ1B,KAAKwZ,YAAYK,qBACzBtc,QAASyC,KAAKzC,QACdwM,KAAM,CACLsM,QAASrW,KAAKqW,QACdC,WAAYtW,KAAKsW,YAElBwD,SAAU9Z,KAAK+Z,eAAelT,KAAK7G,QAIrCJ,iBACCI,KAAKiG,UAGNrG,oBACCI,KAAKga,QAAUla,EAAE,wBACjBE,KAAKsZ,aAAanQ,OAAOnJ,KAAKga,SAG/Bpa,uBACCI,KAAKia,WAAana,0FAEdE,KAAKka,gDAENtW,OACH5D,KAAKsZ,aAAanQ,OAAOnJ,KAAKia,YAG/Bra,oBACCI,KAAKma,QAAUra,EAAE,8BAA8B8D,OAC/C5D,KAAKsZ,aAAanQ,OAAOnJ,KAAKma,SAG/Bva,wBACC,OAAO1B,GAAG,mBAGX0B,+BAECI,KAAKoa,aAAeta,4HADE,CAAC,GAAI,IAAK,KAKZkB,aAAIzC,yHAEJA,yBACZA,8CAED6F,KAAK,sJAKNlG,GAAG,kEAIP0F,OACF5D,KAAKsZ,aAAanQ,OAAOnJ,KAAKoa,cAG9Bpa,KAAKoa,aACHzY,gCAAgC3B,uBAChCwD,SAAS,YAEXxD,KAAKoa,aAAahY,GAAG,QAAS,kCAA0BgE,GACvDlD,IAAMmX,EAAQva,EAAEsG,EAAEkO,eAEd+F,EAAMC,GAAG,gBAEZta,EAAKoa,aAAazY,KAAK,eAAeW,YAAY,YAClD+X,EAAM7W,SAAS,YAEfxD,EAAKgW,MAAQ,EACbhW,EAAKiW,YAAcoE,EAAMxO,OAAOtN,MAChCyB,EAAKiG,WACKoU,EAAMC,GAAG,eACnBta,EAAKgW,MAAQhW,EAAKgW,MAAQhW,EAAKiW,YAC/BjW,EAAKiG,aAKRrG,aAEC,OAAOI,KAAKoW,OAAOpV,aAAI6E,UAAKxI,OAAOG,MAAM+c,qBAAqB1U,EAAE,GAAIA,EAAE,MAGvEjG,cAIAA,uBAGC,OAAOI,KAAKwZ,YACTxZ,KAAKwZ,YAAY5T,MAAM5E,aAAIE,UAAUA,EAAO6J,MAAM,EAAG,KACrD,GAGJnL,WACC,MAAO,CACNrC,QAASyC,KAAKzC,QACd6Y,OAAQpW,KAAKwa,aACbxR,QAAShJ,KAAKya,uBACdC,SAAU1a,KAAK2Z,cAAcgB,iBAC7B3E,MAAOhW,KAAKgW,MACZC,YAAajW,KAAKiW,YAClB2E,KAAM5a,KAAK4a,MAIbhb,gBACCsD,IAAM6G,EAAO/J,KAAKyQ,WAClB,MAAO,CACND,OAAQxQ,KAAKwQ,OACbzG,KAAMA,EACN8Q,OAAQ7a,KAAK8a,oBAAqB,EAClCC,eAAgB/a,KAAK+a,gBAAmB7c,GAAG,WAAa,OAI1D0B,kBAKAA,qBAGC,OAFAI,KAAK6a,QAAO,GAELxd,OAAOkT,KAAKvQ,KAAKgb,iBAAiBtX,cAAKiN,GAE7C3Q,EAAKib,aAAatK,GAClB3Q,EAAKkb,qBACLlb,EAAKmb,gBACLnb,EAAKob,SACLpb,EAAKqb,eACLrb,EAAK6a,QAAO,GACR7a,EAAK3B,SAAS4H,SACjBjG,EAAK3B,SAAS4H,QAAQjG,KAKzBJ,aAAa+Q,GACZhO,IAAIkJ,EAAO8E,EAAEQ,SAAW,GACxBtF,EAAQ3H,MAAMC,QAAQ0H,GAAoDA,EAA5CxO,OAAOiC,MAAMgc,KAAKzP,EAAK0P,KAAM1P,EAAK2P,QAE7C,IAAfxb,KAAKgW,MACRhW,KAAK6L,KAAOA,EAEZ7L,KAAK6L,KAAO7L,KAAK6L,KAAKgB,OAAOhB,GAG9B7L,KAAK6L,KAAO7L,KAAK6L,KAAKsL,gBAAOzK,UAAKA,EAAE0F,OAGrCxS,UAIAA,iBAIAA,gBAIAA,UAIAA,oBAIAA,qBACCI,KAAKga,QAAQ/S,OAAOjH,KAAK6L,KAAKvC,OAAS,GACvCtJ,KAAKoa,aAAanT,OAAOjH,KAAK6L,KAAKvC,OAAS,GAC5CtJ,KAAKia,WAAWhT,OAA2B,GAApBjH,KAAK6L,KAAKvC,QAEjCpG,IAAMuY,EAAazb,KAAKgW,MAAQhW,KAAKiW,aAAgBjW,KAAK6L,KAAKvC,OAC/DtJ,KAAKoa,aAAazY,KAAK,aACrBsF,OAAOwU,GAGV7b,wBAAwB4Q,EAAQzG,6BAAO,IACtCA,EAAK2R,MAAQ1b,KAAK2b,mBAAkB,GAEpCte,OAAOkT,KAAK,CACXC,OAAQA,EACRzG,KAAMA,EACN8Q,QAAQ,EACRnK,kBAAUC,GACJA,EAAE8B,KACNzS,EAAKiG,eAOV,MAAMwT,WACL7Z,YAAY4Y,GACXxY,KAAKwY,UAAYA,EACjBxY,KAAK4b,yBAA2B5b,KAAKwY,UAAUlB,KAAKE,UACpDxX,KAAK6Z,qBAAuB/Z,EAAE,6BAA6B2B,SAASzB,KAAKwY,UAAUc,cACnFtZ,KAAK6b,iBAAkB,EACvB7b,KAAKsB,QAGN1B,QACCI,KAAK8b,wBACL9b,KAAK+b,mBAGNnc,MACC+C,IAAIqG,EAAUhJ,KAAKgc,YAAYC,cAC3BC,EAAmBlc,KAAKmc,uBAE5B,OAAOnT,EACL6D,OAAOqP,GACP/E,OAAOnF,KAAKc,WAGflT,IAAIoJ,cAGH,OADAhJ,KAAK6b,iBAAkB,EAChB7b,KAAKqS,IAAIrJ,GAAS,GACvBtF,gBACA1D,EAAK6b,iBAAkB,IAI1Bjc,IAAIoJ,EAAS/C,cACZ,mBADsB,IACjB+C,GAAW9E,MAAMC,QAAQ6E,IAA+B,IAAnBA,EAAQM,OACjD,OAAOhG,QAAQC,UAEU,iBAAfyF,EAAQ,KAGlBA,EAAU,CADK9E,MAAMkY,KAAKtS,aAI3Bd,EAAUA,EAAQ9H,gBAAO2E,GACxB,OAAQ7F,EAAK2K,OAAO9E,KAGrB,MAA0C7F,KAAKqc,oBAAoBrT,4BAEnE,iBACEtF,gBACA,OAAO4Y,EAAqBhT,OAAS,GACpCtJ,EAAKgc,YAAYO,YAAYD,KAE9B5Y,gBACAuC,GAAWjG,EAAKwY,UAAUvS,YAI7BrG,oBACKI,KAAK6b,kBACR7b,KAAKwY,UAAUxC,MAAQ,EACvBhW,KAAKwY,UAAUvS,UACfjG,KAAKwY,UAAUgE,oBAIjB5c,OAAOiG,GACNlD,IAAIgI,GAAS,EAEP8R,EAAczc,KAAKwY,UAAUlB,KAAKmF,YAC3B,MAAT5W,EAAE,IAAcA,EAAE,KAAM4W,IACbA,EAAY5W,EAAE,IAAIN,cAE/BoF,GAAS,IASX,OAJKA,IACJA,EAAS3K,KAAKgc,YAAY5R,cAAcvE,IAGlC8E,EAGR/K,oBAAoBoJ,GACnB,GAAuB,IAAnBA,EAAQM,OACX,MAAO,CACNgT,qBAAsB,GACtBjZ,QAASC,QAAQC,WAInBL,IAAMuZ,EAAczc,KAAKwY,UAAUlB,KAAKmF,YAoBxC,OAlBUzT,EAAQ0T,gBAAQC,EAAKzb,QAE9B,yBAaA,OAZAyb,EAAItZ,QAAUsZ,EAAItZ,SAAWC,QAAQC,UACrCoZ,EAAIL,qBAAuBK,EAAIL,sBAAwB,IAEnDG,EAAYxa,IAA6B,MAAdW,GAAmC,SAAdA,EAOnD+Z,EAAIL,qBAAqBjc,KAAKa,GAL9Byb,EAAItZ,QAAUsZ,EAAItZ,QAAQK,uBACnB+Y,EAAYxa,GAAWE,UAAU5D,KAMlCoe,GACL,IAKJ/c,OAAOqC,GACNiB,IAAMuZ,EAAczc,KAAKwY,UAAUlB,KAAKmF,YAExC,GAAIxa,KAAawa,EAChB,OAAOA,EAAYxa,GAAWE,UAAU,IAGzCQ,IAAIzB,EAASlB,KAAKgc,YAAYY,WAAW3a,GAEzC,OADIf,GAAQA,EAAOmB,SACZiB,QAAQC,UAGhB3D,MAAMqG,8BAAU,GACVA,IACJjG,KAAK6b,iBAAkB,GAGxB7b,KAAKgc,YAAYvS,gBAEjBvG,IAAMwG,EAAW,GACX+S,EAAczc,KAAKwY,UAAUlB,KAAKmF,0BAEvCvZ,IAAMR,EAAQ1C,EAAKwY,UAAUlB,KAAKmF,YAAYI,GAC9CnT,EAASrJ,uBAAWqC,EAAMP,UAAU,OAFrC,IAAKQ,IAAIka,KAAOJ,OAIhB,OAAOpf,OAAOsM,aAAaD,GACzBhG,gBACA1D,EAAK6b,iBAAkB,IAI1Bjc,mCACKwW,EAAS,CACZ,CACCtT,UAAW,OACXuE,MAAO,OACPzE,UAAW,OACXX,UAAW,OACX6X,2BAAgB9Z,EAAK8c,uBAIpB9c,KAAKwY,UAAUuE,wBACjB/c,KAAKwY,UAAUuE,sBAAsBlV,iBAAQmV,GAC5CA,EAAOlD,2BAAiB9Z,EAAK8c,uBAG9B1G,EAASA,EAAOvJ,OAAO7M,KAAKwY,UAAUuE,wBAGvC7Z,IAAM+Z,EAAiBjd,KAAKwY,UAAU1a,KAAKsY,OACrCU,EAAc9W,KAAKwY,UAAU1a,KAAKgZ,aAExCV,EAASA,EAAOvJ,OAAOoQ,EAAe/b,gBACrC+B,UAAOA,EAAGhB,YAAc6U,GAAiB7T,EAAGia,oBAAsB7f,OAAOG,MAAMwZ,cAAc/T,EAAGH,aAC/F9B,aAAIiC,GACLN,IAAIsC,EAAUhC,EAAGgC,QACbrC,EAAY,IACZE,EAAYG,EAAGH,UACf,CAAC,OAAQ,aAAc,cAAe,cAAe,OAAQ,OAAQ,aAAaC,SAASD,KAC9FA,EAAY,OACZF,EAAY,QAEO,UAAhBK,EAAGH,WAAyBG,EAAGgC,UAClCA,EAAUhC,EAAGgC,QAAQuD,MAAM,OACfc,OAAS,GAAmB,IAAdrE,EAAQ,KACjCA,EAAQkY,QAAQ,IAChBlY,EAAUA,EAAQb,KAAK,OAGzBzB,IAAIya,EAA+B,SAAdta,EAAwBzF,OAAOggB,SAASC,iBAAiBrY,GAAW,KAIzF,MAHI,CAAC,YAAa,YAAYlC,SAASqa,KACtCA,EAAgB,MAEV,CACNta,UAAWA,EACXuE,MAAOnJ,GAAG+E,EAAGoE,OACbpC,QAASA,EACThD,UAAWgB,EAAGhB,UACdW,UAAWA,EACX2a,QAASH,EACTtD,2BAAgB9Z,EAAK8c,qBACrBlU,uBAAsC,iBAAd9F,EACxBgC,UAAW,OAIN9D,aAAIiC,UAAMjD,EAAKwY,UAAUlB,KAAKkG,UAAUva,KAGhDrD,uBACCsD,IAAM8F,EAAU,GACVyT,EAAczc,KAAKwY,UAAUlB,KAAKmF,YACxC,IAAK9Z,IAAIka,KAAOJ,EAAa,CAC5B9Z,IAAID,EAAQ+Z,EAAYI,GACpBte,EAAQmE,EAAM6C,YACdhH,IACwB,SAAvBmE,EAAMO,GAAGL,WAAyBrE,EAAMwE,SAAS,OACpDxE,EAAQ,IAAMA,EAAQ,KAEvByK,EAAQ3I,KAAK,CACZL,KAAKwY,UAAUjb,QACfmF,EAAMO,GAAGhB,UACTS,EAAMO,GAAGL,WAAa,IACtBrE,KAKH,OAAOyK,EAGRpJ,8BACCI,KAAKgc,YAAc,IAAI3e,OAAOqC,GAAGqJ,YAAY,CAC5C0U,UAAWzd,KAAKwY,UAChB9W,OAAQ1B,KAAK6Z,qBACbtc,QAASyC,KAAKwY,UAAUjb,QACxBmgB,gBAAiB,GACjBnb,4BAAiBvC,EAAK8c,uBAIxBld,kBAEC,OAAOI,KAAKgc,aACXhc,KAAKgc,YAAY9V,QAAQvE,KAAK,uBAAuB2H,OAAS,GAKjEjM,OAAOsX,MAAMgJ,WAAa,CAAC,OAAQ,QAAS,SAAU,WAAY,QAAS,QAAS,UACpFtgB,OAAOsX,MAAMiJ,kBAAWC,UAAaxgB,OAAOsX,MAAMgJ,WAAW5a,SAAS8a,ICprBvD,MAAMC,eACpBle,YAAYU,mBACN/C,GAASF,OAAO6M,MAAMhM,GAAG,qBAC9B8B,KAAKzC,QAAUA,EAGhBqC,MAAMme,cACCC,EAAiB3gB,OAAOG,MAAMygB,QAAQ,kBAAmB,kBACzDC,EAAwBjW,KAAK+V,EAAeE,uBAC5CzgB,EAAiBJ,OAAOG,MAAMC,eAAeuC,KAAKzC,SAClD4gB,EAA4BlW,KAAK+V,EAAeG,2BAEhDC,EAAaL,EAAK7c,gBAAOlD,GAC9B,OAAQP,GAAoC,IAAlBO,EAAIiB,WAC5Bkf,GAA8C,GAAjBngB,EAAIiB,WACjCif,GAA0C,GAAjBlgB,EAAIiB,WAC9B5B,OAAOwU,KAAKwM,SAAS,mBACpBrd,aAAIhD,UAAOA,EAAIoU,OAIlB,GAFqB2L,EAAK7c,gBAAOlD,UAAQogB,EAAWrb,SAAS/E,EAAIoU,QAEhD9I,OAAS,EACzBjM,OAAOihB,SAASpgB,GAAG,mDAIpB,GAAIkgB,EAAW9U,OAAS,EAAG,CAC1BpG,IAAMqb,EAAS,IAAIlhB,OAAOqC,GAAG8e,OAAO,CACnCC,MAAOvgB,GAAG,mBACVkY,OAAQ,CAAC,CACRtT,UAAa,QACbuE,MAASnJ,GAAG,mBACZ+D,UAAa,mBAEd,CACCa,UAAa,SACbuE,MAASnJ,GAAG,gBACZ+D,UAAa,YACbgD,QAAS5H,OAAOS,KAAK4gB,kBAAkB1e,KAAKzC,aAI9CghB,EAAOI,mBAAmBzgB,GAAG,kBAAU6L,GACtC,GAAKA,EAAL,CACA7G,IAAM0b,EAAuBvhB,OAAOwY,SAAS7V,EAAKzC,SAASqhB,qBACrDC,EAAkB9U,EAAK8U,gBAAkB,EAAI,EAC7CC,EAAe/U,EAAKgV,UAAYhV,EAAKgV,UAAYH,EACjDI,EAAchN,KAAKc,UAAUsL,GAEzBnV,OAAOgW,KAAK,oEACRC,mBAAmBlf,EAAKzC,SACrC,SAAW2hB,mBAAmBF,GAC9B,WAAaE,mBAAmBJ,GAChC,mBAAqBD,EAAkB,IAAM,OAE7CxhB,OAAOihB,SAASpgB,GAAG,6BAKrBqgB,EAAOvX,YAEP3J,OAAOihB,SAASpgB,GAAG,yCAIrB0B,OAAOuf,EAAUC,kBAAO,MACvB/hB,OACEkT,KAAK,CACLC,OAAQ,sCACRqK,QAAQ,EACR9Q,KAAM,CACLsV,MAAOF,EACP5hB,QAASyC,KAAKzC,WAGfmG,cAAMiN,GACNhO,IAAI2c,EAAS3O,EAAEQ,QACVmO,IAAQA,EAAS,IAElBA,EAAOhW,SAAWqH,EAAE4O,kBACvBliB,OAAO6M,MAAMhM,GAAG,oBAAqB,CAACohB,EAAOte,aAAI6E,UAAKA,EAAEsE,SAAQ/F,KAAK,SAElEkb,EAAOhW,OAAS6V,EAAS7V,SAC5BjM,OAAOiC,MAAMkgB,WAAW,UACpBJ,GAAMA,OAKdxf,OAAOuf,EAAUC,GAChB,GAAID,EAAS7V,OAAS,EAAG,CACxBpG,IAAMuc,EAAY,IAAIpiB,OAAOqC,GAAGoG,KAAK4Z,eAAe,CACnDC,IAAK3f,KACLwQ,OAAQ,0CACRjT,QAASyC,KAAKzC,QACdgU,QAAS4N,EACTS,aAAa,EACbC,WAAW,EACXnP,SAAU0O,IAEXK,EAAUlB,OAAOnS,QACjBqT,EAAUlB,OAAOvX,YAEjB3J,OAAOihB,SAASpgB,GAAG,kCAIrB0B,sBAAsBuf,EAAUC,GAC3BD,EAAS7V,OAAS,GACrBjM,OAAOkT,KAAK,uEAAwE,CACnFhT,QAASyC,KAAKzC,QACd4hB,SAAUA,IACRzb,uBAAW0b,MAIhBxf,iBAAiBuf,EAAU1I,EAAiB2I,kBAAV,yBAAe,MAChD3I,EAASA,EAAO5N,cAChBxL,OACEkT,KAAK,CACLC,OAAQ,2EACRzG,KAAM,CACLxM,QAASyC,KAAKzC,QACdkZ,OAAQA,EACR0I,SAAUA,KAGXzb,cAAMiN,GACNhO,IAAI2c,EAAS3O,EAAEQ,QACVmO,IAAQA,EAAS,IAElBA,EAAOhW,SAAWqH,EAAE4O,kBACvBliB,OAAO6M,MAAMhM,GAAG,iBAAkB,CAACuY,EAAQ6I,EAAOte,aAAI6E,UAAKA,EAAEsE,SAAQ/F,KAAK,SAEvEkb,EAAOhW,OAAS6V,EAAS7V,SAC5BjM,OAAOiC,MAAMkgB,WAAW/I,GACpB2I,GAAMA,OAKdxf,KAAKuf,EAAUW,EAAgBV,cAC1BW,EAAgBlL,OAAO0G,KAAKuE,GAAgB7S,OAC1C+S,EAAe,UAEfC,EAAgBF,EAAcpe,cAAKpD,UAASyhB,EAAaE,KAAK3hB,KAE9DggB,EAAS,IAAIlhB,OAAOqC,GAAG8e,OAAO,CACnCC,MAAOvgB,GAAG,QACVkY,OAAQ,CACP,CACCtT,UAAa,SACbmC,QAAW8a,EACXxC,QAAW0C,EACX5Y,MAASnJ,GAAG,SACZ+D,UAAa,QACb0G,KAAQ,EACRmR,oBACCqG,EAAgB5B,KAGlB,CACCzb,UAAa,OACbuE,MAASnJ,GAAG,SACZ+D,UAAa,QACb0G,KAAQ,IAGV4N,wBAAiBjW,mBACV2B,EAAY6d,EAAevB,EAAOhZ,UAAU,UAAUtD,UAC5Dsc,EAAO6B,yBACP/iB,OAAOkT,KAAK,CACXC,OAAQ,2EACRzG,KAAM,CACLxM,QAASyC,EAAKzC,QACdsd,QAAQ,EACRsE,SAAUA,EACV1I,OAAQ,SACR5K,QAAM,KACJ5J,GAAY1D,QAGbmF,cAAKiN,GACPhO,IAAI2c,EAAS3O,EAAEQ,SAAW,GAEtBmO,EAAOhW,SAAWqH,EAAE4O,mBACvBhB,EAAO8B,wBACPhjB,OAAO6M,MAAMhM,GAAG,oBAAqB,CAACohB,EAAOte,aAAI6E,UAAKA,EAAEsE,KAAOtE,EAAEsE,OAAStE,IAAGzB,KAAK,UAEnFgb,IACAb,EAAO3a,OACPvG,OAAOijB,WAAWpiB,GAAG,4BAGvBqiB,qBAAsBriB,GAAG,YAK1B,SAASiiB,EAAgBK,GACxBtd,IAAMud,EAAS5L,OAAOC,OAAO,GAC5BgL,EAAeU,EAAUjb,UAAU,WAIpC,GAAGkb,EAAOpZ,MAAMqZ,MAAMV,IACA,WAArBS,EAAO3d,YAA2B2d,EAAOlD,QAAS,CAClD5a,IAAIsC,EAAU,GACa,iBAAjBwb,EAAOxb,UAChBA,EAAUwb,EAAOxb,QAAQuD,MAAM,OAGhCiY,EAAOlD,QAAUtY,EAAQ,IAAMA,EAAQ,GAExCwb,EAAOpZ,MAAQnJ,GAAG,SAClBuiB,EAAO9X,KAAO,SACP8X,EAAOE,WACdH,EAAUI,cAAc,QAASH,GApB9BR,GAAeE,EAAgB5B,GAuBnCA,EAAOtY,UACPsY,EAAOvX,QC5NT3J,OAAOqX,QAAQ,gBAEfrX,OAAOsX,MAAMkM,SAAW,cAAuBxjB,OAAOsX,MAAMC,SAC3DhV,wBACCsD,IAAM4d,EAAQzjB,OAAO0jB,YACfxjB,EAAUujB,EAAM,GAEtB,GAAqB,IAAjBA,EAAMxX,OAAc,CAEvBpG,IACM8d,EADgB3jB,OAAO0Y,kBAAkBxY,GACfyjB,UAEhC,OADA3jB,OAAOmX,UAAU,OAAQjX,EAASF,OAAOsX,MAAMiJ,SAASoD,GAAaA,EAAY,SAC1E,EAER,OAAO,EAGRphB,YAAYC,GACXohB,MAAMphB,GACNG,KAAKgH,OAGNpH,kBAEC,OADiBvC,OAAO6P,KAAKC,SAASnN,KAAKzC,QAAS,EAAG,QAIxDqC,OAGC,GAFAI,KAAK0B,OAAOwf,uBAAwB,GAE/BlhB,KAAKmhB,kBAGT,OAFA9jB,OAAOmX,UAAU,SACjBnX,OAAOihB,SAASpgB,4BAA4B8B,KAAY,UAIzDihB,MAAMja,OAGPoa,gBACC,MAAO,OAGRC,yBACC,OAAOrhB,KAAK8V,cAAc9V,KAAKohB,YAAc,GAG9CxhB,4BASC,GARAqhB,MAAM/L,iBAENlV,KAAK4a,KAAO,OAEZ5a,KAAKqW,QAAUrW,KAAKqhB,mBAAmBhL,SAAW,WAClDrW,KAAKsW,WAAatW,KAAKqhB,mBAAmB/K,YAAc,OAGpDtW,KAAKqhB,mBAAmBrY,SAAWhJ,KAAKqhB,mBAAmBrY,QAAQM,OAAQ,CAE9EpG,IAAMoe,EAAgBthB,KAAKqhB,mBAAmBrY,QAC9ChJ,KAAKgJ,QAAUhJ,KAAKuhB,iBAAiBD,QAGrCthB,KAAKgJ,SAAWhJ,KAAK3B,SAAS2K,SAAW,IAAIhI,aAAI6E,GAIhD,OAHiB,IAAbA,EAAEyD,SACLzD,EAAI,CAAC7F,EAAKzC,QAASsI,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAE3BA,IAOT,GAFA7F,KAAK0W,WAAa1W,KAAK0W,WAAW7J,OAAO7M,KAAKwhB,kBAE1CxhB,KAAKqhB,mBAAmBrY,SAAWhJ,KAAKqhB,mBAAmBrY,QAAQM,OAAQ,CAE9EpG,IAAMoe,EAAgBthB,KAAKqhB,mBAAmBrY,QAC9ChJ,KAAKgJ,QAAUhJ,KAAKuhB,iBAAiBD,QAGrCthB,KAAKgJ,SAAWhJ,KAAK3B,SAAS2K,SAAW,IAAIhI,aAAI6E,GAIhD,OAHiB,IAAbA,EAAEyD,SACLzD,EAAI,CAAC7F,EAAKzC,QAASsI,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAE3BA,IAKT,OADA7F,KAAKyhB,6BACEzhB,KAAK0hB,yBAGb9hB,oCACC,OAAOvC,OAAOkT,KAAK,yCAA0C,CAAChT,QAASyC,KAAKzC,UAC1EmG,cAAK1F,UAAOgC,EAAK2hB,mBAAqB3jB,EAAImT,SAAW,KAGxDvR,eAAeyW,EAASC,GACvBtW,KAAKqW,QAAUA,EACfrW,KAAKsW,WAAaA,EAClB2K,MAAMlH,iBAGPna,iBAAiBoJ,GAChB9F,IAAM0e,EAAe5hB,KAAKlC,KAAKsY,OAAOpV,aAAIiC,UAAMA,EAAGhB,YACnD,OAAO+G,EACL9H,gBAAO2E,UAAK+b,EAAa7e,SAAS8C,EAAE,MACpCsR,gBAAOtR,UAAKA,EAAE,KAGjBjG,aACCI,KAAK0B,OAAO8W,UAAYxY,KACxBihB,MAAM5L,aAGPzV,kBACCqhB,MAAMxJ,kBACNzX,KAAK2e,qBACL3e,KAAK6hB,yBAGNjiB,oCACCI,KAAK8hB,mBAAqB9hB,KAAK+hB,yBAC/B/hB,KAAKgiB,2BAA6BhiB,KAAKiiB,iCACvCjiB,KAAKkiB,sBAAwB,GAEbliB,KAAK8hB,mBAAmBjV,OAAO7M,KAAKgiB,4BAC5ChhB,aAAI2K,GACXzI,IAAM8U,EAAQhY,EAAKsX,KAAK6K,sBAAsBxW,EAAKtE,MAAOsE,EAAK8K,OAAQ9K,EAAKuM,UACxEvM,EAAKgL,OACRqB,EAAMxU,SAASmI,EAAKgL,OAEjBhL,EAAKyW,oBAAsBpK,IAE9BhY,EAAKkiB,sBAAsBvW,EAAKyG,MAAQ4F,KAK3CpY,0DACOyiB,EAAmBhlB,OAAO6P,KAAKoV,gBAAgBtiB,KAAKzC,SACtD8kB,EAAiB/Y,SACpBtJ,KAAKuiB,gBAAkBziB,gDAAgD5B,GAAG,2BACxEskB,QAAQ,8CACRpO,wBAAYpU,EAAKyiB,kBAAkBJ,KACnC5gB,SAASzB,KAAKsX,KAAKE,YAIvB5X,kBAAkByiB,kBAAiB,IAClChlB,OAAOihB,SAASjhB,OAAOmE,gBAAgB,oCAAqC,CAC3EkhB,eAAgBL,IACbnkB,GAAG,iBAGR0B,wBACc,GAAGiN,OACfxP,OAAOG,MAAMyM,gBACbjK,KAAK2iB,0BACL,CAAC3iB,KAAKlC,KAAKgZ,YAAa9W,KAAKlC,KAAK8kB,aACjC5iB,KAAK3B,SAASwkB,YAAc,GAC7B7iB,KAAKlC,KAAKglB,WAAa,QAAU,KACjC9iB,KAAKqW,QACL,UACA,WACA,SAGMxO,iBAAQhC,UAAK7F,EAAK+W,WAAWlR,KAEpC7F,KAAKoW,OAAOvO,iBAAQhC,GACnB3C,IAAMD,EAAK5F,OAAOS,KAAKilB,aAAald,EAAE,GAAIA,EAAE,IACxC5C,GAAuB,aAAjBA,EAAGH,WAA4BG,EAAGgC,UAAYhC,EAAGgC,QAAQlC,SAAS,MAC3E/C,EAAK+W,WAAW9T,EAAGgC,WAKtBrF,wCAECI,KAAKiG,QAAUjG,KAAKiG,QAAQY,KAAK7G,MACjCA,KAAKiG,QAAU5I,OAAOiC,MAAM0jB,SAAShjB,KAAKiG,QAAS,KACnDjG,KAAKijB,SAAW,IAAI3f,iBAAQC,GACvBvD,EAAKkjB,cACR7lB,OAAO8lB,QAAQnjB,EAAKkjB,cAAe3f,GAEnCA,MAKF6f,uBAEK/lB,OAAOsY,kBAAoB3V,EAAK0V,WACnC1V,EAAKiG,WAJU,KASlBrG,gCACKI,KAAKkW,WACRlW,KAAKsX,KAAKqH,mBAAmBzgB,GAAG,kBAC3B8B,EAAK3B,SAASkY,eACjBvW,EAAK3B,SAASkY,iBAEdvW,EAAKqjB,gBAEJ,wBAEHrjB,KAAKsX,KAAKgM,uBAIZ1jB,eACCsD,IAAM3F,EAAUyC,KAAKzC,QACf0H,EAAU,GAChBjF,KAAKwZ,YAAY5T,MAAMiC,iBAAQhC,GACjB,MAATA,EAAE,IAAcxI,OAAOG,MAAM+lB,iBAAiB1d,EAAE,MACnDZ,EAAQY,EAAE,IAAMA,EAAE,MAGpBxI,OAAOmmB,QAAQjmB,EAAS0H,GAGzBrF,aACCI,KAAKyjB,gBACLzjB,KAAK0jB,gBACL1jB,KAAK2jB,kBACL3jB,KAAK4jB,eACL5jB,KAAK3B,SAASwlB,QAAU7jB,KAAK3B,SAASwlB,OAAO7jB,MAC7CA,KAAK8jB,+CAINlkB,oBACCI,KAAKma,QACJra,qEAAqE5B,GAAG,wBACtE0F,OACH5D,KAAKga,QAAQ7Q,OAAOnJ,KAAKma,SAG1Bva,2BAECI,KAAK+jB,QAAU,GAEf7gB,IAAM8gB,EAAS3mB,OAAOS,KAAKilB,aAAalc,KAAK,KAAM7G,KAAKzC,SAGpDyC,KAAKlC,KAAKgZ,YACb9W,KAAK+jB,QAAQ1jB,KAAK,CACjB4jB,KAAM,UACNhhB,GAAI+gB,EAAOhkB,KAAKlC,KAAKgZ,eAGtB9W,KAAK+jB,QAAQ1jB,KAAK,CACjB4jB,KAAM,UACNhhB,GAAI,CACHoE,MAAOnJ,GAAG,QACV+D,UAAW,UAMV5E,OAAOC,cAAc0C,KAAKzC,UAE7ByC,KAAK+jB,QAAQ1jB,KAAK,CACjB4jB,KAAM,WAIR/gB,IAAMghB,EAAsBlkB,KAAK2iB,0BAEjC3iB,KAAK+jB,QAAU/jB,KAAK+jB,QAAQlX,OAC3BqX,EACEhjB,gBAAO+B,GACP,QAAI5F,OAAOC,cAAc0C,EAAKzC,UAA6B,WAAjB0F,EAAGhB,eAGxCgB,EAAGgU,cAGDhU,EAAGhB,YAAcjC,EAAKlC,KAAKgZ,eAElC9V,aAAIiC,UACJghB,KAAM,WACNhhB,MAQHN,IAAIwhB,EAAe,EAEflb,OAAOmb,YAAc,KACxBD,EAAe,EACLlb,OAAOmb,WAAa,OAC9BD,EAAe,GAGhBnkB,KAAK+jB,QAAU/jB,KAAK+jB,QAAQhZ,MAAM,EAAGoZ,GAGtCvkB,wBACCsD,IAAMmhB,EAAarkB,KAAKkW,8EAEpBhY,GAAG,mBAAoB,CAACA,GAAG8B,KAAKzC,mCAClB,GAElB,mDACMW,GAAG,eAAgB,CAACA,GAAG8B,KAAKzC,0BAC/B8mB,iBAIJzkB,SACKI,KAAK2hB,qBAAuB3hB,KAAK2hB,mBAAmB2C,eACvDtkB,KAAKga,QAAQrY,KAAK,eAAeuF,cAAchJ,GAAG,4BAIpD0B,WACCsD,IAAM6G,EAAOkX,MAAMxQ,WAEnB,OAAOoE,OAAOC,OAAO/K,EAAM,CAC1Bwa,oBAAoB,IAItB3kB,4BACC,OAAIvC,OAAOmnB,gBACVxkB,KAAKgJ,QAAUhJ,KAAKykB,mCACpBpnB,OAAOmnB,cAAgB,KAEnBxkB,KAAKgJ,QAAQM,OAAS,GAClBtJ,KAAKwZ,YAAYpN,OAAM,GAC5B1I,uBAAW1D,EAAKwZ,YAAYE,IAAI1Z,EAAKgJ,WAIlC1F,QAAQC,UAGhB3D,yCACC,OAAQI,KAAK3B,SAAS2K,SAAW,IAAIhI,aAAI6E,GAIxC,OAHiB,IAAbA,EAAEyD,SACLzD,EAAI,CAAC7F,EAAKzC,QAASsI,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAE3BA,IAITjG,qBACCqhB,MAAM/F,qBACNlb,KAAK0kB,2BACJ1kB,KAAKga,QAAQrY,KAAK,2BAA2B2H,OAAS,GAIxD1J,2BAA2BqH,GACtBA,GACHjH,KAAKsX,KAAKqN,oBACV3kB,KAAKsX,KAAKgM,uBACVtjB,KAAK4kB,4BAEL5kB,KAAKsX,KAAKuN,oBACV7kB,KAAK2e,sBAIP/e,gBACoD,IAA/CI,KAAKga,QAAQrY,KAAK,kBAAkB2H,QAEvCtJ,KAAKga,QAAQwI,QAAQxiB,KAAK8kB,mBAI5BllB,kBACCsD,IAAM6hB,EAAO/kB,KAAKglB,2BAA2B,wCAC7ChlB,KAAKga,QAAQ7Q,OAAO4b,GAGrBnlB,gBACCI,KAAK3B,SAAS8c,eAAiBnb,KAAK3B,SAAS8c,gBAC7C9d,OAAOG,MAAMsY,cAAcmP,KAAKjlB,KAAKzC,QAAS,YAAayC,KAAKohB,WAChEphB,KAAKklB,wBAAwB,CAC5Blc,QAAShJ,KAAKwZ,YAAY5T,MAC1ByQ,QAASrW,KAAK2Z,cAActD,QAC5BC,WAAYtW,KAAK2Z,cAAcrD,aAIjC1W,eACCI,KAAKsY,aAAa6M,eAGnBvlB,SACCI,KAAKolB,cACLplB,KAAKqlB,iBACLrlB,KAAKslB,eACLtlB,KAAKulB,cAGN3lB,yBAECI,KAAKga,QAAQrY,KAAK,uBAAuBU,SACrCrC,KAAK6L,KAAKvC,OAAS,GAEtBtJ,KAAKga,QAAQ7Q,OACZnJ,KAAK6L,KAAK7K,aAAKhD,EAAKiO,GAEnB,OADAjO,EAAIwnB,KAAOvZ,EACJjM,EAAKylB,kBAAkBznB,KAC5BoG,KAAK,KAKXxE,0BACMI,KAAK2hB,mBAAmB2C,eAC5BtkB,KAAK0lB,gBAAgBhiB,cAAKiiB,GACzB3lB,EAAKga,QAAQrY,KAAK,eAAeuF,cAAcye,eAKlD/lB,yBACOgmB,EAAa5lB,KAAKga,QAAQrY,KAAK,uBAErC3B,KAAK6L,KAAKhE,iBAAS6E,EAAGT,GACrBtJ,IAAIkjB,EAAW/lB,EAAE,uFAER2B,SAASmkB,EAAWhgB,IAAIqG,IAGhB,IAAI5O,OAAOqC,GAAGsQ,UAAU,CACxCtO,OAAQmkB,EAASlkB,KAAK,aACtBsP,IAAK,CACJ1T,QAASyC,EAAKzC,QACdgU,QAAS7E,EAAE0F,MAEZkG,aAActY,EAAKsY,aACnBpI,UAAWxD,EAAEoZ,WACbvjB,mBAAY2N,GACXxD,EAAEoZ,WAAa5V,KAINhK,QAAQ9D,GAAG,QAAS,wBAAiBgE,GAC/ClD,IAAMmX,EAAQva,EAAEsG,EAAEkO,eAClBtU,EAAKwZ,YAAYnH,IAAIrS,EAAKzC,QAAS,aAAc,IAAK8c,EAAMtO,YAK/DnM,kBACCsD,IAAM6iB,EAAgB/lB,KAAK+jB,QAAQ,GAAG9gB,GAClC+iB,EAAe,qFAC0D9nB,GAAG,wIAEnBA,GAAG,kEAEpCA,GAAG6nB,EAAc1e,uBAEvC4e,EAAWjmB,KAAK+jB,QAAQ/iB,aAAIklB,GAOjC,+BANc,CACb,wBACY,WAAZA,EAAIjC,KAAoB,qBAAuB,YAC/C5mB,OAAOG,MAAM2oB,iBAAiBD,EAAIjjB,IAAM,aAAe,IACtDmB,KAAK,uBAIU,YAAb8hB,EAAIjC,KAAqB+B,uBACnB9nB,GAAGgoB,EAAIjjB,IAAMijB,EAAIjjB,GAAGoE,OAAS6e,EAAIjC,8CAGzC7f,KAAK,IAER,OAAOpE,KAAKomB,yBAAyBH,EAAU,oCAGhDrmB,yBAAyBymB,EAAWC,GACnC,sBAD+B,mBAAY,+IAItCD,4MAI2EnoB,GAAG,mKAK9EooB,4CAMN1mB,cAAc5B,cACb,OAAOgC,KAAK+jB,QAAQ/iB,aAAIklB,UAAOlmB,EAAKumB,gBAAgBL,EAAKloB,KAAMoG,KAAK,IAGrExE,eAAe5B,GACd,OAAOgC,KAAKwmB,cAAcxoB,GAG3B4B,kBAAkB5B,GACjB,OAAOgC,KAAKglB,2BAA2BhlB,KAAKymB,cAAczoB,GACzDgC,KAAK0mB,eAAe1oB,IAGtB4B,2BAA2BymB,EAAWC,GACrC,sBADiC,mBAAY,mKAKvCD,8FAGAC,2DAOP1mB,gBAAgBsmB,EAAKloB,cACpB,GAAiB,WAAbkoB,EAAIjC,KACP,4EAEIjkB,KAAK2mB,mBAAmB3oB,8BAK7BkF,IAAMD,EAAKijB,EAAIjjB,IAAM,GACfoE,EAAQpE,EAAGoE,MACXpF,EAAYgB,EAAGhB,UACf1D,EAAQP,EAAIiE,IAAc,GAkFhC,6BAZkB,CACjB,wBALiB,CACjB2kB,QAAS,qBACTC,MAAO,aAIGX,EAAIjC,MACd5mB,OAAOG,MAAM2oB,iBAAiBljB,GAAM,aAAe,IAClDmB,KAAK,oBAEU,CAChBwiB,QAAS5mB,KAAK8mB,iBAAiB9oB,GAC/B6oB,iBA5DAlkB,IAAIuE,EACA6f,EAGHA,EADG/mB,EAAK3B,SAAS2oB,YAAchnB,EAAK3B,SAAS2oB,WAAW/kB,GAC/CjC,EAAK3B,SAAS2oB,WAAW/kB,GAAW1D,EAAO0E,EAAIjF,GAEd,eAAhBiF,EAAGH,WACxBG,EAAGgkB,YAAc,CAAC,OAAQ,cAAclkB,SAASE,EAAGH,WAE/CokB,WAAW3oB,GAEM,iBAAVA,EAAqBlB,OAAOiC,MAAM6nB,YAAY5oB,GAASA,EA+BzE,OA1BC2I,EADoB,UAAjBjE,EAAGH,UACCG,EAAGgC,qBACIjH,EAAIiF,EAAGgC,yDACpB,sHAG0B,WAAjBhC,EAAGH,UACN,qCAAqCzF,OAAOiC,MAAMC,aAAawnB,yCACtD9kB,QAAe1D,mBAC5BL,GAAG6oB,uBAEqB,SAAjB9jB,EAAGH,UACN,qEACSb,QAAe1D,mBAC5BwoB,mBAEO,CAAC,cAAe,OAAQ,aAAc,eAAehkB,SAASE,EAAGH,WACpE,iDACJikB,sBAGI,qEACS9kB,QAAe1D,oBApDX,SAAjB0E,EAAGH,UACCvE,EACoB,YAAjB0E,EAAGH,4KAGOvE,0EACqC6oB,KAAKC,MAAM9oB,gDAI7DlB,OAAO6K,OAAO3J,EAAO0E,EAAI,KAAMjF,+DAgD7BE,GAAGmJ,QAAWigB,OAAOP,kBAC5B7f,oBAgBIqgB,IAEqBrB,EAAIjC,6BASlCrkB,cAAc5B,GACb2E,IAAIuE,EAAO,GACNlH,KAAK3B,SAASmpB,kBAAoBxpB,EAAIgC,KAAKlC,KAAKgZ,aAAe,MAAQ9Y,EAAIoU,OAC/ElL,GAAQ,mHAEiClH,KAAKynB,cAAczpB,sBACvDA,mDAMFgC,KAAK3B,SAASqpB,QAAU1nB,KAAK3B,SAASqpB,OAAO1gB,KAAKhJ,KACrDkJ,GAAQ,qIAGQlJ,sBAAuBA,gCAC3BgC,KAAK3B,SAASqpB,OAAOC,gBAAgB3pB,sBAC5CgC,KAAK3B,SAASqpB,OAAOE,UAAU5pB,+CAMrCkF,IAAM2kB,EAAWC,aAAa9pB,EAAI6pB,UAAU,GAEtCE,EAAgB/V,KAAKC,MAAMjU,EAAIgqB,SAAW,MAAMjd,OAAO,GAAG,GAyBhE,OAXA7D,GAAQ,yEAEJ2gB,gBAfgBE,kEAEWA,kBAC3B1qB,OAAO4W,OAAO8T,qBAEjB,wEAGA,iBAAiB/pB,EAAIiqB,eAAsC,GAArB,8GAEnCjqB,EAAIiqB,eAAiB,GAAK,MAAQjqB,EAAIiqB,oHAUtCjoB,KAAKkoB,kBAAkBlqB,0BAO5B4B,2BACKuoB,EAAgBnoB,KAAK6L,KAAKvC,OAC1B8e,EAAyBpoB,KAAK6L,KAAKsL,gBAAOzK,UAAKA,EAAE0F,OAAM9I,OAE3D,OAAOjM,OAAOgrB,GAAGC,MAAMtoB,KAAKzC,QAAS,CACpCyL,QAAShJ,KAAKya,yBACZ/W,cAAK6kB,GACPvoB,EAAKuoB,YAAcA,GAAeJ,EAClCxlB,IAAIgjB,EAAMznB,GAAG,aAAc,CAACiqB,EAAenoB,EAAKuoB,cAIhD,OAHIH,IAA2BD,IAC9BxC,EAAMznB,GAAG,sCAAuC,CAACkqB,EAAwBpoB,EAAKuoB,YAAaJ,KAErFxC,IAIT/lB,cAAc5B,GACb,GAAIgC,KAAK3B,SAASopB,cACjB,OAAOznB,KAAK3B,SAASopB,cAAczpB,GAEpCkF,IAAMqO,EAAUvT,EAAIoU,KAAKsO,MAAM,WAC5BxB,mBAAmBlhB,EAAIoU,MACvBpU,EAAIoU,KAEP,MAAO,SAAWpS,KAAKzC,QAAU,IAAMgU,EAGxC3R,eAAe5B,GACd,OAAOgU,KAAKC,MAAMjU,EAAIwqB,OAAS,MAAMzlB,SAAS1F,OAAOuU,QAAQC,MAC1D,GACA,OAGJjS,iBAAiB5B,GAChB2E,IAAIkP,EAAOxU,OAAOuU,QAAQC,KAEtBtT,EAAQP,EADQgC,KAAK+jB,QAAQ,GAAG9gB,GACNhB,YAAcjE,EAAIoU,KAC5CqW,EAAUvB,WAAW3oB,EAAMmqB,YAC3BC,EAAkBtrB,OAAOiC,MAAM6nB,YAAYsB,GAEzC7V,EAAWZ,KAAKC,MAAMjU,EAAI+T,WAAa,MACzC6W,EAAchW,EAAS7P,SAAS8O,GACnC,WAAa,6BAERgX,EAAO7oB,KAAK8oB,eAAe9qB,GAqBjC,MAnBmB,4FACiEspB,OAAOtpB,EAAIoU,8HAE/CwW,6BAChC5qB,0BAA2BgC,6CACvB+oB,UAAU/qB,EAAI+T,YAAc,oFAI1Ca,EAAStJ,OAAS,GAAKpL,GAAG,MAAQ,IAAMA,GAAG0U,EAAStJ,QAAU,wEAGzCuf,uBAAyBF,2CACtB3oB,KAAKynB,cAAczpB,eAAgB2qB,qBAAkC3oB,6BAA4BhC,sBAC3HyqB,wCAQL7oB,mBAAmB5B,GAClBkF,IAAM9D,EAAY/B,OAAOM,cAAcK,EAAKgC,KAAKzC,SACjD,OAAI6B,4BAC8BA,EAAU,0CAC3BA,EAAU,kBACvBlB,GAAGkB,EAAU,qBAGV,GAGRQ,kBAAkB5B,GACjBkF,IAAM9D,EAAY/B,OAAOM,cAAcK,EAAKgC,KAAKzC,SACjD,OAAK6B,4BAC4BA,EAAU,eAAclB,GAAGkB,EAAU,gBAD/C,GAIxBQ,eACCI,KAAKgpB,mBACLhpB,KAAKipB,mBACLjpB,KAAKkpB,kBACLlpB,KAAKmpB,sBACLnpB,KAAKopB,qBACLppB,KAAKqpB,aACLrpB,KAAKspB,yBACLtpB,KAAKupB,uBACLvpB,KAAKwpB,4BAGN5pB,uCAIK6pB,aACH3pB,EAAE8Y,SAAS8Q,eAAeC,OAAO7a,SAE9B8a,aACH9pB,EAAE8Y,SAAS8Q,eAAeG,OAAO/a,SAK9Bgb,WAAa/E,GACHA,EAAKpjB,KAAK,wBAChByS,SAEJ2V,oBANIjqB,EAAE8Y,SAAS8Q,eAAepP,GAAG,uBAOfxa,EAAE8Y,SAAS8Q,eAAiB,MAE9CM,oBAAwBhqB,EAAKsX,KAAKpR,QAAQoU,GAAG,aAC7C2P,oBAAyBnqB,EAAE8Y,SAAS8Q,eAAepP,GAAG,UAEtD4P,WAAqBC,GACxB,IAAKH,KAAqBC,IAAoB,OAAO,EAErCF,IAED,SAAdI,EAAuBV,IAAeG,IA1BvC5pB,EAAKga,QAAQrY,KAAK,6BAA6BmN,SAgChDzR,OAAOqC,GAAG6b,KAAK6O,aAAa,CAC3BjS,SAAU,OACV1B,yBAAcyT,EAAkB,SAChCxhB,YAAaxK,GAAG,sBAChBoZ,KAAMtX,KAAKsX,OAGZja,OAAOqC,GAAG6b,KAAK6O,aAAa,CAC3BjS,SAAU,KACV1B,yBAAcyT,EAAkB,OAChCxhB,YAAaxK,GAAG,oBAChBoZ,KAAMtX,KAAKsX,OAGZja,OAAOqC,GAAG6b,KAAK6O,aAAa,CAC3BjS,SAAU,aACV1B,kBACC,IAAKuT,KAAqBC,IAAoB,OAAO,EACrDtnB,IAAI0nB,EAAYN,IAChBD,EAAUO,GACVZ,KAED/gB,YAAaxK,GAAG,8BAChBoZ,KAAMtX,KAAKsX,OAGZja,OAAOqC,GAAG6b,KAAK6O,aAAa,CAC3BjS,SAAU,WACV1B,kBACC,IAAKuT,KAAqBC,IAAoB,OAAO,EACrDtnB,IAAI0nB,EAAYN,IAChBD,EAAUO,GACVT,KAEDlhB,YAAaxK,GAAG,8BAChBoZ,KAAMtX,KAAKsX,OAGZja,OAAOqC,GAAG6b,KAAK6O,aAAa,CAC3BjS,SAAU,QACV1B,kBACC9T,IAAI0nB,EAAYN,IAChB,QAAIM,IACHA,EAAU1oB,KAAK,gBAAgB,GAAGyS,SAC3B,IAIT1L,YAAaxK,GAAG,kBAChBoZ,KAAMtX,KAAKsX,OAGZja,OAAOqC,GAAG6b,KAAK6O,aAAa,CAC3BjS,SAAU,QACV1B,kBACC9T,IAAI0nB,EAAYN,IAChB,QAAIM,IACHP,EAAUO,IACH,IAIT3hB,YAAaxK,GAAG,oBAChBoZ,KAAMtX,KAAKsX,OAIb1X,8BAECI,KAAKga,QAAQ5X,GAAG,QAAS,uBAAegE,GACvC,IAAIA,EAAEkkB,UAAWlkB,EAAEmkB,QAAnB,CACAnkB,EAAEokB,kBACFtnB,IAGMunB,EAHQ3qB,EAAEsG,EAAEkO,eACIzE,KAAK,eAAerH,MAAM,KAEfxH,aAAI6E,GAOpC,MALa,WADbA,EAAIA,EAAE2C,MAAM,MACN,GACL3C,EAAE,GAAKxI,OAAOqtB,SAASC,YACL,QAAR9kB,EAAE,KACZA,EAAE,GAAKxI,OAAOuU,QAAQC,MAEhB,CAAC7R,EAAKzC,QAASsI,EAAE,GAAIA,EAAE,GAAIA,EAAEkF,MAAM,GAAG3G,KAAK,QAEnDpE,EAAKwZ,YAAYnH,IAAIoY,MAIvB7qB,8BACCI,KAAKga,QAAQ5X,GAAG,QAAS,yCAAkCgE,GAC1DlD,IAAM0nB,EAAU9qB,EAAEsG,EAAE4K,QAEpB,GAAI5K,EAAEmkB,SAAWnkB,EAAEkkB,UAAYM,EAAQtQ,GAAG,KAAM,CAC/CpX,IACM2nB,EADY/qB,EAAEsG,EAAEkO,eACG3S,KAAK,sBAI9B,OAHAkpB,EAAOC,KAAK,WAAYD,EAAOC,KAAK,YACpC1kB,EAAE2kB,sBACF/qB,EAAKqlB,iBAIN,KAAIuF,EAAQtY,SAAS,eACpBsY,EAAQtY,SAAS,kBACjBsY,EAAQtQ,GAAG,cACXsQ,EAAQtQ,GAAG,MAHZ,CAOApX,IACM8nB,EADOlrB,EAAEsG,EAAEkO,eACC3S,KAAK,mBAAmBiE,IAAI,GAC9C,OAAIolB,GACH/hB,OAAOgiB,SAASC,KAAOF,EAAKE,MACrB,QAFR,KAOFtrB,kCACCI,KAAKga,QAAQ5X,GAAG,QAAS,uBAAgBgE,GACxClD,IAAMioB,EAAUrrB,EAAEsG,EAAEkO,eACdtW,EAAMgC,EAAK6L,KAAKsf,EAAQtb,KAAK,aAGnC,OAFA7P,EAAK3B,SAASqpB,OAAOjR,OAAOzY,GAC5BoI,EAAEokB,mBACK,IAIT5qB,gCACCI,KAAKga,QAAQ5X,GAAG,SAAU,gCAAwBgE,GACjDlD,IAAM0nB,EAAU9qB,EAAEsG,EAAEkO,eAEpB,GAAIsW,EAAQtQ,GAAG,wCAAyC,CACvDpX,IAAM2nB,EAAS7qB,EAAKga,QAAQrY,KAAK,qCACjCkpB,EAAOC,KAAK,UAAWF,EAAQE,KAAK,YACpCD,EAAOzZ,QAAQ,eACT,GAAIwZ,EAAQtQ,GAAG,qCAAsC,CAC5Cta,EAAKga,QAAQrY,KAAK,wCAC1BmpB,KAAK,UAAWF,EAAQE,KAAK,YAEpC9qB,EAAKga,QAAQrY,KAAK,sBAChBmpB,KAAK,UAAWF,EAAQE,KAAK,YAGhC9qB,EAAKqlB,mBAGNrlB,KAAKga,QAAQ5X,GAAG,QAAS,8BAAsBgE,SACxCwkB,EAAU9qB,EAAEsG,EAAEkO,eAGpB,GAAIlO,EAAEglB,UAAYprB,EAAKqrB,mBAAqBT,EAAQtQ,GAAGta,EAAKqrB,kBAAmB,CAC9EnoB,IAAMooB,EAAStrB,EAAKqrB,iBAAiBxf,OAAOuG,KACtCmZ,EAASX,EAAQ/e,OAAOuG,OAGD,CAFbpS,EAAK6L,KAAK2f,mBAAU9e,UAAKA,EAAE0F,OAASkZ,IACpCtrB,EAAK6L,KAAK2f,mBAAU9e,UAAKA,EAAE0F,OAASmZ,mBAGhDE,EAAYC,IACdD,KAAwB,CAACC,EAAWD,OAAzBC,QAGb/oB,IACM0Q,EADSrT,EAAK6L,KAAKd,MAAM0gB,EAAY,EAAGC,GAAW1qB,aAAI0L,UAAKA,EAAE0F,OAC1CpR,aAAIoR,0CAAyCA,SAAUhO,KAAK,KACtFpE,EAAKga,QAAQrY,KAAK0R,GAAUyX,KAAK,WAAW,GAG7C9qB,EAAKqrB,iBAAmBT,IAI1BhrB,wBACCI,KAAKga,QAAQ5X,GAAG,QAAS,eAAgB/E,OAAOqC,GAAGqT,mBACnD/S,KAAKga,QAAQ5X,GAAG,QAAS,6BAAqBgE,GAC7ClD,IAAMmX,EAAQva,EAAEsG,EAAEkO,eAClB+F,EAAMvB,YAAY,UAEduB,EAAM/H,SAAS,UAClBtS,EAAKwZ,YAAYnH,IAAIrS,EAAKzC,QAAS,YAAa,OAAQ,IAAMF,OAAOuU,QAAQC,KAAO,KAEpF7R,EAAKwZ,YAAYnX,OAAO,eAI1BhF,OAAOqC,GAAGyT,mBAAmBnT,KAAKga,QAAS,aAG5Cpa,iCACCI,KAAKia,WAAWtY,KAAK,gBAAgByS,iBAChCpU,EAAK3B,SAASkY,eACjBvW,EAAK3B,SAASkY,iBAEdvW,EAAKqjB,iBAKRzjB,6BACCI,KAAKsY,aAAa5W,OAAOU,GAAG,QAAS,+BACpCpC,EAAK2rB,gBAIP/rB,oCACKI,KAAK2hB,oBAAsB3hB,KAAK2hB,mBAAmBiK,sBAGvDvuB,OAAOwuB,SAASzpB,GAAG,uBAAeyJ,GACjC,IAAI7L,EAAKwZ,YAAYsS,kBAArB,CAIA,yBACA,GAAIvuB,IAAYyC,EAAKzC,QAArB,CAGA2F,IAAM6oB,EAAY/rB,EAAKgb,gBACvB+Q,EAAUhiB,KAAKf,QAAQ3I,KAAK,CAACL,EAAKzC,QAAS,OAAQ,IAAK6U,IACxD2Z,EAAUhiB,KAAKiM,MAAQ,EAEvB3Y,OAAOkT,KAAKwb,GACVroB,cAAMpD,mBACN,GAAK6Q,EAAL,CACAjO,IAAM2I,EAAOxO,OAAOiC,MAAMgc,KAAKnK,EAAQoK,KAAMpK,EAAQqK,QACrD,IAAM3P,IAAQA,EAAKvC,OAMlB,OAFAtJ,EAAK6L,KAAO7L,EAAK6L,KAAK3K,gBAAOwL,UAAKA,EAAE0F,OAASA,SAC7CpS,EAAKolB,cAINliB,IAAM8oB,EAAQngB,EAAK,GACbogB,EAAQjsB,EAAK6L,KAAK2f,mBAAU9e,UAAKA,EAAE0F,OAAS4Z,EAAM5Z,QAEzC,IAAX6Z,EAEHjsB,EAAK6L,KAAKxL,KAAK2rB,GAGfhsB,EAAK6L,KAAKogB,GAASD,EAGpBhsB,EAAK6L,KAAKoB,cAAMif,EAAGC,GAClBjpB,IAAMkpB,EAAUF,EAAElsB,EAAKqW,UAAY,GAC7BgW,EAAUF,EAAEnsB,EAAKqW,UAAY,GAE/BiW,EAAe,EAYnB,OAXIF,EAAUC,IACbC,EAAe,GAGZD,EAAUD,IACbE,GAAgB,GAGO,SAApBtsB,EAAKsW,aACRgW,GAAgBA,GAEVA,IAERtsB,EAAKkb,qBACLlb,EAAKolB,cACDplB,EAAKusB,SAAWvsB,EAAKusB,QAAQjjB,QAChCtJ,EAAKwsB,6BAMV5sB,iCACCE,EAAEwM,KAAKtM,KAAKusB,iBAAUtgB,EAAGwgB,GACxB9pB,IAAI4O,EAAUzR,EAAE2sB,GAAI5c,KAAK,aACzB7P,EAAKga,QAAQrY,sCAAsC4P,QAAauZ,KAAK,WAAW,KAEjF9qB,KAAKqlB,iBAGNzlB,iBACCI,KAAK0sB,mBAAqB1sB,KAAK0sB,oBAAsB1sB,KAAKga,QAAQrY,KAAK,+BACvE3B,KAAK2sB,kBAAoB3sB,KAAK2sB,mBAAqB3sB,KAAKga,QAAQrY,KAAK,4BAErE3B,KAAKusB,QAAUvsB,KAAKga,QAAQrY,KAAK,8BAEjC3B,KAAK0sB,mBAAmBzlB,OAA+B,IAAxBjH,KAAKusB,QAAQjjB,QAC5CtJ,KAAK2sB,kBAAkB1lB,OAAOjH,KAAKusB,QAAQjjB,OAAS,GAExB,IAAxBtJ,KAAKusB,QAAQjjB,OAChBtJ,KAAK0sB,mBAAmB/qB,KAAK,mBAAmBmpB,KAAK,WAAW,IAEhE9qB,KAAK2sB,kBAAkBhrB,KAAK,qBAAqBuF,KAChDhJ,GAAG,qBAAsB,CAAC8B,KAAKusB,QAAQjjB,UAExCtJ,KAAK2sB,kBAAkB3lB,OACvBhH,KAAK0sB,mBAAmB9oB,QAEzB5D,KAAK0kB,2BAA2B1kB,KAAKusB,QAAQjjB,OAAS,GAGvD1J,cACCI,KAAKga,QAAQlB,YAAY,cAG1BlZ,kBAAkBgtB,GACjB1pB,IAAMic,EAAWjb,MAAMkY,KAAKpc,KAAKusB,SAAW,IAC1CvrB,aAAI6rB,UAASC,KAAKC,SAASjtB,EAAE+sB,GAAOhhB,OAAOuG,SAE7C,OAAIwa,EAAsBzN,EAEnBnf,KAAK6L,KAAK3K,gBAAOwL,UAAKyS,EAASpc,SAAS2J,EAAE0F,QAGlDxS,wBAAwB+f,GACvB,OAAOtiB,OAAOG,MAAMsY,cAAcmP,KAAKjlB,KAAKzC,QAASyC,KAAKohB,UAAWzB,GAGtE/f,aAIAA,gBACCsD,IAAM8pB,EAAehtB,KAAKya,uBAAuBzZ,aAAIE,GAEpD,OADAA,EAAO,GAAKge,mBAAmBhe,EAAO,IACpB,MAAdA,EAAO,GACAA,EAAO,OAAMA,EAAO,GAExB,CAACA,EAAO,GAAI,IAAK8Q,KAAKc,UAAU,CAAC5R,EAAO,GAAIA,EAAO,MAAMkD,KAAK,MACnEA,KAAK,KAEJ6oB,EAAWhkB,OAAOgiB,SAASC,KAI/B,OAHI8B,IACHC,GAAY,IAAMD,GAEZC,EAGRrtB,YACW,IAAIvC,OAAOqC,GAAG8e,OAAO,CAC9BC,MAAOvgB,GAAG,aACVkY,OAAQ,CACP,CACCtT,UAAW,OACXb,UAAW,MACXoF,MAAO,MACPkW,QAASvd,KAAKktB,gBACdroB,UAAW,MAIZmC,OAGHpH,4BACOrC,EAAUyC,KAAKzC,QACf8hB,EAAQ,GA8Ed,OA5EIhiB,OAAOG,MAAM2vB,WAAW5vB,IAC3B8hB,EAAMhf,KAAK,CACVgH,MAAOnJ,GAAG,UACVuY,yBAAcpZ,OAAOmX,UAAU,OAAQ,cAAe,CACrD4Y,kBAAmB7vB,KAEpB2a,UAAU,IAIR7a,OAAOG,MAAM6vB,yBAAyB9vB,IACzC8hB,EAAMhf,KAAK,CACVgH,MAAOnJ,GAAG,oBACVuY,yBAAcpZ,OAAOmX,UAAU,OAAQ,kBAAmB,CACzD8Y,MAAO/vB,KAER2a,UAAU,IAIR7a,OAAOkwB,WAAWxqB,SAAS,oBAC9Bsc,EAAMhf,KAAK,CACVgH,MAAOnJ,GAAG,4BACVuY,yBAAcpZ,OAAOmX,UAAU,qBAAsB,SACpDjX,KAED2a,UAAU,IAGXmH,EAAMhf,KAAK,CACVgH,MAAOnJ,GAAG,aACVuY,kBACMzW,EAAKlC,OACNkC,EAAKlC,KAAK0vB,OACbnwB,OAAOmX,UAAU,OAAQ,UAAWjX,GACzByC,EAAKlC,KAAK0vB,QACrBnwB,OAAOmX,UAAU,OAAQ,iBAAkB,CAC1CiZ,SAAUlwB,MAIb2a,UAAU,EACVC,SAAU,YAIZkH,EAAMhf,KAAK,CACVgH,MAAOnJ,GAAG,kBACVuY,yBAAczW,EAAK0tB,mBACnBxV,UAAU,EACVC,SAAU,WAGXkH,EAAMhf,KAAK,CACVgH,MAAOnJ,GAAG,aACVuY,yBAAczW,EAAK2tB,aACnBzV,UAAU,EACVC,SAAU,WAGP9a,OAAOwU,KAAKwM,SAAS,mBAAoD,IAA/BhhB,OAAOsK,KAAKimB,gBAEzDvO,EAAMhf,KAAK,CACVgH,MAAOnJ,GAAG,gBACVuY,yBAAcpZ,OAAOmX,UAAU,OAAQ,UAAWjX,IAClD2a,UAAU,IAIR7a,OAAOwU,KAAKwM,SAAS,mBACxBgB,EAAMhf,KAAK,CACVgH,MAAOnJ,GAAG,YACVuY,yBAAczW,EAAK6tB,sBACnB3V,UAAU,IAGLmH,EAGRzf,gCACCvC,OAAOG,MAAMswB,aAAa,+BACzBnrB,IAAI+J,EAAI,IAAIrP,OAAOqC,GAAG8e,OAAO,CAC5BC,MAAOvgB,GAAG,YACVkY,OAAQ/Y,OAAOwY,SAAS,qBAAqBO,SAE9C1J,EAAEvJ,WAAWnD,EAAK2hB,oBAClBjV,EAAE1F,OACF0F,EAAEiS,mBAAmBzgB,GAAG,mBACvByE,IAAI6Y,EAAS9O,EAAEqhB,aACf1wB,OAAOkT,KAAK,yCAA0C,CAAChT,QAASyC,EAAKzC,QAASie,OAAQA,IACtF3G,OAAOC,OAAO9U,EAAK2hB,mBAAoBnG,GACvC9O,EAAE9I,WAKLhE,4CACOouB,EAAmB,GACrB3wB,OAAOG,MAAMywB,aAAajuB,KAAKzC,UAClBF,OAAOO,SAASswB,2BAA2BluB,KAAKzC,SACxDsK,iBAAQ4O,GACfuX,EAAiB3tB,KAAK,CACrBgH,MAAOnJ,GAAGuY,GACVrE,KAAMqE,EACNA,kBACCpZ,OAAO8wB,MAAM,+CAAgD,CAC5DhP,SAAUnf,EAAK2b,mBAAkB,GACjCpe,QAASyC,EAAKzC,QACdkZ,OAAQA,KAGV2L,oBAAoB,MAIvB,OAAO4L,EAGRpuB,qCACC,GAAKvC,OAAOG,MAAMywB,aAAajuB,KAAKzC,SAApC,CACA2F,IAAMkrB,EAAgBpuB,KAAK2b,oBAC3Bte,OAAO8wB,MAAM,sDAAuD,CACnEpQ,KAAMqQ,EACN7wB,QAASyC,KAAKzC,UACZmG,cAAK2qB,GACPxZ,OAAO0G,KAAKvb,EAAKkiB,uBAAuBra,iBAASgV,GAChD7c,EAAKkiB,sBAAsBrF,GAAK5V,OAAOonB,EAAQtrB,SAAS8Z,SAK3Djd,oCACOrC,EAAUyC,KAAKzC,QACfukB,EAAqB,GACrBwM,EAAkB,IAAIxQ,eAAe,CAAEvgB,QAASyC,KAAKzC,UAErDgxB,WAAqBC,GAC1B,OAAOA,EAAUvsB,WAAa5E,OAAOG,MAAMwZ,cAAcwX,IAC7B,cAAxBA,EAAU1rB,YAA8B0rB,EAAU/qB,SAAW+qB,EAAU3pB,WA8H5E,gBA3H6BtH,GAC5B,OAAOF,OAAOS,KAAK0P,cAAcjQ,GAASkxB,cAAKD,UAAaD,EAAkBC,KA6F3EE,CAAoBnxB,IACvBukB,EAAmBzhB,KArBZ,CACNgH,MAAOnJ,GAAG,QACVuY,kBACC9T,IAAImd,EAAiB,GAErBziB,OAAOS,KAAK0P,cAAcjQ,GAASsK,iBAAQ2mB,GACtCD,EAAkBC,KACrB1O,EAAe0O,EAAUnnB,OAASwN,OAAOC,OAAO,GAAI0Z,MAItDtrB,IAAMic,EAAWnf,EAAK2b,mBAAkB,GAExC2S,EAAgBK,KAAKxP,EAAUW,EAAgB9f,EAAKiG,UAErDiS,UAAU,IAUZ4J,EAAmBzhB,KAzFX,CACNgH,MAAOnJ,GAAG,aACVuY,yBAAc6X,EAAgBxZ,OAAO9U,EAAK2b,mBAAkB,GAAO3b,EAAKiG,UACxEiS,UAAU,IAwFZ4J,EAAmBzhB,KAnFX,CACNgH,MAAOnJ,GAAG,yBACVuY,yBAAc6X,EAAgBM,sBAAsB5uB,EAAK2b,mBAAkB,GAAO3b,EAAKiG,UACvFiS,UAAU,IAmFR7a,OAAOG,MAAMqxB,UAAUtxB,IAC1BukB,EAAmBzhB,KA/EZ,CACNgH,MAAOnJ,GAAG,SACVuY,yBAAc6X,EAAgBQ,MAAM9uB,EAAK2b,sBACzCzD,UAAU,IAgFR7a,OAAOG,MAAMC,eAAeF,aAzGDA,GAC9B,OAAOF,OAAO6P,KAAKC,SAAS5P,EAAS,EAAG,UAwGGwxB,CAAsBxxB,KAAcF,OAAOG,MAAMywB,aAAa1wB,IACzGukB,EAAmBzhB,KAlDZ,CACNgH,MAAOnJ,GAAG,UACVuY,kBACCvT,IAAMic,EAAWnf,EAAK2b,mBAAkB,GACpCwD,EAAS7V,OAAS,GACrBjM,OAAO2xB,QAAQ9wB,GAAG,wBAAyB,CAACihB,EAAS7V,2BAC9CglB,EAAgBW,iBAAiB9P,EAAU,SAAUnf,EAAKiG,YAGnEiS,UAAU,IA6CR7a,OAAOG,MAAM0xB,WAAW3xB,KAAcF,OAAOG,MAAMywB,aAAa1wB,IACnEukB,EAAmBzhB,KArEZ,CACNgH,MAAOnJ,GAAG,UACVuY,kBACCvT,IAAMic,EAAWnf,EAAK2b,mBAAkB,GACpCwD,EAAS7V,OAAS,GACrBjM,OAAO2xB,QAAQ9wB,GAAG,wBAAyB,CAACihB,EAAS7V,2BAC9CglB,EAAgBW,iBAAiB9P,EAAU,SAAUnf,EAAKiG,YAGnEiS,UAAU,IAgER7a,OAAOG,MAAM2xB,WAAW5xB,IAC3BukB,EAAmBzhB,KAtFZ,CACNgH,MAAOnJ,GAAG,UACVuY,kBACCvT,IAAMic,EAAWnf,EAAK2b,mBAAkB,GAAM3a,aAAIuQ,UAAWA,EAAQmX,aACrErrB,OAAO2xB,QAAQ9wB,GAAG,gCAAiC,CAACihB,EAAS7V,2BACtDglB,EAAgBc,OAAOjQ,EAAUnf,EAAKiG,YAE9CiS,UAAU,IAkFL4J,EAGRliB,mCACCsD,IAAM8F,EAAU,GAEhB,IAAKrG,IAAID,KAASrF,OAAOmnB,cAAe,CAEvC7hB,IAAIpF,EAAU,KACVgB,EAAQlB,OAAOmnB,cAAc9hB,GAE7B2sB,SACJ,GAAIvvB,EAAEqE,QAAQ5F,IAAUA,EAAM,GAAG+J,WAAW,MAAQ/J,EAAM,GAAGgK,SAAS,KAAM,CAC3E8mB,EAAc,GACd,IAAI,IAAIpjB,EAAE,EAAGA,EAAE1N,EAAM+K,OAAQ2C,IAC5BojB,EAAYhvB,KAAK2R,KAAKC,MAAM1T,EAAM0N,SAER,iBAAV1N,GAAsBA,EAAM+J,WAAW,MAAQ/J,EAAMgK,SAAS,OAC/EhK,EAAQyT,KAAKC,MAAM1T,IAkBpB,GAdImE,EAAMK,SAAS,OAClBxF,EAAUmF,EAAM8F,MAAM,KAAK,GAC3B9F,EAAQA,EAAM8F,MAAM,KAAK,IAQrBjL,IACJA,EAAUF,OAAOS,KAAKwxB,sBAAsBtvB,KAAKzC,QAASmF,IAGvDnF,EACH,GAAI8xB,EACH,IAAI,IAAIE,EAAE,EAAGA,EAAEF,EAAY/lB,OAAQimB,IAC9BzvB,EAAEqE,QAAQkrB,EAAYE,IACzBvmB,EAAQ3I,KAAK,CAAC9C,EAASmF,EAAO2sB,EAAYE,GAAG,GAAIF,EAAYE,GAAG,KAEhEvmB,EAAQ3I,KAAK,CAAC9C,EAASmF,EAAO,IAAK2sB,EAAYE,UAGvCzvB,EAAEqE,QAAQ5F,GACpByK,EAAQ3I,KAAK,CAAC9C,EAASmF,EAAOnE,EAAM,GAAIA,EAAM,KAE9CyK,EAAQ3I,KAAK,CAAC9C,EAASmF,EAAO,IAAKnE,IAKtC,OAAOyK,EAGRpJ,2BAA2BiM,GAC1B3I,IAAM3F,EAAUsO,EAAKtO,QACrB,GAAKA,EAIL,GAHAF,OAAOqX,QAAQ,sBAGXrX,OAAOsX,MAAM6a,MAAMjyB,GACtBF,OAAOsX,MAAM6a,MAAMjyB,GAASkyB,KAAKxpB,cADlC,CAMA/C,IAAMwS,EAAYrY,OAAOsY,gBACnB6C,EAAYnb,OAAOsX,MAAM6D,UAAU9C,GACzC8C,GAAaA,EAAUkX,UAAU7jB,MAInC/L,EAAE8Y,UAAUxW,GAAG,gBAASutB,EAAO3xB,GAC9BX,OAAOsX,MAAMkM,SAAS+O,oBAAoB5xB,KAG3CX,OAAOwyB,uBAAiBtyB,GACvBoF,IAAIme,EAAQ,QAAQvjB,UACpB,OAAOF,OAAOsX,MAAM6D,UAAUsI,IC1+C/BzjB,OAAOqX,QAAQ,0BAEfzL,OAAO6mB,SAAW,KAClBzyB,OAAOsX,MAAMob,YAAc,cAA0B1yB,OAAOsX,MAAMqb,QACjEpwB,KAAMkhB,GACL,IAAI5V,EAAKlL,KACLzC,EAAUujB,EAAM,GAEpBzjB,OAAOG,MAAMswB,aAAavwB,EAAS,WAClC,GAAIkB,OAAgB,QAAElB,GAAS0yB,SAC9B5yB,OAAO6yB,aAAa,OAAQ3yB,OACtB,CAGN2F,IAAMke,EAAwB,SAAZ7jB,EAAqBujB,EAAM,GAAK,OAC9CqP,EAAa9yB,OAAOsX,MAAMyM,EAAY,QAG1C,GAFK+O,IAAYA,EAAa9yB,OAAOsX,MAAMkM,UAEvCsP,GAAcA,EAAWC,gBAAkBD,EAAWC,iBAEzD,OAGD/yB,OAAOqX,QAAQ,0BAA4BnX,GAC3C2F,IAAMwS,EAAYrY,OAAOsY,gBAEpBtY,OAAOsX,MAAM6D,UAAU9C,GAM3BrY,OAAOoX,UAAU4b,UAAU3a,GAL3BrY,OAAOsX,MAAM6D,UAAU9C,GAAa,IAAIya,EAAW,CAClD5yB,QAASA,EACTmE,OAAQwJ,EAAGolB,WAAU,EAAM5a,KAK7BxK,EAAGqlB,kBAKN3wB,OACII,KAAKwwB,qBAGRxwB,KAAKywB,wBACLxP,MAAMja,OACNhH,KAAKuwB,eACLT,UAAYA,SAAS9oB,QAGtBpH,mBACC,IAAIkhB,EAAQzjB,OAAO0jB,YACfxjB,EAAUujB,EAAM,GAChB4P,EAAarzB,OAAOszB,cAAc5lB,OAAO,GAAG,GAChD,GAAiB,SAAb+V,EAAM,IAAkC,IAAjBA,EAAMxX,QAAgBjM,OAAOsX,MAAM6D,UAAUjb,GACvE,SAAGmzB,GAA8B,SAAhBA,EAAW,IAAeA,EAAW,KAAKnzB,KAU1D0L,OAAO2nB,QAAQC,IAAI,IACZ,GAOVjxB,wBACC,GAAIvC,OAAOszB,cAAcrnB,OAAS,EAAG,CACpC,IAAIwnB,EAAazzB,OAAOszB,cAActzB,OAAOszB,cAAcrnB,OAAS,GACpE,GAAsB,YAAlBwnB,EAAW,GAAkB,CAChC,IAAIvzB,EAAUF,OAAO0jB,YAAY,GAChC1I,EAASyY,EAAW,GACjBzzB,OAAO0zB,aAAa1Y,IAAWhb,OAAO0zB,aAAa1Y,GAAQtV,SAASxF,IAEvEF,OAAO+a,YAAY4Y,mBAAmBzzB,EAAS8a,KAMnDzY,eACC,IAAIkhB,EAAQzjB,OAAO0jB,YACfrL,EAAYrY,OAAOsY,gBACvBma,SAAWzyB,OAAOsX,MAAM6D,UAAU9C,GAC9Boa,UAAYA,SAASvyB,UAAYujB,EAAM,KAE1C7X,OAAO6mB,SAAW,QC/FrBzyB,OAAOqX,QAAQ,aAEA,MAAMuc,WACpBrxB,YAAYU,uBACXuU,OAAOC,OAAO9U,KAAM8J,UAAU,IAC9B9J,KAAKkxB,eAAiB7zB,OAAOwU,KAAKwM,SAAS,CAAC,iBAAkB,kBAC9Dre,KAAKgJ,QAAU,GACfhJ,KAAKmB,OACLnB,KAAK6G,OACL7G,KAAKiG,UAGNrG,OAECI,KAAKkG,QAAQgB,KAAK,gCAClBlH,KAAKmxB,YAAcnxB,KAAKkG,QAAQvE,KAAK,eACrC3B,KAAKoxB,cAAgBpxB,KAAKkG,QAAQvE,KAAK,iBAEvC3B,KAAKqxB,aAAeh0B,OAAOqC,GAAGoG,KAAKC,aAAa,CAC/C9C,GAAI,CACHH,UAAW,OACXuE,MAAOnJ,GAAG,eAAeozB,cACzBrjB,YAAa/P,GAAG,eAChBqzB,YAAa,YAEd7vB,OAAQ1B,KAAKmxB,YACbK,aAAc,IAGf1xB,EAAEE,KAAKqxB,aAAaI,YAAYlf,IAAI,YAAa,IAEjDvS,KAAK0xB,gBAAkBr0B,OAAOqC,GAAGoG,KAAKC,aAAa,CAClD9C,GAAI,CACHH,UAAW,QACXuE,MAAOnJ,GAAG,cAEXwD,OAAQ1B,KAAKmxB,YACbK,aAAc,IAKhB5xB,OACCI,KAAK2xB,mBACL3xB,KAAK4xB,oBACL5xB,KAAK6xB,qBAGNjyB,qBACCI,KAAK8xB,mBACHpuB,gBACAR,IAAMgE,EAAOlH,EAAKgJ,QAAQhI,aAAIE,UAAUlB,EAAK+xB,gBAAgB7wB,KAC7DlB,EAAKkG,QAAQvE,KAAK,cAAcU,SAChCrC,EAAKkG,QAAQiD,OAAOjC,KAEtBlH,KAAK0xB,gBAAgBzqB,QAAO,GAC5BjH,KAAKqxB,aAAaW,gBAAgB,IAGnCpyB,gBAAgBsB,GACf,0CAA2CA,+CACbA,2HAK/BtB,+BACCI,KAAKkG,QAAQ9D,GAAG,QAAS,sBAAcgE,GACtClD,IAAMkP,EAAOtS,EAAEsG,EAAEkO,eAAezE,KAAK,aACrC7P,EAAKwY,UAAUgB,YAAYpN,QACzB1I,gBACA1D,EAAKwY,UAAUgB,YAAYnH,IAAIrS,EAAKiyB,mBAAmB7f,QAK3DxS,gCACCI,KAAKkG,QAAQ9D,GAAG,QAAS,8BAAsBgE,GAC9ClD,IAAMqM,EAAMzP,EAAEsG,EAAEkO,eAAevN,QAAQ,cACjCqL,EAAO7C,EAAIM,KAAK,aACtBN,EAAIlN,SACJrC,EAAKkyB,cAAc9f,GACjB1O,uBAAW1D,EAAKiG,cAIpBrG,8BACCI,KAAKqxB,aAAalmB,OAAOhF,QAAQ9I,OAAOiC,MAAM6yB,kBAAS/rB,GACtDlD,IAAM3E,EAAQyB,EAAKqxB,aAAa9rB,YAC1B6sB,EAAYlb,QAAQ3Y,GAE1B,GAAI6H,EAAEC,QAAUhJ,OAAOqC,GAAG+O,QAAe,MAAG,CAC3C,IAAK2jB,GAAapyB,EAAKqyB,mBAAmB9zB,GAAQ,OAElDyB,EAAKqxB,aAAalvB,UAAU,IAC5BnC,EAAKsyB,YAAY/zB,GACfmF,uBAAW1D,EAAKiG,gBACZ,CACNtD,IAAI4vB,EAAYr0B,GAAG,uBAEf8B,EAAKqyB,mBAAmB9zB,KAC3Bg0B,EAAYr0B,GAAG,0BAGhB8B,EAAKqxB,aAAaW,gBAAgBI,EAAYG,EAAY,IAEtDvyB,EAAKkxB,gBACRlxB,EAAK0xB,gBAAgBzqB,OAAOmrB,KAG5B,MAGJxyB,YAAY4yB,GACX,OAAOn1B,OAAOgrB,GAAGoK,OAAO,CACvBl1B,QAAS,cACT6vB,kBAAmBptB,KAAKwY,UAAUjb,oBAClCi1B,EACAE,SAAU1yB,KAAK0xB,gBAAgBnsB,YAAc,GAAKlI,OAAOuU,QAAQC,KACjE7I,QAASgJ,KAAKc,UAAU9S,KAAK2yB,yBAI/B/yB,cAAcwS,GACb,GAAKA,EACL,OAAO/U,OAAOgrB,GAAGuK,WAAW,cAAexgB,GAG5CxS,mBAAmBwS,GAClBlP,IAAMhC,EAASlB,KAAKgJ,QAAQrH,cAAKT,UAAUA,EAAOkR,OAASA,IAC3D,OAAQJ,KAAKC,MAAM/Q,EAAO8H,SAAW,MAGtCpJ,sBACC,OAAOI,KAAKwY,UAAUgB,YAAY5T,MAGnChG,mBAAmB4yB,GAClB,OAAQxyB,KAAKgJ,SAAW,IAAIrH,cAAKkE,UAAKA,EAAE2sB,cAAgBA,IAGzD5yB,8BACC,OAAOvC,OAAOgrB,GAAGwK,SAAS,cAAe,CACxCzc,OAAQ,CAAC,OAAQ,cAAe,WAAY,WAC5CpN,QAAS,CAAEokB,kBAAmBptB,KAAKwY,UAAUjb,SAC7Cu1B,WAAY,CAAC,CAAC,WAAY,IAAKz1B,OAAOuU,QAAQC,MAAO,CAAC,WAAY,IAAK,OACrEnO,cAAMsF,GACRhJ,EAAKgJ,QAAUA,GAAW,MC+M7B,SAAS+pB,oCAER,MAAiB,SADH11B,OAAO0jB,YACX,KAGT1jB,OAAOmX,UAAU,OAAQ,OAAQ,SAC1B,GCnDT,SAASwe,mBA4BR,MA3BgB,CACfC,MAAS,CACRC,UAAa,CACZC,iBAAoB,UACpBC,QAAW,UACX1qB,YAAe,cACf2qB,SAAY,iBACZC,SAAY,YACZC,OAAU,cAEXC,YAAe,CAAC,UAAW,YAC3BC,cAAiB,IAElBC,KAAQ,CACPR,UAAa,CACZC,iBAAoB,UACpBzqB,YAAe,cACf4qB,SAAY,OACZlG,kBAAqB,iBACrBuG,mBAAsB,iBACtBC,YAAe,SAEhBJ,YAAe,CAAC,eAChBC,cAAiB,CAAC,SAAU,cC1U/Bp2B,OAAOqX,QAAQ,gBAQfrX,OAAOsX,MAAM4D,YAAc,MAC1B3Y,YAAYC,GACXC,EAAEC,OAAOC,KAAMH,GACfG,KAAKmB,OACLnB,KAAK6zB,SAAW,GAGjBj0B,kBACKk0B,EAAkBz2B,OAAOmE,gBAAgB,eAAgB,CAAEjE,QAASyC,KAAKzC,UAE7EyC,KAAK+zB,QAAUj0B,EAAE,wEACfoH,KAAK4sB,GACLryB,SAASzB,KAAKsX,KAAKyc,QAAQpuB,SAE7B3F,KAAKg0B,gBACLh0B,KAAKi0B,oBACLj0B,KAAKk0B,cACLl0B,KAAKm0B,sBACLn0B,KAAKo0B,sBACLp0B,KAAKq0B,oBACLr0B,KAAKs0B,2BACLt0B,KAAKu0B,sBAILz0B,EAAE8Y,UAAUxH,QAAQ,sBAEhBpR,KAAKwY,UAAUmJ,oBAAsB3hB,KAAKwY,UAAUmJ,mBAAmB6S,sBAC1Ex0B,KAAK+zB,QAAQpyB,KAAK,iBAAiBU,SAEnCrC,KAAK+zB,QAAQpyB,KAAK,eAAeS,GAAG,iBAAUgE,GAC7CpG,EAAKmlB,iBAMRvlB,cACC,IAAI60B,GAAiB,EAEjBp3B,OAAOsX,MAAM+f,SAAS10B,KAAKzC,WAC9ByC,KAAK+zB,QAAQpyB,KAAK,oCAAoCW,YAAY,QAClEtC,KAAK+zB,QAAQpyB,KAAK,iCAAiCW,YAAY,QAC/DmyB,GAAiB,GAGlBz0B,KAAK+zB,QAAQpyB,KAAK,kCAAkCW,YAAY,QAC3C,kBAAjBtC,KAAKzC,SAA+BF,OAAOsK,KAAKgtB,eAAerrB,SAClEtJ,KAAK+zB,QAAQpyB,KAAK,iCAAiCW,YAAY,QAC/DmyB,GAAiB,IAGdp3B,OAAOu3B,kBAAkB50B,KAAKzC,UAAYF,OAAOwY,SAAS7V,KAAKzC,SAASs3B,UAC3E70B,KAAK+zB,QAAQpyB,KAAK,cAAcW,YAAY,QAG7CtC,KAAK80B,aAAe,OACpB,IAAIhU,EAAQzjB,OAAO0jB,YACfD,EAAMxX,OAAS,GAAKjM,OAAOsX,MAAMgJ,WAAW5a,SAAS+d,EAAM,MAC9D9gB,KAAK80B,aAAehU,EAAM,GAEA,WAAtB9gB,KAAK80B,aACR90B,KAAK+0B,aAAejU,EAAM,GACM,UAAtB9gB,KAAK80B,eACf90B,KAAKg1B,cAAgBlU,EAAM,KAK7B9gB,KAAK+zB,QAAQpyB,KAAK,yBAA2B3B,KAAK80B,aAAe,QAC/DjlB,KAAK,WAAY,YAAYrM,SAAS,YAGxCxD,KAAK+zB,QAAQpyB,KAAK,qEAChBkO,KAAK,WAAY,MAAMvN,YAAY,YAGjCtC,KAAKwY,UAAU1a,KAAK8kB,cACvB5iB,KAAK+zB,QAAQpyB,KAAK,iCAAiCW,YAAY,QAC/DmyB,GAAiB,GAGdA,GACHz0B,KAAK+zB,QAAQpyB,KAAK,gCAAgCW,YAAY,QAIhE1C,gBAEC,IAAIsL,EAAKlL,KACLi1B,EAAQ,GACRC,EAAWl1B,KAAKsX,KAAKyc,QAAQpyB,KAAK,qBAClCwzB,GAAU,EAEVC,EAAc,SAASC,GAC1Bv1B,EAAEwM,KAAK+oB,EAAS,SAASjjB,EAAMzB,GAC9B,IAAKA,EAAE2kB,aAAe3kB,EAAE2kB,aAAepqB,EAAG3N,QAAS,CAClD,IAAIg4B,EAAgC,mBAAlB5kB,EAAE4kB,oBACX5kB,wBAAyB,eAE9BmQ,EAAQnQ,EAAEmQ,OAASyU,EAAc,KAAO5kB,EAAE8N,OAAS9N,EAAEyB,OAE3B,IAA1B6iB,EAAM5sB,QAAQyY,KAEjBmU,EAAM50B,KAAKygB,GAENqU,IACJjqB,EAAGsqB,cAAc/zB,SAASyzB,GAC1BC,GAAU,GAGXr1B,EAAE,iBAAmBghB,EAAQ,KAC5B5iB,GAAGyS,EAAE8N,OAAS9N,EAAEyB,MAAQ,aAAa3Q,SAASyzB,QAO/Cl1B,KAAKwY,UAAUna,SAASg3B,SAC3BD,EAAYp1B,KAAKwY,UAAUna,SAASg3B,SAOrCD,EAHcvgB,OAAO2G,OAAOne,OAAOsK,KAAKkK,KAAK4jB,aAAaxoB,cAAMif,EAAEC,UAAMD,EAAEzN,MAAMiX,cAAcvJ,EAAE1N,UAAW,IAM5G7e,oBACCI,KAAK21B,YAAc,IAAI1E,WAAW,CACjC/qB,QAASlG,KAAKsX,KAAKyc,QAAQpyB,KAAK,iBAChCpE,QAASyC,KAAKzC,QACdib,UAAWxY,KAAKwY,YAIlB5Y,sBACCsD,IAAM0yB,EAAY51B,KAAKsX,KAAKyc,QAAQpyB,KAAK,oBACzCtE,OAAOsX,MAAMkhB,WAAWC,0BAA0B91B,KAAKzC,QAASq4B,GAGjEh2B,iCACOrC,EAAUyC,KAAKzC,QAErBF,OAAOgrB,GAAGwK,SAAS,gBAAiB,CACnC7pB,QAAS,CACRokB,kBAAmB7vB,KAElBmG,cAAKqyB,GACP,GAAM7xB,MAAMC,QAAQ4xB,IAAWA,EAAOzsB,OAAtC,CACApG,IAAM8yB,EAAiBD,EACjBE,EAAiBj2B,EAAK+zB,QAAQpyB,KAAK,oCAErCu0B,EAAe,GACf74B,OAAOsX,MAAM+f,SAAS10B,EAAKzC,WAE9B24B,EAAe,sBAAsB34B,oCACjCW,GAAG,wBAERgF,IAAMizB,EAAcH,EAAeh1B,aAClCo1B,+BAAuC74B,eAAoB64B,wBACvDl4B,GAAGk4B,EAAchkB,8BAEpBhO,KAAK,IAEDiyB,EAAgB,2JAGhBn4B,GAAG,8KAGJg4B,mBACAC,8CAILF,EAAe3zB,YAAY,QAC3B2zB,EAAe/uB,KAAKmvB,MAItBz2B,+BAEC,GAAoB,iBAAhBI,KAAKzC,QAAT,CAGAoF,IAAIizB,EAAY51B,KAAKsX,KAAKyc,QAAQpyB,KAAK,2BACnCwzB,GAAU,EAEVmB,WAAWj5B,OAAOkwB,WAAY,CAAC,iBAAkB,mBACpDztB,sCAAsC5B,GAAG,kCACvCuD,SAASm0B,GAGGv4B,OAAOsK,KAAKgtB,eAClB9sB,iBAAS0uB,GACjB5zB,IACIme,EAAQ,CAAC,OAAQ,gBAAiB,QADG,gBAApByV,EAAQC,SAA8B,eAAiBD,EAAQvB,eACtB5wB,KAAK,KAC/DqyB,EAAe,CAAC,eAAgB,YAAa,OAAQ,SAAS1zB,SAASwzB,EAAQC,UAAYt4B,GAAGq4B,EAAQC,UAAYD,EAAQC,SAEzHrB,IACJn1B,EAAKw1B,cAAc/zB,SAASm0B,GAC5BT,GAAU,GAEXr1B,mBAAmBghB,OAAU2V,eAAyBh1B,SAASm0B,GACtC,cAArBW,EAAQC,WACXrB,GAAU,KAGZS,EAAUj0B,KAAK,sBAAsByS,MAAM,WAC1C/W,OAAOmmB,QAAQ,oBAIjB5jB,sCACCI,KAAK+zB,QAAQpyB,KAAK,+CAA+C2K,cAAML,EAAGwgB,GACzEpvB,OAAOqC,GAAG6b,KACRmb,mBAAmB12B,EAAKsX,MACxBjF,IAAIvS,EAAE2sB,MAIV7sB,sBACCI,KAAK22B,cAAgB,IAAIt5B,OAAOsX,MAAMiiB,YAAY,CACjDr5B,QAASyC,KAAKzC,QACdw2B,QAAS/zB,KACTwY,UAAWxY,KAAKwY,UAChBlB,KAAMtX,KAAKsX,OAIb1X,eACC,OAAOI,KAAK6zB,SAGbj0B,YACC,IAAIsL,EAAKlL,KACT3C,OAAOkT,KAAK,CACXC,OAAQ,2CACRyT,KAAM,MACNla,KAAM,CACLqN,MAAOlM,EAAGkM,MACV7Z,QAAS2N,EAAG3N,QAEZyL,SAAUkC,EAAGsN,UAAUgB,YAActO,EAAGyqB,YAAYhD,sBAAwBznB,EAAGwS,kBAAoB,IAEpGhN,SAAU,SAASC,GAClBzF,EAAG2rB,YAAY,cAAelmB,EAAEQ,QAAQiG,OAAS,IAAgB,YACjEzU,IAAIm0B,EAAiB5rB,EAAG6oB,QAAQpyB,KAAK,wBACrCtE,OAAOiC,MAAMy3B,aAAaD,EAAgB,aAAc,kBAK3Dl3B,YAAY8C,EAAOs0B,EAAM5mB,GACxB,IAAIlF,EAAKlL,KACLi3B,EAAM,EACN7f,EAAQ,GACR/P,EAAQhK,OAAOS,KAAKo5B,aAAal3B,KAAKzC,SAASmF,GAClDrF,OAAOS,KAAKo5B,aAAal3B,KAAKzC,SAASmF,GAAO2E,MAAQ3E,EASvD,GAPAs0B,GAAQA,GAAQ,IAAI/pB,KAAK,SAASif,EAAGC,GACpC,OAAOA,EAAE,GAAKD,EAAE,KAEjBpsB,EAAEwM,KAAK0qB,EAAM,SAAS/qB,EAAGxD,GACxBwuB,GAAYxuB,EAAE,KAGX2H,EAAM,CACT,IAAK,IAAI+mB,KAAK/mB,EAAM,CACnB,IAAIgnB,GAAU,EACd,IAAK,IAAInrB,KAAK+qB,EACb,GAAI5mB,EAAK+mB,KAAOH,EAAK/qB,GAAG,GAAI,CAC3BmL,EAAM/W,KAAK22B,EAAK/qB,IAChBmrB,EAASnrB,EACT,MAGEmrB,EAAS,EACZhgB,EAAM/W,KAAK,CAAC+P,EAAK+mB,GAAI,IAErBjsB,EAAGmsB,UAAsB,WAAEloB,OAAOioB,EAAQ,GAG5C10B,EAAQ,kBAER0U,EAAQ4f,EAET,IAAIM,EAAU,CACb50B,MAAOA,EACPs0B,KAAM5f,EACN6f,IAAKA,EACL5vB,MAAiB,eAAV3E,EAA0B0N,EAAOlS,GAAGmJ,GAASnJ,GAAG,QAAWA,GAAGmJ,IAEtEvH,EAAEzC,OAAOmE,gBAAgB,oBAAqB81B,IAC5Cl1B,GAAG,QAAS,aAAc,WAC1B,IAAIH,EAAYnC,EAAEE,MAAM6P,KAAK,cACzBxI,EAAQvH,EAAEE,MAAM6P,KAAK,cACrBjN,EAAY,OACZ20B,EAAWrsB,EAAGsN,UAAUgB,YAAYwC,YAAYY,WAAW3a,GAC5Ds1B,GACFA,EAASl1B,SAEG,WAATgF,IACHA,EAAQ,MACRzE,EAAY,YAEbsI,EAAGsN,UAAUgB,YAAYwC,YAAYzS,WAAW2B,EAAGsN,UAAUjb,QAAS0E,EAAWW,EAAWyE,GAC1F3D,KAAK,WACLwH,EAAGsN,UAAUvS,cAGfxE,SAASzB,KAAK+zB,QAAQpyB,KAAK,yBAG9B/B,cAAcqD,GAGO,aAAhBA,EAAGhB,WACNgB,EAAGH,UAAY,SACfG,EAAGgC,QAAU,CACZ,CAAE1G,MAAO,EAAG8I,MAAO,SACnB,CAAE9I,MAAO,EAAG8I,MAAO,aACnB,CAAE9I,MAAO,EAAG8I,MAAO,eAEM,SAAhBpE,EAAGH,WACbG,EAAGH,UAAY,SACfG,EAAGgC,QAAU,CAAC,CAAE1G,MAAO,EAAG8I,MAAO,MAChC,CAAE9I,MAAO,EAAG8I,MAAO,UAIO,GAFjB,CAAC,OAAQ,aAAc,cAAe,OAAQ,MAAO,WAC/D,eAAgB,YAAa,UAC5BgB,QAAQpF,EAAGH,WACZG,EAAGH,UAAY,OACW,QAAhBG,EAAGH,WAA2D,KAApC9C,KAAKw3B,GAAG71B,KAAK,cAAc4E,QAC/DtD,EAAGH,UAAY,QAEK,SAAjBG,EAAGH,WAA6D,WAApCG,EAAGgC,SAAW,IAAI4D,gBACjD5F,EAAGgC,QAAU,MAIfrF,eACCI,KAAK+zB,QAAQpyB,KAAK,cAAcU,SAChCrC,KAAK+zB,QAAQpyB,KAAK,oBAAoBU,SACtCrC,KAAKy3B,YAGN73B,cACC,OAAOE,EAAE,61ICzWXzC,OAAOqX,QAAQ,gBAEfrX,OAAOsX,MAAMiiB,YAAc,MAC1Bh3B,YAAYC,GACXC,EAAEC,OAAOC,KAAMH,GACfG,KAAK03B,eAEL13B,KAAK8V,cAAgBzY,OAAO0Y,kBAAkB/V,KAAKzC,SACnDyC,KAAK23B,gBAAkB,CAAC,cAAe,SACpC33B,KAAK8V,cAAc6hB,kBACrB33B,KAAK23B,gBAAkB33B,KAAK23B,gBAAgB9qB,OAAO7M,KAAK8V,cAAc6hB,kBAEvE33B,KAAK43B,wBACL53B,KAAK63B,6BACL73B,KAAK83B,iBACL93B,KAAK+3B,kBAGNn4B,wCACK8M,EAAI,IAAIrP,OAAOqC,GAAG8e,OAAQ,CAC7BC,MAAOvgB,GAAG,kBACVkY,OAAQpW,KAAKg4B,iCAGdtrB,EAAEiS,mBAAmB,gBAASre,2BAC7BjD,OAAOG,MAAMsY,cAAcmP,KAAKjlB,EAAKzC,QAAS,kBAAmBo6B,GAAmB,MACpF33B,EAAK23B,gBAAkBA,EAAkB,CAAC,cAAe,gBAAYA,GAAmB,CAAC,cAAe,SACxG33B,EAAK43B,wBACLlrB,EAAE9I,SAGH8I,EAAEurB,MAAMzV,+EAC2BtkB,GAAG,gFAGtC8B,KAAKsX,KAAKyc,QAAQpyB,KAAK,wBAAwBS,GAAG,mBACjD/E,OAAOiC,MAAMy3B,aAAarqB,EAAEurB,MAAO,iBAAkB,eACrDvrB,EAAE1F,SAIJpH,eACCI,KAAKkO,SAAWlO,KAAK+zB,QAAQA,QAAQpyB,KAAK,kBAC1CgB,IAAIuE,EAAO,oDAEPhJ,GAAG,wMAMFA,GAAG,iHAIR8B,KAAKkO,SAAShH,KAAKA,GAGpBtH,mCAgCKsH,EAAOlH,KAAK23B,gBAAgB32B,aA/BXiB,GACpBU,IAAI0E,EAAOvE,EACX,GAAkB,gBAAdb,EACHoF,EAAQnJ,GAAG,oBACL,GAAkB,UAAd+D,EACVoF,EAAQnJ,GAAG,kBACL,CACNmJ,EAAQhK,OAAOS,KAAK8pB,UAAU5nB,EAAKzC,QAAS0E,GAC5CU,IAAIu1B,EAAW76B,OAAOS,KAAKilB,aAAa/iB,EAAKzC,QAAS0E,GACtD,IAAKi2B,EACJ,OAEDp1B,EAAYo1B,EAASp1B,UAGtB,iNAGgBuE,uBAA0BpF,uBAA8Ba,iEAEnE5E,GAAGmJ,0NAIFnJ,GAAG,0GAOyCkG,KAAK,IACxDpE,KAAKkO,SAASvM,KAAK,yBAAyBuF,KAAKA,GAGlDtH,4BACCI,KAAKkO,SAAS9L,GAAG,QAAS,2BAAoBgE,GAC7CzD,IAAIuyB,EAAWp1B,EAAEsG,EAAEkO,eAAe3S,KAAK,sBACnCM,EAAYnC,EAAEsG,EAAEkO,eAAe3S,KAAK,KAAKkO,KAAK,kBAC9C/M,EAAYhD,EAAEsG,EAAEkO,eAAe3S,KAAK,KAAKkO,KAAK,kBAClD7P,EAAKm4B,mBAAmBl2B,GAAWyB,cAAK00B,GACnCA,EAAiB9uB,QACpBtJ,EAAKq4B,sBAAsBD,EAAkBt1B,EAAWoyB,GACxD73B,OAAOiC,MAAMy3B,aAAa7B,EAAU,iBAAkB,kBAAmB,cAEzEA,EAAShuB,sFAENhJ,GAAG,gDAQV0B,0CACK+3B,EAAkB,GAClBvhB,EAASpW,KAAKwY,UAAU1a,KAAKsY,OAAOlV,gBAAQ2E,SAAK,CAAC,SAAU,OAAQ,OAAQ,MAAO,SAAS9C,SAAS8C,EAAE/C,aAa3G,OAZA60B,EAAgBt3B,KAAK,CACpBgH,MAAOnJ,GAAG8B,KAAKzC,SACf0E,UAAW,kBACXa,UAAW,aACXihB,QAAS,EACT9e,QAASmR,EACPpV,aAAIiC,UACJoE,MAAOnJ,GAAG+E,EAAGoE,OACb9I,MAAO0E,EAAGhB,UACVq2B,QAASt4B,EAAK23B,gBAAgB50B,SAASE,EAAGhB,gBAGtC01B,EAGR/3B,mBAAmB8C,GAClBC,IAAI41B,EAAkBv4B,KAAKwY,UAAUiC,uBAGrC8d,EACCA,EAAgBr3B,gBAAQs3B,UAAWA,EAAMz1B,SAAmB,gBAAVL,EAA0B,UAAWA,KAExFC,IAAIoH,EAAQ,CACXxM,QAASyC,KAAKzC,QACdg7B,gBAAiBA,EACjB71B,MAAOA,GAIR,OAAOrF,OAAOkT,KAAK,0CAA2CxG,GAAMrG,cAAMiN,GACzEhO,IAAI81B,EAAe9nB,EAAEQ,SAAW,GAE5BunB,GADJD,EAAeA,EAAav3B,gBAAO2E,UAAiB,IAAZA,EAAEyiB,SACV3mB,cAAKkE,UAAKA,EAAEuM,OAAS/U,OAAOuU,QAAQC,OAIpE,OAHA4mB,EAAeA,EAAav3B,gBAAO2E,UAAM,CAAC,QAAS,gBAAiBxI,OAAOuU,QAAQC,MAAM9O,SAAS8C,EAAEuM,QAEhGsmB,GAAcD,EAAatb,QAAQub,GAChCD,IAIT74B,sBAAsBwW,EAAQtT,EAAWoyB,GACxCvyB,IAsBI0zB,EANgB,kFAEgBn4B,GAAG,6GAIHkY,EAAOpV,aAtBlB0B,GACxBC,IAAI0E,EAAsB,MAAd3E,EAAM0P,KAAelU,GAAG,iBAAmBwE,EAAM0P,KAQ7D,OAPI/K,IAAUhK,OAAOuU,QAAQC,KAC5BxK,EAAQnJ,GAAG,MACD4E,GAA0B,SAAbA,IACvBuE,EAAiB,KAATA,EAAcnJ,GAAG,MAAOA,GAAG,kDAEV,MAAdwE,EAAM0P,KAAe,GAAK8M,mBAAmBxc,EAAM0P,kIAInB1P,YAAe2E,sEACT3E,+CAUe0B,KAAK,IACvE8wB,EAAShuB,KAAKmvB,GAGfz2B,6BACCI,KAAKkO,SAAS9L,GAAG,QAAS,0BAAmBgE,GAC5CzD,IAAIioB,EAAU9qB,EAAEsG,EAAEkO,eACdrS,EAAY2oB,EAAQ+N,QAAQ,mBAAmBh3B,KAAK,KAAKkK,KAAK,aAC9DtN,EAAyC,iBAA1BqsB,EAAQ/e,KAAK,SAC7B+sB,mBAAmBhO,EAAQ/e,KAAK,SAASxH,QACzCumB,EAAQ/e,KAAK,SAGhB,OAFA5J,EAA0B,gBAAdA,EAA8B,UAAWA,EAE9CjC,EAAKwY,UAAUgB,YAAYnX,OAAOJ,GACvCyB,gBACAf,IAAIk2B,EAAW,IAUf,MATc,KAAVt6B,IACHs6B,EAAW,KACXt6B,EAAQ,WAES,YAAd0D,IACH42B,EAAW,OACXt6B,EAAQ,IAAIA,OAGNyB,EAAKwY,UAAUgB,YAAYnH,IAAIrS,EAAKzC,QAAS0E,EAAW42B,EAAUt6B,ibC9M9ElB,OAAOqX,QAAQ,gBAEfrX,OAAOsX,MAAMmkB,UAAY,cAAwBz7B,OAAOsX,MAAMkM,SAC7DO,gBACC,MAAO,QAGRxhB,4BACC,OAAOqhB,MAAM/L,iBACXxR,gBACA1D,EAAK4V,WAAa5V,EAAK4V,WAAa,IAAM1X,GAAG,SAC7C8B,EAAK+4B,kBAAoB17B,OAAOsX,MAAM+f,SAAS10B,EAAKzC,UAAY,GAErB,iBAAhCyC,EAAK+4B,kBAAkBC,OACjCnkB,OAAOC,OAAO9U,EAAK+4B,kBAAmB/4B,EAAK+4B,kBAAkBC,OAG1Dh5B,EAAK+4B,kBAAkBre,UAC1B1a,EAAKqW,QAAUrW,EAAK+4B,kBAAkBre,SACtC1a,EAAKsW,WAAa,QAElBtW,EAAKqW,QAAUrW,EAAKqhB,mBAAmBhL,SAAWrW,EAAK+4B,kBAAkB7F,UAAUld,MACnFhW,EAAKsW,WAAatW,EAAKqhB,mBAAmB/K,YAAc,SAK5D1W,cAIAA,aAAaiM,GACZoV,MAAMhG,aAAapP,GACnB7L,KAAKi5B,gBAGNr5B,gBACC,IAAIsL,EAAKlL,KACLlC,EAAOkC,KAAKlC,KACZo1B,EAAYlzB,KAAK+4B,kBAAkB7F,UAEvClzB,KAAKiV,MAAQjV,KAAK6L,KAAK7K,IAAI,SAAU2K,GAEpC,IAQItE,EARA6xB,EAAW,EACXhG,EAAUgG,UAAYp5B,EAAEq5B,WAAWjG,EAAUgG,UAChDA,EAAWhG,EAAUgG,SAASvtB,GACpBunB,EAAUgG,WACpBA,EAAWvtB,EAAKunB,EAAUgG,WAM1B7xB,EADGvJ,EAAKgZ,YACAhX,EAAEoI,OAAO,YAAa,CAACyD,EAAK7N,EAAKgZ,aAAcnL,EAAKyG,OAEpDzG,EAAKunB,EAAUzU,OAGxB,IAAI9N,EAAI,CACPqF,MAAOrK,EAAKunB,EAAUld,OACtBojB,IAAKztB,EAAKunB,EAAUkG,KACpBhnB,KAAM/K,EACNgyB,GAAI1tB,EAAKunB,EAAUmG,IAAM,QACzB97B,QAAS2N,EAAG3N,QACZ27B,SAAUA,EACVI,aAAc3tB,EAAK4tB,kBAAoB,IAWxC,OARI5tB,EAAK6tB,OAASn8B,OAAOqC,GAAG85B,MAAMC,aAAa9tB,EAAK6tB,SACnD7oB,EAAgB,aAAI,SAAWhF,EAAK6tB,MAAME,OAAO,IAG9C/tB,EAAKguB,eACRhpB,EAAgB,aAAI,iBAGdA,IAIT/Q,oBACCI,KAAKijB,SAASvf,gBACb1D,EAAK45B,iBAIPh6B,iBAIAA,eACCsD,IAAMgI,EAAKlL,KACL65B,EAAkB75B,KAAKqhB,mBAAmBwY,iBAAmB,MAC7D3G,EAAYlzB,KAAK+4B,kBAAkB7F,UAGzClzB,KAAKga,QAAQrU,QAEb3F,KAAKg5B,MAAQ,IAAIc,MAAM95B,KAAKga,QAAQ,GAAIha,KAAKiV,MAAO,CACnD4I,UAAWgc,EACXE,YAAa,aACbC,kBAAUC,GACT58B,OAAOmX,UAAU,OAAQylB,EAAK18B,QAAS08B,EAAKZ,KAE7Ca,wBAAiBD,EAAMjkB,EAAOojB,SACxBluB,EAAGiL,WACR9Y,OAAOgrB,GAAGlmB,UAAU83B,EAAK18B,QAAS08B,EAAKZ,OAAI,IACzCnG,EAAUld,OAAQmkB,OAAOnkB,GAAO9N,OAbhB,gBAchBgrB,EAAUkG,KAAMe,OAAOf,GAAKlxB,OAdZ,mBAiBnBkyB,4BAAqBH,EAAMf,SAC1B,GAAKhuB,EAAGiL,UAAR,CACA,IAAIkkB,EAAqB,WAErBv6B,EAAEq5B,WAAWjG,EAAUgG,UAC1BmB,EAAqB,KACXnH,EAAUgG,WACpBmB,EAAqBnH,EAAUgG,UAG5BmB,GACHh9B,OAAOgrB,GAAGlmB,UAAU83B,EAAK18B,QAAS08B,EAAKZ,OAAI,IACzCgB,GAAqBC,SAASpB,SAIlCqB,wBAAgBC,GAEftvB,EAAGga,wBAAwB,CAC1B2U,gBAAiBW,KAGnBC,2BAAmBR,GAClB,IAAItuB,EAAOT,EAAGc,SAASiuB,EAAKZ,IAExBnyB,EACH,sBAAsB+yB,kDACEE,OAAOF,EAAKS,QAAQxyB,OAAO,eAAciyB,OAAOF,EAAKU,MAAMzyB,OAAO,kBAGvFslB,EAAStiB,EAAG7M,SAASu8B,wBACrBpN,GAAU1tB,EAAEq5B,WAAW3L,KAE1BtmB,EAAOsmB,EADQyM,EACStuB,IAEzB,MAAO,kCAAoCzE,EAAO,YAGpDlH,KAAK66B,0BACL76B,KAAK86B,aAGNl7B,qCAKC,KADiBI,KAAKoa,aAAazY,KAAK,oBACzB2H,OAAS,GAAxB,CAEApG,IAAMya,EAAa3d,KAAKg5B,MAAM/zB,QAAQ0Y,YAAc,GAE9CzW,EACL,oDACGyW,EAAW3c,aAAIzC,4FAHEsf,EAI0Ctf,EAJ7ByB,EAAKg5B,MAAM+B,QAAQld,GAAa,WAAa,kCAK7Dtf,qBACZL,GAAGK,+BANYsf,IAONzZ,KAAK,qBAGpBpE,KAAKoa,aAAazY,KAAK,eAAewH,OAAOjC,GAK7ClH,KAAKoa,aAAahY,GAAG,QAAS,0BAAkBgE,GAC/ClD,IAAMiP,EAAOrS,EAAEsG,EAAEkO,eACjBtU,EAAKoa,aAAazY,KAAK,kBAAkBW,YAAY,YACrD6P,EAAK3O,SAAS,qBALWjF,GAAUkT,6BAAiBzR,EAAKg5B,MAAMgC,iBAAiBz8B,IAAQ,GAQxFy8B,CADc7oB,EAAKtG,OAAOtN,UAK5BqB,aACCsD,IAIIxE,EAJYsB,KAAKiV,MACnBjU,aAAIm2B,UAAKA,EAAE8D,eACX/5B,gBAAOD,UAAKA,GAAKA,EAAEqH,WAAW,YAEZtH,aAAIC,GACvBiC,IAAMg4B,EAAaj6B,EAAE0R,QAAQ,IAAK,IAC5BwoB,EAAY,IAAMl6B,EAAEy4B,OAAO,GAEjC,uCACuBwB,8BACbC,+CAEaD,uCALA79B,OAAOqC,GAAG85B,MAAM4B,mBAAmBD,4BASxD/2B,KAAK,IAER1F,EAAQ,UAAUA,aAClBsB,KAAKga,QAAQwI,QAAQ9jB,GAGtBkB,SAASwS,GACR,OAAOpS,KAAK6L,KAAKlK,cAAKgK,UAAQA,EAAKyG,OAASA,IAG7C8Q,oBACC,MAAO,CACN,gEACA,sECrNH7lB,OAAOqX,QAAQ,yBACfrX,OAAOqX,QAAQ,0BAEfrX,OAAOsX,MAAM0mB,aAAe,cAA2Bh+B,OAAOsX,MAAMkM,SACnEjhB,wBACCsD,IAAM4d,EAAQzjB,OAAO0jB,YACrB,GAAqB,IAAjBD,EAAMxX,OAAc,CACvBpG,IAAM3F,EAAUujB,EAAM,GAChBhL,EAAgBzY,OAAO0Y,kBAAkBxY,GAAmB,UAAK,GAGvE,OAFAujB,EAAMzgB,KAAKyV,EAAcwlB,eAAiB,WAC1Cj+B,OAAOmX,UAAUsM,IACV,EAEP,OAAO,EAITlhB,sBAEAwhB,gBACC,MAAO,WAGRxhB,4BACC,OAAOqhB,MAAM/L,iBACXxR,gBACA1D,EAAK4V,WAAa1X,GAAG,eAAgB,CAAC8B,EAAK4V,aAC3C5V,EAAK+4B,kBAAoB17B,OAAOsX,MAAM+f,SAAS10B,EAAKzC,UAAY,GAChEyC,EAAKu7B,cAAgBl+B,OAAO0jB,YAAY,KAI3CnhB,cAIAA,gBACCqhB,MAAM9F,gBACNnb,KAAKklB,wBAAwB,CAC5BoW,cAAet7B,KAAKu7B,gBAItB37B,oBACKI,KAAK00B,SACR10B,KAAK00B,SAASzuB,UAIfjG,KAAKijB,SACHvf,uBAAW1D,EAAKw7B,6BAChB93B,cAAKuB,GACLjF,EAAK00B,SAAW,IAAIr3B,OAAOsX,MAAM8mB,SAASx2B,KAI7CrF,sCACOqF,EAAU,CACf1H,QAASyC,KAAKzC,QACdmE,OAAQ1B,KAAKga,QACb1C,KAAMtX,KAAKsX,KACXkB,UAAWxY,MAENu7B,EAAgBv7B,KAAKu7B,cAE3B,OAAO,IAAIj4B,iBAAQC,GACI,YAAlBg4B,GACH1mB,OAAOC,OAAO7P,EAAS5H,OAAOsX,MAAM+f,SAAS10B,EAAKzC,UAClDgG,EAAQ0B,IAER5H,OAAOG,MAAMk+B,SAAS,gBAAiBH,aACtCr4B,IAAMlF,EAAMX,OAAO4gB,QAAQ,gBAAiBsd,GAC5C1mB,OAAOC,OAAO7P,EAAS,CACtBiuB,UAAW,CACVmG,GAAI,OACJrjB,MAAOhY,EAAI29B,iBACXvC,IAAKp7B,EAAI49B,eACTnd,MAAOzgB,EAAI+nB,iBAGbxiB,EAAQ0B,OAMZie,oBACC,MAAO,CACN,yDACA,wDACA,qDAKH7lB,OAAOsX,MAAM8mB,SAAWzwB,MAAMjL,OAAO,CACpCkL,KAAM,SAAShG,GACdnF,EAAEC,OAAOC,KAAMiF,GACfjF,KAAK67B,uBAENA,oBAAqB,sBACpB,OAAO,IAAIv4B,iBAAUC,GACpBZ,IAAIm5B,EAAcpjB,aAAaqjB,QAAQ,mBACnCC,EAAWtjB,aAAaqjB,QAAQ,gBAKpCx4B,EAJe,CACdu4B,YAAeA,GAA4B,QAC3CE,SAAYA,IAAsB,MAGjCt4B,cAAK2Z,GACPrd,EAAKswB,YACLtwB,EAAKi8B,cAAc5e,GACnBrd,EAAKmB,OACLnB,EAAKk8B,uBAAuB7e,GAC5Brd,EAAK6G,UAGPypB,UAAW,WACV,IAAIplB,EAAKlL,KAGTkL,EAAGoM,KAAK6kB,qBACRr8B,EAAEwM,KAAKjP,OAAOsK,KAAKy0B,UAAW,SAASnwB,EAAG1O,GACtCF,OAAOG,MAAM6+B,SAAS9+B,IACxB2N,EAAGoM,KAAKW,cAAc/Z,GAAGX,GAAU,WAClCF,OAAOmX,UAAU,OAAQjX,EAAS,gBAKrCuC,EAAEE,KAAK0B,QAAQU,GAAG,OAAQ,WACzB8I,EAAGoxB,KAAKC,aAAa,oBAIvBp7B,KAAM,WACLnB,KAAKkO,SAAWlO,KAAK0B,OACrB1B,KAAKs8B,KAAOx8B,EAAE,SAAS2B,SAASzB,KAAKkO,UACrClO,KAAKw8B,cAAgBn/B,OAAOiC,MAAMm9B,aAAaz8B,KAAKw8B,cAAex8B,KAAKkO,SACvEhQ,GAAG,4DACJ8B,KAAKw8B,cAAcjqB,IAAI,CAACmqB,aAAc,QAEtC18B,KAAKs8B,KAAKC,aAAav8B,KAAK28B,aAC5B38B,KAAK48B,WAENV,uBAAwB,SAAS7e,GAEhCvd,EADSE,KACJw8B,eAAe76B,KAAK,gBAAgBk7B,SACzCl6B,IACMm6B,EAAM,uDADIzf,EAAiB,SAAInf,GAAG,iBAAmBA,GAAG,8BAFrD8B,KAINw8B,cAAcrzB,OAAO2zB,IAEzBC,wBAAyB,SAASC,EAAQz+B,GACzCma,aAAaukB,WAAWD,GACxBtkB,aAAawkB,QAAQF,EAAQz+B,IAE9BsI,KAAM,WACL3D,IAAMgI,EAAKlL,KACKkL,EAAGgD,SAASvM,KAAK,oBACvBS,GAAG,QAAS,OAAQ,WAC7BO,IAAIpE,EAASuB,EAAEE,MAAMsS,SAAS,wBAA2B,aAAiBxS,EAAEE,MAAMsS,SAAS,uBAA0B,YAAc,QACnIpH,EAAG6xB,wBAAwB,kBAAmBx+B,KAG/C2M,EAAGgD,SAAS9L,GAAG,QAAS,eAAgB,WACvC8I,EAAGyxB,YAAYX,UAAY9wB,EAAGyxB,YAAYX,SAC1C9wB,EAAGoxB,KAAKC,aAAa,SAAU,WAAYrxB,EAAGyxB,YAAYX,UAC1D9wB,EAAG6xB,wBAAwB,eAAgB7xB,EAAGyxB,YAAYX,UAC1D9wB,EAAG0xB,UACH1xB,EAAGgxB,uBAAuBhxB,EAAGyxB,gBAG/BC,QAAS,WAER58B,KAAKkO,SAASvM,KAAK,2BACjBW,YAAY,oBACZkB,SAAS,mBAEXxD,KAAKkO,SAASvM,KAAK,oBAAoB6B,SAAS,aAEhDxD,KAAKkO,SAASvM,KAAK,wBACjBkO,KAAK,QAAS,IAAIrM,SAAS,sBAC7BxD,KAAKkO,SAASvM,KAAK,wBACjBkO,KAAK,QAAS,IAAIrM,SAAS,uBAE7B,IAAI25B,EAAYn9B,KAAKkO,SAASvM,KAAK,oBACnCw7B,EAAUx7B,KAAK,oBAAoB6B,SAAS,UAE5C25B,EAAUx7B,KAAK,QAAQS,GAAG,QAAS,WAClC+6B,EAAUx7B,KAAK,QAAQW,YAAY,UACnCxC,EAAEE,MAAMwD,SAAS,aAGnB0vB,UAAW,CACVmG,GAAM,OACNrjB,MAAS,QACTojB,IAAO,MACPgE,OAAU,WAEXC,UAAW,CACVC,OAAU,MACVC,QAAW,QACXC,QAAW,SACXjgB,QAAW,QAEZkgB,oBAAqB,SAASC,GAE7B,OADAA,EAAKC,QAAWxD,OAAOuD,GAAME,GAAGvgC,OAAOwgC,aAAaC,WAAkB,QAC/DzgC,OAAOqtB,SAASqT,qBAAqBL,IAE7CzB,cAAe,SAAS5e,GACvB,IAAInS,EAAKlL,KACTA,KAAK28B,YAAc,CAClBqB,OAAQ3gC,OAAOsK,KAAKkK,KAAKosB,UAAY,KACrCC,OAAQ,CACP7X,KAAM,QACN8X,OAAQ,GACR7X,MAAO,8CAER8X,UAAU,EACVC,YAAY,EACZC,cAAc,EACdC,oBAAoB,EACpBzC,YAAaze,EAASye,YACtBE,SAAU3e,EAAS2e,SACnBwC,cAAc,EACdC,OAAQ,SAASzoB,EAAOojB,EAAKsF,EAAUhuB,GACtC,OAAOrT,OAAOkT,KAAK,CAClBC,OAAQtF,EAAGyzB,mBAAqB,kCAChC1a,KAAM,MACNla,KAAMmB,EAAGuF,SAASuF,EAAOojB,GACzB1oB,SAAU,SAASC,GAClB,IAAI8tB,EAAS9tB,EAAEQ,SAAW,GAC1BstB,EAASvzB,EAAG0zB,eAAeH,GAC3B/tB,EAAS+tB,OAIZI,YAAa,SAASlP,EAAOmP,GAC5BA,EAAQjvB,KAAK,QAAS8f,EAAMoP,UAE7BC,WAAY,SAASrP,GAEpB,IAAIpyB,EAAUoyB,EAAMpyB,SAAW2N,EAAG3N,QAC/BF,OAAOG,MAAM6+B,SAAS9+B,IACxBF,OAAOmX,UAAU,OAAQjX,EAASoyB,EAAMvd,OAG1C6sB,UAAW,SAAStP,EAAOuP,EAAOC,GACjCj0B,EAAGk0B,aAAazP,EAAOwP,IAExBE,YAAa,SAAS1P,EAAOuP,EAAOC,GACnCj0B,EAAGk0B,aAAazP,EAAOwP,IAExBn9B,OAAQ,SAASs9B,EAAWC,EAASC,EAAS5kB,GAC7C,GAAgB,UAAZA,EAAKxI,MAAmBmtB,EAAUD,GAAa,MAAnD,CAKA,IAAI3P,EAAQtyB,OAAOG,MAAMiiC,YAAYv0B,EAAG3N,SAOxC,GALAoyB,EAAMzkB,EAAGgoB,UAAUld,OAAS9K,EAAGuyB,oBAAoB6B,GAEhDp0B,EAAGgoB,UAAUkG,MACfzJ,EAAMzkB,EAAGgoB,UAAUkG,KAAOluB,EAAGuyB,oBAAoB8B,IAE/Cr0B,EAAGgoB,UAAUkK,OAAQ,CACvB,IAAIsC,EAAWJ,EAAUK,YAAcJ,EAAQI,WAAc,EAAI,EAEjEhQ,EAAMzkB,EAAGgoB,UAAUkK,QAAUsC,EAEzBA,IACH/P,EAAMzkB,EAAGgoB,UAAUkG,KAAOluB,EAAGuyB,oBAAoBtD,OAAOoF,GAASK,SAAS,EAAG,OAG/EviC,OAAOmX,UAAU,OAAQtJ,EAAG3N,QAASoyB,EAAMvd,QAE5CytB,SAAU,SAASnC,EAAM8B,EAAS5kB,GACjC,GAAiB,UAAdA,EAAKxI,KAAkB,CACzBlP,IAAM48B,EAAahgC,EAAE,gBAAkB49B,EAAKx1B,OAAO,cAAgB,KAEhE43B,EAAWxtB,SAAS,kBACtBpH,EAAGoxB,KAAKC,aAAa,aAAc,aACnCrxB,EAAGoxB,KAAKC,aAAa,WAAYmB,GACjCxyB,EAAGgD,SAASvM,KAAK,iBAAiBW,YAAY,gBAG9C4I,EAAGgD,SAASvM,KAAK,oBAAoBW,YAAY,UACjD4I,EAAGgD,SAASvM,KAAK,wBAAwB6B,SAAS,WAGnD0H,EAAGgD,SAASvM,KAAK,iBAAiBW,YAAY,gBAC9Cw9B,EAAWt8B,SAAS,gBAErB,OAAO,IAINxD,KAAKiF,SACPnF,EAAEC,OAAOC,KAAK28B,YAAa38B,KAAKiF,UAGlCwL,SAAU,SAASuF,EAAOojB,GAQzB,MAPW,CACV77B,QAASyC,KAAKzC,QACdyY,MAAOhW,KAAKy9B,oBAAoBznB,GAChCojB,IAAKp5B,KAAKy9B,oBAAoBrE,GAC9BpwB,QAAShJ,KAAKwY,UAAUgB,YAAY5T,MACpCstB,UAAWlzB,KAAKkzB,YAIlBjtB,QAAS,WACRjG,KAAKs8B,KAAKC,aAAa,kBAExBqC,eAAgB,SAASH,GACxB,IAAIvzB,EAAKlL,KAET,OAAQy+B,GAAU,IAAIz9B,aAAI0L,GAkCzB,OAjCAA,EAAE2sB,GAAK3sB,EAAE0F,KACT1F,EAAE0xB,SAAW/gC,OAAOG,MAAM2Y,UAAUzJ,EAAEnP,SAAW2N,EAAG3N,SAGjDmP,EAAEzN,WAAayN,EAAEzN,UAAY,IAC/ByN,EAAE0xB,UAAW,GAGdt+B,EAAEwM,KAAKpB,EAAGgoB,UAAW,SAASliB,EAAQ+uB,GACrCrzB,EAAEsE,GAAUtE,EAAEqzB,KAGX70B,EAAGgoB,UAAUkK,SAChB1wB,EAAE0wB,OAAS,GAGZ1wB,EAAEsJ,MAAQ3Y,OAAOqtB,SAASsV,mBAAmBtzB,EAAEsJ,OAC/CtJ,EAAE0sB,IAAM/7B,OAAOqtB,SAASsV,mBAAmBtzB,EAAE0sB,MAGxC/7B,OAAOqtB,SAASuV,SAASvzB,EAAEsJ,QAAUtJ,EAAE0sB,MAC3C1sB,EAAEsJ,MAAQ3Y,OAAOqtB,SAASwV,SAASxzB,EAAE0sB,KAAM,IAGxC1sB,EAAEsJ,QAAU3Y,OAAOqtB,SAASuV,SAASvzB,EAAE0sB,OAC1C1sB,EAAE0sB,IAAM/7B,OAAOqtB,SAASwV,SAASxzB,EAAEsJ,MAAO,IAG3C9K,EAAGi1B,8BAA8BzzB,GACjCxB,EAAGk1B,eAAe1zB,GAElBA,EAAE+R,MAAQphB,OAAOiC,MAAM+gC,UAAU3zB,EAAE+R,OAE5B/R,KAGT0zB,eAAgB,SAAS1zB,GACxB/J,IAAI62B,EAAO8G,EAeX,OAdGtgC,KAAKugC,eACPD,EAAatgC,KAAKq9B,UAAUr9B,KAAKugC,cAAc7zB,IAC/C4zB,EAAajjC,OAAOqC,GAAG85B,MAAMC,aAAa6G,GACzCA,EAAa,OACd5zB,EAAE8zB,gBAAkBnjC,OAAOqC,GAAG85B,MAAM5zB,IAAI06B,EAAY,eACpD5zB,EAAE+zB,UAAYpjC,OAAOqC,GAAG85B,MAAM5zB,IAAI06B,EAAY,UAE9C9G,EAAQ9sB,EAAE8sB,MACLn8B,OAAOqC,GAAG85B,MAAMC,aAAaD,IAAWA,IAC5CA,EAAQn8B,OAAOqC,GAAG85B,MAAM5zB,IAAI,OAAQ,gBAErC8G,EAAE8zB,gBAAkBhH,EACpB9sB,EAAE+zB,UAAYpjC,OAAOqC,GAAG85B,MAAM4B,mBAAmB5B,IAE3C9sB,GAER0yB,aAAc,SAASzP,EAAOwP,GAG7B,OADA9hC,OAAOG,MAAMkjC,mBADJ1gC,KAC0BzC,QAASoyB,EAAMvd,MAC3C/U,OAAOkT,KAAK,CAClBC,OAHQxQ,KAGG2gC,qBAAuB,oCAClC52B,KAJQ/J,KAIC4gC,gBAAgBjR,GACzBjf,SAAU,SAASC,GACfA,EAAE8B,MACJpV,OAAOijB,WAAWpiB,GAAG,2BACrBihC,MAGF0B,MAAO,WACN1B,QAIHyB,gBAAiB,SAASjR,GACzB,IACI5lB,EAAO,CACVqI,KAAMud,EAAM3vB,KAAKkzB,UAAUmG,KAsB5B,OAnBAtvB,EAAK/J,KAAKkzB,UAAUld,OALXhW,KAKuBy9B,oBAAoB9N,EAAM3Z,OAEvDhW,KAAKkzB,UAAUkK,SACjBrzB,EAAK/J,KAAKkzB,UAAUkK,QAAWzN,EAAM3Z,MAAM2pB,YAAchQ,EAAMyJ,IAAIuG,WAAc,EAAI,GAEnF3/B,KAAKkzB,UAAUkG,MACZzJ,EAAMyJ,MACVzJ,EAAMyJ,IAAMzJ,EAAM3Z,MAAM3D,IAAI,EAAG,SAGhCtI,EAAK/J,KAAKkzB,UAAUkG,KAfZp5B,KAesBy9B,oBAAoB9N,EAAMyJ,KAEpDrvB,EAAK/J,KAAKkzB,UAAUkK,UACvBrzB,EAAK/J,KAAKkzB,UAAUkG,KAlBbp5B,KAkBuBy9B,oBAAoBtD,OAAOxK,EAAMyJ,KAAKwG,SAAS,EAAG,QAIlF71B,EAAKxM,QAAUoyB,EAAMpyB,SAAWyC,KAAKzC,QAE9B,CAAEwM,KAAMA,EAAMmpB,UAAWlzB,KAAKkzB,YAGtCiN,8BAA+B,SAASxQ,GACnCA,EAAMyN,SAETzN,EAAM3Z,MAAQ2Z,EAAM3Z,MAAQlW,EAAEy8B,aAAapC,OAAOxK,EAAM3Z,OAAO8qB,YAAc,KAC7EnR,EAAMyJ,IAAMzJ,EAAMyJ,IAAMt5B,EAAEy8B,aAAapC,OAAOxK,EAAMyJ,KAAK/mB,IAAI,EAAG,OAAOyuB,YAAc,SCtaxFzjC,OAAOqX,QAAQ,gBAEfrX,OAAOsX,MAAMosB,UAAY,cAAwB1jC,OAAOsX,MAAMkM,SAC7DO,gBACC,MAAO,QAGRxhB,4BACC,OAAOqhB,MAAM/L,iBACXxR,gBACA1D,EAAK4V,WAAa5V,EAAK4V,WAAa,IAAM1X,GAAG,YAIhD0B,aACCI,KAAKyjB,gBACLzjB,KAAKopB,qBAGNxpB,aACCI,KAAKoW,OAAS,CACb,eACGpW,KAAK2iB,0BAA0B3hB,aAAKyrB,UAAMA,EAAGxqB,aAChDjC,KAAKlC,KAAKgZ,cACV9W,KAAKlC,KAAK8kB,cAIZhjB,aAAaiM,cACZoV,MAAMhG,aAAapP,GACnB7L,KAAKqf,MAAQrf,KAAK6L,KAAK7K,aAAI0L,GAG1B,OADAA,EAAEs0B,WAAahhC,EAAKihC,cAAcv0B,GAC3BA,IAIT9M,oBACCI,KAAKkhC,sBACHx9B,gBACA1D,EAAKmhC,oBAEAnhC,EAAKohC,QAGTphC,EAAKohC,QAAQC,mBAAmBrhC,EAAKqf,MAAOrf,EAAKshC,YAFjDthC,EAAKuhC,kBAOT3hC,oBACC,IAAIsH,EAAOlH,KAAKqf,MAAMre,IAAIhB,KAAKwhC,UAAU36B,KAAK7G,OAAOoE,KAAK,IAE1DpE,KAAKga,QAAQ9S,gBACVlH,KAAK8kB,+EAEJ5d,0BAKLtH,kBAAkB+L,GACjBzI,IAAMu+B,EAAczhC,KAAK2iB,0BAA0B3hB,aAAKyrB,UAAMA,EAAGxqB,aAAe,GAC5Ey/B,EAAY,kDAQhB,OAPAD,EAAY55B,iBAASnF,EAAOupB,GACvBtgB,EAAKjJ,KACQg/B,GAAH,GAATzV,EAAyB,OAAOtgB,EAAKjJ,WACvB,0BAA0BiJ,EAAKjJ,cAGnDg/B,GAAa,cAId9hC,UAAU+L,GACTA,EAAKg2B,MAAQ5Y,UAAUpd,EAAKyG,MAC5BlP,IAAM0+B,EAAej2B,EAAKg2B,MACpBljB,EAAQyI,WAAWvb,EAAK3L,KAAKlC,KAAKgZ,aAAe,SACjD+qB,EAAUl2B,EAAKq1B,WAA0B,GAAb,WAC5Bc,EAAQn2B,EAAKq1B,8BACCY,YAAuBj2B,uBAA2B8S,mDAEjEphB,OAAO0kC,SAAStjB,qBAGjBujB,EAAUhiC,KAAKiiC,kBAAkBt2B,GAErC,uKAIM3L,KAAK8mB,iBAAiBnb,0GAIRi2B,2BACPA,0BACD5hC,KAAKynB,cAAc9b,0DAEDk2B,iCACZD,qCAEXE,0EACqDF,iJAMxDI,yBAKLpiC,cAAciM,GACb,IAAIq2B,EAOJ,OANAA,EAAMr2B,EAAKs2B,MAAQt2B,EAAKs2B,MAAQt2B,EAAK7L,KAAKlC,KAAK8kB,aAG3C3Z,OAAOm5B,UAAY/kC,OAAOiC,MAAM+iC,OAAOH,KAC1CA,EAAM7kC,OAAOilC,SAAWJ,GAErBA,GAGG,KAGRtiC,iCACC,OAAOvC,OAAOkT,KAAK,CAClBC,OAAQ,oDACRzG,KAAM,CACLxM,QAASyC,KAAKzC,QACdme,MAAO1b,KAAKqf,MAAMre,aAAIiL,UAAKA,EAAEmG,UAE5B1O,cAAKiN,GACP3Q,EAAKshC,WAAazsB,OAAOC,OAAO9U,EAAKshC,YAAc,GAAI3wB,EAAEQ,WAI3DvR,kBACC,OAAOI,KAAKomB,yBAAyB,6WAWtCxmB,gBACC,IAAIsL,EAAKlL,KACTA,KAAKohC,QAAU,IAAI/jC,OAAOsX,MAAM4tB,YAAY,CAC3ChlC,QAASyC,KAAKzC,QACd8hB,MAAOrf,KAAKqf,MACZnZ,QAASlG,KAAKga,QACdsnB,WAAYthC,KAAKshC,aAElBthC,KAAKga,QAAQ5X,GAAG,QAAS,iBAAkB,SAAUgE,GACpDA,EAAE2kB,iBACF3kB,EAAEokB,kBACF,IAAIpY,EAAOtS,EAAEE,MAAM6L,OAAOuG,KAG1B,OAFAA,EAAOwmB,mBAAmBxmB,GAC1BlH,EAAGk2B,QAAQp6B,KAAKoL,IACT,MAKV/U,OAAOsX,MAAM4tB,YAAcv3B,MAAMjL,OAAO,CACvCkL,KAAM,SAAUpL,GACfC,EAAEC,OAAOC,KAAMH,GACf,IAAIqL,EAAKlL,KAETA,KAAKwiC,UAAYxiC,KAAKijB,WACtBjjB,KAAKwiC,UAAU9+B,KAAK,WACnBwH,EAAGu3B,aAGLA,QAAS,WAGR,GADAziC,KAAK0iC,UAAY5iC,EAAE,gBACW,IAA1BE,KAAK0iC,UAAUp5B,OAAc,CAChC,IAAIq5B,EAAOtlC,OAAOmE,gBAAgB,kBAClCxB,KAAK0iC,UAAY5iC,EAAE6iC,GAAMlhC,SAAS,UAGpC4/B,mBAAoB,SAAUuB,EAAQC,cACjC33B,EAAKlL,KAQT,OANI4iC,IAEH5iC,KAAKqf,MAAQrf,KAAKqf,MAAMxS,OAAO+1B,GAC/B5iC,KAAKshC,WAAauB,GAGZ,IAAIv/B,iBAAQC,GAClBL,IAAMmc,EAAQrf,EAAKqf,MAAMre,IAAI,SAAUiL,GACtC/I,IAGI4/B,EAAOC,EAHLC,EAAQ,kBAAoB/2B,EAAE01B,MAAQ,KACxClV,EAAKvhB,EAAGhF,QAAQvE,KAAKqhC,GAAOp9B,IAAI,GAcpC,OAXI6mB,IACHqW,EAAQrW,EAAGwW,aACXF,EAAStW,EAAGyW,eAGRzW,IAEJqW,GADArW,EAAKvhB,EAAGhF,QAAQvE,KAAK,2BAA6BsK,EAAE01B,MAAQ,MAAM/7B,IAAI,IAC3Du9B,wBAAwBL,MACnCC,EAAStW,EAAG0W,wBAAwBJ,QAG9B,CACNK,IAAKn3B,EAAE+0B,WACPqC,KAAMp3B,EAAE+0B,WACR5uB,KAAMnG,EAAEmG,KACRkxB,EAAGR,EACHS,EAAGR,EACHtW,GAAIA,KAGNzsB,EAAKwjC,WAAankB,EAClB9b,OAGFyD,KAAM,SAAUuK,cACfvR,KAAKwiC,UACH9+B,uBAAW1D,EAAKqhC,uBAChB39B,uBAAW1D,EAAKyjC,MAAMlyB,MAEzBkyB,MAAO,SAAUlyB,GAChBrO,IAAMgI,EAAKlL,KACLqf,EAAQrf,KAAKwjC,WAGfv+B,EAAU,CACbgnB,MAHkB5M,EAAMmM,mBAAU7f,UAAQA,EAAKyG,OAASb,IAIxDmyB,iBAAkB,SAAUzX,GAC3B/oB,IAAM8/B,EAAQ,kBAAoB3jB,EAAM4M,GAAO0V,MAAQ,KACnDgC,EAAYz4B,EAAGhF,QAAQvE,KAAKqhC,GAAOp9B,IAAI,GAE3C,GAAK+9B,EAAL,CAIA,IAAIC,EAAc36B,OAAO46B,aAAejrB,SAASkrB,gBAAgBC,UAChEC,EAAOL,EAAUR,wBAElB,MAAO,CACNc,EAAGD,EAAK3d,KACR6d,EAAGF,EAAKG,IAAMP,EACdN,EAAGU,EAAKlB,SAGVlS,SAAS,EACTwT,SAAS,EACTC,iBAAiB,GAIlBrkC,KAAK2iC,KAAO,IAAI2B,WACftkC,KAAK0iC,UAAU98B,IAAI,GACnB2+B,qBACAllB,EACApa,GAEDjF,KAAKwkC,gBACLxkC,KAAK2iC,KAAK13B,QAEXu5B,cAAe,sBACRC,EAAczkC,KAAK0iC,UAAU/gC,KAAK,qBAClC2/B,EAAathC,KAAKshC,WACpBoD,EAAoB,KAuCxB,SAASC,IACRC,aAAaF,GAMbD,EAAYz9B,OAJZ09B,EAAoBjzB,WAAWozB,EAAiB,KAOjD,SAASA,IACRJ,EAAY7gC,OAGb,SAASkhC,EAAS1B,GACjB,0DACaA,qBArDdpjC,KAAK2iC,KAAKoC,OAAO,cAAe,WAC/B7hC,IAAM8hC,EAAS1D,EAAWthC,KAAKilC,SAAS7yB,MACxC,GAAK4yB,GAA4B,IAAlBA,EAAO17B,OAAtB,CAKAq7B,IACAzhC,IAAMgE,EAAO89B,EAAOhkC,IAAI8jC,GAAU1gC,KAAK,IACvCqgC,EAAYv9B,KAAKA,QANhBu9B,EAAYv9B,KAAK,MASnBlH,KAAK2iC,KAAKoC,OAAO,eAAgBF,GACjC7kC,KAAK2iC,KAAKoC,OAAO,iBAAkBF,GACnC7kC,KAAK2iC,KAAKoC,OAAO,qBAChBjlC,EAAE8Y,UAAUssB,IAAI,YAAaP,KAI9BF,EAAYriC,GAAG,QAAS,4BAAqBgE,GAC5ClD,IAAMiiC,EAAS/+B,EAAE4K,OACXib,EAAQjsB,EAAK2iC,KAAKtjB,MAAMmM,mBAAUvf,UAAKA,EAAEmG,OAASpS,EAAK2iC,KAAKsC,SAAS7yB,OAE3EpS,EAAK2iC,KAAKyC,KAAKnZ,GACfjsB,EAAK2iC,KAAKtjB,MAAMlQ,OAAO8c,EAAO,EAAG,CAChCmX,IAAK+B,EAAO/B,IACZE,EAAG6B,EAAOlC,aACVM,EAAG4B,EAAOjC,cACV9wB,KAAMpS,EAAK2iC,KAAKsC,SAAS7yB,OAE1BpS,EAAK2iC,KAAK0C,sBACVrlC,EAAK2iC,KAAK2C,YAAW,KAItBxlC,EAAE8Y,UAAUxW,GAAG,YAAauiC,IAsB7B1hB,SAAU,WACT,OAAO,IAAI3f,iBAAQC,GAClB,IAAIgiC,EAAY,mCAChBloC,OAAO8lB,QAAQ,CACdoiB,EAAY,iBACZA,EAAY,mBACZA,EAAY,gBACZA,EAAY,4BACVhiC,QCzVNlG,OAAOqX,QAAQ,gBAEfrX,OAAOsX,MAAMkhB,WAAa,cAAyBx4B,OAAOsX,MAAMkM,SAC/DjhB,wBACCsD,IAAM4d,EAAQzjB,OAAO0jB,YACrB,GAAqB,IAAjBD,EAAMxX,OAAc,CACvBpG,IAAM3F,EAAUujB,EAAM,GAChBhL,EAAgBzY,OAAO0Y,kBAAkBxY,GAAiB,QAAK,GACrE,OAAKuY,EAAc0vB,mBASnB1kB,EAAMzgB,KAAKyV,EAAc0vB,mBACzBnoC,OAAOmX,UAAUsM,IACV,IAVNzjB,OAAOihB,SAAS,CACfG,MAAOvgB,GAAG,SACVkB,UAAW,MACX+R,QAASjT,GAAG,yCAEbb,OAAOmX,UAAU,OAAQjX,EAAS,SAC3B,GAMT,OAAO,EAGR6jB,gBACC,MAAO,SAGRxhB,4BACC,OAAOqhB,MAAM/L,iBACXxR,gBAYA,OAXA1D,EAAKylC,WAAapoC,OAAO0jB,YAAY,GACrC/gB,EAAK4V,WAAa1X,GAAG8B,EAAKylC,YAC1BzlC,EAAK0lC,UAAY1lC,EAAK2lC,gBAEtB3lC,EAAK0W,WAAWrW,KAAK,CACpBgH,MAAOnJ,GAAG,gBACVuY,kBACCzW,EAAK4lC,+BAIA5lC,EAAK6lC,cAIfjmC,uBACC,OAAOvC,OAAOgrB,GAAGpK,QAAQ,eAAgBje,KAAKylC,YAC5C/hC,cAAKoiC,GACL9lC,EAAK8lC,MAAQA,EACb9lC,EAAK8lC,MAAMC,cAAgB/zB,KAAKC,MAAMjS,EAAK8lC,MAAM98B,SAAW,MAC5DhJ,EAAKgJ,QAAUhJ,EAAK8lC,MAAMC,gBAI7BnmC,kBAIAA,aACCI,KAAKspB,yBAGN1pB,aACCqhB,MAAMrK,aACN5W,KAAK+W,WAAW/W,KAAK0lC,UAAU5uB,aAGhClX,gBACCvC,OAAOG,MAAMsY,cAAcmP,KAAKjlB,KAAKzC,QAAS,YAAayC,KAAKohB,WAChEphB,KAAKklB,wBAAwB,CAC5BsgB,kBAAmBxlC,KAAKylC,aAI1B7lC,eAIAA,mBACKoS,KAAKc,UAAU9S,KAAK8lC,MAAMC,iBAAmB/zB,KAAKc,UAAU9S,KAAKwZ,YAAY5T,OAChF5F,KAAKsX,KAAK0uB,cAAc9nC,GAAG,aAAc,UAEzC8B,KAAKsX,KAAK2uB,kBAIZrmC,uCACOoJ,EAAUhJ,KAAKwZ,YAAY5T,MAEjCvI,OAAOkT,KAAK,CACXC,OAAQ,6DACRzG,KAAM,CACL07B,WAAYzlC,KAAKylC,WACjBz8B,QAASA,KAERtF,cAAKiN,GACHA,EAAE8B,IACLpV,OAAOijB,WAAW,CACjBlhB,UAAW,MACX+R,QAASjT,GAAG,wCAIdb,OAAOijB,WAAW,CACjBlhB,UAAW,QACX+R,QAASjT,GAAG,mBAGb8B,EAAK8lC,MAAMC,cAAgB/8B,EAC3BhJ,EAAKwc,sBAIP5c,aAEC,OADAI,KAAKoW,OAAO/V,KAAK,CAACL,KAAK8lC,MAAMI,WAAYlmC,KAAK8lC,MAAM1Y,oBAC7CnM,MAAMzG,aAGd5a,SACCsD,IAAMuiC,EAAazlC,KAAKylC,WACpBzlC,KAAKmmC,QAAUV,IAAezlC,KAAKmmC,OAAOV,WAC7CzlC,KAAKmmC,OAAO57B,OAAOvK,KAAK6L,MAIzB7L,KAAKmmC,OAAS,IAAI9oC,OAAOsX,MAAMyxB,YAAY,CAC1C7oC,QAASyC,KAAKzC,QACduoC,MAAO9lC,KAAK8lC,MACZL,WAAYA,EACZY,MAAOrmC,KAAK6L,KACZ65B,UAAW1lC,KAAK0lC,UAChBx/B,QAASlG,KAAKga,QACd8V,SAAU9vB,KACV8V,cAAe9V,KAAKqhB,qBAItBzhB,gBACC,IAAI9B,EAAOT,OAAOwY,SAAS7V,KAAKzC,SAC5BS,EAAMX,OAAOG,MAAMiiC,YAAYz/B,KAAKzC,SACpCuZ,EAAc,KACdwvB,GAAc,EAEdtmC,KAAKlC,KAAKgZ,cACbA,EAAczZ,OAAOS,KAAKyoC,UAAUvmC,KAAKzC,QAASyC,KAAKlC,KAAKgZ,cAG7D9W,KAAKlC,KAAKsY,OAAOvO,iBAAS5E,GAExBuE,QAAQ,CAAC,OAAQ,OAAQ,aAAc,eAAgBvE,EAAGH,aACtDG,EAAGQ,SAEeqT,IAEtBA,EAAc7T,KAKhB,IAAIujC,EAAY1oC,EAAKsY,OAAOlV,gBAAQ+B,UAAOA,EAAG0F,OAAS3K,EAAIiF,EAAGhB,aAU9D,OARIukC,EAAU/X,cAAKxrB,UAAM5F,OAAOG,MAAM+O,aAAaxJ,SAASE,EAAGH,cAAe0jC,EAAUl9B,OAAS,KAChGg9B,GAAc,GAGVxvB,IACJA,EAAczZ,OAAOS,KAAKyoC,UAAUvmC,KAAKzC,QAAS,SAG5C,CACN+oC,YAAaA,EACbxvB,YAAaA,GAIfoM,oBACC,MAAO,CACN,sCACA,0DAMH7lB,OAAOsX,MAAMkhB,WAAWC,0BAA4B,SAASv4B,EAASq4B,GA6H7Dv4B,OAAOkT,KAAK,kEAAmE,SAAEhT,IACtFmG,cAAKiN,UAAKA,EAAEQ,UA3HbzN,cAAM+iC,GACDA,IAEL3mC,EAAE,8CAA8C2B,SAASm0B,GAEzD6Q,EAAc5+B,iBAAQi+B,GACrB5iC,IAAM4d,EAAQ,CAAC,OAAQglB,EAAM1Y,kBAAmB,SAAU0Y,EAAM1zB,MAAMhO,KAAK,KAE3EtE,+BACaghB,2BACH5iB,GAAG4nC,EAAM1zB,6BAChB0zB,EAAMY,QAAU,gDAAkD,iDAGlEjlC,SAASm0B,QAIfA,EAAUxzB,GAAG,QAAS,+BACNukC,IACR3/B,SAuBRrE,IAAI4b,EAAS,KAEb,SAASooB,IACR,GAAIpoB,EAAQ,OAAOA,EAEnBrb,IAAMkT,EAkBP,WAECzT,IAAIyT,EAAS,CAAC,CACbtT,UAAW,OACXb,UAAW,aACXoF,MAAOnJ,GAAG,qBACVyK,KAAM,EACND,YAAa,CAAC,OAAQ,QAAQ3F,SAASxF,GACtCW,GAAG,qCAAuC,KAG5B,SAAZX,GACH6Y,EAAO/V,KAAK,CACXyC,UAAW,OACXb,UAAW,UACXoF,MAAOnJ,GAAG,WACV+G,QAAS,YAIX/B,IAAM0jC,EACLvpC,OAAOwY,SAAStY,GAAS6Y,OACvBlV,gBAAO+B,GACP,MAAwB,WAAjBA,EAAGH,WACQ,kBAAjBG,EAAGhB,YAGH2kC,EAAct9B,OAAS,EAC1B8M,EAAO/V,KAAK,CACXyC,UAAW,SACXb,UAAW,aACXoF,MAAOnJ,GAAG,oBACV+G,QAAS2hC,EAAc5lC,aAAIiC,UAAQoE,MAAOpE,EAAGoE,MAAO9I,MAAO0E,EAAGhB,aAC9Dsb,QAASqpB,EAAc,GACvBj+B,KAAM,IAGPyN,EAAS,CAAC,CACTtT,UAAW,OACXmC,+EAGI/G,GAAG,gOAEmEX,uBACrEW,GAAG,qEAOV,OAAOkY,EAtEQywB,GAEXtmB,EAAuBnK,EAAO9M,OAAS,EAAIpL,GAAG,QAAU,GACxDqY,EAAiBH,EAAO9M,OAAS,WACnChJ,IA7BH,SAA2BmlC,EAAYS,EAAYY,GAClD,OAAOzpC,OAAOkT,KAAK,CAClBC,OAAQ,mEACRzG,KAAM,SACLxM,aACAkoC,aACAS,UACAY,GAEDp2B,SAAU,SAASC,GAClB,IAAIo2B,EAAKp2B,EAAEQ,QACP41B,EAAG/9B,UACN3L,OAAOqX,QAAQ,yBACfrX,OAAO2pC,eAAeD,EAAGE,mBAAqBF,EAAG/9B,SAElD3L,OAAOmX,UAAU,OAAQjX,EAAS,SAAUwpC,EAAGE,uBAe/CC,sCACExjC,uBAAW6a,EAAO3a,iBAASujC,UAAQ9pC,OAAOihB,SAAS6oB,MAClD,KAQL,OANA5oB,EAAS,IAAIlhB,OAAOqC,GAAG8e,OAAO,CAC7BC,MAAOvgB,GAAG,2BACVkY,uBACAmK,iBACAhK,MCrPHlZ,OAAOqX,QAAQ,gBAEfrX,OAAOsX,MAAMyyB,UAAY,cAAwB/pC,OAAOsX,MAAMkM,SAC7DjhB,wBACCsD,IAEK8xB,EAFClU,EAAQzjB,OAAO0jB,YACrB,OAAKD,EAAM,IAAMzjB,OAAOsK,KAAKgtB,eAAerrB,QAG1C0rB,EAD6C,gBAA1C33B,OAAOsK,KAAKgtB,eAAe,GAAG6B,SACjB,eAEAn5B,OAAOsK,KAAKgtB,eAAe,GAAGK,cAE/C33B,OAAOmX,UAAU,OAAQ,gBAAiB,QAASwgB,IAC5C,IACIlU,EAAM,KAAoB,iBAAbA,EAAM,IAK/B,SAAkBkU,GACjB,OAAO33B,OAAOsK,KAAKgtB,eAAehzB,cAAK+K,UAAKA,EAAEsoB,gBAAkBA,IANRpX,CAASkD,EAAM,MACvEzjB,OAAO6M,MAAMhM,GAAG,gGAEV,GAORkjB,gBACC,MAAO,QAGRxhB,OACCqhB,MAAMja,OAENhH,KAAKklB,wBAAwB,CAC5BmiB,mBAAoBrnC,KAAKsnC,wBAI3B1nC,iBACCqhB,MAAM/L,iBAGNlV,KAAKqW,QAAUrW,KAAKqhB,mBAAmBhL,SAAW,qBAClDrW,KAAKsW,WAAatW,KAAKqhB,mBAAmB/K,YAAc,OAExDtW,KAAKg1B,cAAgB33B,OAAO0jB,YAAY,GACxC/gB,KAAK4V,WAAa5V,KAAKg1B,cACvBh1B,KAAKgJ,QAAUhJ,KAAKunC,oBAGrB3nC,gBAECI,KAAK+jB,QAAU,GACf/jB,KAAK+jB,QAAQ1jB,KAAK,CACjB4jB,KAAM,UACNhhB,GAAI,CACHoE,MAAOnJ,GAAG,WACV+D,UAAW,aAGbjC,KAAK+jB,QAAQ1jB,KAAK,CACjB4jB,KAAM,QACNhhB,GAAI,CACHoE,MAAOrH,KAAKwnC,eAAiBtpC,GAAG,MAAQA,GAAG,QAC3C+D,UAAWjC,KAAKwnC,eAAiB,aAAe,YAKnD5nC,eAAe5B,GAKd,OAHCkZ,QAAQlZ,EAAI6qB,OAAS7W,KAAKC,MAAMjU,EAAIwqB,OAAS,MAAMzlB,SAAS1F,OAAOuU,QAAQC,MACxE,GACA,OAIL21B,qBACCtkC,IAAM2C,EAAI7F,KAAKwZ,YAAY5T,MACzBjE,cAAKT,SAAwB,qBAAdA,EAAO,KACxB,OAAO2E,GAAc,SAATA,EAAE,GAGfjG,gBACCI,KAAKga,QAAQrY,KAAK,kBAAkBU,SACpCrC,KAAKga,QAAQwI,QAAQxiB,KAAK8kB,mBAG3BllB,SACCI,KAAKyjB,gBACLzjB,KAAK0jB,gBACL1jB,KAAKolB,cACLplB,KAAKqlB,iBACLrlB,KAAKslB,eACLtlB,KAAKulB,cAGN3lB,cAAc6nC,GACbvkC,IAAMwkC,EAAaD,EAAME,gEACyBzpC,GAAG,+BAAgC,GAE/E0pC,EAAYvqC,OAAOiC,MAAMmoB,cAAcggB,EAAMra,kBAAmBqa,EAAMI,gBACtE7c,EAAOyc,EAAMra,mBAAqBqa,EAAMra,oBAAsBptB,KAAKzC,4CACpCqqC,uBAC1B1pC,GAAG,kBAAmB,CAACupC,EAAMra,kFAE/B,GAEH0a,EAAqBhgB,aAAa2f,EAAMK,oBAAoB,GAMlE,qEAEI9c,eACA0c,gBAPa,UAAhBD,EAAMpoC,oDAAkEnB,GAAGupC,EAAMpoC,oBAChE,WAAhBooC,EAAMpoC,yDAAwEnB,GAAGupC,EAAMpoC,oBACtF,iBAOCyoC,yBAKLloC,oBACC,IAAIo1B,EAAgBh1B,KAAKg1B,cACrBtX,EAAkB,CACrB,CAAC,gBAAiB,qBAAsB,IAAK,iBAAiB,GAC9D,CAAC,gBAAiB,uBAAwB,IAAK,SAAS,IAErD1U,EAAU,GACd,GAAsB,SAAlBgsB,EACHhsB,EAAU0U,EAAgB7Q,OAAO,CAChC,CAAC,gBAAiB,mBAAoB,IAAK,QAAQ,GACnD,CAAC,gBAAiB,eAAgB,SAAU,cAAc,UAErD,GAAIrF,QAAQ,CAAC,OAAQ,SAAUwtB,GACrChsB,EAAU0U,EAAgB7Q,OAAO,CAChC,CAAC,gBAAiB,eAAgB,IAAKmoB,GAAe,GACtD,CAAC,gBAAiB,gBAAiB,KAAM33B,OAAOsK,KAAKogC,cAAc,SAE9D,CACN,IAAIC,EAAK,IACY,gBAAjBhT,IACHgT,EAAK,KACLhT,EAAgB33B,OAAOsK,KAAKogC,cAG7B/+B,EAAU0U,EAAgB7Q,OAAO,CAChC,CAAC,gBAAiB,mBAAoB,IAAK,YAAY,GACvD,CAAC,gBAAiB,SAAU,IAAK,QAAQ,GACzC,CAAC,gBAAiB,gBAAiBm7B,EAAIhT,GAAe,GACtD,CAAC,gBAAiB,eAAgB,SAAU,cAAc,KAI5D,OAAOhsB,EAGRpJ,wBACC,IACImK,EADAirB,EAAgBh1B,KAAKg1B,cAEzB,OAAIxtB,QAAQ,CAAC,OAAQ,SAAUwtB,GACvB92B,GAAG,cAAe,CAAC82B,KAU1BjrB,EATWirB,GAAkB33B,OAAOsK,KAAKgtB,eAAerrB,OASjD,CACN/L,QAAS,gBACT0qC,IAAK/pC,GAAG,aACRmJ,MAAOnJ,GAAG,kBAVJ,CACNX,QAAS,gBACT0qC,IAAK/pC,GAAG,oBACRmJ,MAAOnJ,GAAG,2EAWCb,OAAOG,MAAM0Y,WAAWnM,EAAKxM,eACnCwM,iGAGFA,wDAIG7L,GAAG,8DASZ0B,eACMI,KAAKg1B,eAAkB33B,OAAOsK,KAAKgtB,eAAerrB,OAMtD,IAAIjM,OAAOsX,MAAMuzB,sBAAsB,CACtClqC,IAAK,MANNX,OAAOmnB,cAAgB,CACtBgS,SAAYn5B,OAAOuU,QAAQu2B,YAE5B9qC,OAAOmmB,QAAQ,oBR5MlBnmB,OAAOqX,QAAQ,gBAEfrX,OAAOsX,MAAMyzB,SAAW,cAAuB/qC,OAAOsX,MAAMkM,SAC3DjhB,wBAEC,GAAqB,IADPvC,OAAO0jB,YACXzX,OAAc,CACvBpG,IAAMme,EAAqBhkB,OAAO0Y,kBAAkB,OAAQ,QAE5D,OADA1Y,OAAOmX,UAAU,OAAQ,OAAQ6M,EAAmBgnB,aAAehrC,OAAOsK,KAAK2gC,cACxE,EAER,OAAOvV,oCAGR3R,gBACC,MAAO,OAGRxhB,OACMmzB,qCACJ9R,MAAMja,OAIRpH,aACCI,KAAK0jB,gBACL1jB,KAAK4jB,eAGNhkB,kBACCsD,IAAM4d,EAAQzjB,OAAO0jB,YACrBD,EAAM3R,QAAQ,GAEM,SADA2R,EAAMA,EAAMxX,OAAS,IAGzCjM,OAAO+a,YAAY/F,IAAI,CACtB4R,KAAM,SACN5c,MAAOnJ,GAAG,QACV4iB,MAAO,oBAITlhB,4BACC,OAAOqhB,MAAM/L,iBACXxR,gBACA1D,EAAK4V,WAAa1X,GAAG,gBAErBgF,IAAM4d,EAAQzjB,OAAO0jB,YACrB/gB,EAAKuoC,eAAiBznB,EAAM/V,MAAM,GAAG3G,KAAK,KAC1CpE,EAAKgJ,QAAU,CAAC,CAAC,OAAQ,SAAU,IAAKhJ,EAAKuoC,gBAAgB,IAC7DvoC,EAAK0a,SAAW1a,EAAKqhB,mBAAmB3G,UAAY,gBAEpD1a,EAAK0W,WAAa1W,EAAK0W,WAAW7J,OAAO7M,EAAKwoC,qBAIjD5oC,6BAqEC,MApEc,CACb,CACCyH,MAAOnJ,GAAG,QACVuY,kBACCpZ,OAAOmX,UAAU,OAAQ,OAAQ,UAGnC,CACCnN,MAAOnJ,GAAG,OACVuY,kBACCpZ,OAAOorC,aAAaC,IAAI1oC,EAAK2b,oBAAqB3b,EAAKuoC,iBAExD5xB,MAAO,wBAER,CACCtP,MAAOnJ,GAAG,SACVuY,kBACCpZ,OAAOorC,aAAaE,MAAM3oC,EAAKuoC,iBAEhC5xB,MAAO,0BAER,CACCtP,MAAOnJ,GAAG,cACVuY,kBACCpZ,OAAOurC,OAAO1qC,GAAG,iBAAUsd,GACtBA,EAAOjd,MAAM8J,QAAQ,MAAQ,GAChChL,OAAO6M,MAAMhM,GAAG,+CAEjBgF,IAAM2I,EAAQ,CACbg9B,UAAWrtB,EAAOjd,MAClBuqC,OAAQ9oC,EAAKuoC,gBAEdlrC,OAAOkT,KAAK,CACXC,OAAQ,kDACRzG,KAAM8B,KAEL3N,GAAG,qBAAsBA,GAAG,aAGjC,CACCmJ,MAAOnJ,GAAG,oBACVuY,kBACCpZ,OAAOsX,MAAMyzB,SAASW,WAAa1rC,OAAOsX,MAAMyzB,SAASW,UACzD/oC,EAAKiG,YAGP,CACCoB,MAAOnJ,GAAG,cACVuY,kBACC,IAAIpZ,OAAOqC,GAAGspC,aAAa,CAC1BF,OAAQ9oC,EAAKuoC,eACbU,aAAc,CACbC,mBAAoB,CAAC,SAEtBC,oBAAYC,GACX/rC,OAAOijB,WAAWpiB,GAAG,uBACrBb,OAAOkT,KAAK,2CAA4C,CAAE6B,KAAMg3B,EAAKh3B,OACnE1O,cAAMiN,GACFA,EAAEQ,SACL9T,OAAOijB,WAAWpiB,GAAG,qBAAsB,CAACyS,EAAEQ,mBAYvDvR,aACCI,KAAKoW,OAASpW,KAAKlC,KAAKsY,OACtBlV,gBAAO+B,UAAM5F,OAAOG,MAAMwZ,cAAc/T,EAAGH,aAAeG,EAAGQ,SAC7DzC,aAAIiC,UAAMA,EAAGhB,YACb4K,OAAO,CAAC,OAAQ,WAAY,aAG/BjN,aAAaiM,cACZoV,MAAMhG,aAAapP,GAEnB7L,KAAK6L,KAAO7L,KAAK6L,KAAK7K,aAAI0L,UAAK1M,EAAKqpC,cAAc38B,KAIlC,cADI1M,KAAK2Z,uBAExB3Z,KAAK6L,KAAKoB,cAAMif,EAAGC,GAClB,OAAID,EAAEod,YAAcnd,EAAEmd,WACb,GAEJpd,EAAEod,WAAYnd,EAAEmd,UACb,EAED,IAKV1pC,cAAc8M,GACb/J,IAAI4mC,EAAa,GAEhBA,EADG78B,EAAE48B,UACQ,iCACHjsC,OAAOiC,MAAMkqC,cAAc98B,EAAEm8B,WAC1B,6BAEA,4BAGdlmC,IAAI8b,EAAQ/R,EAAEm8B,WAAan8B,EAAE+8B,SAU7B,OATAhrB,EAAQA,EAAM1T,MAAM,EAAG,IACvB2B,EAAEg9B,OAASjrB,EACX/R,EAAE68B,WAAaA,EAEf78B,EAAEsZ,aAAe,qBACJujB,yDACJ9qB,qBACN/R,EAAEi9B,WAAa,gDAAkD,aAE7Dj9B,EAGR9M,gBACCqhB,MAAM9F,gBACN9d,OAAOG,MAAMsY,cAAcmP,KAAK,OAAQ,YAAa5nB,OAAOsX,MAAMyzB,SAASW,WAC3E/oC,KAAKklB,wBAAwB,CAC5BmjB,YAAaroC,KAAKuoC,iBAIpB3oC,SACCI,KAAKga,QAAQ1X,YAAY,aACrBjF,OAAOsX,MAAMyzB,SAASW,UACzB/oC,KAAK4pC,mBAEL3oB,MAAM7F,SAIRxb,uBACKsH,SAEJA,EAAOlH,KAAK6L,KAAK7K,aAAI0L,GACpB,4BACY1M,EAAK6pC,cAAcn9B,8IAGZA,yGAEmBA,4DAIpCtI,KAAK,IACRpE,KAAKga,QAAQxW,SAAS,aACtBxD,KAAKga,QAAQ9S,KAAKA,GAGnBtH,uBACCsD,IACM4mC,EADQzsC,OAAO0jB,YACChW,MAAM,GAE5B,OAAO++B,EACL9oC,aAAK8nC,EAAQ78B,GACb,OAAIA,IAAM69B,EAAQxgC,OAAS,WACVw/B,wBAEHgB,EAAQptB,gBAAQqtB,EAAKC,EAAMza,GAIxC,OAHIA,GAAKtjB,IACR89B,GAAO,IAAMC,GAEPD,GACL,mBAE0BjB,WAG7B/9B,OAAO,GACP3G,KAAK,iBAGRxE,kBACCsD,IAAM+mC,EAAmBjqC,KAAKkqC,uBAE1BlkB,EAAe,4IAE2D9nB,GAAG,sDACpD+rC,+FAGnB/rC,GAAG,qGAGHA,GAAG,yCAIb,OAAO8B,KAAKomB,yBAAyBJ,EAAc,oCAGpDpmB,cAAcwpC,GACb,OAAOA,EAAKE,UAAY,cAAgBF,EAAKh3B,KAAOpS,KAAKynB,cAAc2hB,GAGxExpC,cAAcwpC,GAEblmC,IAGIinC,EAHEC,GADNhB,EAAOppC,KAAKqpC,cAAcD,IACHgB,UAAY/sC,OAAOyI,KAAKkhB,WAAWqjB,SAASjB,EAAKgB,WAAa,GAC/EE,EAAYtqC,KAAK6pC,cAAcT,KAGtBA,EAAKmB,SAAS/hC,MAAM,QAOnC,OALC2hC,EADGzM,IAASrgC,OAAOqtB,SAAS8f,WACf1iB,aAAashB,EAAKmB,UAElBltC,OAAOqtB,SAAS+f,YAAY/M,+JAK2C0L,gEACvCA,uDACfkB,cAAqBlB,+BAC9CA,iJAKIgB,0GAGAD,gCAKXvqC,eAAewpC,GACd,qEAEIthB,aAAashB,EAAKvhB,iCAKvBjoB,eACCqhB,MAAM2C,eACN5jB,KAAK0qC,kBAGN9qC,6BACCI,KAAKga,QAAQ5X,GAAG,sBAAsB,GACpCA,GAAG,gBAAQgE,GACX,IAAIukC,EAAevkC,EAAE0F,cAAc6+B,aAC7BA,GAAgBA,EAAaC,OAASD,EAAaC,MAAMthC,OAAS,IAGxElD,EAAEokB,kBACFpkB,EAAE2kB,iBAEF,IAAI1tB,OAAOqC,GAAGspC,aAAa,CAC1B4B,MAAOD,EAAaC,MACpB9B,OAAQ9oC,EAAKuoC,oBAKjB3oC,qBACCqhB,MAAM/F,qBACNlb,KAAK6qC,2BAGNjrC,iBACCqhB,MAAMoE,iBACNrlB,KAAK6qC,2BAGNjrC,2BAECsD,IAAM4nC,EAAa9qC,KAAKsX,KAAKyzB,eAAeppC,KAAK,uBACnCtE,OAAOorC,aAAauC,WACjC3tC,OAAOorC,aAAawC,aAAejrC,KAAKuoC,eAGxCuC,EAAWtnC,SAAS,QAEpBsnC,EAAWxoC,YAAY,QAIxBY,IAAMgoC,EAAWlrC,KAAKsX,KAAKyzB,eAAeppC,KAAK,oBAC3C3B,KAAKusB,SAAWvsB,KAAKusB,QAAQjjB,OAAS,EACzC4hC,EAAS5oC,YAAY,QAErB4oC,EAAS1nC,SAAS,UAKrBnG,OAAOsX,MAAMyzB,SAASW,UAAY1rC,OAAO0Y,kBAAkB,QAAQgzB,YAAa,ES7VhF1rC,OAAOqX,QAAQ,4BACfrX,OAAOqX,QAAQ,sBACfzL,OAAOkiC,SAAW,KAElB9tC,OAAOsX,MAAMy2B,YAAc,cAA0B/tC,OAAOsX,MAAMqb,QACjEpwB,KAAKkhB,GACJzjB,OAAOG,MAAMswB,aAAahN,EAAM,GAAI,WACnC,IAAI7b,EAAU,CACb1H,QAASujB,EAAM,GACfhjB,KAAMT,OAAOwY,SAASiL,EAAM,KAG7B,IAAKzjB,OAAOu3B,kBAAkB9T,EAAM,MAAQzjB,OAAOS,KAAKilB,aAAajC,EAAM,GAAI,YAE9E,OADAzjB,OAAOihB,SAASpgB,GAAG,kCAAmC,CAAC4iB,EAAM,OACtD,EAERhhB,EAAEC,OAAOkF,EAAS5H,OAAOu3B,kBAAkB9T,EAAM,KAAO,IACxDzjB,OAAOsX,MAAM6a,MAAMvqB,EAAQ1H,SAAW,IAAIF,OAAOsX,MAAM02B,SAASpmC,OAKnE5H,OAAOsX,MAAM02B,SAAWrgC,MAAMjL,OAAO,CACpCkL,KAAM,SAASpL,GAGdG,KAAKH,KAAO,GACZG,KAAKH,KAAKyrC,eAAgB,EAC1BtrC,KAAKH,KAAK0rC,iBAAkB,EAC5BzrC,EAAEC,OAAOC,KAAKH,KAAMA,GACpBG,KAAKzC,QAAUsC,EAAKtC,QACpByC,KAAK+J,KAAO,CAACxM,QAPJyC,KAOgBzC,SACzByC,KAAK0V,UAAYrY,OAAOsY,gBACxB3V,KAAKwrC,eATIxrC,KASiBH,KAAK2rC,gBAAkB,oCAEjDxrC,KAAKyrC,kBACLzrC,KAAKswB,YACLtwB,KAAK0rC,eAbI1rC,KAeFH,KAAKyrC,eACXtrC,KAAK2rC,WAGN3rC,KAAK6jB,SACL7jB,KAAK4rC,gBACL5rC,KAAK2e,sBAEN8sB,gBAAiB,WAChBzrC,KAAKq8B,SAAWh/B,OAAOG,MAAM6+B,SAASr8B,KAAKzC,SAC3CyC,KAAKkW,YAAoE,IAAvD7Y,OAAOsK,KAAKkK,KAAKqE,WAAW7N,QAAQrI,KAAKzC,WACF,IAAtDF,OAAOsK,KAAKkK,KAAKg6B,UAAUxjC,QAAQrI,KAAKzC,SAC3CyC,KAAKmW,UAAY9Y,OAAOG,MAAM2Y,UAAUnW,KAAKzC,SAC7CyC,KAAKmvB,WAAa9xB,OAAOG,MAAM2xB,WAAWnvB,KAAKzC,UAEhD+yB,UAAW,WACV,IAAIplB,EAAKlL,KAqBT,GApBAA,KAAK0B,OAASrE,OAAOoX,UAAUq3B,SAAS9rC,KAAK0V,WAC7CrY,OAAOqC,GAAGqsC,cAAc,CAACrqC,OAAO1B,KAAK0B,OAAQsqC,eAAc,IAE3DhsC,KAAKsX,KAAOtX,KAAK0B,OAAO4V,KACxBja,OAAOoX,UAAU4b,UAAUrwB,KAAK0V,WAChCrY,OAAO+a,YAAY/F,IAAInH,EAAGrL,KAAKosC,YAAcxtC,OAAOytC,QAAQhhC,EAAG3N,SAAS8a,OAAQnN,EAAG3N,SAEnFyC,KAAK0X,YAEL1X,KAAKsX,KAAKiC,KAAKhH,IAAI,CAClB45B,aAAc,QACdC,iBAAkB,SAGhBpsC,KAAKH,KAAK0rC,iBACZvrC,KAAKsX,KAAK+0B,iBAAiBnuC,GAAG,cAAe,WAC5CgN,EAAGukB,KAAK6c,cAAcphC,EAAGukB,KAAK8c,WAAW,KAIxCvsC,KAAKH,KAAK2sC,cAAe,CAC3B,IAAIC,EAAM3sC,EAAE,0BAA0B2B,SAASzB,KAAKsX,KAAKiC,MACzDvZ,KAAK6Y,KAAO/Y,EAAE,0CAA0C2B,SAASgrC,GACjEzsC,KAAK0sC,UAAY5sC,EAAE,0CAA0C2B,SAASgrC,QAEtEzsC,KAAK6Y,KAAO7Y,KAAKsX,KAAKiC,MAGxB7B,UAAW,WACV1X,KAAKsX,KAAKI,UAAU1X,KAAKH,KAAK4e,OAASvgB,GAAG,WAAY,CAACA,GAAG8B,KAAKzC,aAEhEsmB,OAAQ,WAEP7jB,KAAKH,KAAKgkB,QAAU7jB,KAAKH,KAAKgkB,OADrB7jB,OAGV0rC,aAAc,WACb,IAAIxgC,EAAKlL,KACT3C,OAAOu3B,kBAAkB5rB,QAAU,GACnClJ,EAAEwM,KAAKtM,KAAKH,KAAKmJ,SAAW,GAAI,SAASiD,EAAG/K,GACvC7D,OAAOmnB,eAAiBnnB,OAAOmnB,cAActjB,EAAOe,aACvDf,EAAOqc,QAAUlgB,OAAOmnB,cAActjB,EAAOe,YAGzCf,EAAOyrC,mBACXzrC,EAAOuB,OAAS,WACfvB,EAAO4Y,UAAY5Y,EAAO4Y,WAC1B,IAAIvT,EAAMvG,KAAKuF,YACf2F,EAAGnB,KAAK7I,EAAOe,WAAasE,EAE3B2E,EAAG0hC,WADArmC,GAGa2E,EAAGrL,KAAK+sC,WAEzB1hC,EAAGwM,YACHxM,EAAG2hC,cAIL3hC,EAAGoM,KAAKkG,UAAUtc,GAEdA,EAAOqc,SACVzd,EAAE,oBAAoBoB,EAAOe,UAAU,MAAMmP,QAAQ,aAIxDu6B,SAAU,WACT,IAAIzgC,EAAKlL,KACT3C,OAAOkT,KAAK,CACXC,OAAQtF,EAAGsgC,eACXzhC,KAAMmB,EAAGnB,KACT2G,SAAU,SAASC,GACdA,EAAEQ,UACLjG,EAAG0hC,WAAaj8B,EAAEQ,QAAQ,GAAU,MACpCjG,EAAG2hC,iBAKPA,UAAW,sBACV/sC,EAAEE,KAAK0B,QAAQC,KAAK,SAASU,SAE7BrC,KAAKyvB,KAAO,IAAIpyB,OAAOqC,GAAGotC,KAAK,CAC9BprC,OAAQ1B,KAAK6Y,KACbxR,MAAOrH,KAAK+J,KAAK/J,KAAKH,KAAK+sC,aAAe5sC,KAAK4sC,YAAc5sC,KAAKH,KAAK+sC,WACvEG,YAAY,EAEZhjC,KAAM/J,KAAK+J,KACXyG,OAAQxQ,KAAKwrC,eAGbwB,QAAShtC,KAAKitC,cAEdrlB,UAAW5nB,KAAKH,KAAK+nB,UACrBslB,UAAWltC,KAAKH,KAAKstC,SACrBnT,kBAAWoT,GAAWptC,EAAKqtC,YAAYD,MAGxCjC,SAAWnrC,KAAKyvB,KAChBzvB,KAAKstC,eAGNA,YAAa,WACHttC,KACNH,KAAKytC,aADCttC,KACiBH,KAAKytC,YADtBttC,OAIVqtC,YAAa,SAASD,GAElBptC,KAAKH,KAAKuU,OACZpU,KAAKH,KAAKuU,MAAMg5B,GAEdptC,KAAKH,KAAK2sC,gBACZxsC,KAAK0sC,UAAU/mC,QACf7F,EAAEzC,OAAOmE,gBANDxB,KAMoBH,KAAK2sC,cAChC,CAAC3gC,KAAKuhC,EAAKvhC,KAAMtO,QAPVyC,KAOqBzC,WAAWkE,SAASzB,KAAK0sC,aAGxDO,YAAa,WACZ,IAAI/hC,EAAKlL,KAELgtC,EAAU,CACb,CACC3lC,MAAMnJ,GAAGgN,EAAGiL,UAAW,OAAQ,WAC/BvT,UAAW,SAASwqC,GACnB,OAAQA,EAAKG,SAAWriC,EAAGmxB,UAE5BjoB,MAAO,SAASg5B,GACf/vC,OAAOmX,UAAU,OAAQtJ,EAAG3N,QAAS6vC,EAAK/lC,SAG5C,CACCA,MAAMnJ,GAAG,aACT0E,UAAW,SAASwqC,GACnB,OAAOliC,EAAGgL,YAAck3B,EAAKL,aAAeK,EAAKI,UAElDp5B,MAAO,SAASg5B,GACfliC,EAAGuiC,YAEJC,SAAU,aAEX,CACCrmC,MAAMnJ,GAAG,UACT0E,UAAW,SAASwqC,GACnBzqC,IAAIgrC,GAAe,EAInB,OAHIziC,EAAG3N,SAAWF,OAAOwY,SAAS3K,EAAG3N,WAChCF,OAAOwY,SAAS3K,EAAG3N,SAASowC,eAAcA,GAAe,KAEtDP,EAAKG,SAAWriC,EAAGiL,WAAaw3B,GAEzCv5B,MAAO,SAASg5B,GACf/vC,OAAOG,MAAMowC,WAAW1iC,EAAG3N,QAAS6vC,EAAK/lC,MAAO,SAASwmC,GACxDT,EAAKU,WAAWnsC,KAAK,KAAKoK,KAAK8hC,GAC/BT,EAAK/lC,MAAQwmC,KAGfH,SAAU,aAEX,CACCrmC,MAAMnJ,GAAG,UACT0E,UAAW,SAASwqC,GAAQ,OAAQA,EAAKG,SAAWriC,EAAGikB,YACvD/a,MAAO,SAASg5B,GACf/vC,OAAOG,MAAMo1B,WAAW1nB,EAAG3N,QAAS6vC,EAAK/lC,MAAO,WAC/C+lC,EAAK1rC,OAAOW,YAGdqrC,SAAU,cAIZ,OAAG1tC,KAAKH,KAAKmtC,SAAWhtC,KAAKH,KAAKkuC,gBACjCf,EAAUA,EAAQ9rC,gBAAO47B,GACxB,OAAQ5xB,EAAGrL,KAAKmtC,QAAQrrC,cAAK+K,UAAKA,EAAS,OAAGowB,EAAW,WAE3CjwB,OAAO7M,KAAKH,KAAKmtC,SACtBhtC,KAAKH,KAAKmtC,UAAYhtC,KAAKH,KAAKkuC,eACnC/tC,KAAKH,KAAKmtC,QAEVA,GAGTS,SAAU,WACT,IAAIviC,EAAKlL,KACLotC,EAAOliC,EAAGukB,KAAKue,oBAEnB,GAAKZ,GAAQA,EAAKL,WAAlB,CAKA/sC,KAAKiuC,iBAGL,IAAIvhC,EAAI,IAAIrP,OAAOqC,GAAG8e,OAAO,CAC5BC,MAAOvgB,GAAG,UAAU,CAACA,GAAGgN,EAAG3N,WAC3B6Y,OAAQlL,EAAGkL,SAGRrM,EAAOjK,EAAEC,OAAO,GAAImL,EAAGnB,MAC3BA,EAAK,UAAUmB,EAAG3N,QAAQsL,cAAc8J,QAAQ,KAAK,MAAQzH,EAAGnB,KAAa,OAE7E2C,EAAEvK,UAAU,WAAY,GACxBuK,EAAEvJ,WAAW4G,GAGb2C,EAAEiS,mBAAmBzgB,GAAG,cAAe,WAEtC,IAAIuK,EAAIiE,EAAEqhB,aACV,GAAItlB,EAgBJ,OAdAA,EAAE/G,OAAS0rC,EAAK/lC,MAChBoB,EAAElL,QAAU2N,EAAG3N,QAEZ6vC,EAAKG,QACP9kC,EAAW,QAAI2kC,EAAKG,QAGpB9kC,EAAW,SAAI,EAGhBiE,EAAE9I,OACFvG,OAAOkW,IAAIsH,OAAO3c,GAAG,eAAgB,CAACgN,EAAG3N,WAEzCuC,EAAEC,OAAOgK,EAAMtB,GACRpL,OAAOkT,KAAK,CAClBC,OAAQtF,EAAGrL,KAAKquC,eAAiB,gCACjCnkC,KAAMA,EACN2G,SAAU,SAASC,GACdA,EAAE8B,MACF26B,EAAKe,UACPjjC,EAAGukB,KAAK2e,YAAYhB,GAErBliC,EAAGukB,KAAK6c,cAAcc,GAAM,KAG9BiB,OAAQ,WACPhxC,OAAOkW,IAAI+6B,gBAId5hC,EAAE1F,YAtDD3J,OAAOihB,SAASpgB,GAAG,gCAwDrB+vC,eAAgB,WACf,IAAI/iC,EAAKlL,KAETA,KAAKoW,OAAS,CACb,CAACtT,UAAU,QAASb,UAAU,WAAYoF,MAAMnJ,GAAG,cAClDwK,YAAaxK,GAAG,gEAGd8B,KAAKH,KAAKuW,SACbpW,KAAKoW,OAASpW,KAAKH,KAAKuW,QAGzBpW,KAAKuuC,cAAgBvuC,KAAKH,KAAK0uC,eAAiB,GAEhD,IAAIC,EAAmB1uC,EAAEkB,IAAIkK,EAAGrL,KAAK/B,KAAKsY,OAAQ,SAAS1J,GAC1D,OAAQA,EAAE/D,MAAQ+D,EAAEvC,OAASuC,EAAE7H,UAAa6H,EAAI,OAE7C+hC,EAAmBzuC,KAAKoW,OAAOpV,IAAI,SAAS0L,GAC/C,OAAOA,EAAEzK,YAGVusC,EAAiBxtC,IAAI,SAAS0L,IACoB,IAA9C5M,EAAE4uC,QAAQhiC,EAAEzK,UAAWiJ,EAAGqjC,iBAAuE,IAA9CzuC,EAAE4uC,QAAQhiC,EAAEzK,UAAWwsC,IAC5EvjC,EAAGkL,OAAO/V,KAAKqM,MAIlBiiC,WAAY,WACX,IAAItxC,OAAOG,MAAMqxB,UAAU7uB,KAAKzC,SAE/B,OADAF,OAAOihB,SAASpgB,GAAG,8CACZ,EAER,IAAIuxB,EAAO3vB,EAAE,iBAAiBoH,OAC1BgE,EAAKlL,KACT3C,OAAOqC,GAAGkvC,oBAAmB,EAAO,SAAS5wB,GAC5C,IAAIS,EAASvgB,GAAGgN,EAAGqG,SAAWrG,EAAG3N,SACjCF,OAAOwxC,YAAY,CAACpwB,MAAOA,EAAOgR,KAAMA,EAAMzR,eAAeA,IAC7D3gB,OAAOkT,KAAK,CACXC,OAAQ,4DACRzG,KAAM,CACLxM,QAAS2N,EAAG3N,QACZuxC,YAAa5jC,EAAGwK,UAChB4B,KAAMmY,EACNjf,OAAQ,cAKZmO,mBAAoB,WACnB,IAAIzT,EAAKlL,MACJA,KAAKH,KAAKkvC,kBAAoB/uC,KAAKkW,YACvChL,EAAGoM,KAAKqH,mBAAmBzgB,GAAG,OAAQ,WACrCgN,EAAGuiC,YACD,yBAGL7B,cAAe,WACd,IAAI1gC,GAAKlL,KAETA,KAAK0W,WAAa,CACjB,CACCrP,MAAOnJ,GAAG,aACVuY,OAAQ,WACPpZ,OAAOmX,UAAU,OAAQtJ,GAAG3N,WAG9B,CACC8J,MAAOnJ,GAAG,SACVuY,OAAQ,WACPvL,GAAGyjC,eAIL,CACCtnC,MAAOnJ,GAAG,WACVuY,OAAQ,WACPvL,GAAG2hC,eAKF3hC,GAAGrL,KAAK6W,YACXxL,GAAGwL,WAAWrW,KAAK2uC,MAAM9jC,GAAGwL,WAAYxL,GAAGrL,KAAK6W,YAGjD5W,EAAEwM,KAAKpB,GAAGwL,WAAY,SAASzK,EAAGgjC,WACjC,IAAI9hC,UAAW,EACZ8hC,UAAqB,YACvB9hC,SAAW+hC,KAAKD,UAAqB,YAGlC9hC,UACHjC,GAAGoM,KAAKW,cAAcg3B,UAAiB,MAAGA,UAAkB,aRtYhE5xC,OAAOqX,QAAQ,gBACfrX,OAAOqX,QAAQ,+BAEfrX,OAAOsX,MAAMw6B,oBAAsB,MAClCvvC,YAAYC,GACXC,EAAEC,OAAOC,KAAMH,GACfG,KAAKmB,OAGNvB,OACC+C,IAAIuI,EAAKlL,KACTkL,EAAGqT,OAAS,IAAIlhB,OAAOqC,GAAG8e,OAAO,CAChCC,MAAQvT,EAAGuT,OAASvT,EAAGud,SAAWvqB,GAAG,gBACrCkxC,oBAAoB,EACpBh5B,OAAQlL,EAAGsP,aACX+F,qBAAsBriB,GAAG,UACzBqY,eAAgB,WACfrL,EAAGmkC,mBAILvvC,EAAE8Y,UAAUxW,GAAG,kBAAmB,SAASutB,EAAO+X,GACjD,GAAGx8B,EAAGqT,OAAO+wB,QAAS,CACrB3sC,IAAIuD,EAAUpG,EAAEoL,EAAGqT,OAAO9B,YAAY8yB,mBAAmBrpC,SAGrDkoB,EAAgBloB,EAAQvE,KAAK,4BAA4BX,IAAI,WAChE,OAAOlB,EAAEE,MAAM6P,KAAK,oBAIrB3E,EAAGskC,gBAGHphB,EAAc/tB,KAAKqnC,EAAWt1B,MAE9BtS,EAAEwM,KAAK8hB,EAAe,SAASniB,EAAGwjC,GACjCvpC,EAAQvE,KAAK,oBAAqB8tC,EAAU,MAAM3kB,KAAK,WAAW,QAIrE5f,EAAGu3B,UACHv3B,EAAGqT,OAAOvX,OAGXpH,aACC+C,IAAIuI,EAAKlL,KACL0vC,EAAmB76B,OAAO0G,KAAKyX,oBAqCnC,MAnCa,CACZ,CAAC3rB,MAAMnJ,GAAG,aAAc4E,UAAU,SACjCb,UAAU,mBAAoBgD,QAASyqC,EACvC/mC,KAAM,EACNmR,oBACCnX,IAAI6Y,EAAStQ,EAAG6iB,aAChB7iB,EAAGsP,aAAa3S,iBAAQnF,GACA,oBAAnBA,EAAMT,YACTiJ,EAAGqT,OAAOoxB,gBAAgBjtC,EAAMT,UAAW,OAAQ,GACnDiJ,EAAGqT,OAAOoxB,gBAAgBjtC,EAAMT,UAAW,SAAU,MAGvDiJ,EAAG0kC,uBAAuBp0B,GAC1BtQ,EAAG2kC,yBAGL,CAACxoC,MAAMnJ,GAAG,YAAa4E,UAAU,SAChCb,UAAU,WAAYgD,QAAS,GAAIxB,OAAQ,GAC5C,CAAC4D,MAAMnJ,GAAG,UAAW4E,UAAU,QAC9Bb,UAAU,SAAUsb,QAAS,KAC9B,CAACza,UAAW,gBACZ,CAACuE,MAAMnJ,GAAG,QAAS4E,UAAU,WAC5Bb,UAAU,YACX,CAACoF,MAAMnJ,GAAG,eAAgB4E,UAAU,OACnCb,UAAU,cAAegD,QAAQ,QAClC,CAACnC,UAAW,iBACZ,CAACuE,MAAMnJ,GAAG,WAAY4E,UAAU,OAC/Bb,UAAU,WACX,CAACa,UAAW,iBACZ,CAACA,UAAU,cAAeb,UAAU,eACpC,CAACa,UAAW,iBACZ,CAACuE,MAAMnJ,GAAG,sBAAuB4E,UAAU,OAC1Cb,UAAU,uBAObrC,uBACC+C,IAAIuI,EAAKlL,KACT3C,OAAOG,MAAMswB,aAAa,mBACzBnrB,IAAImtC,EAAazyC,OAAOS,KAAKilB,aAAa,QAAS,kBAAkB9d,QAAQuD,MAAM,MACnF0C,EAAGqT,OAAOwxB,UAAU,YAAYpqC,QAAQqqC,YAAYF,KAItDlwC,UACCI,KAAKiwC,eAGNrwC,uBAAuB4b,GACtB7Y,IAAIuI,EAAKlL,KACT,GAAIwb,GAAQ,qBAAsBA,EAAQ,CACzC7Y,IAAIutC,EAAcld,mBAClBkd,EAAY10B,EAAO2X,kBAA+B,YAAEtrB,iBAAQtJ,GAC3D2M,EAAGqT,OAAOoxB,gBAAgBpxC,EAAO,OAAQ,KAG1C2xC,EAAY10B,EAAO2X,kBAAiC,cAAEtrB,iBAAQtJ,GAC7D2M,EAAGqT,OAAOoxB,gBAAgBpxC,EAAO,SAAU,MAK9CqB,0BACKwW,EAASpW,KAAKue,OAAO9B,YACrB0zB,EAASrwC,EAAEsW,EAAOm5B,mBAAmBrpC,SAEpClG,KAAKowC,cACTpwC,KAAKowC,YAAc,IAGpBztC,IAAIoH,EAAO,CACV++B,OAAQ,mBACRK,oBAAYzB,UAAc1nC,EAAKowC,YAAY/vC,KAAKqnC,KAG7C1nC,KAAKiR,MACRlH,EAAO,CACNxM,QAASyC,KAAKiR,IAAI1T,QAClBgU,QAASvR,KAAKiR,IAAIM,QAClBu3B,OAAQ,mBACRK,oBAAYzB,GACX1nC,EAAKiR,IAAIm/B,YAAYC,oBAAoB3I,GACzC1nC,EAAKwvC,mBAKR1vC,EAAE,mFACA5B,GAAG,sBAAsB,4KAGzBA,GAAG,kBAAkB,YAAYuD,SAAS0uC,EAAOxqC,SACnDwqC,EACExuC,KAAK,2BACLS,GAAG,0BAAc,IAAI/E,OAAOqC,GAAGspC,aAAaj/B,KAC9C/J,KAAKwvC,gBAGN5vC,gBACC+C,IAAIyT,EAASpW,KAAKue,OAAO9B,YACrB0zB,EAASrwC,EAAEsW,EAAOm5B,mBAAmBrpC,SAASvE,KAAK,gBAAgBgE,QAEnEilC,EAAQ,GACR5qC,KAAKowC,aAAepwC,KAAKowC,YAAY9mC,SACxCshC,EAAQA,EAAM/9B,OAAO7M,KAAKowC,cAEvBE,UACH1F,EAAQA,EAAM/9B,OAAOyjC,QAAQC,cAG3B3F,EAAMthC,QACRxJ,EAAEwM,KAAKs+B,EAAO,SAAS3+B,EAAGpG,GACpBA,EAAEgjC,YACPhjC,EAAE4jC,SAAWpsC,OAAOmzC,OAAOC,aAAa5qC,EAAE4jC,UAE1C3pC,EAAE8L,KAAK,sSAKY/F,IACjBpE,SAAS0uC,MAKdvwC,gBACC+C,IACIm6B,EADK98B,KACIue,OAAOmyB,kBAEhBC,EAAc3wC,KAAK+tB,aACvB,GAAI4iB,EAAJ,CAEAhuC,IAAIiuC,EACH9wC,EAAEkB,IAAIlB,EAPEE,KAOGue,OAAOrY,SAASvE,KAAK,4BAA6B,SAASm9B,GACrE,OAAOh/B,EAAEg/B,GAASjvB,KAAK,oBARhB7P,KAWN6wC,mBAAmB/T,EAAK6T,EAAaC,IAGzChxC,aACC+C,IACI6Y,EAASxb,KAAKue,OAAOwP,YAAW,GAMpC,OALIvS,IACHA,EAA0B,kBAHlBxb,KAGyBiR,IAAIjT,IAAIT,QACzCie,EAA2B,mBAJnBxb,KAI0BiR,IAAIjT,IAAIoU,MAGpCoJ,EAGR5b,mBAAmBk9B,EAAK6T,EAAaC,GACpCjuC,IAAIuI,EAAKlL,KACTkL,EAAGqT,OAAO3a,OAEVjB,IAAIuwB,EAAYF,mBACZ8d,EAAqB,GAezB,OAdAj8B,OAAO0G,KAAKo1B,GAAa9oC,iBAAQtJ,GAChCuyC,EAAmB5d,EAAUyd,EAAYxd,kBAA6B,UAAE50B,IAAUoyC,EAAYpyC,KAG3F,eAAgBuyC,IACnBA,EAA+B,WAA2B,GAAtBH,EAAYpd,OAAe,SAAW,WAEtC,SAAjCud,EAA4B,UAC/BA,EAAuC,mBAAI,CAAC,CAAC1jB,kBAAqBujB,EAAYvjB,kBAC7E2jB,kBAAqBJ,EAAYhd,sBAE7B,UAAWmd,IAChBA,EAA0B,MAAIzzC,OAAOuU,QAAQC,MAEvCxU,OAAOkT,KAAK,CAClBC,OAAO,uBACPzG,KAAM,CAAE/L,IAAK8yC,GACbhU,IAAKA,EACLpsB,SAAU,SAASC,GACdA,EAAE8B,IAkBLpV,OAAOihB,SAASpgB,GAAG,sEAjBnBb,OAAOijB,WAAW,CACjBnP,QAASjT,GAAG,2BAA4B,CAACyyC,EAAYxd,mBACrD/zB,UAAW,UAER,gBAAiBuxC,GACpBzlC,EAAG8lC,gBAAgBrgC,EAAEQ,QAASw/B,EAAyB,aAGpDC,GACH1lC,EAAG+lC,gBAAgBtgC,EAAEQ,QAASy/B,GAE3BN,UAEHA,QAAQY,SAASngC,OAASu/B,QAAQY,SAASngC,MAAMxK,IAAI,IACrD+pC,QAAQa,kBAUbvxC,gBAAgB5B,EAAKozC,GACD,QAAfpzC,EAAIT,SACPF,OAAOkT,KAAK,CACXC,OAAO,iCACPzG,KAAM,CACLxM,QAASS,EAAIT,QACb6U,KAAMpU,EAAIoU,KACVqN,UAAW2xB,GAEZ1gC,SAAS,SAASC,GACjB,OAAIA,EAAE8B,SAOLpV,OAAOijB,WAAW,CACjBnP,QAASjT,GAAG,gDACZkB,UAAW,gBARZ/B,OAAOijB,WAAW,CACjBnP,QAASjT,GAAG,wCAAyC,CAACkzC,IACtDhyC,UAAW,aAgBjBQ,gBAAgB5B,EAAKoyC,GACpB/yC,OAAOkT,KAAK,CACXC,OAAO,4CACPzG,KAAM,CACLxM,QAASS,EAAIT,QACb6U,KAAMpU,EAAIoU,KACVg+B,YAAap+B,KAAKc,UAAUs9B,IAE7B1/B,SAAS,SAASC,GACjB,OAAIA,EAAE8B,SAGLpV,OAAOijB,WAAW,CACjBnP,QAASjT,GAAG,qEACZkB,UAAW,gBAJZ"}