!function(){"use strict";frappe.templates.item_dashboard='<div>  <div class="result">  </div>  <div class="more hidden" style="padding: 15px;">   <a class="btn btn-default btn-xs btn-more">More</a>  </div> </div>',frappe.templates.item_dashboard_list='{% for d in data %}  <div class="dashboard-list-item">   <div class="row">    <div class="col-sm-3 small" style="margin-top: 8px;">     <a data-type="warehouse" data-name="{{ d.warehouse }}">{{ d.warehouse }}</a>    </div>    <div class="col-sm-3 small" style="margin-top: 8px;">     {% if show_item %}      <a data-type="item"       data-name="{{ d.item_code }}">{{ d.item_code }}       {% if d.item_name != d.item_code %}({{ d.item_name }}){% endif %}      </a>     {% endif %}    </div>    <div class="col-sm-4 small">     <span class="inline-graph">      <span class="inline-graph-half" title="{{ __("Reserved Qty") }}">       <span class="inline-graph-count">{{ d.total_reserved }}</span>       <span class="inline-graph-bar">        <span class="inline-graph-bar-inner"         style="width: {{ cint(Math.abs(d.total_reserved)/max_count * 100) || 5 }}%">        </span>       </span>      </span>      <span class="inline-graph-half" title="{{ __("Actual Qty {0} / Waiting Qty {1}", [d.actual_qty, d.pending_qty]) }}">       <span class="inline-graph-count">        {{ d.actual_qty }} {{ (d.pending_qty > 0) ? ("(" + d.pending_qty+ ")") : "" }}       </span>       <span class="inline-graph-bar">        <span class="inline-graph-bar-inner dark"         style="width: {{ cint(d.actual_qty/max_count * 100) }}%">        </span>        {% if d.pending_qty > 0 %}        <span class="inline-graph-bar-inner" title="{{ __("Projected Qty") }}"         style="width: {{ cint(d.pending_qty/max_count * 100) }}%">        </span>        {% endif %}       </span>      </span>     </span>    </div>    {% if can_write %}    <div class="col-sm-2 text-right" style="margin-top: 8px;">     {% if d.actual_qty %}     <button class="btn btn-default btn-xs btn-move"      data-disable_quick_entry="{{ d.disable_quick_entry }}"      data-warehouse="{{ d.warehouse }}"      data-actual_qty="{{ d.actual_qty }}"      data-item="{{ escape(d.item_code) }}">{{ __("Move") }}</a>     {% endif %}     <button style="margin-left: 7px;" class="btn btn-default btn-xs btn-add"      data-disable_quick_entry="{{ d.disable_quick_entry }}"      data-warehouse="{{ d.warehouse }}"      data-actual_qty="{{ d.actual_qty }}"      data-item="{{ escape(d.item_code) }}"      data-rate="{{ d.valuation_rate }}">{{ __("Add") }}</a>    </div>    {% endif %}   </div>  </div> {% endfor %} ',frappe.provide("erpnext.stock"),erpnext.stock.ItemDashboard=Class.extend({init:function(e){$.extend(this,e),this.make()},make:function(){var e=this;function t(t,a){var r=unescape(t.attr("data-item")),n=unescape(t.attr("data-warehouse")),s=unescape(t.attr("data-actual_qty"));if(Number(unescape(t.attr("data-disable_quick_entry"))))!function(e,t,a){frappe.model.with_doctype("Stock Entry",function(){var r=frappe.model.get_new_doc("Stock Entry");a&&(r.stock_entry_type=a);var n=frappe.model.add_child(r,"items");n.item_code=e,n.s_warehouse=t,frappe.set_route("Form",r.doctype,r.name)})}(r,n,"Move"===a?"Material Transfer":null);else if("Add"===a){var i=unescape($(this).attr("data-rate"));erpnext.stock.move_item(r,null,n,s,i,function(){e.refresh()})}else erpnext.stock.move_item(r,n,null,s,null,function(){e.refresh()})}this.start=0,this.sort_by||(this.sort_by="projected_qty",this.sort_order="asc"),this.content=$(frappe.render_template("item_dashboard")).appendTo(this.parent),this.result=this.content.find(".result"),this.content.on("click",".btn-move",function(){t($(this),"Move")}),this.content.on("click",".btn-add",function(){t($(this),"Add")}),this.content.find(".btn-more").on("click",function(){e.start+=20,e.refresh()})},refresh:function(){this.before_refresh&&this.before_refresh();var e=this;frappe.call({method:"erpnext.stock.dashboard.item_dashboard.get_data",args:{item_code:this.item_code,warehouse:this.warehouse,item_group:this.item_group,start:this.start,sort_by:this.sort_by,sort_order:this.sort_order},callback:function(t){e.render(t.message)}})},render:function(e){0===this.start&&(this.max_count=0,this.result.empty());var t=this.get_item_dashboard_data(e,this.max_count,!0);if(this.max_count=this.max_count,e&&21===e.length?(this.content.find(".more").removeClass("hidden"),e.splice(-1)):this.content.find(".more").addClass("hidden"),t.data.length>0)$(frappe.render_template("item_dashboard_list",t)).appendTo(this.result);else{var a=__(" Currently no stock available in any warehouse");$("<span class='text-muted small'>"+a+"</span>").appendTo(this.result)}},get_item_dashboard_data:function(e,t,a){t||(t=0),e||(e=[]),e.forEach(function(e){e.actual_or_pending=e.projected_qty+e.reserved_qty+e.reserved_qty_for_production+e.reserved_qty_for_sub_contract,e.pending_qty=0,e.total_reserved=e.reserved_qty+e.reserved_qty_for_production+e.reserved_qty_for_sub_contract,e.actual_or_pending>e.actual_qty&&(e.pending_qty=e.actual_or_pending-e.actual_qty),t=Math.max(e.actual_or_pending,e.actual_qty,e.total_reserved,t)});var r=0;return frappe.boot.user.can_write.indexOf("Stock Entry")>=0&&(r=1),{data:e,max_count:t,can_write:r,show_item:a||!1}}}),erpnext.stock.move_item=function(e,t,a,r,n,s){var i=new frappe.ui.Dialog({title:a?__("Add Item"):__("Move Item"),fields:[{fieldname:"item_code",label:__("Item"),fieldtype:"Link",options:"Item",read_only:1},{fieldname:"source",label:__("Source Warehouse"),fieldtype:"Link",options:"Warehouse",read_only:1},{fieldname:"target",label:__("Target Warehouse"),fieldtype:"Link",options:"Warehouse",reqd:1},{fieldname:"qty",label:__("Quantity"),reqd:1,fieldtype:"Float",description:__("Available {0}",[r])},{fieldname:"rate",label:__("Rate"),fieldtype:"Currency",hidden:1}]});i.show(),i.get_field("item_code").set_input(e),t?i.get_field("source").set_input(t):(i.get_field("source").df.hidden=1,i.get_field("source").refresh()),n&&(i.get_field("rate").set_value(n),i.get_field("rate").df.hidden=0,i.get_field("rate").refresh()),a&&(i.get_field("target").df.read_only=1,i.get_field("target").value=a,i.get_field("target").refresh()),i.set_primary_action(__("Submit"),function(){var e=i.get_values();e&&(t&&e.qty>r?frappe.msgprint(__("Quantity must be less than or equal to {0}",[r])):(e.source===e.target&&frappe.msgprint(__("Source and target warehouse must be different")),frappe.call({method:"erpnext.stock.doctype.stock_entry.stock_entry_utils.make_stock_entry",args:e,freeze:!0,callback:function(e){frappe.show_alert(__("Stock Entry {0} created",['<a href="#Form/Stock Entry/'+e.message.name+'">'+e.message.name+"</a>"])),i.hide(),s(e)}})))}),$('<p style="margin-left: 10px;"><a class="link-open text-muted small">'+__("Add more items or open full form")+"</a></p>").appendTo(i.body).find(".link-open").on("click",function(){frappe.model.with_doctype("Stock Entry",function(){var e=frappe.model.get_new_doc("Stock Entry");e.from_warehouse=i.get_value("source"),e.to_warehouse=i.get_value("target");var t=frappe.model.add_child(e,"items");t.item_code=i.get_value("item_code"),t.f_warehouse=i.get_value("target"),t.t_warehouse=i.get_value("target"),t.qty=i.get_value("qty"),t.conversion_factor=1,t.transfer_qty=i.get_value("qty"),t.basic_rate=i.get_value("rate"),frappe.set_route("Form",e.doctype,e.name)})})}}();
//# sourceMappingURL=item-dashboard.min.js.map
