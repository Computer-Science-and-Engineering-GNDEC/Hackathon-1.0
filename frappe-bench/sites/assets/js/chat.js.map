{"version":3,"file":"chat.js","sources":["../../../apps/frappe/node_modules/fuse.js/dist/fuse.js","../../../apps/frappe/frappe/public/js/lib/hyper.min.js","../../../apps/frappe/frappe/public/js/frappe/socketio_client.js","../../../apps/frappe/frappe/public/js/frappe/class.js","../../../apps/frappe/frappe/public/js/frappe/form/layout.js","../../../apps/frappe/frappe/public/js/frappe/ui/field_group.js","../../../apps/frappe/frappe/public/js/frappe/dom.js","../../../apps/frappe/frappe/public/js/frappe/ui/dialog.js","../../../apps/frappe/frappe/public/js/frappe/ui/capture.js","../../../apps/frappe/frappe/public/js/frappe/utils/user.js","../../../apps/frappe/frappe/public/js/frappe/chat.js"],"sourcesContent":["/*!\n * Fuse.js v3.6.1 - Lightweight fuzzy-search (http://fusejs.io)\n * \n * Copyright (c) 2012-2017 Kirollos Risk (http://kiro.me)\n * All Rights Reserved. Apache Software License 2.0\n * \n * http://www.apache.org/licenses/LICENSE-2.0\n */\n!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(\"Fuse\",[],t):\"object\"==typeof exports?exports.Fuse=t():e.Fuse=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=0)}([function(e,t,r){function n(e){return(n=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=r(1),a=r(7),s=a.get,c=(a.deepValue,a.isArray),h=function(){function e(t,r){var n=r.location,o=void 0===n?0:n,i=r.distance,a=void 0===i?100:i,c=r.threshold,h=void 0===c?.6:c,l=r.maxPatternLength,u=void 0===l?32:l,f=r.caseSensitive,v=void 0!==f&&f,p=r.tokenSeparator,d=void 0===p?/ +/g:p,g=r.findAllMatches,y=void 0!==g&&g,m=r.minMatchCharLength,k=void 0===m?1:m,b=r.id,S=void 0===b?null:b,x=r.keys,M=void 0===x?[]:x,_=r.shouldSort,w=void 0===_||_,L=r.getFn,A=void 0===L?s:L,O=r.sortFn,C=void 0===O?function(e,t){return e.score-t.score}:O,j=r.tokenize,P=void 0!==j&&j,I=r.matchAllTokens,F=void 0!==I&&I,T=r.includeMatches,N=void 0!==T&&T,z=r.includeScore,E=void 0!==z&&z,W=r.verbose,K=void 0!==W&&W;!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e),this.options={location:o,distance:a,threshold:h,maxPatternLength:u,isCaseSensitive:v,tokenSeparator:d,findAllMatches:y,minMatchCharLength:k,id:S,keys:M,includeMatches:N,includeScore:E,shouldSort:w,getFn:A,sortFn:C,verbose:K,tokenize:P,matchAllTokens:F},this.setCollection(t),this._processKeys(M)}var t,r,a;return t=e,(r=[{key:\"setCollection\",value:function(e){return this.list=e,e}},{key:\"_processKeys\",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&\"string\"==typeof e[0])for(var t=0,r=e.length;t<r;t+=1){var n=e[t];this._keyWeights[n]=1,this._keyNames.push(n)}else{for(var o=null,i=null,a=0,s=0,c=e.length;s<c;s+=1){var h=e[s];if(!h.hasOwnProperty(\"name\"))throw new Error('Missing \"name\" property in key object');var l=h.name;if(this._keyNames.push(l),!h.hasOwnProperty(\"weight\"))throw new Error('Missing \"weight\" property in key object');var u=h.weight;if(u<0||u>1)throw new Error('\"weight\" property in key must bein the range of [0, 1)');i=null==i?u:Math.max(i,u),o=null==o?u:Math.min(o,u),this._keyWeights[l]=u,a+=u}if(a>1)throw new Error(\"Total of weights cannot exceed 1\")}}},{key:\"search\",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\\nSearch pattern: \"'.concat(e,'\"'));var r=this._prepareSearchers(e),n=r.tokenSearchers,o=r.fullSearcher,i=this._search(n,o);return this._computeScore(i),this.options.shouldSort&&this._sort(i),t.limit&&\"number\"==typeof t.limit&&(i=i.slice(0,t.limit)),this._format(i)}},{key:\"_prepareSearchers\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\",t=[];if(this.options.tokenize)for(var r=e.split(this.options.tokenSeparator),n=0,o=r.length;n<o;n+=1)t.push(new i(r[n],this.options));return{tokenSearchers:t,fullSearcher:new i(e,this.options)}}},{key:\"_search\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,r=this.list,n={},o=[];if(\"string\"==typeof r[0]){for(var i=0,a=r.length;i<a;i+=1)this._analyze({key:\"\",value:r[i],record:i,index:i},{resultMap:n,results:o,tokenSearchers:e,fullSearcher:t});return o}for(var s=0,c=r.length;s<c;s+=1)for(var h=r[s],l=0,u=this._keyNames.length;l<u;l+=1){var f=this._keyNames[l];this._analyze({key:f,value:this.options.getFn(h,f),record:h,index:s},{resultMap:n,results:o,tokenSearchers:e,fullSearcher:t})}return o}},{key:\"_analyze\",value:function(e,t){var r=this,n=e.key,o=e.arrayIndex,i=void 0===o?-1:o,a=e.value,s=e.record,h=e.index,l=t.tokenSearchers,u=void 0===l?[]:l,f=t.fullSearcher,v=t.resultMap,p=void 0===v?{}:v,d=t.results,g=void 0===d?[]:d;!function e(t,o,i,a){if(null!=o)if(\"string\"==typeof o){var s=!1,h=-1,l=0;r._log(\"\\nKey: \".concat(\"\"===n?\"--\":n));var v=f.search(o);if(r._log('Full text: \"'.concat(o,'\", score: ').concat(v.score)),r.options.tokenize){for(var d=o.split(r.options.tokenSeparator),y=d.length,m=[],k=0,b=u.length;k<b;k+=1){var S=u[k];r._log('\\nPattern: \"'.concat(S.pattern,'\"'));for(var x=!1,M=0;M<y;M+=1){var _=d[M],w=S.search(_),L={};w.isMatch?(L[_]=w.score,s=!0,x=!0,m.push(w.score)):(L[_]=1,r.options.matchAllTokens||m.push(1)),r._log('Token: \"'.concat(_,'\", score: ').concat(L[_]))}x&&(l+=1)}h=m[0];for(var A=m.length,O=1;O<A;O+=1)h+=m[O];h/=A,r._log(\"Token score average:\",h)}var C=v.score;h>-1&&(C=(C+h)/2),r._log(\"Score average:\",C);var j=!r.options.tokenize||!r.options.matchAllTokens||l>=u.length;if(r._log(\"\\nCheck Matches: \".concat(j)),(s||v.isMatch)&&j){var P={key:n,arrayIndex:t,value:o,score:C};r.options.includeMatches&&(P.matchedIndices=v.matchedIndices);var I=p[a];I?I.output.push(P):(p[a]={item:i,output:[P]},g.push(p[a]))}}else if(c(o))for(var F=0,T=o.length;F<T;F+=1)e(F,o[F],i,a)}(i,a,s,h)}},{key:\"_computeScore\",value:function(e){this._log(\"\\n\\nComputing score:\\n\");for(var t=this._keyWeights,r=!!Object.keys(t).length,n=0,o=e.length;n<o;n+=1){for(var i=e[n],a=i.output,s=a.length,c=1,h=0;h<s;h+=1){var l=a[h],u=l.key,f=r?t[u]:1,v=0===l.score&&t&&t[u]>0?Number.EPSILON:l.score;c*=Math.pow(v,f)}i.score=c,this._log(i)}}},{key:\"_sort\",value:function(e){this._log(\"\\n\\nSorting....\"),e.sort(this.options.sortFn)}},{key:\"_format\",value:function(e){var t=[];if(this.options.verbose){var r=[];this._log(\"\\n\\nOutput:\\n\\n\",JSON.stringify(e,function(e,t){if(\"object\"===n(t)&&null!==t){if(-1!==r.indexOf(t))return;r.push(t)}return t},2)),r=null}var o=[];this.options.includeMatches&&o.push(function(e,t){var r=e.output;t.matches=[];for(var n=0,o=r.length;n<o;n+=1){var i=r[n];if(0!==i.matchedIndices.length){var a={indices:i.matchedIndices,value:i.value};i.key&&(a.key=i.key),i.hasOwnProperty(\"arrayIndex\")&&i.arrayIndex>-1&&(a.arrayIndex=i.arrayIndex),t.matches.push(a)}}}),this.options.includeScore&&o.push(function(e,t){t.score=e.score});for(var i=0,a=e.length;i<a;i+=1){var s=e[i];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),o.length){for(var c={item:s.item},h=0,l=o.length;h<l;h+=1)o[h](s,c);t.push(c)}else t.push(s.item)}return t}},{key:\"_log\",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&o(t.prototype,r),a&&o(t,a),e}();e.exports=h},function(e,t,r){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=r(2),i=r(3),a=r(6),s=function(){function e(t,r){var n=r.location,o=void 0===n?0:n,i=r.distance,s=void 0===i?100:i,c=r.threshold,h=void 0===c?.6:c,l=r.maxPatternLength,u=void 0===l?32:l,f=r.isCaseSensitive,v=void 0!==f&&f,p=r.tokenSeparator,d=void 0===p?/ +/g:p,g=r.findAllMatches,y=void 0!==g&&g,m=r.minMatchCharLength,k=void 0===m?1:m,b=r.includeMatches,S=void 0!==b&&b;!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e),this.options={location:o,distance:s,threshold:h,maxPatternLength:u,isCaseSensitive:v,tokenSeparator:d,findAllMatches:y,includeMatches:S,minMatchCharLength:k},this.pattern=v?t:t.toLowerCase(),this.pattern.length<=u&&(this.patternAlphabet=a(this.pattern))}var t,r,s;return t=e,(r=[{key:\"search\",value:function(e){var t=this.options,r=t.isCaseSensitive,n=t.includeMatches;if(r||(e=e.toLowerCase()),this.pattern===e){var a={isMatch:!0,score:0};return n&&(a.matchedIndices=[[0,e.length-1]]),a}var s=this.options,c=s.maxPatternLength,h=s.tokenSeparator;if(this.pattern.length>c)return o(e,this.pattern,h);var l=this.options,u=l.location,f=l.distance,v=l.threshold,p=l.findAllMatches,d=l.minMatchCharLength;return i(e,this.pattern,this.patternAlphabet,{location:u,distance:f,threshold:v,findAllMatches:p,minMatchCharLength:d,includeMatches:n})}}])&&n(t.prototype,r),s&&n(t,s),e}();e.exports=s},function(e,t){var r=/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g;e.exports=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,o=new RegExp(t.replace(r,\"\\\\$&\").replace(n,\"|\")),i=e.match(o),a=!!i,s=[];if(a)for(var c=0,h=i.length;c<h;c+=1){var l=i[c];s.push([e.indexOf(l),l.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(e,t,r){var n=r(4),o=r(5);e.exports=function(e,t,r,i){for(var a=i.location,s=void 0===a?0:a,c=i.distance,h=void 0===c?100:c,l=i.threshold,u=void 0===l?.6:l,f=i.findAllMatches,v=void 0!==f&&f,p=i.minMatchCharLength,d=void 0===p?1:p,g=i.includeMatches,y=void 0!==g&&g,m=s,k=e.length,b=u,S=e.indexOf(t,m),x=t.length,M=[],_=0;_<k;_+=1)M[_]=0;if(-1!==S){var w=n(t,{errors:0,currentLocation:S,expectedLocation:m,distance:h});if(b=Math.min(w,b),-1!==(S=e.lastIndexOf(t,m+x))){var L=n(t,{errors:0,currentLocation:S,expectedLocation:m,distance:h});b=Math.min(L,b)}}S=-1;for(var A=[],O=1,C=x+k,j=1<<(x<=31?x-1:30),P=0;P<x;P+=1){for(var I=0,F=C;I<F;){n(t,{errors:P,currentLocation:m+F,expectedLocation:m,distance:h})<=b?I=F:C=F,F=Math.floor((C-I)/2+I)}C=F;var T=Math.max(1,m-F+1),N=v?k:Math.min(m+F,k)+x,z=Array(N+2);z[N+1]=(1<<P)-1;for(var E=N;E>=T;E-=1){var W=E-1,K=r[e.charAt(W)];if(K&&(M[W]=1),z[E]=(z[E+1]<<1|1)&K,0!==P&&(z[E]|=(A[E+1]|A[E])<<1|1|A[E+1]),z[E]&j&&(O=n(t,{errors:P,currentLocation:W,expectedLocation:m,distance:h}))<=b){if(b=O,(S=W)<=m)break;T=Math.max(1,2*m-S)}}if(n(t,{errors:P+1,currentLocation:m,expectedLocation:m,distance:h})>b)break;A=z}var $={isMatch:S>=0,score:0===O?.001:O};return y&&($.matchedIndices=o(M,d)),$}},function(e,t){e.exports=function(e,t){var r=t.errors,n=void 0===r?0:r,o=t.currentLocation,i=void 0===o?0:o,a=t.expectedLocation,s=void 0===a?0:a,c=t.distance,h=void 0===c?100:c,l=n/e.length,u=Math.abs(s-i);return h?l+u/h:u?1:l}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=[],n=-1,o=-1,i=0,a=e.length;i<a;i+=1){var s=e[i];s&&-1===n?n=i:s||-1===n||((o=i-1)-n+1>=t&&r.push([n,o]),n=-1)}return e[i-1]&&i-n>=t&&r.push([n,i-1]),r}},function(e,t){e.exports=function(e){for(var t={},r=e.length,n=0;n<r;n+=1)t[e.charAt(n)]=0;for(var o=0;o<r;o+=1)t[e.charAt(o)]|=1<<r-o-1;return t}},function(e,t){var r=function(e){return Array.isArray?Array.isArray(e):\"[object Array]\"===Object.prototype.toString.call(e)},n=function(e){return null==e?\"\":function(e){if(\"string\"==typeof e)return e;var t=e+\"\";return\"0\"==t&&1/e==-1/0?\"-0\":t}(e)},o=function(e){return\"string\"==typeof e},i=function(e){return\"number\"==typeof e};e.exports={get:function(e,t){var a=[];return function e(t,s){if(s){var c=s.indexOf(\".\"),h=s,l=null;-1!==c&&(h=s.slice(0,c),l=s.slice(c+1));var u=t[h];if(null!=u)if(l||!o(u)&&!i(u))if(r(u))for(var f=0,v=u.length;f<v;f+=1)e(u[f],l);else l&&e(u,l);else a.push(n(u))}else a.push(t)}(e,t),a},isArray:r,isString:o,isNum:i,toString:n}}])});","!function(){\"use strict\";function e(){}function t(t,n){var o,r,i,l,a=W;for(l=arguments.length;l-- >2;)S.push(arguments[l]);n&&null!=n.children&&(S.length||S.push(n.children),delete n.children);while(S.length)if((r=S.pop())&&void 0!==r.pop)for(l=r.length;l--;)S.push(r[l]);else\"boolean\"==typeof r&&(r=null),(i=\"function\"!=typeof t)&&(null==r?r=\"\":\"number\"==typeof r?r+=\"\":\"string\"!=typeof r&&(i=!1)),i&&o?a[a.length-1]+=r:a===W?a=[r]:a.push(r),o=i;var _=new e;return _.nodeName=t,_.children=a,_.attributes=null==n?void 0:n,_.key=null==n?void 0:n.key,void 0!==M.vnode&&M.vnode(_),_}function n(e,t){for(var n in t)e[n]=t[n];return e}function o(e){!e.__d&&(e.__d=!0)&&1==A.push(e)&&(M.debounceRendering||V)(r)}function r(){var e,t=A;A=[];while(e=t.pop())e.__d&&N(e)}function i(e,t,n){return\"string\"==typeof t||\"number\"==typeof t?void 0!==e.splitText:\"string\"==typeof t.nodeName?!e._componentConstructor&&l(e,t.nodeName):n||e._componentConstructor===t.nodeName}function l(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function a(e){var t=n({},e.attributes);t.children=e.children;var o=e.nodeName.defaultProps;if(void 0!==o)for(var r in o)void 0===t[r]&&(t[r]=o[r]);return t}function _(e,t){var n=t?document.createElementNS(\"http://www.w3.org/2000/svg\",e):document.createElement(e);return n.__n=e,n}function u(e){var t=e.parentNode;t&&t.removeChild(e)}function p(e,t,n,o,r){if(\"className\"===t&&(t=\"class\"),\"key\"===t);else if(\"ref\"===t)n&&n(null),o&&o(e);else if(\"class\"!==t||r)if(\"style\"===t){if(o&&\"string\"!=typeof o&&\"string\"!=typeof n||(e.style.cssText=o||\"\"),o&&\"object\"==typeof o){if(\"string\"!=typeof n)for(var i in n)i in o||(e.style[i]=\"\");for(var i in o)e.style[i]=\"number\"==typeof o[i]&&!1===P.test(i)?o[i]+\"px\":o[i]}}else if(\"html\"===t)o&&(e.innerHTML=o);else if(\"o\"==t[0]&&\"n\"==t[1]){var l=t!==(t=t.replace(/Capture$/,\"\"));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,s,l):e.removeEventListener(t,s,l),(e.__l||(e.__l={}))[t]=o}else if(\"list\"!==t&&\"type\"!==t&&!r&&t in e)c(e,t,null==o?\"\":o),null!=o&&!1!==o||e.removeAttribute(t);else{var a=r&&t!==(t=t.replace(/^xlink\\:?/,\"\"));null==o||!1===o?a?e.removeAttributeNS(\"http://www.w3.org/1999/xlink\",t.toLowerCase()):e.removeAttribute(t):\"function\"!=typeof o&&(a?e.setAttributeNS(\"http://www.w3.org/1999/xlink\",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||\"\"}function c(e,t,n){try{e[t]=n}catch(e){}}function s(e){return this.__l[e.type](M.event&&M.event(e)||e)}function f(){var e;while(e=E.pop())M.afterMount&&M.afterMount(e),e.on_mounted&&e.on_mounted()}function d(e,t,n,o,r,i){D++||(H=null!=r&&void 0!==r.ownerSVGElement,R=null!=e&&!(\"__hyperattr_\"in e));var l=h(e,t,n,o,i);return r&&l.parentNode!==r&&r.appendChild(l),--D||(R=!1,i||f()),l}function h(e,t,n,o,r){var i=e,a=H;if(null!=t&&\"boolean\"!=typeof t||(t=\"\"),\"string\"==typeof t||\"number\"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),m(e,!0))),i.__hyperattr_=!0,i;var u=t.nodeName;if(\"function\"==typeof u)return k(e,t,n,o);if(H=\"svg\"===u||\"foreignObject\"!==u&&H,u+=\"\",(!e||!l(e,u))&&(i=_(u,H),e)){while(e.firstChild)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),m(e,!0)}var p=i.firstChild,c=i.__hyperattr_,s=t.children;if(null==c){c=i.__hyperattr_={};for(var f=i.attributes,d=f.length;d--;)c[f[d].name]=f[d].value}return!R&&s&&1===s.length&&\"string\"==typeof s[0]&&null!=p&&void 0!==p.splitText&&null==p.nextSibling?p.nodeValue!=s[0]&&(p.nodeValue=s[0]):(s&&s.length||null!=p)&&v(i,s,n,o,R||null!=c.html),y(i,t.attributes,c),H=a,i}function v(e,t,n,o,r){var l,a,_,p,c,s=e.childNodes,f=[],d={},v=0,b=0,y=s.length,g=0,w=t?t.length:0;if(0!==y)for(var C=0;C<y;C++){var x=s[C],N=x.__hyperattr_,k=w&&N?x._component?x._component.__k:N.key:null;null!=k?(v++,d[k]=x):(N||(void 0!==x.splitText?!r||x.nodeValue.trim():r))&&(f[g++]=x)}if(0!==w)for(var C=0;C<w;C++){p=t[C],c=null;var k=p.key;if(null!=k)v&&void 0!==d[k]&&(c=d[k],d[k]=void 0,v--);else if(!c&&b<g)for(l=b;l<g;l++)if(void 0!==f[l]&&i(a=f[l],p,r)){c=a,f[l]=void 0,l===g-1&&g--,l===b&&b++;break}c=h(c,p,n,o),_=s[C],c&&c!==e&&c!==_&&(null==_?e.appendChild(c):c===_.nextSibling?u(_):e.insertBefore(c,_))}if(v)for(var C in d)void 0!==d[C]&&m(d[C],!1);while(b<=g)void 0!==(c=f[g--])&&m(c,!1)}function m(e,t){var n=e._component;n?U(n):(null!=e.__hyperattr_&&e.__hyperattr_.ref&&e.__hyperattr_.ref(null),!1!==t&&null!=e.__hyperattr_||u(e),b(e))}function b(e){e=e.lastChild;while(e){var t=e.previousSibling;m(e,!0),e=t}}function y(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||p(e,o,n[o],n[o]=void 0,H);for(o in t)\"children\"===o||\"innerHTML\"===o||o in n&&t[o]===(\"value\"===o||\"checked\"===o?e[o]:n[o])||p(e,o,n[o],n[o]=t[o],H)}function g(e){var t=e.constructor.name;(j[t]||(j[t]=[])).push(e)}function w(e,t,n){var o,r=j[e.name];if(e.prototype&&e.prototype.render?(o=new e(t,n),L.call(o,t,n)):(o=new L(t,n),o.constructor=e,o.render=C),r)for(var i=r.length;i--;)if(r[i].constructor===e){o.__b=r[i].__b,r.splice(i,1);break}return o}function C(e,t,n){return this.constructor(e,n)}function x(e,t,n,r,i){e.__x||(e.__x=!0,(e.__r=t.ref)&&delete t.ref,(e.__k=t.key)&&delete t.key,!e.base||i?e.on_mount&&e.on_mount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r),r&&r!==e.context&&(e.__c||(e.__c=e.context),e.context=r),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==n&&(1!==n&&!1===M.syncComponentUpdates&&e.base?o(e):N(e,1,i)),e.__r&&e.__r(e))}function N(e,t,o,r){if(!e.__x){var i,l,_,u=e.props,p=e.state,c=e.context,s=e.__p||u,h=e.__s||p,v=e.__c||c,b=e.base,y=e.__b,g=b||y,C=e._component,k=!1;if(b&&(e.props=s,e.state=h,e.context=v,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(u,p,c)?k=!0:e.componentWillUpdate&&e.componentWillUpdate(u,p,c),e.props=u,e.state=p,e.context=c),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!k){i=e.render(u,p,c),e.getChildContext&&(c=n(n({},c),e.getChildContext()));var L,T,S=i&&i.nodeName;if(\"function\"==typeof S){var W=a(i);l=C,l&&l.constructor===S&&W.key==l.__k?x(l,W,1,c,!1):(L=l,e._component=l=w(S,W,c),l.__b=l.__b||y,l.__u=e,x(l,W,0,c,!1),N(l,1,o,!0)),T=l.base}else _=g,L=C,L&&(_=e._component=null),(g||1===t)&&(_&&(_._component=null),T=d(_,i,c,o||!b,g&&g.parentNode,!0));if(g&&T!==g&&l!==C){var P=g.parentNode;P&&T!==P&&(P.replaceChild(T,g),L||(g._component=null,m(g,!1)))}if(L&&U(L),e.base=T,T&&!r){var V=e,A=e;while(A=A.__u)(V=A).base=T;T._component=V,T._componentConstructor=V.constructor}}if(!b||o?E.unshift(e):k||(e.on_updated&&e.on_updated(s,h,v),M.afterUpdate&&M.afterUpdate(e)),null!=e.__h)while(e.__h.length)e.__h.pop().call(e);D||r||f()}}function k(e,t,n,o){var r=e&&e._component,i=r,l=e,_=r&&e._componentConstructor===t.nodeName,u=_,p=a(t);while(r&&!u&&(r=r.__u))u=r.constructor===t.nodeName;return r&&u&&(!o||r._component)?(x(r,p,3,n,o),e=r.base):(i&&!_&&(U(i),e=l=null),r=w(t.nodeName,p,n),e&&!r.__b&&(r.__b=e,l=null),x(r,p,1,n,o),e=r.base,l&&e!==l&&(l._component=null,m(l,!1))),e}function U(e){M.beforeUnmount&&M.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?U(n):t&&(t.__hyperattr_&&t.__hyperattr_.ref&&t.__hyperattr_.ref(null),e.__b=t,u(t),g(e),b(t)),e.__r&&e.__r(null)}function L(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{}}function T(e,t,n){return d(n,e,{},!1,t,!1)}var M={},S=[],W=[],P=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,V=\"function\"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,A=[],E=[],D=0,H=!1,R=!1,j={};n(L.prototype,{set_state:function(e,t){var r=this.state;this.__s||(this.__s=n({},r)),n(r,\"function\"==typeof e?e(r,this.props):e),t&&(this.__h=this.__h||[]).push(t),o(this)},forceUpdate:function(e){e&&(this.__h=this.__h||[]).push(e),N(this,2)},render:function(){}});var I={h:t,Component:L,render:T};\"undefined\"!=typeof module?module.exports=I:self.hyper=I}();","frappe.socketio = {\n\topen_tasks: {},\n\topen_docs: [],\n\temit_queue: [],\n\tinit: function(port = 3000) {\n\t\tif (!window.io) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (frappe.boot.disable_async) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (frappe.socketio.socket) {\n\t\t\treturn;\n\t\t}\n\n\t\t//Enable secure option when using HTTPS\n\t\tif (window.location.protocol == \"https:\") {\n\t\t\tfrappe.socketio.socket = io.connect(frappe.socketio.get_host(port), {secure: true});\n\t\t}\n\t\telse if (window.location.protocol == \"http:\") {\n\t\t\tfrappe.socketio.socket = io.connect(frappe.socketio.get_host(port));\n\t\t}\n\t\telse if (window.location.protocol == \"file:\") {\n\t\t\tfrappe.socketio.socket = io.connect(window.localStorage.server);\n\t\t}\n\n\t\tif (!frappe.socketio.socket) {\n\t\t\tconsole.log(\"Unable to connect to \" + frappe.socketio.get_host(port));\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.socketio.socket.on('msgprint', function(message) {\n\t\t\tfrappe.msgprint(message);\n\t\t});\n\n\t\tfrappe.socketio.socket.on('eval_js', function(message) {\n\t\t\teval(message);\n\t\t});\n\n\t\tfrappe.socketio.socket.on('progress', function(data) {\n\t\t\tif(data.progress) {\n\t\t\t\tdata.percent = flt(data.progress[0]) / data.progress[1] * 100;\n\t\t\t}\n\t\t\tif(data.percent) {\n\t\t\t\tif(data.percent==100) {\n\t\t\t\t\tfrappe.hide_progress();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_progress(data.title || __(\"Progress\"), data.percent, 100, data.description);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tfrappe.socketio.setup_listeners();\n\t\tfrappe.socketio.setup_reconnect();\n\t\tfrappe.socketio.uploader = new frappe.socketio.SocketIOUploader();\n\n\t\t$(document).on('form-load form-rename', function(e, frm) {\n\t\t\tif (frm.is_new()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (var i=0, l=frappe.socketio.open_docs.length; i<l; i++) {\n\t\t\t\tvar d = frappe.socketio.open_docs[i];\n\t\t\t\tif (frm.doctype==d.doctype && frm.docname==d.name) {\n\t\t\t\t\t// already subscribed\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfrappe.socketio.doc_subscribe(frm.doctype, frm.docname);\n\t\t});\n\n\t\t$(document).on(\"form-refresh\", function(e, frm) {\n\t\t\tif (frm.is_new()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrappe.socketio.doc_open(frm.doctype, frm.docname);\n\t\t});\n\n\t\t$(document).on('form-unload', function(e, frm) {\n\t\t\tif (frm.is_new()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// frappe.socketio.doc_unsubscribe(frm.doctype, frm.docname);\n\t\t\tfrappe.socketio.doc_close(frm.doctype, frm.docname);\n\t\t});\n\n\t\twindow.onbeforeunload = function() {\n\t\t\tif (!cur_frm || cur_frm.is_new()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// if tab/window is closed, notify other users\n\t\t\tif (cur_frm.doc) {\n\t\t\t\tfrappe.socketio.doc_close(cur_frm.doctype, cur_frm.docname);\n\t\t\t}\n\t\t}\n\t},\n\tget_host: function(port = 3000) {\n\t\tvar host = window.location.origin;\n\t\tif(window.dev_server) {\n\t\t\tvar parts = host.split(\":\");\n\t\t\tport = frappe.boot.socketio_port || port.toString() || '3000';\n\t\t\tif(parts.length > 2) {\n\t\t\t\thost = parts[0] + \":\" + parts[1];\n\t\t\t}\n\t\t\thost = host + \":\" + port;\n\t\t}\n\t\treturn host;\n\t},\n\tsubscribe: function(task_id, opts) {\n\t\t// TODO DEPRECATE\n\n\t\tfrappe.socketio.socket.emit('task_subscribe', task_id);\n\t\tfrappe.socketio.socket.emit('progress_subscribe', task_id);\n\n\t\tfrappe.socketio.open_tasks[task_id] = opts;\n\t},\n\ttask_subscribe: function(task_id) {\n\t\tfrappe.socketio.socket.emit('task_subscribe', task_id);\n\t},\n\ttask_unsubscribe: function(task_id) {\n\t\tfrappe.socketio.socket.emit('task_unsubscribe', task_id);\n\t},\n\tdoc_subscribe: function(doctype, docname) {\n\t\tif (frappe.flags.doc_subscribe) {\n\t\t\tconsole.log('throttled');\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.flags.doc_subscribe = true;\n\n\t\t// throttle to 1 per sec\n\t\tsetTimeout(function() { frappe.flags.doc_subscribe = false }, 1000);\n\n\t\tfrappe.socketio.socket.emit('doc_subscribe', doctype, docname);\n\t\tfrappe.socketio.open_docs.push({doctype: doctype, docname: docname});\n\t},\n\tdoc_unsubscribe: function(doctype, docname) {\n\t\tfrappe.socketio.socket.emit('doc_unsubscribe', doctype, docname);\n\t\tfrappe.socketio.open_docs = $.filter(frappe.socketio.open_docs, function(d) {\n\t\t\tif(d.doctype===doctype && d.name===docname) {\n\t\t\t\treturn null;\n\t\t\t} else {\n\t\t\t\treturn d;\n\t\t\t}\n\t\t})\n\t},\n\tdoc_open: function(doctype, docname) {\n\t\t// notify that the user has opened this doc, if not already notified\n\t\tif(!frappe.socketio.last_doc\n\t\t\t|| (frappe.socketio.last_doc[0]!=doctype && frappe.socketio.last_doc[1]!=docname)) {\n\t\t\tfrappe.socketio.socket.emit('doc_open', doctype, docname);\n\t\t}\n\t\tfrappe.socketio.last_doc = [doctype, docname];\n\t},\n\tdoc_close: function(doctype, docname) {\n\t\t// notify that the user has closed this doc\n\t\tfrappe.socketio.socket.emit('doc_close', doctype, docname);\n\t},\n\n\tsetup_listeners: function() {\n\t\tfrappe.socketio.socket.on('task_status_change', function(data) {\n\t\t\tfrappe.socketio.process_response(data, data.status.toLowerCase());\n\t\t});\n\t\tfrappe.socketio.socket.on('task_progress', function(data) {\n\t\t\tfrappe.socketio.process_response(data, \"progress\");\n\t\t});\n\t},\n\tsetup_reconnect: function() {\n\t\t// subscribe again to open_tasks\n\t\tfrappe.socketio.socket.on(\"connect\", function() {\n\t\t\t// wait for 5 seconds before subscribing again\n\t\t\t// because it takes more time to start python server than nodejs server\n\t\t\t// and we use validation requests to python server for subscribing\n\t\t\tsetTimeout(function() {\n\t\t\t\t$.each(frappe.socketio.open_tasks, function(task_id, opts) {\n\t\t\t\t\tfrappe.socketio.subscribe(task_id, opts);\n\t\t\t\t});\n\n\t\t\t\t// re-connect open docs\n\t\t\t\t$.each(frappe.socketio.open_docs, function(d) {\n\t\t\t\t\tif(locals[d.doctype] && locals[d.doctype][d.name]) {\n\t\t\t\t\t\tfrappe.socketio.doc_subscribe(d.doctype, d.name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (cur_frm && cur_frm.doc) {\n\t\t\t\t\tfrappe.socketio.doc_open(cur_frm.doc.doctype, cur_frm.doc.name);\n\t\t\t\t}\n\t\t\t}, 5000);\n\t\t});\n\t},\n\tprocess_response: function(data, method) {\n\t\tif(!data) {\n\t\t\treturn;\n\t\t}\n\n\t\t// success\n\t\tvar opts = frappe.socketio.open_tasks[data.task_id];\n\t\tif(opts[method]) {\n\t\t\topts[method](data);\n\t\t}\n\n\t\t// \"callback\" is std frappe term\n\t\tif(method===\"success\") {\n\t\t\tif(opts.callback) opts.callback(data);\n\t\t}\n\n\t\t// always\n\t\tfrappe.request.cleanup(opts, data);\n\t\tif(opts.always) {\n\t\t\topts.always(data);\n\t\t}\n\n\t\t// error\n\t\tif(data.status_code && data.status_code > 400 && opts.error) {\n\t\t\topts.error(data);\n\t\t}\n\t}\n}\n\nfrappe.provide(\"frappe.realtime\");\nfrappe.realtime.on = function(event, callback) {\n\tfrappe.socketio.socket && frappe.socketio.socket.on(event, callback);\n};\n\nfrappe.realtime.off = function(event, callback) {\n\tfrappe.socketio.socket && frappe.socketio.socket.off(event, callback);\n}\n\nfrappe.realtime.publish = function(event, message) {\n\tif(frappe.socketio.socket) {\n\t\tfrappe.socketio.socket.emit(event, message);\n\t}\n}\n\nfrappe.socketio.SocketIOUploader = class SocketIOUploader {\n\tconstructor() {\n\t\tfrappe.socketio.socket.on('upload-request-slice', (data) => {\n\t\t\tvar place = data.currentSlice * this.chunk_size,\n\t\t\t\tslice = this.file.slice(place,\n\t\t\t\t\tplace + Math.min(this.chunk_size, this.file.size - place));\n\n\t\t\tif (this.on_progress) {\n\t\t\t\t// update progress\n\t\t\t\tthis.on_progress(place / this.file.size * 100);\n\t\t\t}\n\n\t\t\tthis.reader.readAsArrayBuffer(slice);\n\t\t\tthis.started = true;\n\t\t\tthis.keep_alive();\n\t\t});\n\n\t\tfrappe.socketio.socket.on('upload-end', (data) => {\n\t\t\tthis.reader = null;\n\t\t\tthis.file = null;\n\t\t\tif (data.file_url.substr(0, 7)==='/public') {\n\t\t\t\tdata.file_url = data.file_url.substr(7);\n\t\t\t}\n\t\t\tthis.callback(data);\n\t\t});\n\n\t\tfrappe.socketio.socket.on('upload-error', (data) => {\n\t\t\tthis.disconnect(false);\n\t\t\tfrappe.msgprint({\n\t\t\t\ttitle: __('Upload Failed'),\n\t\t\t\tmessage: data.error,\n\t\t\t\tindicator: 'red'\n\t\t\t});\n\t\t});\n\n\t\tfrappe.socketio.socket.on('disconnect', () => {\n\t\t\tthis.disconnect();\n\t\t});\n\t}\n\n\tstart({file=null, is_private=0, filename='', callback=null, on_progress=null,\n\t\tchunk_size=24576, fallback=null} = {}) {\n\n\t\tif (this.reader) {\n\t\t\tfrappe.throw(__('File Upload in Progress. Please try again in a few moments.'));\n\t\t}\n\n\t\tfunction fallback_required() {\n\t\t\treturn !frappe.socketio.socket.connected\n\t\t\t\t|| !( !frappe.boot.sysdefaults || frappe.boot.sysdefaults.use_socketio_to_upload_file );\n\t\t}\n\n\t\tif (fallback_required()) {\n\t\t\treturn fallback ? fallback() : frappe.throw(__('Socketio is not connected. Cannot upload'));\n\t\t}\n\n\t\tthis.reader = new FileReader();\n\t\tthis.file = file;\n\t\tthis.chunk_size = chunk_size;\n\t\tthis.callback = callback;\n\t\tthis.on_progress = on_progress;\n\t\tthis.fallback = fallback;\n\t\tthis.started = false;\n\n\t\tthis.reader.onload = () => {\n\t\t\tfrappe.socketio.socket.emit('upload-accept-slice', {\n\t\t\t\tis_private: is_private,\n\t\t\t\tname: filename,\n\t\t\t\ttype: this.file.type,\n\t\t\t\tsize: this.file.size,\n\t\t\t\tdata: this.reader.result\n\t\t\t});\n\t\t\tthis.keep_alive();\n\t\t};\n\n\t\tvar slice = file.slice(0, this.chunk_size);\n\t\tthis.reader.readAsArrayBuffer(slice);\n\t}\n\n\tkeep_alive() {\n\t\tif (this.next_check) {\n\t\t\tclearTimeout (this.next_check);\n\t\t}\n\t\tthis.next_check = setTimeout (() => {\n\t\t\tif (!this.started) {\n\t\t\t\t// upload never started, so try fallback\n\t\t\t\tif (this.fallback) {\n\t\t\t\t\tthis.fallback();\n\t\t\t\t} else {\n\t\t\t\t\tthis.disconnect();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.disconnect();\n\t\t}, 3000);\n\t}\n\n\tdisconnect(with_message = true) {\n\t\tif (this.reader) {\n\t\t\tthis.reader = null;\n\t\t\tthis.file = null;\n\t\t\tfrappe.hide_progress();\n\t\t\tif (with_message) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('File Upload'),\n\t\t\t\t\tmessage: __('File Upload Disconnected. Please try again.'),\n\t\t\t\t\tindicator: 'red'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n/*\n\nInheritence \"Class\"\n-------------------\nsee: http://ejohn.org/blog/simple-javascript-inheritance/\nTo subclass, use:\n\n\tvar MyClass = Class.extend({\n\t\tinit: function\n\t})\n\n*/\n// https://stackoverflow.com/a/15052240/5353542\n\n/* Simple JavaScript Inheritance for ES 5.1\n * based on http://ejohn.org/blog/simple-javascript-inheritance/\n *  (inspired by base2 and Prototype)\n * MIT Licensed.\n */\n(function(global) {\n\t\"use strict\";\n\tvar fnTest = /xyz/.test(function(){xyz;}) ? /\\b_super\\b/ : /.*/;\n\n\t// The base Class implementation (does nothing)\n\tfunction Class(){}\n\n\t// Create a new Class that inherits from this class\n\tClass.extend = function(props) {\n\t  var _super = this.prototype;\n\n\t  // Set up the prototype to inherit from the base class\n\t  // (but without running the init constructor)\n\t  var proto = Object.create(_super);\n\n\t  // Copy the properties over onto the new prototype\n\t  for (var name in props) {\n\t\t// Check if we're overwriting an existing function\n\t\tproto[name] = typeof props[name] === \"function\" &&\n\t\t  typeof _super[name] == \"function\" && fnTest.test(props[name])\n\t\t  ? (function(name, fn){\n\t\t\t  return function() {\n\t\t\t\tvar tmp = this._super;\n\n\t\t\t\t// Add a new ._super() method that is the same method\n\t\t\t\t// but on the super-class\n\t\t\t\tthis._super = _super[name];\n\n\t\t\t\t// The method only need to be bound temporarily, so we\n\t\t\t\t// remove it when we're done executing\n\t\t\t\tvar ret = fn.apply(this, arguments);\n\t\t\t\tthis._super = tmp;\n\n\t\t\t\treturn ret;\n\t\t\t  };\n\t\t\t})(name, props[name])\n\t\t  : props[name];\n\t  }\n\n\t  // The new constructor\n\t  var newClass = typeof proto.init === \"function\"\n\t\t? proto.hasOwnProperty(\"init\")\n\t\t  ? proto.init // All construction is actually done in the init method\n\t\t  : function SubClass(){ _super.init.apply(this, arguments); }\n\t\t: function EmptyClass(){};\n\n\t  // Populate our constructed prototype object\n\t  newClass.prototype = proto;\n\n\t  // Enforce the constructor to be what we expect\n\t  proto.constructor = newClass;\n\n\t  // And make this class extendable\n\t  newClass.extend = Class.extend;\n\n\t  return newClass;\n\t};\n\n\t// export\n\tglobal.Class = Class;\n  })(this);","import '../class';\n\nfrappe.ui.form.Layout = Class.extend({\n\tinit: function(opts) {\n\t\tthis.views = {};\n\t\tthis.pages = [];\n\t\tthis.sections = [];\n\t\tthis.fields_list = [];\n\t\tthis.fields_dict = {};\n\n\t\t$.extend(this, opts);\n\t},\n\tmake: function() {\n\t\tif(!this.parent && this.body) {\n\t\t\tthis.parent = this.body;\n\t\t}\n\t\tthis.wrapper = $('<div class=\"form-layout\">').appendTo(this.parent);\n\t\tthis.message = $('<div class=\"form-message text-muted small hidden\"></div>').appendTo(this.wrapper);\n\t\tif(!this.fields) {\n\t\t\tthis.fields = this.get_doctype_fields();\n\t\t}\n\t\tthis.setup_tabbing();\n\t\tthis.render();\n\t},\n\tshow_empty_form_message: function() {\n\t\tif(!(this.wrapper.find(\".frappe-control:visible\").length || this.wrapper.find(\".section-head.collapsed\").length)) {\n\t\t\tthis.show_message(__(\"This form does not have any input\"));\n\t\t}\n\t},\n\tget_doctype_fields: function() {\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tparent: this.frm.doctype,\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tfieldname: '__newname',\n\t\t\t\treqd: 1,\n\t\t\t\thidden: 1,\n\t\t\t\tlabel: __('Name'),\n\t\t\t\tget_status: function(field) {\n\t\t\t\t\tif (field.frm && field.frm.is_new()\n\t\t\t\t\t\t&& field.frm.meta.autoname\n\t\t\t\t\t\t&& ['prompt', 'name'].includes(field.frm.meta.autoname.toLowerCase())) {\n\t\t\t\t\t\treturn 'Write';\n\t\t\t\t\t}\n\t\t\t\t\treturn 'None';\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tfields = fields.concat(frappe.meta.sort_docfields(frappe.meta.docfield_map[this.doctype]));\n\t\treturn fields;\n\t},\n\tshow_message: function(html, color) {\n\t\tif (this.message_color) {\n\t\t\t// remove previous color\n\t\t\tthis.message.removeClass(this.message_color);\n\t\t}\n\t\tthis.message_color = (color && ['yellow', 'blue'].includes(color)) ? color : 'blue';\n\t\tif(html) {\n\t\t\tif(html.substr(0, 1)!=='<') {\n\t\t\t\t// wrap in a block\n\t\t\t\thtml = '<div>' + html + '</div>';\n\t\t\t}\n\t\t\tthis.message.removeClass('hidden').addClass(this.message_color);\n\t\t\t$(html).appendTo(this.message);\n\t\t} else {\n\t\t\tthis.message.empty().addClass('hidden');\n\t\t}\n\t},\n\trender: function(new_fields) {\n\t\tvar me = this;\n\t\tvar fields = new_fields || this.fields;\n\n\t\tthis.section = null;\n\t\tthis.column = null;\n\n\t\tif (this.with_dashboard) {\n\t\t\tthis.setup_dashboard_section();\n\t\t}\n\n\t\tif (this.no_opening_section()) {\n\t\t\tthis.make_section();\n\t\t}\n\t\t$.each(fields, function(i, df) {\n\t\t\tswitch(df.fieldtype) {\n\t\t\t\tcase \"Fold\":\n\t\t\t\t\tme.make_page(df);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"Section Break\":\n\t\t\t\t\tme.make_section(df);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"Column Break\":\n\t\t\t\t\tme.make_column(df);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tme.make_field(df);\n\t\t\t}\n\t\t});\n\n\t},\n\n\tno_opening_section: function() {\n\t\treturn (this.fields[0] && this.fields[0].fieldtype!=\"Section Break\") || !this.fields.length;\n\t},\n\n\tsetup_dashboard_section: function() {\n\t\tif (this.no_opening_section()) {\n\t\t\tthis.fields.unshift({fieldtype: 'Section Break'});\n\t\t}\n\n\t\tthis.fields.unshift({\n\t\t\tfieldtype: 'Section Break',\n\t\t\tfieldname: '_form_dashboard',\n\t\t\tlabel: __('Dashboard'),\n\t\t\tcssClass: 'form-dashboard',\n\t\t\tcollapsible: 1,\n\t\t\t// hidden: 1\n\t\t});\n\t},\n\n\treplace_field: function(fieldname, df, render) {\n\t\tdf.fieldname = fieldname; // change of fieldname is avoided\n\t\tif (this.fields_dict[fieldname] && this.fields_dict[fieldname].df) {\n\t\t\tconst fieldobj = this.init_field(df, render);\n\t\t\tthis.fields_dict[fieldname].$wrapper.remove();\n\t\t\tthis.fields_list.splice(this.fields_dict[fieldname], 1, fieldobj);\n\t\t\tthis.fields_dict[fieldname] = fieldobj;\n\t\t\tif (this.frm) {\n\t\t\t\tfieldobj.perm = this.frm.perm;\n\t\t\t}\n\t\t\tthis.section.fields_list.splice(this.section.fields_dict[fieldname], 1, fieldobj);\n\t\t\tthis.section.fields_dict[fieldname] = fieldobj;\n\t\t\tthis.refresh_fields([df]);\n\t\t}\n\t},\n\n\tmake_field: function(df, colspan, render) {\n\t\t!this.section && this.make_section();\n\t\t!this.column && this.make_column();\n\n\t\tconst fieldobj = this.init_field(df, render);\n\t\tthis.fields_list.push(fieldobj);\n\t\tthis.fields_dict[df.fieldname] = fieldobj;\n\t\tif(this.frm) {\n\t\t\tfieldobj.perm = this.frm.perm;\n\t\t}\n\n\t\tthis.section.fields_list.push(fieldobj);\n\t\tthis.section.fields_dict[df.fieldname] = fieldobj;\n\t\tfieldobj.section = this.section;\n\t},\n\n\tinit_field: function(df, render = false) {\n\t\tconst fieldobj = frappe.ui.form.make_control({\n\t\t\tdf: df,\n\t\t\tdoctype: this.doctype,\n\t\t\tparent: this.column.wrapper.get(0),\n\t\t\tfrm: this.frm,\n\t\t\trender_input: render,\n\t\t\tdoc: this.doc\n\t\t});\n\n\t\tfieldobj.layout = this;\n\t\treturn fieldobj;\n\t},\n\n\tmake_page: function(df) {\n\t\tvar me = this,\n\t\t\thead = $('<div class=\"form-clickable-section text-center\">\\\n\t\t\t\t<a class=\"btn-fold h6 text-muted\">'+__(\"Show more details\")+'</a>\\\n\t\t\t</div>').appendTo(this.wrapper);\n\n\t\tthis.page = $('<div class=\"form-page second-page hide\"></div>').appendTo(this.wrapper);\n\n\t\tthis.fold_btn = head.find(\".btn-fold\").on(\"click\", function() {\n\t\t\tvar page = $(this).parent().next();\n\t\t\tif(page.hasClass(\"hide\")) {\n\t\t\t\t$(this).removeClass(\"btn-fold\").html(__(\"Hide details\"));\n\t\t\t\tpage.removeClass(\"hide\");\n\t\t\t\tfrappe.utils.scroll_to($(this), true, 30);\n\t\t\t\tme.folded = false;\n\t\t\t} else {\n\t\t\t\t$(this).addClass(\"btn-fold\").html(__(\"Show more details\"));\n\t\t\t\tpage.addClass(\"hide\");\n\t\t\t\tme.folded = true;\n\t\t\t}\n\t\t});\n\n\t\tthis.section = null;\n\t\tthis.folded = true;\n\t},\n\n\tunfold: function() {\n\t\tthis.fold_btn.trigger('click');\n\t},\n\n\tmake_section: function(df) {\n\t\tthis.section = new frappe.ui.form.Section(this, df);\n\n\t\t// append to layout fields\n\t\tif(df) {\n\t\t\tthis.fields_dict[df.fieldname] = this.section;\n\t\t\tthis.fields_list.push(this.section);\n\t\t}\n\n\t\tthis.column = null;\n\t},\n\n\tmake_column: function(df) {\n\t\tthis.column = new frappe.ui.form.Column(this.section, df);\n\t\tif(df && df.fieldname) {\n\t\t\tthis.fields_list.push(this.column);\n\t\t}\n\t},\n\n\trefresh: function(doc) {\n\t\tvar me = this;\n\t\tif(doc) this.doc = doc;\n\n\t\tif (this.frm) {\n\t\t\tthis.wrapper.find(\".empty-form-alert\").remove();\n\t\t}\n\n\t\t// NOTE this might seem redundant at first, but it needs to be executed when frm.refresh_fields is called\n\t\tme.attach_doc_and_docfields(true);\n\n\t\tif(this.frm && this.frm.wrapper) {\n\t\t\t$(this.frm.wrapper).trigger(\"refresh-fields\");\n\t\t}\n\n\t\t// dependent fields\n\t\tthis.refresh_dependency();\n\n\t\t// refresh sections\n\t\tthis.refresh_sections();\n\n\t\t// collapse sections\n\t\tif(this.frm) {\n\t\t\tthis.refresh_section_collapse();\n\t\t}\n\t},\n\n\trefresh_sections: function() {\n\t\tvar cnt = 0;\n\n\t\t// hide invisible sections and set alternate background color\n\t\tthis.wrapper.find(\".form-section:not(.hide-control)\").each(function() {\n\t\t\tvar $this = $(this).removeClass(\"empty-section\")\n\t\t\t\t.removeClass(\"visible-section\")\n\t\t\t\t.removeClass(\"shaded-section\");\n\t\t\tif(!$this.find(\".frappe-control:not(.hide-control)\").length\n\t\t\t\t&& !$this.hasClass('form-dashboard')) {\n\t\t\t\t// nothing visible, hide the section\n\t\t\t\t$this.addClass(\"empty-section\");\n\t\t\t} else {\n\t\t\t\t$this.addClass(\"visible-section\");\n\t\t\t\tif(cnt % 2) {\n\t\t\t\t\t$this.addClass(\"shaded-section\");\n\t\t\t\t}\n\t\t\t\tcnt++;\n\t\t\t}\n\t\t});\n\t},\n\n\trefresh_fields: function(fields) {\n\t\tlet fieldnames = fields.map((field) => {\n\t\t\tif(field.fieldname) return field.fieldname;\n\t\t});\n\n\t\tthis.fields_list.map(fieldobj => {\n\t\t\tif(fieldnames.includes(fieldobj.df.fieldname)) {\n\t\t\t\tfieldobj.refresh();\n\t\t\t\tif(fieldobj.df[\"default\"]) {\n\t\t\t\t\tfieldobj.set_input(fieldobj.df[\"default\"]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tadd_fields: function(fields) {\n\t\tthis.render(fields);\n\t\tthis.refresh_fields(fields);\n\t},\n\n\trefresh_section_collapse: function() {\n\t\tif(!this.doc) return;\n\n\t\tfor(var i=0; i<this.sections.length; i++) {\n\t\t\tvar section = this.sections[i];\n\t\t\tvar df = section.df;\n\t\t\tif(df && df.collapsible) {\n\t\t\t\tvar collapse = true;\n\n\t\t\t\tif(df.collapsible_depends_on) {\n\t\t\t\t\tcollapse = !this.evaluate_depends_on_value(df.collapsible_depends_on);\n\t\t\t\t}\n\n\t\t\t\tif (collapse && section.has_missing_mandatory()) {\n\t\t\t\t\tcollapse = false;\n\t\t\t\t}\n\n\t\t\t\tif(df.fieldname === '_form_dashboard') {\n\t\t\t\t\tcollapse = localStorage.getItem('collapseFormDashboard')==='yes' ? true : false;\n\t\t\t\t}\n\n\t\t\t\tsection.collapse(collapse);\n\t\t\t}\n\t\t}\n\t},\n\n\tattach_doc_and_docfields: function(refresh) {\n\t\tvar me = this;\n\t\tfor(var i=0, l=this.fields_list.length; i<l; i++) {\n\t\t\tvar fieldobj = this.fields_list[i];\n\t\t\tif(me.doc) {\n\t\t\t\tfieldobj.doc = me.doc;\n\t\t\t\tfieldobj.doctype = me.doc.doctype;\n\t\t\t\tfieldobj.docname = me.doc.name;\n\t\t\t\tfieldobj.df = frappe.meta.get_docfield(me.doc.doctype,\n\t\t\t\t\tfieldobj.df.fieldname, me.frm ? me.frm.doc.name : me.doc.name) || fieldobj.df;\n\n\t\t\t\t// on form change, permissions can change\n\t\t\t\tif(me.frm) {\n\t\t\t\t\tfieldobj.perm = me.frm.perm;\n\t\t\t\t}\n\t\t\t}\n\t\t\trefresh && fieldobj.df && fieldobj.refresh && fieldobj.refresh();\n\t\t}\n\t},\n\n\trefresh_section_count: function() {\n\t\tthis.wrapper.find(\".section-count-label:visible\").each(function(i) {\n\t\t\t$(this).html(i+1);\n\t\t});\n\t},\n\tsetup_tabbing: function() {\n\t\tvar me = this;\n\t\tthis.wrapper.on(\"keydown\", function(ev) {\n\t\t\tif(ev.which==9) {\n\t\t\t\tvar current = $(ev.target),\n\t\t\t\t\tdoctype = current.attr(\"data-doctype\"),\n\t\t\t\t\tfieldname = current.attr(\"data-fieldname\");\n\t\t\t\tif(doctype)\n\t\t\t\t\treturn me.handle_tab(doctype, fieldname, ev.shiftKey);\n\t\t\t}\n\t\t});\n\t},\n\thandle_tab: function(doctype, fieldname, shift) {\n\t\tvar me = this,\n\t\t\tgrid_row = null,\n\t\t\tprev = null,\n\t\t\tfields = me.fields_list,\n\t\t\tin_grid = false,\n\t\t\tfocused = false;\n\n\t\t// in grid\n\t\tif(doctype != me.doctype) {\n\t\t\tgrid_row = me.get_open_grid_row();\n\t\t\tif(!grid_row || !grid_row.layout) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfields = grid_row.layout.fields_list;\n\t\t}\n\n\t\tfor(var i=0, len=fields.length; i < len; i++) {\n\t\t\tif(fields[i].df.fieldname==fieldname) {\n\t\t\t\tif(shift) {\n\t\t\t\t\tif(prev) {\n\t\t\t\t\t\tthis.set_focus(prev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(this.primary_button).focus();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif(i < len-1) {\n\t\t\t\t\tfocused = me.focus_on_next_field(i, fields);\n\t\t\t\t}\n\n\t\t\t\tif (focused) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(this.is_visible(fields[i]))\n\t\t\t\tprev = fields[i];\n\t\t}\n\n\t\tif (!focused) {\n\t\t\t// last field in this group\n\t\t\tif(grid_row) {\n\t\t\t\t// in grid\n\t\t\t\tif(grid_row.doc.idx==grid_row.grid.grid_rows.length) {\n\t\t\t\t\t// last row, close it and find next field\n\t\t\t\t\tgrid_row.toggle_view(false, function() {\n\t\t\t\t\t\tgrid_row.grid.frm.layout.handle_tab(grid_row.grid.df.parent, grid_row.grid.df.fieldname);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// next row\n\t\t\t\t\tgrid_row.grid.grid_rows[grid_row.doc.idx].toggle_view(true);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$(this.primary_button).focus();\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\tfocus_on_next_field: function(start_idx, fields) {\n\t\t// loop to find next eligible fields\n\t\tfor(var i= start_idx + 1, len = fields.length; i < len; i++) {\n\t\t\tvar field = fields[i];\n\t\t\tif(this.is_visible(field)) {\n\t\t\t\tif(field.df.fieldtype===\"Table\") {\n\t\t\t\t\t// open table grid\n\t\t\t\t\tif(!(field.grid.grid_rows && field.grid.grid_rows.length)) {\n\t\t\t\t\t\t// empty grid, add a new row\n\t\t\t\t\t\tfield.grid.add_new_row();\n\t\t\t\t\t}\n\t\t\t\t\t// show grid row (if exists)\n\t\t\t\t\tfield.grid.grid_rows[0].show_form();\n\t\t\t\t\treturn true;\n\n\t\t\t\t} else if(!in_list(frappe.model.no_value_type, field.df.fieldtype)) {\n\t\t\t\t\tthis.set_focus(field);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tis_visible: function(field) {\n\t\treturn field.disp_status===\"Write\" && (field.$wrapper && field.$wrapper.is(\":visible\"));\n\t},\n\tset_focus: function(field) {\n\t\t// next is table, show the table\n\t\tif(field.df.fieldtype==\"Table\") {\n\t\t\tif(!field.grid.grid_rows.length) {\n\t\t\t\tfield.grid.add_new_row(1);\n\t\t\t} else {\n\t\t\t\tfield.grid.grid_rows[0].toggle_view(true);\n\t\t\t}\n\t\t} else if(field.editor) {\n\t\t\tfield.editor.set_focus();\n\t\t} else if(field.$input) {\n\t\t\tfield.$input.focus();\n\t\t}\n\t},\n\tget_open_grid_row: function() {\n\t\treturn $(\".grid-row-open\").data(\"grid_row\");\n\t},\n\trefresh_dependency: function() {\n\t\t// Resolve \"depends_on\" and show / hide accordingly\n\t\tvar me = this;\n\n\t\t// build dependants' dictionary\n\t\tvar has_dep = false;\n\n\t\tfor(var fkey in this.fields_list) {\n\t\t\tvar f = this.fields_list[fkey];\n\t\t\tf.dependencies_clear = true;\n\t\t\tif(f.df.depends_on) {\n\t\t\t\thas_dep = true;\n\t\t\t}\n\t\t}\n\n\t\tif(!has_dep)return;\n\n\t\t// show / hide based on values\n\t\tfor(var i=me.fields_list.length-1;i>=0;i--) {\n\t\t\tvar f = me.fields_list[i];\n\t\t\tf.guardian_has_value = true;\n\t\t\tif(f.df.depends_on) {\n\t\t\t\t// evaluate guardian\n\n\t\t\t\tf.guardian_has_value = this.evaluate_depends_on_value(f.df.depends_on);\n\n\t\t\t\t// show / hide\n\t\t\t\tif(f.guardian_has_value) {\n\t\t\t\t\tif(f.df.hidden_due_to_dependency) {\n\t\t\t\t\t\tf.df.hidden_due_to_dependency = false;\n\t\t\t\t\t\tf.refresh();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif(!f.df.hidden_due_to_dependency) {\n\t\t\t\t\t\tf.df.hidden_due_to_dependency = true;\n\t\t\t\t\t\tf.refresh();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.refresh_section_count();\n\t},\n\tevaluate_depends_on_value: function(expression) {\n\t\tvar out = null;\n\t\tvar doc = this.doc;\n\n\t\tif (!doc && this.get_values) {\n\t\t\tvar doc = this.get_values(true);\n\t\t}\n\n\t\tif (!doc) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar parent = this.frm ? this.frm.doc : this.doc || null;\n\n\t\tif(typeof(expression) === 'boolean') {\n\t\t\tout = expression;\n\n\t\t} else if(typeof(expression) === 'function') {\n\t\t\tout = expression(doc);\n\n\t\t} else if(expression.substr(0,5)=='eval:') {\n\t\t\ttry {\n\t\t\t\tout = eval(expression.substr(5));\n\t\t\t\tif(parent && parent.istable && expression.includes('is_submittable')) {\n\t\t\t\t\tout = true;\n\t\t\t\t}\n\t\t\t} catch(e) {\n\t\t\t\tfrappe.throw(__('Invalid \"depends_on\" expression'));\n\t\t\t}\n\n\t\t} else if(expression.substr(0,3)=='fn:' && this.frm) {\n\t\t\tout = this.frm.script_manager.trigger(expression.substr(3), this.doctype, this.docname);\n\t\t} else {\n\t\t\tvar value = doc[expression];\n\t\t\tif($.isArray(value)) {\n\t\t\t\tout = !!value.length;\n\t\t\t} else {\n\t\t\t\tout = !!value;\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t}\n});\n\nfrappe.ui.form.Section = Class.extend({\n\tinit: function(layout, df) {\n\t\tvar me = this;\n\t\tthis.layout = layout;\n\t\tthis.df = df || {};\n\t\tthis.fields_list = [];\n\t\tthis.fields_dict = {};\n\n\t\tthis.make();\n\t\t// if(this.frm)\n\t\t// \tthis.section.body.css({\"padding\":\"0px 3%\"})\n\t\tthis.row = {\n\t\t\twrapper: this.wrapper\n\t\t};\n\n\t\tif (this.df.collapsible && this.df.fieldname !== '_form_dashboard') {\n\t\t\tthis.collapse(true);\n\t\t}\n\n\t\tthis.refresh();\n\t},\n\tmake: function() {\n\t\tif(!this.layout.page) {\n\t\t\tthis.layout.page = $('<div class=\"form-page\"></div>').appendTo(this.layout.wrapper);\n\t\t}\n\n\t\tthis.wrapper = $('<div class=\"row form-section\">')\n\t\t\t.appendTo(this.layout.page);\n\t\tthis.layout.sections.push(this);\n\n\t\tif(this.df) {\n\t\t\tif(this.df.label) {\n\t\t\t\tthis.make_head();\n\t\t\t}\n\t\t\tif(this.df.description) {\n\t\t\t\t$('<div class=\"col-sm-12 small text-muted form-section-description\">' + __(this.df.description) + '</div>')\n\t\t\t\t\t.appendTo(this.wrapper);\n\t\t\t}\n\t\t\tif(this.df.cssClass) {\n\t\t\t\tthis.wrapper.addClass(this.df.cssClass);\n\t\t\t}\n\t\t}\n\n\n\t\t// for bc\n\t\tthis.body = $('<div class=\"section-body\">').appendTo(this.wrapper);\n\t},\n\tmake_head: function() {\n\t\tvar me = this;\n\t\tif(!this.df.collapsible) {\n\t\t\t$('<div class=\"col-sm-12\"><h6 class=\"form-section-heading uppercase\">'\n\t\t\t\t+ __(this.df.label) + '</h6></div>')\n\t\t\t\t.appendTo(this.wrapper);\n\t\t} else {\n\t\t\tthis.head = $('<div class=\"section-head\"><a class=\"h6 uppercase\">'\n\t\t\t\t+__(this.df.label)+'</a><span class=\"octicon octicon-chevron-down collapse-indicator\"></span></div>').appendTo(this.wrapper);\n\n\t\t\t// show / hide based on status\n\t\t\tthis.collapse_link = this.head.on(\"click\", function() {\n\t\t\t\tme.collapse();\n\t\t\t});\n\n\t\t\tthis.indicator = this.head.find(\".collapse-indicator\");\n\t\t}\n\t},\n\trefresh: function() {\n\t\tif(!this.df)\n\t\t\treturn;\n\n\t\t// hide if explictly hidden\n\t\tvar hide = this.df.hidden || this.df.hidden_due_to_dependency;\n\n\t\t// hide if no perm\n\t\tif(!hide && this.layout && this.layout.frm && !this.layout.frm.get_perm(this.df.permlevel || 0, \"read\")) {\n\t\t\thide = true;\n\t\t}\n\n\t\tthis.wrapper.toggleClass(\"hide-control\", !!hide);\n\t},\n\tcollapse: function(hide) {\n\t\t// unknown edge case\n\t\tif (!(this.head && this.body)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(hide===undefined) {\n\t\t\thide = !this.body.hasClass(\"hide\");\n\t\t}\n\n\t\tif (this.df.fieldname==='_form_dashboard') {\n\t\t\tlocalStorage.setItem('collapseFormDashboard', hide ? 'yes' : 'no');\n\t\t}\n\n\t\tthis.body.toggleClass(\"hide\", hide);\n\t\tthis.head.toggleClass(\"collapsed\", hide);\n\t\tthis.indicator.toggleClass(\"octicon-chevron-down\", hide);\n\t\tthis.indicator.toggleClass(\"octicon-chevron-up\", !hide);\n\n\t\t// refresh signature fields\n\t\tthis.fields_list.forEach((f) => {\n\t\t\tif (f.df.fieldtype=='Signature') {\n\t\t\t\tf.refresh();\n\t\t\t}\n\t\t});\n\t},\n\tis_collapsed() {\n\t\treturn this.body.hasClass('hide');\n\t},\n\thas_missing_mandatory: function() {\n\t\tvar missing_mandatory = false;\n\t\tfor (var j=0, l=this.fields_list.length; j < l; j++) {\n\t\t\tvar section_df = this.fields_list[j].df;\n\t\t\tif (section_df.reqd && this.layout.doc[section_df.fieldname]==null) {\n\t\t\t\tmissing_mandatory = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn missing_mandatory;\n\t}\n});\n\nfrappe.ui.form.Column = Class.extend({\n\tinit: function(section, df) {\n\t\tif(!df) df = {};\n\n\t\tthis.df = df;\n\t\tthis.section = section;\n\t\tthis.make();\n\t\tthis.resize_all_columns();\n\t},\n\tmake: function() {\n\t\tthis.wrapper = $('<div class=\"form-column\">\\\n\t\t\t<form>\\\n\t\t\t</form>\\\n\t\t</div>').appendTo(this.section.body)\n\t\t\t.find(\"form\")\n\t\t\t.on(\"submit\", function() {\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\tif (this.df.label) {\n\t\t\t$('<label class=\"control-label\">' + __(this.df.label)\n\t\t\t\t+ '</label>').appendTo(this.wrapper);\n\t\t}\n\t},\n\tresize_all_columns: function() {\n\t\t// distribute all columns equally\n\t\tvar colspan = cint(12 / this.section.wrapper.find(\".form-column\").length);\n\n\t\tthis.section.wrapper.find(\".form-column\").removeClass()\n\t\t\t.addClass(\"form-column\")\n\t\t\t.addClass(\"col-sm-\" + colspan);\n\n\t},\n\trefresh: function() {\n\t\tthis.section.refresh();\n\t}\n});\n","import '../form/layout';\n\nfrappe.provide('frappe.ui');\n\nfrappe.ui.FieldGroup = frappe.ui.form.Layout.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.dirty = false;\n\t\tthis._super();\n\t\t$.each(this.fields || [], function(i, f) {\n\t\t\tif(!f.fieldname && f.label) {\n\t\t\t\tf.fieldname = f.label.replace(/ /g, \"_\").toLowerCase();\n\t\t\t}\n\t\t})\n\t\tif(this.values) {\n\t\t\tthis.set_values(this.values);\n\t\t}\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tif(this.fields) {\n\t\t\tthis._super();\n\t\t\tthis.refresh();\n\t\t\t// set default\n\t\t\t$.each(this.fields_list, function(i, field) {\n\t\t\t\tif (field.df[\"default\"]) {\n\t\t\t\t\tlet def_value = field.df[\"default\"];\n\n\t\t\t\t\tif (def_value == 'Today' && field.df[\"fieldtype\"] == 'Date') {\n\t\t\t\t\t\tdef_value = frappe.datetime.get_today();\n\t\t\t\t\t}\n\n\t\t\t\t\tfield.set_input(def_value);\n\t\t\t\t\t// if default and has depends_on, render its fields.\n\t\t\t\t\tme.refresh_dependency();\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tif(!this.no_submit_on_enter) {\n\t\t\t\tthis.catch_enter_as_submit();\n\t\t\t}\n\n\t\t\t$(this.wrapper).find('input, select').on('change', () => {\n\t\t\t\tthis.dirty = true;\n\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t\t() => me.refresh_dependency()\n\t\t\t\t]);\n\t\t\t});\n\n\t\t}\n\t},\n\tfirst_button: false,\n\tfocus_on_first_input: function() {\n\t\tif(this.no_focus) return;\n\t\t$.each(this.fields_list, function(i, f) {\n\t\t\tif(!in_list(['Date', 'Datetime', 'Time', 'Check'], f.df.fieldtype) && f.set_focus) {\n\t\t\t\tf.set_focus();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t},\n\tcatch_enter_as_submit: function() {\n\t\tvar me = this;\n\t\t$(this.body).find('input[type=\"text\"], input[type=\"password\"], select').keypress(function(e) {\n\t\t\tif(e.which==13) {\n\t\t\t\tif(me.has_primary_action) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tme.get_primary_btn().trigger(\"click\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tget_input: function(fieldname) {\n\t\tvar field = this.fields_dict[fieldname];\n\t\treturn $(field.txt ? field.txt : field.input);\n\t},\n\tget_field: function(fieldname) {\n\t\treturn this.fields_dict[fieldname];\n\t},\n\tget_values: function(ignore_errors) {\n\t\tvar ret = {};\n\t\tvar errors = [];\n\t\tfor(var key in this.fields_dict) {\n\t\t\tvar f = this.fields_dict[key];\n\t\t\tif(f.get_value) {\n\t\t\t\tvar v = f.get_value();\n\t\t\t\tif(f.df.reqd && is_null(v))\n\t\t\t\t\terrors.push(__(f.df.label));\n\n\t\t\t\tif(!is_null(v)) ret[f.df.fieldname] = v;\n\t\t\t}\n\t\t}\n\t\tif(errors.length && !ignore_errors) {\n\t\t\tfrappe.msgprint({\n\t\t\t\ttitle: __('Missing Values Required'),\n\t\t\t\tmessage: __('Following fields have missing values:') +\n\t\t\t\t\t'<br><br><ul><li>' + errors.join('<li>') + '</ul>',\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\treturn null;\n\t\t}\n\t\treturn ret;\n\t},\n\tget_value: function(key) {\n\t\tvar f = this.fields_dict[key];\n\t\treturn f && (f.get_value ? f.get_value() : null);\n\t},\n\tset_value: function(key, val){\n\t\treturn new Promise(resolve => {\n\t\t\tvar f = this.fields_dict[key];\n\t\t\tif(f) {\n\t\t\t\tf.set_value(val).then(() => {\n\t\t\t\t\tf.set_input(val);\n\t\t\t\t\tthis.refresh_dependency();\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t},\n\tset_input: function(key, val) {\n\t\treturn this.set_value(key, val);\n\t},\n\tset_values: function(dict) {\n\t\tfor(var key in dict) {\n\t\t\tif(this.fields_dict[key]) {\n\t\t\t\tthis.set_value(key, dict[key]);\n\t\t\t}\n\t\t}\n\t},\n\tclear: function() {\n\t\tfor(var key in this.fields_dict) {\n\t\t\tvar f = this.fields_dict[key];\n\t\t\tif(f && f.set_input) {\n\t\t\t\tf.set_input(f.df['default'] || '');\n\t\t\t}\n\t\t}\n\t},\n\tset_df_property: function (fieldname, prop, value) {\n\t\tconst field    = this.get_field(fieldname);\n\t\tfield.df[prop] = value;\n\t\tfield.refresh();\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n// add a new dom element\nfrappe.provide('frappe.dom');\n\nfrappe.dom = {\n\tid_count: 0,\n\tfreeze_count: 0,\n\tby_id: function(id) {\n\t\treturn document.getElementById(id);\n\t},\n\tget_unique_id: function() {\n\t\tconst id = 'unique-' + frappe.dom.id_count;\n\t\tfrappe.dom.id_count++;\n\t\treturn id;\n\t},\n\tset_unique_id: function(ele) {\n\t\tvar $ele = $(ele);\n\t\tif($ele.attr('id')) {\n\t\t\treturn $ele.attr('id');\n\t\t}\n\t\tvar id = 'unique-' + frappe.dom.id_count;\n\t\t$ele.attr('id', id);\n\t\tfrappe.dom.id_count++;\n\t\treturn id;\n\t},\n\teval: function(txt) {\n\t\tif(!txt) return;\n\t\tvar el = document.createElement('script');\n\t\tel.appendChild(document.createTextNode(txt));\n\t\t// execute the script globally\n\t\tdocument.getElementsByTagName('head')[0].appendChild(el);\n\t},\n\tremove_script_and_style: function(txt) {\n\t\tconst evil_tags = [\"script\", \"style\", \"noscript\", \"title\", \"meta\", \"base\", \"head\"];\n\t\tconst regex = new RegExp(evil_tags.map(tag => `<${tag}>.*<\\\\/${tag}>`).join('|'));\n\t\tif (!regex.test(txt)) {\n\t\t\t// no evil tags found, skip the DOM method entirely!\n\t\t\treturn txt;\n\t\t}\n\n\t\tvar div = document.createElement('div');\n\t\tdiv.innerHTML = txt;\n\t\tvar found = false;\n\t\tevil_tags.forEach(function(e) {\n\t\t\tvar elements = div.getElementsByTagName(e);\n\t\t\ti = elements.length;\n\t\t\twhile (i--) {\n\t\t\t\tfound = true;\n\t\t\t\telements[i].parentNode.removeChild(elements[i]);\n\t\t\t}\n\t\t});\n\n\t\t// remove links with rel=\"stylesheet\"\n\t\tvar elements = div.getElementsByTagName('link');\n\t\tvar i = elements.length;\n\t\twhile (i--) {\n\t\t\tif (elements[i].getAttribute(\"rel\")==\"stylesheet\"){\n\t\t\t\tfound = true;\n\t\t\t\telements[i].parentNode.removeChild(elements[i]);\n\t\t\t}\n\t\t}\n\t\tif(found) {\n\t\t\treturn div.innerHTML;\n\t\t} else {\n\t\t\t// don't disturb\n\t\t\treturn txt;\n\t\t}\n\t},\n\tis_element_in_viewport: function (el, tolerance=0) {\n\n\t\t//special bonus for those using jQuery\n\t\tif (typeof jQuery === \"function\" && el instanceof jQuery) {\n\t\t\tel = el[0];\n\t\t}\n\n\t\tvar rect = el.getBoundingClientRect();\n\n\t\treturn (\n\t\t\trect.top + tolerance >= 0\n\t\t\t&& rect.left + tolerance >= 0\n\t\t\t&& rect.bottom - tolerance <= $(window).height()\n\t\t\t&& rect.right - tolerance <= $(window).width()\n\t\t);\n\t},\n\n\tset_style: function(txt, id) {\n\t\tif(!txt) return;\n\n\t\tvar se = document.createElement('style');\n\t\tse.type = \"text/css\";\n\n\t\tif (id) {\n\t\t\tvar element = document.getElementById(id);\n\t\t\tif (element) {\n\t\t\t\telement.parentNode.removeChild(element);\n\t\t\t}\n\t\t\tse.id = id;\n\t\t}\n\n\t\tif (se.styleSheet) {\n\t\t\tse.styleSheet.cssText = txt;\n\t\t} else {\n\t\t\tse.appendChild(document.createTextNode(txt));\n\t\t}\n\t\tdocument.getElementsByTagName('head')[0].appendChild(se);\n\t\treturn se;\n\t},\n\tadd: function(parent, newtag, className, cs, innerHTML, onclick) {\n\t\tif(parent && parent.substr)parent = frappe.dom.by_id(parent);\n\t\tvar c = document.createElement(newtag);\n\t\tif(parent)\n\t\t\tparent.appendChild(c);\n\n\t\t// if image, 3rd parameter is source\n\t\tif(className) {\n\t\t\tif(newtag.toLowerCase()=='img')\n\t\t\t\tc.src = className\n\t\t\telse\n\t\t\t\tc.className = className;\n\t\t}\n\t\tif(cs) frappe.dom.css(c,cs);\n\t\tif(innerHTML) c.innerHTML = innerHTML;\n\t\tif(onclick) c.onclick = onclick;\n\t\treturn c;\n\t},\n\tcss: function(ele, s) {\n\t\tif(ele && s) {\n\t\t\t$.extend(ele.style, s);\n\t\t}\n\t\treturn ele;\n\t},\n\tactivate: function($parent, $child, common_class, active_class='active') {\n\t\t$parent.find(`.${common_class}.${active_class}`)\n\t\t\t.removeClass(active_class);\n\t\t$child.addClass(active_class);\n\t},\n\tfreeze: function(msg, css_class) {\n\t\t// blur\n\t\tif(!$('#freeze').length) {\n\t\t\tvar freeze = $('<div id=\"freeze\" class=\"modal-backdrop fade\"></div>')\n\t\t\t\t.on(\"click\", function() {\n\t\t\t\t\tif (cur_frm && cur_frm.cur_grid) {\n\t\t\t\t\t\tcur_frm.cur_grid.toggle_view();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.appendTo(\"#body_div\");\n\n\t\t\tfreeze.html(repl('<div class=\"freeze-message-container\"><div class=\"freeze-message\"><p class=\"lead\">%(msg)s</p></div></div>',\n\t\t\t\t{msg: msg || \"\"}));\n\n\t\t\tsetTimeout(function() { freeze.addClass(\"in\") }, 1);\n\n\t\t} else {\n\t\t\t$(\"#freeze\").addClass(\"in\");\n\t\t}\n\n\t\tif (css_class) {\n\t\t\t$(\"#freeze\").addClass(css_class);\n\t\t}\n\n\t\tfrappe.dom.freeze_count++;\n\t},\n\tunfreeze: function() {\n\t\tif(!frappe.dom.freeze_count) return; // anything open?\n\t\tfrappe.dom.freeze_count--;\n\t\tif(!frappe.dom.freeze_count) {\n\t\t\tvar freeze = $('#freeze').removeClass(\"in\").remove();\n\t\t}\n\t},\n\tsave_selection: function() {\n\t\t// via http://stackoverflow.com/questions/5605401/insert-link-in-contenteditable-element\n\t\tif (window.getSelection) {\n\t\t\tvar sel = window.getSelection();\n\t\t\tif (sel.getRangeAt && sel.rangeCount) {\n\t\t\t\tvar ranges = [];\n\t\t\t\tfor (var i = 0, len = sel.rangeCount; i < len; ++i) {\n\t\t\t\t\tranges.push(sel.getRangeAt(i));\n\t\t\t\t}\n\t\t\t\treturn ranges;\n\t\t\t}\n\t\t} else if (document.selection && document.selection.createRange) {\n\t\t\treturn document.selection.createRange();\n\t\t}\n\t\treturn null;\n\t},\n\trestore_selection: function(savedSel) {\n\t\tif (savedSel) {\n\t\t\tif (window.getSelection) {\n\t\t\t\tvar sel = window.getSelection();\n\t\t\t\tsel.removeAllRanges();\n\t\t\t\tfor (var i = 0, len = savedSel.length; i < len; ++i) {\n\t\t\t\t\tsel.addRange(savedSel[i]);\n\t\t\t\t}\n\t\t\t} else if (document.selection && savedSel.select) {\n\t\t\t\tsavedSel.select();\n\t\t\t}\n\t\t}\n\t},\n\tis_touchscreen: function() {\n\t\treturn ('ontouchstart' in window)\n\t},\n\thandle_broken_images(container) {\n\t\t$(container).find('img').on('error', (e) => {\n\t\t\tconst $img = $(e.currentTarget);\n\t\t\t$img.addClass('no-image');\n\t\t});\n\t},\n\tscroll_to_bottom(container) {\n\t\tconst $container = $(container);\n\t\t$container.scrollTop($container[0].scrollHeight);\n\t},\n\tfile_to_base64(file_obj) {\n\t\treturn new Promise(resolve => {\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onload = function() {\n\t\t\t\tresolve(reader.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(file_obj);\n\t\t});\n\t},\n\tscroll_to_section(section_name) {\n\t\tsetTimeout(() => {\n\t\t\tconst section = $(`a:contains(\"${section_name}\")`);\n\t\t\tif (section.length) {\n\t\t\t\tif(section.parent().hasClass('collapsed')) {\n\t\t\t\t\t// opens the section\n\t\t\t\t\tsection.click();\n\t\t\t\t}\n\t\t\t\tfrappe.ui.scroll(section.parent().parent());\n\t\t\t}\n\t\t}, 200);\n\t},\n\tpixel_to_inches(pixels) {\n\t\tconst div = $('<div id=\"dpi\" style=\"height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;\"></div>');\n\t\tdiv.appendTo(document.body);\n\n\t\tconst dpi_x = document.getElementById('dpi').offsetWidth;\n\t\tconst inches = pixels / dpi_x;\n\t\tdiv.remove();\n\n\t\treturn inches;\n\t}\n};\n\nfrappe.ellipsis = function(text, max) {\n\tif(!max) max = 20;\n\ttext = cstr(text);\n\tif(text.length > max) {\n\t\ttext = text.substr(0, max) + '...';\n\t}\n\treturn text;\n};\n\nfrappe.run_serially = function(tasks) {\n\tvar result = Promise.resolve();\n\ttasks.forEach(task => {\n\t\tif(task) {\n\t\t\tresult = result.then ? result.then(task) : Promise.resolve();\n\t\t}\n\t});\n\treturn result;\n};\n\nfrappe.load_image = (src, onload, onerror, preprocess = () => {}) => {\n\tvar tester = new Image();\n\ttester.onload = function() {\n\t\tonload(this);\n\t};\n\ttester.onerror = onerror;\n\n\tpreprocess(tester);\n\ttester.src = src;\n}\n\nfrappe.timeout = seconds => {\n\treturn new Promise((resolve) => {\n\t\tsetTimeout(() => resolve(), seconds * 1000);\n\t});\n};\n\nfrappe.scrub = function(text, spacer='_') {\n\treturn text.replace(/ /g, spacer).toLowerCase();\n};\n\nfrappe.get_modal = function(title, content) {\n\treturn $(`<div class=\"modal fade\" style=\"overflow: auto;\" tabindex=\"-1\">\n\t\t<div class=\"modal-dialog\">\n\t\t\t<div class=\"modal-content\">\n\t\t\t\t<div class=\"modal-header\">\n\t\t\t\t\t<div class=\"flex justify-between\">\n\t\t\t\t\t\t<div class=\"fill-width flex\">\n\t\t\t\t\t\t\t<span class=\"indicator hidden\"></span>\n\t\t\t\t\t\t\t<h4 class=\"modal-title\" style=\"font-weight: bold;\">${title}</h4>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"text-right buttons\">\n\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-default btn-sm btn-modal-minimize hide\">\n\t\t\t\t\t\t\t\t\t<i class=\"octicon octicon-chevron-down\" style=\"padding: 1px 0px;\"></i>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-default btn-sm btn-modal-close\" data-dismiss=\"modal\">\n\t\t\t\t\t\t\t\t\t<i class=\"octicon octicon-x visible-xs\" style=\"padding: 1px 0px;\"></i>\n\t\t\t\t\t\t\t\t\t<span class=\"hidden-xs\">${__(\"Close\")}</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary btn-sm hide\">\n\t\t\t\t\t\t\t\t\t${__(\"Confirm\")}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"modal-body ui-front\">${content}</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>`);\n};\n\nfrappe.is_online = function() {\n\tif (frappe.boot.developer_mode == 1) {\n\t\t// always online in developer_mode\n\t\treturn true;\n\t}\n\tif ('onLine' in navigator) {\n\t\treturn navigator.onLine;\n\t}\n\treturn true;\n};\n\n// bind online/offline events\n$(window).on('online', function() {\n\tfrappe.show_alert({\n\t\tindicator: 'green',\n\t\tmessage: __('You are connected to internet.')\n\t});\n});\n\n$(window).on('offline', function() {\n\tfrappe.show_alert({\n\t\tindicator: 'orange',\n\t\tmessage: __('Connection lost. Some features might not work.')\n\t});\n});\n","\nimport './field_group';\nimport '../dom';\n\nfrappe.provide('frappe.ui');\n\nwindow.cur_dialog = null;\n\nfrappe.ui.open_dialogs = [];\n\nfrappe.ui.Dialog = class Dialog extends frappe.ui.FieldGroup {\n\tconstructor(opts) {\n\t\tsuper();\n\t\tthis.display = false;\n\t\tthis.is_dialog = true;\n\n\t\t$.extend(this, { animate: true, size: null }, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.$wrapper = frappe.get_modal(\"\", \"\");\n\n\t\tif(this.static) {\n\t\t\tthis.$wrapper.modal({\n\t\t\t\tbackdrop: 'static',\n\t\t\t\tkeyboard: false\n\t\t\t});\n\t\t\tthis.get_close_btn().hide();\n\t\t}\n\n\t\tthis.wrapper = this.$wrapper.find('.modal-dialog')\n\t\t\t.get(0);\n\t\tif ( this.size == \"small\" )\n\t\t\t$(this.wrapper).addClass(\"modal-sm\");\n\t\telse if ( this.size == \"large\" )\n\t\t\t$(this.wrapper).addClass(\"modal-lg\");\n\n\t\tthis.make_head();\n\t\tthis.modal_body = this.$wrapper.find(\".modal-body\");\n\t\tthis.$body = $('<div></div>').appendTo(this.modal_body);\n\t\tthis.body = this.$body.get(0);\n\t\tthis.$message = $('<div class=\"hide modal-message\"></div>').appendTo(this.modal_body);\n\t\tthis.header = this.$wrapper.find(\".modal-header\");\n\t\tthis.buttons = this.header.find('.buttons');\n\t\tthis.set_indicator();\n\n\t\t// make fields (if any)\n\t\tsuper.make();\n\n\t\t// show footer\n\t\tthis.action = this.action || { primary: { }, secondary: { } };\n\t\tif(this.primary_action || (this.action.primary && this.action.primary.onsubmit)) {\n\t\t\tthis.set_primary_action(this.primary_action_label || this.action.primary.label || __(\"Submit\"),\n\t\t\t\tthis.primary_action || this.action.primary.onsubmit);\n\t\t}\n\n\t\tif(this.secondary_action) {\n\t\t\tthis.set_secondary_action(this.secondary_action);\n\t\t}\n\n\t\tif (this.secondary_action_label || (this.action.secondary && this.action.secondary.label)) {\n\t\t\tthis.get_close_btn().html(this.secondary_action_label || this.action.secondary.label);\n\t\t}\n\n\t\tif (this.minimizable) {\n\t\t\tthis.header.find('.modal-title').click(() => this.toggle_minimize());\n\t\t\tthis.get_minimize_btn().removeClass('hide').on('click', () => this.toggle_minimize());\n\t\t}\n\n\t\tvar me = this;\n\t\tthis.$wrapper\n\t\t\t.on(\"hide.bs.modal\", function() {\n\t\t\t\tme.display = false;\n\t\t\t\tme.secondary_action && me.secondary_action();\n\n\t\t\t\tif(frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]===me) {\n\t\t\t\t\tfrappe.ui.open_dialogs.pop();\n\t\t\t\t\tif(frappe.ui.open_dialogs.length) {\n\t\t\t\t\t\twindow.cur_dialog = frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\twindow.cur_dialog = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tme.onhide && me.onhide();\n\t\t\t\tme.on_hide && me.on_hide();\n\t\t\t})\n\t\t\t.on(\"shown.bs.modal\", function() {\n\t\t\t\t// focus on first input\n\t\t\t\tme.display = true;\n\t\t\t\twindow.cur_dialog = me;\n\t\t\t\tfrappe.ui.open_dialogs.push(me);\n\t\t\t\tme.focus_on_first_input();\n\t\t\t\tme.on_page_show && me.on_page_show();\n\t\t\t\t$(document).trigger('frappe.ui.Dialog:shown');\n\t\t\t})\n\t\t\t.on('scroll', function() {\n\t\t\t\tvar $input = $('input:focus');\n\t\t\t\tif($input.length && ['Date', 'Datetime', 'Time'].includes($input.attr('data-fieldtype'))) {\n\t\t\t\t\t$input.blur();\n\t\t\t\t}\n\t\t\t});\n\n\t}\n\n\tget_primary_btn() {\n\t\treturn this.$wrapper.find(\".modal-header .btn-primary\");\n\t}\n\n\tget_minimize_btn() {\n\t\treturn this.$wrapper.find(\".modal-header .btn-modal-minimize\");\n\t}\n\n\tset_message(text) {\n\t\tthis.$message.removeClass('hide');\n\t\tthis.$body.addClass('hide');\n\t\tthis.$message.text(text);\n\t}\n\n\tclear_message() {\n\t\tthis.$message.addClass('hide');\n\t\tthis.$body.removeClass('hide');\n\t}\n\n\tclear() {\n\t\tsuper.clear();\n\t\tthis.clear_message();\n\t}\n\n\tset_primary_action(label, click) {\n\t\tthis.has_primary_action = true;\n\t\tvar me = this;\n\t\treturn this.get_primary_btn()\n\t\t\t.removeClass(\"hide\")\n\t\t\t.html(label)\n\t\t\t.click(function() {\n\t\t\t\tme.primary_action_fulfilled = true;\n\t\t\t\t// get values and send it\n\t\t\t\t// as first parameter to click callback\n\t\t\t\t// if no values then return\n\t\t\t\tvar values = me.get_values();\n\t\t\t\tif(!values) return;\n\t\t\t\tclick && click.apply(me, [values]);\n\t\t\t});\n\t}\n\n\tset_secondary_action(click) {\n\t\tthis.get_close_btn().on('click', click);\n\t}\n\n\tdisable_primary_action() {\n\t\tthis.get_primary_btn().addClass('disabled');\n\t}\n\tenable_primary_action() {\n\t\tthis.get_primary_btn().removeClass('disabled');\n\t}\n\tmake_head() {\n\t\tthis.set_title(this.title);\n\t}\n\tset_title(t) {\n\t\tthis.$wrapper.find(\".modal-title\").html(t);\n\t}\n\tset_indicator() {\n\t\tif (this.indicator) {\n\t\t\tthis.header.find('.indicator').removeClass().addClass('indicator ' + this.indicator);\n\t\t}\n\t}\n\tshow() {\n\t\t// show it\n\t\tif ( this.animate ) {\n\t\t\tthis.$wrapper.addClass('fade');\n\t\t} else {\n\t\t\tthis.$wrapper.removeClass('fade');\n\t\t}\n\t\tthis.$wrapper.modal(\"show\");\n\n\t\t// clear any message\n\t\tthis.clear_message();\n\n\t\tthis.primary_action_fulfilled = false;\n\t\tthis.is_visible = true;\n\t\treturn this;\n\t}\n\thide() {\n\t\tthis.$wrapper.modal(\"hide\");\n\t\tthis.is_visible = false;\n\t}\n\tget_close_btn() {\n\t\treturn this.$wrapper.find(\".btn-modal-close\");\n\t}\n\tno_cancel() {\n\t\tthis.get_close_btn().toggle(false);\n\t}\n\tcancel() {\n\t\tthis.get_close_btn().trigger(\"click\");\n\t}\n\ttoggle_minimize() {\n\t\tlet modal = this.$wrapper.closest('.modal').toggleClass('modal-minimize');\n\t\tmodal.attr('tabindex') ? modal.removeAttr('tabindex') : modal.attr('tabindex', -1);\n\t\tthis.get_minimize_btn().find('i').toggleClass('octicon-chevron-down').toggleClass('octicon-chevron-up');\n\t\tthis.is_minimized = !this.is_minimized;\n\t\tthis.on_minimize_toggle && this.on_minimize_toggle(this.is_minimized);\n\t\tthis.header.find('.modal-title').toggleClass('cursor-pointer');\n\t}\n};\n","// frappe.ui.Capture\n// Author - Achilles Rasquinha <achilles@frappe.io>\n\n/**\n * @description Converts a canvas, image or a video to a data URL string.\n * \n * @param \t{HTMLElement} element - canvas, img or video.\n * @returns {string} \t\t\t  - The data URL string.\n * \n * @example\n * frappe._.get_data_uri(video)\n * // returns \"data:image/pngbase64,...\"\n */\nfrappe._.get_data_uri = element =>\n{\n\tconst $element = $(element)\n\tconst width    = $element.width()\n\tconst height   = $element.height()\n\n\tconst $canvas     = $('<canvas/>')\n\t$canvas[0].width  = width\n\t$canvas[0].height = height\n\n\tconst context     = $canvas[0].getContext('2d')\n\tcontext.drawImage($element[0], 0, 0, width, height)\n\t\n\tconst data_uri = $canvas[0].toDataURL('image/png')\n\n\treturn data_uri\n}\n\n/**\n * @description Frappe's Capture object.\n * \n * @example\n * const capture = frappe.ui.Capture()\n * capture.show()\n * \n * capture.click((data_uri) => {\n * \t// do stuff\n * })\n * \n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Taking_still_photos\n */\nfrappe.ui.Capture = class\n{\n\tconstructor (options = { })\n\t{\n\t\tthis.options = frappe.ui.Capture.OPTIONS\n\t\tthis.set_options(options)\n\t}\n\t\n\tset_options (options)\n\t{\n\t\tthis.options = { ...frappe.ui.Capture.OPTIONS, ...options }\n\t\t\n\t\treturn this\n\t}\n\t\n\trender ( )\n\t{\n\t\treturn navigator.mediaDevices.getUserMedia({ video: true }).then(stream =>\n\t\t{\n\t\t\tthis.dialog \t = new frappe.ui.Dialog({\n\t\t\t\t  title: this.options.title,\n\t\t\t\tanimate: this.options.animate,\n\t\t\t\t action:\n\t\t\t\t{\n\t\t\t\t\tsecondary:\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"<b>&times</b>\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\n\t\t\tconst $e \t\t = $(frappe.ui.Capture.TEMPLATE)\n\t\t\t\n\t\t\tconst video      = $e.find('video')[0]\n\t\t\tvideo.srcObject  = stream\n\t\t\tvideo.play()\n\t\t\t\n\t\t\tconst $container = $(this.dialog.body)\n\t\t\t$container.html($e)\n\t\t\t\n\t\t\t$e.find('.fc-btf').hide()\n\n\t\t\t$e.find('.fc-bcp').click(() =>\n\t\t\t{\n\t\t\t\tconst data_url = frappe._.get_data_uri(video)\n\t\t\t\t$e.find('.fc-p').attr('src', data_url)\n\n\t\t\t\t$e.find('.fc-s').hide()\n\t\t\t\t$e.find('.fc-p').show()\n\n\t\t\t\t$e.find('.fc-btu').hide()\n\t\t\t\t$e.find('.fc-btf').show()\n\t\t\t})\n\n\t\t\t$e.find('.fc-br').click(() =>\n\t\t\t{\n\t\t\t\t$e.find('.fc-p').hide()\n\t\t\t\t$e.find('.fc-s').show()\n\n\t\t\t\t$e.find('.fc-btf').hide()\n\t\t\t\t$e.find('.fc-btu').show()\n\t\t\t})\n\n\t\t\t$e.find('.fc-bs').click(() =>\n\t\t\t{\n\t\t\t\tconst data_url = frappe._.get_data_uri(video)\n\t\t\t\tthis.hide()\n\t\t\t\t\n\t\t\t\tif (this.callback)\n\t\t\t\t\tthis.callback(data_url)\n\t\t\t})\n\t\t})\n\t}\n\n\tshow ( )\n\t{\n\t\tthis.render().then(() =>\n\t\t{\n\t\t\tthis.dialog.show()\n\t\t}).catch(err => {\n\t\t\tif ( this.options.error )\n\t\t\t{\n\t\t\t\tconst alert = `<span class=\"indicator red\"/> ${frappe.ui.Capture.ERR_MESSAGE}`\n\t\t\t\tfrappe.show_alert(alert, 3)\n\t\t\t}\n\n\t\t\tthrow err\n\t\t})\n\t}\n\n\thide ( )\n\t{\n\t\tif ( this.dialog )\n\t\t\tthis.dialog.hide()\n\t}\n\n\tsubmit (fn)\n\t{\n\t\tthis.callback = fn\n\t}\n}\nfrappe.ui.Capture.OPTIONS =\n{\n\t  title: __(`Camera`),\n\tanimate: false,\n\t  error: false,\n}\nfrappe.ui.Capture.ERR_MESSAGE = __(\"Unable to load camera.\")\nfrappe.ui.Capture.TEMPLATE \t  =\n`\n<div class=\"frappe-capture\">\n\t<div class=\"panel panel-default\">\n\t\t<img class=\"fc-p img-responsive\"/>\n\t\t<div class=\"fc-s  embed-responsive embed-responsive-16by9\">\n\t\t\t<video class=\"embed-responsive-item\">${frappe.ui.Capture.ERR_MESSAGE}</video>\n\t\t</div>\n\t</div>\n\t<div>\n\t\t<div class=\"fc-btf\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col-md-6\">\n\t\t\t\t\t<div class=\"pull-left\">\n\t\t\t\t\t\t<button class=\"btn btn-default fc-br\">\n\t\t\t\t\t\t\t<small>${__('Retake')}</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"col-md-6\">\n\t\t\t\t\t<div class=\"pull-right\">\n\t\t\t\t\t\t<button class=\"btn btn-primary fc-bs\">\n\t\t\t\t\t\t\t<small>${__('Submit')}</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"fc-btu\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"col-md-6\">\n\t\t\t\t\t${\n\t\t\t\t\t\t''\n\t\t\t\t\t\t// <div class=\"pull-left\">\n\t\t\t\t\t\t// \t<button class=\"btn btn-default\">\n\t\t\t\t\t\t// \t\t<small>${__('Take Video')}</small>\n\t\t\t\t\t\t// \t</button>\n\t\t\t\t\t\t// </div>\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"col-md-6\">\n\t\t\t\t\t<div class=\"pull-right\">\n\t\t\t\t\t\t<button class=\"btn btn-default fc-bcp\">\n\t\t\t\t\t\t\t<small>${__('Take Photo')}</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n`","\n\nfrappe.user_info = function(uid) {\n\tif(!uid)\n\t\tuid = frappe.session.user;\n\n\tif(uid.toLowerCase()===\"bot\") {\n\t\treturn {\n\t\t\tfullname: __(\"Bot\"),\n\t\t\timage: \"/assets/frappe/images/ui/bot.png\",\n\t\t\tabbr: \"B\"\n\t\t};\n\t}\n\n\tif(!(frappe.boot.user_info && frappe.boot.user_info[uid])) {\n\t\tvar user_info = {\n\t\t\tfullname: frappe.utils.capitalize(uid.split(\"@\")[0]) || \"Unknown\"\n\t\t};\n\t} else {\n\t\tvar user_info = frappe.boot.user_info[uid];\n\t}\n\n\tuser_info.abbr = frappe.get_abbr(user_info.fullname);\n\tuser_info.color = frappe.get_palette(user_info.fullname);\n\n\treturn user_info;\n};\n\nfrappe.ui.set_user_background = function(src, selector, style) {\n\tif(!selector) selector = \"#page-desktop\";\n\tif(!style) style = \"Fill Screen\";\n\tif(src) {\n\t\tif (window.cordova && src.indexOf(\"http\") === -1) {\n\t\t\tsrc = frappe.base_url + src;\n\t\t}\n\t\tvar background = repl('background: url(\"%(src)s\") center center;', {src: src});\n\t} else {\n\t\tvar background = \"background-color: #4B4C9D;\";\n\t}\n\n\tfrappe.dom.set_style(repl('%(selector)s { \\\n\t\t%(background)s \\\n\t\tbackground-attachment: fixed; \\\n\t\t%(style)s \\\n\t}', {\n\t\tselector:selector,\n\t\tbackground:background,\n\t\tstyle: style===\"Fill Screen\" ? \"background-size: cover;\" : \"\"\n\t}));\n};\n\nfrappe.provide('frappe.user');\n\n$.extend(frappe.user, {\n\tname: 'Guest',\n\tfull_name: function(uid) {\n\t\treturn uid === frappe.session.user ?\n\t\t\t__(\"You\") :\n\t\t\tfrappe.user_info(uid).fullname;\n\t},\n\timage: function(uid) {\n\t\treturn frappe.user_info(uid).image;\n\t},\n\tabbr: function(uid) {\n\t\treturn frappe.user_info(uid).abbr;\n\t},\n\thas_role: function(rl) {\n\t\tif(typeof rl=='string')\n\t\t\trl = [rl];\n\t\tfor(var i in rl) {\n\t\t\tif((frappe.boot ? frappe.boot.user.roles : ['Guest']).indexOf(rl[i])!=-1)\n\t\t\t\treturn true;\n\t\t}\n\t},\n\tget_desktop_items: function() {\n\t\t// hide based on permission\n\t\tvar modules_list = $.map(frappe.boot.allowed_modules, function(icon) {\n\t\t\tvar m = icon.module_name;\n\t\t\tvar type = frappe.modules[m] && frappe.modules[m].type;\n\n\t\t\tif(frappe.boot.user.allow_modules.indexOf(m) === -1) return null;\n\n\t\t\tvar ret = null;\n\t\t\tif (type === \"module\") {\n\t\t\t\tif(frappe.boot.user.allow_modules.indexOf(m)!=-1 || frappe.modules[m].is_help)\n\t\t\t\t\tret = m;\n\t\t\t} else if (type === \"page\") {\n\t\t\t\tif(frappe.boot.allowed_pages.indexOf(frappe.modules[m].link)!=-1)\n\t\t\t\t\tret = m;\n\t\t\t} else if (type === \"list\") {\n\t\t\t\tif(frappe.model.can_read(frappe.modules[m]._doctype))\n\t\t\t\t\tret = m;\n\t\t\t} else if (type === \"view\") {\n\t\t\t\tret = m;\n\t\t\t} else if (type === \"setup\") {\n\t\t\t\tif(frappe.user.has_role(\"System Manager\") || frappe.user.has_role(\"Administrator\"))\n\t\t\t\t\tret = m;\n\t\t\t} else {\n\t\t\t\tret = m;\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t});\n\n\t\treturn modules_list;\n\t},\n\n\tis_report_manager: function() {\n\t\treturn frappe.user.has_role(['Administrator', 'System Manager', 'Report Manager']);\n\t},\n\n\tget_formatted_email: function(email) {\n\t\tvar fullname = frappe.user.full_name(email);\n\n\t\tif (!fullname) {\n\t\t\treturn email;\n\t\t} else {\n\t\t\t// to quote or to not\n\t\t\tvar quote = '';\n\n\t\t\t// only if these special characters are found\n\t\t\t// why? To make the output same as that in python!\n\t\t\tif (fullname.search(/[\\[\\]\\\\()<>@,:;\".]/) !== -1) {\n\t\t\t\tquote = '\"';\n\t\t\t}\n\n\t\t\treturn repl('%(quote)s%(fullname)s%(quote)s <%(email)s>', {\n\t\t\t\tfullname: fullname,\n\t\t\t\temail: email,\n\t\t\t\tquote: quote\n\t\t\t});\n\t\t}\n\t},\n\n\tget_emails: ( ) => {\n\t\treturn Object.keys(frappe.boot.user_info).map(key => frappe.boot.user_info[key].email);\n\t},\n\n\t/* Normally frappe.user is an object\n\t * having properties and methods.\n\t * But in the following case\n\t *\n\t * if (frappe.user === 'Administrator')\n\t *\n\t * frappe.user will cast to a string\n\t * returning frappe.user.name\n\t */\n\ttoString: function() {\n\t\treturn this.name;\n\t}\n});\n\nfrappe.session_alive = true;\n$(document).bind('mousemove', function() {\n\tif(frappe.session_alive===false) {\n\t\t$(document).trigger(\"session_alive\");\n\t}\n\tfrappe.session_alive = true;\n\tif(frappe.session_alive_timeout)\n\t\tclearTimeout(frappe.session_alive_timeout);\n\tfrappe.session_alive_timeout = setTimeout('frappe.session_alive=false;', 30000);\n});","// Frappe Chat\n// Author - Achilles Rasquinha <achilles@frappe.io>\n\nimport Fuse   from 'fuse.js'\nimport hyper  from '../lib/hyper.min'\n\nimport './socketio_client'\n\nimport './ui/dialog'\nimport './ui/capture'\n\nimport './utils/user'\n\n/* eslint semi: \"never\" */\n// Fuck semicolons - https://mislav.net/2010/05/semicolons\n\n// frappe extensions\n\n/**\n * @description The base class for all Frappe Errors.\n *\n * @example\n * try\n *      throw new frappe.Error(\"foobar\")\n * catch (e)\n *      console.log(e.name)\n * // returns \"FrappeError\"\n *\n * @see  https://stackoverflow.com/a/32749533\n * @todo Requires \"transform-builtin-extend\" for Babel 6\n */\nfrappe.Error = Error\n// class extends Error {\n// \tconstructor (message) {\n// \t\tsuper (message)\n\n// \t\tthis.name = 'FrappeError'\n\n// \t\tif ( typeof Error.captureStackTrace === 'function' )\n// \t\t\tError.captureStackTrace(this, this.constructor)\n// \t\telse\n// \t\t\tthis.stack = (new Error(message)).stack\n// \t}\n// }\n\n/**\n * @description TypeError\n */\nfrappe.TypeError  = TypeError\n// class extends frappe.Error {\n// \tconstructor (message) {\n// \t\tsuper (message)\n\n// \t\tthis.name = this.constructor.name\n// \t}\n// }\n\n/**\n * @description ValueError\n */\nfrappe.ValueError = Error\n// class extends frappe.Error {\n// \tconstructor (message) {\n// \t\tsuper (message)\n\n// \t\tthis.name = this.constructor.name\n// \t}\n// }\n\n/**\n * @description ImportError\n */\nfrappe.ImportError = Error\n// class extends frappe.Error {\n// \tconstructor (message) {\n// \t\tsuper (message)\n\n// \t\tthis.name  = this.constructor.name\n// \t}\n// }\n\n// frappe.datetime\nfrappe.provide('frappe.datetime')\n\n/**\n * @description Frappe's datetime object. (Inspired by Python's datetime object).\n *\n * @example\n * const datetime = new frappe.datetime.datetime()\n */\nfrappe.datetime.datetime = class {\n\t/**\n\t * @description Frappe's datetime Class's constructor.\n\t */\n\tconstructor (instance, format = null) {\n\t\tif ( typeof moment === 'undefined' )\n\t\t\tthrow new frappe.ImportError(`Moment.js not installed.`)\n\n\t\tthis.moment = instance ? moment(instance, format) : moment()\n\t}\n\n\t/**\n\t * @description Returns a formatted string of the datetime object.\n\t */\n\tformat (format = null) {\n\t\tconst  formatted = this.moment.format(format)\n\t\treturn formatted\n\t}\n}\n\n/**\n * @description Frappe's daterange object.\n *\n * @example\n * const range = new frappe.datetime.range(frappe.datetime.now(), frappe.datetime.now())\n * range.contains(frappe.datetime.now())\n */\nfrappe.datetime.range   = class {\n\tconstructor (start, end) {\n\t\tif ( typeof moment === undefined )\n\t\t\tthrow new frappe.ImportError(`Moment.js not installed.`)\n\n\t\tthis.start = start\n\t\tthis.end   = end\n\t}\n\n\tcontains (datetime) {\n\t\tconst  contains = datetime.moment.isBetween(this.start.moment, this.end.moment)\n\t\treturn contains\n\t}\n}\n\n/**\n * @description Returns the current datetime.\n *\n * @example\n * const datetime = new frappe.datetime.now()\n */\nfrappe.datetime.now   = () => new frappe.datetime.datetime()\n\nfrappe.datetime.equal = (a, b, type) => {\n\ta = a.moment\n\tb = b.moment\n\n\tconst equal = a.isSame(b, type)\n\n\treturn equal\n}\n\n/**\n * @description Compares two frappe.datetime.datetime objects.\n *\n * @param   {frappe.datetime.datetime} a - A frappe.datetime.datetime/moment object.\n * @param   {frappe.datetime.datetime} b - A frappe.datetime.datetime/moment object.\n *\n * @returns {number} 0 (if a and b are equal), 1 (if a is before b), -1 (if a is after b).\n *\n * @example\n * frappe.datetime.compare(frappe.datetime.now(), frappe.datetime.now())\n * // returns 0\n * const then = frappe.datetime.now()\n *\n * frappe.datetime.compare(then, frappe.datetime.now())\n * // returns 1\n */\nfrappe.datetime.compare = (a, b) => {\n\ta = a.moment\n\tb = b.moment\n\n\tif ( a.isBefore(b) )\n\t\treturn  1\n\telse\n\tif ( b.isBefore(a) )\n\t\treturn -1\n\telse\n\t\treturn  0\n}\n\n// frappe.quick_edit\nfrappe.quick_edit      = (doctype, docname, fn) => {\n\treturn new Promise(resolve => {\n\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\tfrappe.db.get_doc(doctype, docname).then(doc  => {\n\t\t\t\tconst meta     = frappe.get_meta(doctype)\n\t\t\t\tconst fields   = meta.fields\n\t\t\t\tconst required = fields.filter(f => f.reqd || f.bold && !f.read_only)\n\n\t\t\t\trequired.map(f => {\n\t\t\t\t\tif(f.fieldname == 'content' && doc.type == 'File') {\n\t\t\t\t\t\tf['read_only'] = 1;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst dialog   = new frappe.ui.Dialog({\n\t\t\t\t\t title: __(`Edit ${doctype} (${docname})`),\n\t\t\t\t\tfields: required,\n\t\t\t\t\taction: {\n\t\t\t\t\t\tprimary: {\n\t\t\t\t\t\t\t   label: __(\"Save\"),\n\t\t\t\t\t\t\tonsubmit: (values) => {\n\t\t\t\t\t\t\t\tfrappe.call('frappe.client.save',\n\t\t\t\t\t\t\t\t\t{ doc: { doctype: doctype, docname: docname, ...doc, ...values } })\n\t\t\t\t\t\t\t\t\t  .then(r => {\n\t\t\t\t\t\t\t\t\t\tif ( fn )\n\t\t\t\t\t\t\t\t\t\t\tfn(r.message)\n\n\t\t\t\t\t\t\t\t\t\tresolve(r.message)\n\t\t\t\t\t\t\t\t\t  })\n\n\t\t\t\t\t\t\t\tdialog.hide()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsecondary: {\n\t\t\t\t\t\t\tlabel: __(\"Discard\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tdialog.set_values(doc)\n\n\t\t\t\tconst $element = $(dialog.body)\n\t\t\t\t$element.append(`\n\t\t\t\t\t<div class=\"qe-fp\" style=\"padding-top: '15px'; padding-bottom: '15px'; padding-left: '7px'\">\n\t\t\t\t\t\t<button class=\"btn btn-default btn-sm\">\n\t\t\t\t\t\t\t${__(\"Edit in Full Page\")}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t`)\n\t\t\t\t$element.find('.qe-fp').click(() => {\n\t\t\t\t\tdialog.hide()\n\t\t\t\t\tfrappe.set_route(`Form/${doctype}/${docname}`)\n\t\t\t\t})\n\n\t\t\t\tdialog.show()\n\t\t\t})\n\t\t})\n\t})\n}\n\n// frappe._\n// frappe's utility namespace.\nfrappe.provide('frappe._')\n\n// String Utilities\n\n/**\n * @description Python-inspired format extension for string objects.\n *\n * @param  {string} string - A string with placeholders.\n * @param  {object} object - An object with placeholder, value pairs.\n *\n * @return {string}        - The formatted string.\n *\n * @example\n * frappe._.format('{foo} {bar}', { bar: 'foo', foo: 'bar' })\n * // returns \"bar foo\"\n */\nfrappe._.format = (string, object) => {\n\tfor (const key in object)\n\t\tstring  = string.replace(`{${key}}`, object[key])\n\n\treturn string\n}\n\n/**\n * @description Fuzzy Search a given query within a dataset.\n *\n * @param  {string} query   - A query string.\n * @param  {array}  dataset - A dataset to search within, can contain singletons or objects.\n * @param  {object} options - Options as per fuze.js\n *\n * @return {array}          - The fuzzy matched index/object within the dataset.\n *\n * @example\n * frappe._.fuzzy_search(\"foobar\", [\"foobar\", \"bartender\"])\n * // returns [0, 1]\n *\n * @see http://fusejs.io\n */\nfrappe._.fuzzy_search = (query, dataset, options) => {\n\tconst DEFAULT     = {\n\t\t\t\tshouldSort: true,\n\t\t\t\t threshold: 0.6,\n\t\t\t\t  location: 0,\n\t\t\t\t  distance: 100,\n\t\tminMatchCharLength: 1,\n\t\t  maxPatternLength: 32\n\t}\n\toptions       = { ...DEFAULT, ...options }\n\n\tconst fuse    = new Fuse(dataset, options)\n\tconst result  = fuse.search(query)\n\n\treturn result\n}\n\n/**\n * @description Pluralizes a given word.\n *\n * @param  {string} word  - The word to be pluralized.\n * @param  {number} count - The count.\n *\n * @return {string}       - The pluralized string.\n *\n * @example\n * frappe._.pluralize('member',  1)\n * // returns \"member\"\n * frappe._.pluralize('members', 0)\n * // returns \"members\"\n *\n * @todo Handle more edge cases.\n */\nfrappe._.pluralize = (word, count = 0, suffix = 's') => `${word}${count === 1 ? '' : suffix}`\n\n/**\n * @description Captializes a given string.\n *\n * @param   {word}  - The word to be capitalized.\n *\n * @return {string} - The capitalized word.\n *\n * @example\n * frappe._.capitalize('foobar')\n * // returns \"Foobar\"\n */\nfrappe._.capitalize = word => `${word.charAt(0).toUpperCase()}${word.slice(1)}`\n\n// Array Utilities\n\n/**\n * @description Returns the first element of an array.\n *\n * @param   {array} array - The array.\n *\n * @returns - The first element of an array, undefined elsewise.\n *\n * @example\n * frappe._.head([1, 2, 3])\n * // returns 1\n * frappe._.head([])\n * // returns undefined\n */\nfrappe._.head = arr => frappe._.is_empty(arr) ? undefined : arr[0]\n\n/**\n * @description Returns a copy of the given array (shallow).\n *\n * @param   {array} array - The array to be copied.\n *\n * @returns {array}       - The copied array.\n *\n * @example\n * frappe._.copy_array([\"foobar\", \"barfoo\"])\n * // returns [\"foobar\", \"barfoo\"]\n *\n * @todo Add optional deep copy.\n */\nfrappe._.copy_array = array => {\n\tif ( Array.isArray(array) )\n\t\treturn array.slice()\n\telse\n\t\tthrow frappe.TypeError(`Expected Array, recieved ${typeof array} instead.`)\n}\n\n/**\n * @description Check whether an array|string|object|jQuery is empty.\n *\n * @param   {any}     value - The value to be checked on.\n *\n * @returns {boolean}       - Returns if the object is empty.\n *\n * @example\n * frappe._.is_empty([])      // returns true\n * frappe._.is_empty([\"foo\"]) // returns false\n *\n * frappe._.is_empty(\"\")      // returns true\n * frappe._.is_empty(\"foo\")   // returns false\n *\n * frappe._.is_empty({ })            // returns true\n * frappe._.is_empty({ foo: \"bar\" }) // returns false\n *\n * frappe._.is_empty($('.papito'))   // returns false\n *\n * @todo Handle other cases.\n */\nfrappe._.is_empty = value => {\n\tlet empty = false\n\n\tif ( value === undefined || value === null )\n\t\tempty = true\n\telse\n\tif ( Array.isArray(value) || typeof value === 'string' || value instanceof $ )\n\t\tempty = value.length === 0\n\telse\n\tif ( typeof value === 'object' )\n\t\tempty = Object.keys(value).length === 0\n\n\treturn empty\n}\n\n/**\n * @description Converts a singleton to an array, if required.\n *\n * @param {object} item - An object\n *\n * @example\n * frappe._.as_array(\"foo\")\n * // returns [\"foo\"]\n *\n * frappe._.as_array([\"foo\"])\n * // returns [\"foo\"]\n *\n * @see https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#asList-T...-\n */\nfrappe._.as_array = item => Array.isArray(item) ? item : [item]\n\n/**\n * @description Return a singleton if array contains a single element.\n *\n * @param   {array}        list - An array to squash.\n *\n * @returns {array|object}      - Returns an array if there's more than 1 object else the first object itself.\n *\n * @example\n * frappe._.squash([\"foo\"])\n * // returns \"foo\"\n *\n * frappe._.squash([\"foo\", \"bar\"])\n * // returns [\"foo\", \"bar\"]\n */\nfrappe._.squash = list => Array.isArray(list) && list.length === 1 ? list[0] : list\n\n/**\n * @description Returns true, if the current device is a mobile device.\n *\n * @example\n * frappe._.is_mobile()\n * // returns true|false\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent\n */\nfrappe._.is_mobile = () => {\n\tconst regex    = new RegExp(\"Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini\", \"i\")\n\tconst agent    = navigator.userAgent\n\tconst mobile   = regex.test(agent)\n\n\treturn mobile\n}\n\n/**\n * @description Removes falsey values from an array.\n *\n * @example\n * frappe._.compact([1, 2, false, NaN, ''])\n * // returns [1, 2]\n */\nfrappe._.compact   = array => array.filter(Boolean)\n\n// extend utils to base.\nfrappe.utils       = { ...frappe.utils, ...frappe._ }\n\n// frappe extensions\n\n// frappe.user extensions\n/**\n * @description Returns the first name of a User.\n *\n * @param {string} user - User\n *\n * @returns The first name of the user.\n *\n * @example\n * frappe.user.first_name(\"Rahul Malhotra\")\n * // returns \"Rahul\"\n */\nfrappe.provide('frappe.user')\nfrappe.user.first_name = user => frappe._.head(frappe.user.full_name(user).split(\" \"))\n\nfrappe.provide('frappe.ui.keycode')\nfrappe.ui.keycode = { RETURN: 13 }\n\n/**\n * @description Frappe's Store Class\n */\n // frappe.stores  - A registry for frappe stores.\nfrappe.provide('frappe.stores')\nfrappe.stores = [ ]\nfrappe.Store  = class\n{\n\t/**\n\t * @description Frappe's Store Class's constructor.\n\t *\n\t * @param {string} name - Name of the logger.\n\t */\n\tconstructor (name) {\n\t\tif ( typeof name !== 'string' )\n\t\t\tthrow new frappe.TypeError(`Expected string for name, got ${typeof name} instead.`)\n\t\tthis.name = name\n\t}\n\n\t/**\n\t * @description Get instance of frappe.Store (return registered one if declared).\n\t *\n\t * @param {string} name - Name of the store.\n\t */\n\tstatic get (name) {\n\t\tif ( !(name in frappe.stores) )\n\t\t\tfrappe.stores[name] = new frappe.Store(name)\n\t\treturn frappe.stores[name]\n\t}\n\n\tset (key, value) { localStorage.setItem(`${this.name}:${key}`, value) }\n\tget (key, value) { return localStorage.getItem(`${this.name}:${key}`) }\n}\n\n// frappe.loggers - A registry for frappe loggers.\nfrappe.provide('frappe.loggers')\n/**\n * @description Frappe's Logger Class\n *\n * @example\n * frappe.log       = frappe.Logger.get('foobar')\n * frappe.log.level = frappe.Logger.DEBUG\n *\n * frappe.log.info('foobar')\n * // prints '[timestamp] foobar: foobar'\n */\nfrappe.Logger = class {\n\t/**\n\t * @description Frappe's Logger Class's constructor.\n\t *\n\t * @param {string} name - Name of the logger.\n\t */\n\tconstructor (name, level) {\n\t\tif ( typeof name !== 'string' )\n\t\t\tthrow new frappe.TypeError(`Expected string for name, got ${typeof name} instead.`)\n\n\t\tthis.name   = name\n\t\tthis.level  = level\n\n\t\tif ( !this.level ) {\n\t\t\tif ( frappe.boot.developer_mode )\n\t\t\t\tthis.level = frappe.Logger.ERROR\n\t\t\telse\n\t\t\t\tthis.level = frappe.Logger.NOTSET\n\t\t}\n\t\tthis.format = frappe.Logger.FORMAT\n\t}\n\n\t/**\n\t * @description Get instance of frappe.Logger (return registered one if declared).\n\t *\n\t * @param {string} name - Name of the logger.\n\t */\n\tstatic get (name, level) {\n\t\tif ( !(name in frappe.loggers) )\n\t\t\tfrappe.loggers[name] = new frappe.Logger(name, level)\n\t\treturn frappe.loggers[name]\n\t}\n\n\tdebug (message) { this.log(message, frappe.Logger.DEBUG) }\n\tinfo  (message) { this.log(message, frappe.Logger.INFO)  }\n\twarn  (message) { this.log(message, frappe.Logger.WARN)  }\n\terror (message) { this.log(message, frappe.Logger.ERROR) }\n\n\tlog (message, level) {\n\t\tconst timestamp   = frappe.datetime.now()\n\n\t\tif ( level.value <= this.level.value ) {\n\t\t\tconst format  = frappe._.format(this.format, {\n\t\t\t\ttime: timestamp.format('HH:mm:ss'),\n\t\t\t\tname: this.name\n\t\t\t})\n\t\t\tconsole.log(`%c ${format}:`, `color: ${level.color}`, message)\n\t\t}\n\t}\n}\n\nfrappe.Logger.DEBUG  = { value: 10, color: '#616161', name: 'DEBUG'  }\nfrappe.Logger.INFO   = { value: 20, color: '#2196F3', name: 'INFO'   }\nfrappe.Logger.WARN   = { value: 30, color: '#FFC107', name: 'WARN'   }\nfrappe.Logger.ERROR  = { value: 40, color: '#F44336', name: 'ERROR'  }\nfrappe.Logger.NOTSET = { value:  0,                   name: 'NOTSET' }\n\nfrappe.Logger.FORMAT = '{time} {name}'\n\n// frappe.chat\nfrappe.provide('frappe.chat')\n\nfrappe.log = frappe.Logger.get('frappe.chat', frappe.Logger.NOTSET)\n\n// frappe.chat.profile\nfrappe.provide('frappe.chat.profile')\n\n/**\n * @description Create a Chat Profile.\n *\n * @param   {string|array} fields - (Optional) fields to be retrieved after creating a Chat Profile.\n * @param   {function}     fn     - (Optional) callback with the returned Chat Profile.\n *\n * @returns {Promise}\n *\n * @example\n * frappe.chat.profile.create(console.log)\n *\n * frappe.chat.profile.create(\"status\").then(console.log) // { status: \"Online\" }\n */\nfrappe.chat.profile.create = (fields, fn) => {\n\tif ( typeof fields === \"function\" ) {\n\t\tfn     = fields\n\t\tfields = null\n\t} else\n\tif ( typeof fields === \"string\" )\n\t\tfields = frappe._.as_array(fields)\n\n\treturn new Promise(resolve => {\n\t\tfrappe.call(\"frappe.chat.doctype.chat_profile.chat_profile.create\",\n\t\t\t{ user: frappe.session.user, exists_ok: true, fields: fields },\n\t\t\t\tresponse => {\n\t\t\t\t\tif ( fn )\n\t\t\t\t\t\tfn(response.message)\n\n\t\t\t\t\tresolve(response.message)\n\t\t\t\t})\n\t})\n}\n\n/**\n * @description Updates a Chat Profile.\n *\n * @param   {string} user   - (Optional) Chat Profile User, defaults to session user.\n * @param   {object} update - (Required) Updates to be dispatched.\n *\n * @example\n * frappe.chat.profile.update(frappe.session.user, { \"status\": \"Offline\" })\n */\nfrappe.chat.profile.update = (user, update, fn) => {\n\treturn new Promise(resolve => {\n\t\tfrappe.call(\"frappe.chat.doctype.chat_profile.chat_profile.update\",\n\t\t\t{ user: user || frappe.session.user, data: update },\n\t\t\t\tresponse => {\n\t\t\t\t\tif ( fn )\n\t\t\t\t\t\tfn(response.message)\n\n\t\t\t\t\tresolve(response.message)\n\t\t\t\t})\n\t})\n}\n\n// frappe.chat.profile.on\nfrappe.provide('frappe.chat.profile.on')\n\n/**\n * @description Triggers on a Chat Profile update of a user (Only if there's a one-on-one conversation).\n *\n * @param   {function} fn - (Optional) callback with the User and the Chat Profile update.\n *\n * @returns {Promise}\n *\n * @example\n * frappe.chat.profile.on.update(function (user, update)\n * {\n *      // do stuff\n * })\n */\nfrappe.chat.profile.on.update = function (fn) {\n\tfrappe.realtime.on(\"frappe.chat.profile:update\", r => fn(r.user, r.data))\n}\nfrappe.chat.profile.STATUSES\n=\n[\n\t{\n\t\tname: \"Online\",\n\t   color: \"green\"\n\t},\n\t{\n\t\t name: \"Away\",\n\t\tcolor: \"yellow\"\n\t},\n\t{\n\t\t name: \"Busy\",\n\t\tcolor: \"red\"\n\t},\n\t{\n\t\t name: \"Offline\",\n\t\tcolor: \"darkgrey\"\n\t}\n]\n\n// frappe.chat.room\nfrappe.provide('frappe.chat.room')\n\n/**\n * @description Creates a Chat Room.\n *\n * @param   {string}       kind  - (Required) \"Direct\", \"Group\" or \"Visitor\".\n * @param   {string}       owner - (Optional) Chat Room owner (defaults to current user).\n * @param   {string|array} users - (Required for \"Direct\" and \"Visitor\", Optional for \"Group\") User(s) within Chat Room.\n * @param   {string}       name  - Chat Room name.\n * @param   {function}     fn    - callback with created Chat Room.\n *\n * @returns {Promise}\n *\n * @example\n * frappe.chat.room.create(\"Direct\", frappe.session.user, \"foo@bar.com\", function (room) {\n *      // do stuff\n * })\n * frappe.chat.room.create(\"Group\",  frappe.session.user, [\"santa@gmail.com\", \"banta@gmail.com\"], \"Santa and Banta\", function (room) {\n *      // do stuff\n * })\n */\nfrappe.chat.room.create = function (kind, owner, users, name, fn) {\n\tif ( typeof name === \"function\" ) {\n\t\tfn   = name\n\t\tname = null\n\t}\n\n\tusers    = frappe._.as_array(users)\n\n\treturn new Promise(resolve => {\n\t\tfrappe.call(\"frappe.chat.doctype.chat_room.chat_room.create\",\n\t\t\t{ kind: kind, owner: owner || frappe.session.user, users: users, name: name },\n\t\t\tr => {\n\t\t\t\tlet room = r.message\n\t\t\t\troom     = { ...room, creation: new frappe.datetime.datetime(room.creation) }\n\n\t\t\t\tif ( fn )\n\t\t\t\t\tfn(room)\n\n\t\t\t\tresolve(room)\n\t\t\t})\n\t})\n}\n\n/**\n * @description Returns Chat Room(s).\n *\n * @param   {string|array} names   - (Optional) Chat Room(s) to retrieve.\n * @param   {string|array} fields  - (Optional) fields to be retrieved for each Chat Room.\n * @param   {function}     fn      - (Optional) callback with the returned Chat Room(s).\n *\n * @returns {Promise}\n *\n * @example\n * frappe.chat.room.get(function (rooms) {\n *      // do stuff\n * })\n * frappe.chat.room.get().then(function (rooms) {\n *      // do stuff\n * })\n *\n * frappe.chat.room.get(null, [\"room_name\", \"avatar\"], function (rooms) {\n *      // do stuff\n * })\n *\n * frappe.chat.room.get(\"CR00001\", \"room_name\", function (room) {\n *      // do stuff\n * })\n *\n * frappe.chat.room.get([\"CR00001\", \"CR00002\"], [\"room_name\", \"last_message\"], function (rooms) {\n *\n * })\n */\nfrappe.chat.room.get = function (names, fields, fn) {\n\tif ( typeof names === \"function\" ) {\n\t\tfn     = names\n\t\tnames  = null\n\t\tfields = null\n\t}\n\telse\n\tif ( typeof names === \"string\" ) {\n\t\tnames  = frappe._.as_array(names)\n\n\t\tif ( typeof fields === \"function\" ) {\n\t\t\tfn     = fields\n\t\t\tfields = null\n\t\t}\n\t\telse\n\t\tif ( typeof fields === \"string\" )\n\t\t\tfields = frappe._.as_array(fields)\n\t}\n\n\treturn new Promise(resolve => {\n\t\tfrappe.call(\"frappe.chat.doctype.chat_room.chat_room.get\",\n\t\t\t{ user: frappe.session.user, rooms: names, fields: fields },\n\t\t\t\tresponse => {\n\t\t\t\t\tlet rooms = response.message\n\t\t\t\t\tif ( rooms ) { // frappe.api BOGZ! (emtpy arrays are falsified, not good design).\n\t\t\t\t\t\trooms = frappe._.as_array(rooms)\n\t\t\t\t\t\trooms = rooms.map(room => {\n\t\t\t\t\t\t\treturn { ...room, creation: new frappe.datetime.datetime(room.creation),\n\t\t\t\t\t\t\t\tlast_message: room.last_message ? {\n\t\t\t\t\t\t\t\t\t...room.last_message,\n\t\t\t\t\t\t\t\t\tcreation: new frappe.datetime.datetime(room.last_message.creation)\n\t\t\t\t\t\t\t\t} : null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\trooms = frappe._.squash(rooms)\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\trooms = [ ]\n\n\t\t\t\t\tif ( fn )\n\t\t\t\t\t\tfn(rooms)\n\n\t\t\t\t\tresolve(rooms)\n\t\t\t\t})\n\t})\n}\n\n/**\n * @description Subscribe current user to said Chat Room(s).\n *\n * @param {string|array} rooms - Chat Room(s).\n *\n * @example\n * frappe.chat.room.subscribe(\"CR00001\")\n */\nfrappe.chat.room.subscribe = function (rooms) {\n\tfrappe.realtime.publish(\"frappe.chat.room:subscribe\", rooms)\n}\n\n/**\n * @description Get Chat Room history.\n *\n * @param   {string} name - Chat Room name\n *\n * @returns {Promise}     - Chat Message(s)\n *\n * @example\n * frappe.chat.room.history(function (messages)\n * {\n *      // do stuff.\n * })\n */\nfrappe.chat.room.history = function (name, fn) {\n\treturn new Promise(resolve => {\n\t\tfrappe.call(\"frappe.chat.doctype.chat_room.chat_room.history\",\n\t\t\t{ room: name, user: frappe.session.user },\n\t\t\t\tr => {\n\t\t\t\t\tlet messages = r.message ? frappe._.as_array(r.message) : [ ] // frappe.api BOGZ! (emtpy arrays are falsified, not good design).\n\t\t\t\t\tmessages     = messages.map(m => {\n\t\t\t\t\t\treturn { ...m,\n\t\t\t\t\t\t\tcreation: new frappe.datetime.datetime(m.creation)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\n\t\t\t\t\tif ( fn )\n\t\t\t\t\t\tfn(messages)\n\n\t\t\t\t\tresolve(messages)\n\t\t\t\t})\n\t})\n}\n\n/**\n * @description Searches Rooms based on a query.\n *\n * @param   {string} query - The query string.\n * @param   {array}  rooms - A list of Chat Rooms.\n *\n * @returns {array}        - A fuzzy searched list of rooms.\n */\nfrappe.chat.room.search = function (query, rooms) {\n\tconst dataset = rooms.map(r => {\n\t\tif ( r.room_name )\n\t\t\treturn r.room_name\n\t\telse\n\t\t\tif ( r.owner === frappe.session.user )\n\t\t\t\treturn frappe.user.full_name(frappe._.squash(r.users))\n\t\t\telse\n\t\t\t\treturn frappe.user.full_name(r.owner)\n\t})\n\tconst results = frappe._.fuzzy_search(query, dataset)\n\trooms         = results.map(i => rooms[i])\n\n\treturn rooms\n}\n\n/**\n * @description Sort Chat Room(s) based on Last Message Timestamp or Creation Date.\n *\n * @param {array}   - A list of Chat Room(s)\n * @param {compare} - (Optional) a comparision function.\n */\nfrappe.chat.room.sort = function (rooms, compare = null) {\n\tcompare = compare || function (a, b) {\n\t\tif ( a.last_message && b.last_message )\n\t\t\treturn frappe.datetime.compare(a.last_message.creation, b.last_message.creation)\n\t\telse\n\t\tif ( a.last_message )\n\t\t\treturn frappe.datetime.compare(a.last_message.creation, b.creation)\n\t\telse\n\t\tif ( b.last_message )\n\t\t\treturn frappe.datetime.compare(a.creation, b.last_message.creation)\n\t\telse\n\t\t\treturn frappe.datetime.compare(a.creation, b.creation)\n\t}\n\trooms.sort(compare)\n\n\treturn rooms\n}\n\n// frappe.chat.room.on\nfrappe.provide('frappe.chat.room.on')\n\n/**\n * @description Triggers on Chat Room updated.\n *\n * @param {function} fn - callback with the Chat Room and Update.\n */\nfrappe.chat.room.on.update = function (fn) {\n\tfrappe.realtime.on(\"frappe.chat.room:update\", r => {\n\t\tif ( r.data.last_message )\n\t\t\t// creation to frappe.datetime.datetime (easier to manipulate).\n\t\t\tr.data = { ...r.data, last_message: { ...r.data.last_message, creation: new frappe.datetime.datetime(r.data.last_message.creation) } }\n\n\t\tfn(r.room, r.data)\n\t})\n}\n\n/**\n * @description Triggers on Chat Room created.\n *\n * @param {function} fn - callback with the created Chat Room.\n */\nfrappe.chat.room.on.create = function (fn) {\n\tfrappe.realtime.on(\"frappe.chat.room:create\", r =>\n\t\tfn({ ...r, creation: new frappe.datetime.datetime(r.creation) })\n\t)\n}\n\n/**\n * @description Triggers when a User is typing in a Chat Room.\n *\n * @param {function} fn - callback with the typing User within the Chat Room.\n */\nfrappe.chat.room.on.typing = function (fn) {\n\tfrappe.realtime.on(\"frappe.chat.room:typing\", r => fn(r.room, r.user))\n}\n\n// frappe.chat.message\nfrappe.provide('frappe.chat.message')\n\nfrappe.chat.message.typing = function (room, user) {\n\tfrappe.realtime.publish(\"frappe.chat.message:typing\", { user: user || frappe.session.user, room: room })\n}\n\nfrappe.chat.message.send   = function (room, message, type = \"Content\") {\n\tfrappe.call(\"frappe.chat.doctype.chat_message.chat_message.send\",\n\t\t{ user: frappe.session.user, room: room, content: message, type: type })\n}\n\nfrappe.chat.message.update = function (message, update, fn) {\n\treturn new Promise(resolve => {\n\t\tfrappe.call('frappe.chat.doctype.chat_message.chat_message.update',\n\t\t\t{ user: frappe.session.user, message: message, update: update },\n\t\t\tr =>  {\n\t\t\t\tif ( fn )\n\t\t\t\t\tfn(response.message)\n\n\t\t\t\tresolve(response.message)\n\t\t\t})\n\t})\n}\n\nfrappe.chat.message.sort   = (messages) => {\n\tif ( !frappe._.is_empty(messages) )\n\t\tmessages.sort((a, b) => frappe.datetime.compare(b.creation, a.creation))\n\n\treturn messages\n}\n\n/**\n * @description Add user to seen (defaults to session.user)\n */\nfrappe.chat.message.seen   = (mess, user) => {\n\tfrappe.call('frappe.chat.doctype.chat_message.chat_message.seen',\n\t\t{ message: mess, user: user || frappe.session.user })\n}\n\nfrappe.provide('frappe.chat.message.on')\nfrappe.chat.message.on.create = function (fn) {\n\tfrappe.realtime.on(\"frappe.chat.message:create\", r =>\n\t\tfn({ ...r, creation: new frappe.datetime.datetime(r.creation) })\n\t)\n}\n\nfrappe.chat.message.on.update = function (fn) {\n\tfrappe.realtime.on(\"frappe.chat.message:update\", r => fn(r.message, r.data))\n}\n\nfrappe.chat.pretty_datetime   = function (date) {\n\tconst today    = moment()\n\tconst instance = date.moment\n\n\tif ( today.isSame(instance, \"d\") )\n\t\treturn instance.format(\"hh:mm A\")\n\telse\n\tif ( today.isSame(instance, \"week\") )\n\t\treturn instance.format(\"dddd\")\n\telse\n\t\treturn instance.format(\"DD/MM/YYYY\")\n}\n\n// frappe.chat.sound\nfrappe.provide('frappe.chat.sound')\n\n/**\n * @description Plays a given registered sound.\n *\n * @param {value} - The name of the registered sound.\n *\n * @example\n * frappe.chat.sound.play(\"message\")\n */\nfrappe.chat.sound.play  = function (name, volume = 0.1) {\n\t// frappe._.play_sound(`chat-${name}`)\n\tconst $audio = $(`<audio class=\"chat-audio\"/>`)\n\t$audio.attr('volume', volume)\n\n\tif  ( frappe._.is_empty($audio) )\n\t\t$(document).append($audio)\n\n\tif  ( !$audio.paused ) {\n\t\tfrappe.log.info('Stopping sound playing.')\n\t\t$audio[0].pause()\n\t\t$audio.attr('currentTime', 0)\n\t}\n\n\tfrappe.log.info('Playing sound.')\n\t$audio.attr('src', `${frappe.chat.sound.PATH}/chat-${name}.mp3`)\n\t$audio[0].play()\n}\nfrappe.chat.sound.PATH  = '/assets/frappe/sounds'\n\n// frappe.chat.emoji\nfrappe.chat.emojis = [ ]\nfrappe.chat.emoji  = function (fn) {\n\treturn new Promise(resolve => {\n\t\tif ( !frappe._.is_empty(frappe.chat.emojis) ) {\n\t\t\tif ( fn )\n\t\t\t\tfn(frappe.chat.emojis)\n\n\t\t\tresolve(frappe.chat.emojis)\n\t\t}\n\t\telse\n\t\t\t$.get('https://cdn.rawgit.com/frappe/emoji/master/emoji', (data) => {\n\t\t\t\tfrappe.chat.emojis = JSON.parse(data)\n\n\t\t\t\tif ( fn )\n\t\t\t\t\tfn(frappe.chat.emojis)\n\n\t\t\t\tresolve(frappe.chat.emojis)\n\t\t\t})\n\t})\n}\n\n// Website Settings\nfrappe.provide('frappe.chat.website.settings')\nfrappe.chat.website.settings = (fields, fn) =>\n{\n\tif ( typeof fields === \"function\" ) {\n\t\tfn     = fields\n\t\tfields = null\n\t} else\n\tif ( typeof fields === \"string\" )\n\t\tfields = frappe._.as_array(fields)\n\n\treturn new Promise(resolve => {\n\t\tfrappe.call(\"frappe.chat.website.settings\",\n\t\t\t{ fields: fields })\n\t\t\t.then(response => {\n\t\t\t\tvar message = response.message\n\n\t\t\t\tif ( message.enable_from )\n\t\t\t\t\tmessage   = { ...message, enable_from: new frappe.datetime.datetime(message.enable_from, 'HH:mm:ss') }\n\t\t\t\tif ( message.enable_to )\n\t\t\t\t\tmessage   = { ...message, enable_to:   new frappe.datetime.datetime(message.enable_to,   'HH:mm:ss') }\n\n\t\t\t\tif ( fn )\n\t\t\t\t\tfn(message)\n\n\t\t\t\tresolve(message)\n\t\t\t})\n\t})\n}\n\nfrappe.chat.website.token    = (fn) =>\n{\n\treturn new Promise(resolve => {\n\t\tfrappe.call(\"frappe.chat.website.token\")\n\t\t\t.then(response => {\n\t\t\t\tif ( fn )\n\t\t\t\t\tfn(response.message)\n\n\t\t\t\tresolve(response.message)\n\t\t\t})\n\t})\n}\n\nconst { h, Component } = hyper\n\n// frappe.components\n// frappe's component namespace.\nfrappe.provide('frappe.components')\n\nfrappe.provide('frappe.chat.component')\n\n/**\n * @description Button Component\n *\n * @prop {string}  type  - (Optional) \"default\", \"primary\", \"info\", \"success\", \"warning\", \"danger\" (defaults to \"default\")\n * @prop {boolean} block - (Optional) Render a button block (defaults to false).\n */\nfrappe.components.Button\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props } = this\n\t\tconst size      = frappe.components.Button.SIZE[props.size]\n\n\t\treturn (\n\t\t\th(\"button\", { ...props, class: `btn ${size && size.class} btn-${props.type} ${props.block ? \"btn-block\" : \"\"} ${props.class ? props.class : \"\"}` },\n\t\t\t\tprops.children\n\t\t\t)\n\t\t)\n\t}\n}\nfrappe.components.Button.SIZE\n=\n{\n\tsmall: {\n\t\tclass: \"btn-sm\"\n\t},\n\tlarge: {\n\t\tclass: \"btn-lg\"\n\t}\n}\nfrappe.components.Button.defaultProps\n=\n{\n\t type: \"default\",\n\tblock: false\n}\n\n/**\n * @description FAB Component\n *\n * @extends frappe.components.Button\n */\nfrappe.components.FAB\n=\nclass extends frappe.components.Button {\n\trender ( ) {\n\t\tconst { props } = this\n\t\tconst size      = frappe.components.FAB.SIZE[props.size]\n\n\t\treturn (\n\t\t\th(frappe.components.Button, { ...props, class: `${props.class} ${size && size.class}`},\n\t\t\t\th(\"i\", { class: props.icon })\n\t\t\t)\n\t\t)\n\t}\n}\nfrappe.components.FAB.defaultProps\n=\n{\n\ticon: \"octicon octicon-plus\"\n}\nfrappe.components.FAB.SIZE\n=\n{\n\tsmall:\n\t{\n\t\tclass: \"frappe-fab-sm\"\n\t},\n\tlarge:\n\t{\n\t\tclass: \"frappe-fab-lg\"\n\t}\n}\n\n/**\n * @description Octicon Component\n *\n * @prop color - (Required) color for the indicator\n */\nfrappe.components.Indicator\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props } = this\n\n\t\treturn props.color ? h(\"span\", { ...props, class: `indicator ${props.color}` }) : null\n\t}\n}\n\n/**\n * @description FontAwesome Component\n */\nfrappe.components.FontAwesome\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props } = this\n\n\t\treturn props.type ? h(\"i\", { ...props, class: `fa ${props.fixed ? \"fa-fw\" : \"\"} fa-${props.type} ${props.class}` }) : null\n\t}\n}\nfrappe.components.FontAwesome.defaultProps\n=\n{\n\tfixed: false\n}\n\n/**\n * @description Octicon Component\n *\n * @extends frappe.Component\n */\nfrappe.components.Octicon\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props } = this\n\n\t\treturn props.type ? h(\"i\", { ...props, class: `octicon octicon-${props.type}` }) : null\n\t}\n}\n\n/**\n * @description Avatar Component\n *\n * @prop {string} title - (Optional) title for the avatar.\n * @prop {string} abbr  - (Optional) abbreviation for the avatar, defaults to the first letter of the title.\n * @prop {string} size  - (Optional) size of the avatar to be displayed.\n * @prop {image}  image - (Optional) image for the avatar, defaults to the first letter of the title.\n */\nfrappe.components.Avatar\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props } = this\n\t\tconst abbr      = props.abbr || props.title.substr(0, 1)\n\t\tconst size      = frappe.components.Avatar.SIZE[props.size] || frappe.components.Avatar.SIZE.medium\n\n\t\treturn (\n\t\t\th(\"span\", { class: `avatar ${size.class} ${props.class ? props.class : \"\"}` },\n\t\t\t\tprops.image ?\n\t\t\t\t\th(\"img\", { class: \"media-object\", src: props.image })\n\t\t\t\t\t:\n\t\t\t\t\th(\"div\", { class: \"standard-image\" }, abbr)\n\t\t\t)\n\t\t)\n\t}\n}\nfrappe.components.Avatar.SIZE\n=\n{\n\tsmall:\n\t{\n\t\tclass: \"avatar-small\"\n\t},\n\tlarge:\n\t{\n\t\tclass: \"avatar-large\"\n\t},\n\tmedium:\n\t{\n\t\tclass: \"avatar-medium\"\n\t}\n}\n\n/**\n * @description Frappe Chat Object.\n *\n * @example\n * const chat = new frappe.Chat(options) // appends to \"body\"\n * chat.render()\n * const chat = new frappe.Chat(\".selector\", options)\n * chat.render()\n *\n * const chat = new frappe.Chat()\n * chat.set_wrapper('.selector')\n *     .set_options(options)\n *     .render()\n */\nfrappe.Chat\n=\nclass {\n\t/**\n\t * @description Frappe Chat Object.\n\t *\n\t * @param {string} selector - A query selector, HTML Element or jQuery object.\n\t * @param {object} options  - Optional configurations.\n\t */\n\tconstructor (selector, options) {\n\t\tif ( !(typeof selector === \"string\" || selector instanceof $ || selector instanceof HTMLElement) ) {\n\t\t\toptions  = selector\n\t\t\tselector = null\n\t\t}\n\n\t\tthis.options = frappe.Chat.OPTIONS\n\n\t\tthis.set_wrapper(selector ? selector : \"body\")\n\t\tthis.set_options(options)\n\n\t\t// Load Emojis.\n\t\tfrappe.chat.emoji()\n\t}\n\n\t/**\n\t * Set the container on which the chat widget is mounted on.\n\t * @param   {string|HTMLElement} selector - A query selector, HTML Element or jQuery object.\n\t *\n\t * @returns {frappe.Chat}                 - The instance.\n\t *\n\t * @example\n\t * const chat = new frappe.Chat()\n\t * chat.set_wrapper(\".selector\")\n\t */\n\tset_wrapper (selector) {\n\t\tthis.$wrapper = $(selector)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Set the configurations for the chat interface.\n\t * @param   {object}      options - Optional Configurations.\n\t *\n\t * @returns {frappe.Chat}         - The instance.\n\t *\n\t * @example\n\t * const chat = new frappe.Chat()\n\t * chat.set_options({ layout: frappe.Chat.Layout.PAGE })\n\t */\n\tset_options (options) {\n\t\tthis.options = { ...this.options, ...options }\n\n\t\treturn this\n\t}\n\n\t/**\n\t * @description Destory the chat widget.\n\t *\n\t * @returns {frappe.Chat} - The instance.\n\t *\n\t * @example\n\t * const chat = new frappe.Chat()\n\t * chat.render()\n\t *     .destroy()\n\t */\n\tdestroy ( ) {\n\t\tconst $wrapper = this.$wrapper\n\t\t$wrapper.remove(\".frappe-chat\")\n\n\t\treturn this\n\t}\n\n\t/**\n\t * @description Render the chat widget component onto destined wrapper.\n\t *\n\t * @returns {frappe.Chat} - The instance.\n\t *\n\t * @example\n\t * const chat = new frappe.Chat()\n\t * chat.render()\n\t */\n\trender (props = { }) {\n\t\tthis.destroy()\n\n\t\tconst $wrapper   = this.$wrapper\n\t\tconst options    = this.options\n\n\t\tconst component  = h(frappe.Chat.Widget, {\n\t\t\tlayout: options.layout,\n\t\t\ttarget: options.target,\n\t\t\t...props\n\t\t})\n\n\t\thyper.render(component, $wrapper[0])\n\n\t\treturn this\n\t}\n}\nfrappe.Chat.Layout\n=\n{\n\tPAGE: \"page\", POPPER: \"popper\"\n}\nfrappe.Chat.OPTIONS\n=\n{\n\tlayout: frappe.Chat.Layout.POPPER\n}\n\n/**\n * @description The base Component for Frappe Chat\n */\nfrappe.Chat.Widget\n=\nclass extends Component {\n\tconstructor (props) {\n\t\tsuper (props)\n\n\t\tthis.setup(props)\n\t\tthis.make()\n\t}\n\n\tsetup (props) {\n\t\t// room actions\n\t\tthis.room           = { }\n\t\tthis.room.add       = rooms => {\n\t\t\trooms           = frappe._.as_array(rooms)\n\t\t\tconst names     = rooms.map(r => r.name)\n\n\t\t\tfrappe.log.info(`Subscribing ${frappe.session.user} to Chat Rooms ${names.join(\", \")}.`)\n\t\t\tfrappe.chat.room.subscribe(names)\n\n\t\t\tconst state     = [ ]\n\n\t\t\tfor (const room of rooms)\n\t\t\t\t  if ( [\"Group\", \"Visitor\"].includes(room.type) || room.owner === frappe.session.user || room.last_message || room.users.includes(frappe.session.user)) {\n\t\t\t\t\tfrappe.log.info(`Adding ${room.name} to component.`)\n\t\t\t\t\tstate.push(room)\n\t\t\t\t}\n\n\t\t\tthis.set_state({ rooms: [ ...this.state.rooms, ...state ] })\n\t\t}\n\t\tthis.room.update    = (room, update) => {\n\t\t\tconst { state } = this\n\t\t\tvar   exists    = false\n\t\t\tconst rooms     = state.rooms.map(r => {\n\t\t\t\tif ( r.name === room ) {\n\t\t\t\t\texists  = true\n\t\t\t\t\tif ( update.typing ) {\n\t\t\t\t\t\tif ( !frappe._.is_empty(r.typing) ) {\n\t\t\t\t\t\t\tconst usr = update.typing\n\t\t\t\t\t\t\tif ( !r.typing.includes(usr) ) {\n\t\t\t\t\t\t\t\tupdate.typing = frappe._.copy_array(r.typing)\n\t\t\t\t\t\t\t\tupdate.typing.push(usr)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tupdate.typing = frappe._.as_array(update.typing)\n\t\t\t\t\t}\n\n\t\t\t\t\treturn { ...r, ...update }\n\t\t\t\t}\n\n\t\t\t\treturn r\n\t\t\t})\n\n\t\t\tif ( frappe.session.user !== 'Guest' ) {\n\t\t\t\tif ( !exists )\n\t\t\t\t\tfrappe.chat.room.get(room, (room) => this.room.add(room))\n\t\t\t\telse\n\t\t\t\t\tthis.set_state({ rooms })\n\t\t\t}\n\n\t\t\tif ( state.room.name === room ) {\n\t\t\t\tif ( update.typing ) {\n\t\t\t\t\tif ( !frappe._.is_empty(state.room.typing) ) {\n\t\t\t\t\t\tconst usr = update.typing\n\t\t\t\t\t\tif ( !state.room.typing.includes(usr) ) {\n\t\t\t\t\t\t\tupdate.typing = frappe._.copy_array(state.room.typing)\n\t\t\t\t\t\t\tupdate.typing.push(usr)\n\t\t\t\t\t\t}\n\t\t\t\t\t} else\n\t\t\t\t\t\tupdate.typing = frappe._.as_array(update.typing)\n\t\t\t\t}\n\n\t\t\t\tconst room  = { ...state.room, ...update }\n\n\t\t\t\tthis.set_state({ room })\n\t\t\t}\n\t\t}\n\t\tthis.room.select    = (name) => {\n\t\t\tfrappe.chat.room.history(name, (messages) => {\n\t\t\t\tconst  { state } = this\n\t\t\t\tconst room       = state.rooms.find(r => r.name === name)\n\n\t\t\t\tthis.set_state({\n\t\t\t\t\troom: { ...state.room, ...room, messages: messages }\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\n\t\tthis.state = { ...frappe.Chat.Widget.defaultState, ...props }\n\t}\n\n\tmake ( ) {\n\t\tif ( frappe.session.user !== 'Guest' ) {\n\t\t\tfrappe.chat.profile.create([\n\t\t\t\t\"status\", \"message_preview\", \"notification_tones\", \"conversation_tones\"\n\t\t\t]).then(profile => {\n\t\t\t\tthis.set_state({ profile })\n\n\t\t\t\tfrappe.chat.room.get(rooms => {\n\t\t\t\t\trooms = frappe._.as_array(rooms)\n\t\t\t\t\tfrappe.log.info(`User ${frappe.session.user} is subscribed to ${rooms.length} ${frappe._.pluralize('room', rooms.length)}.`)\n\n\t\t\t\t\tif ( !frappe._.is_empty(rooms) )\n\t\t\t\t\t\tthis.room.add(rooms)\n\t\t\t\t})\n\n\t\t\t\tthis.bind()\n\t\t\t})\n\t\t} else {\n\t\t\tthis.bind()\n\t\t}\n\t}\n\n\tbind ( ) {\n\t\tfrappe.chat.profile.on.update((user, update) => {\n\t\t\tfrappe.log.warn(`TRIGGER: Chat Profile update ${JSON.stringify(update)} of User ${user}.`)\n\n\t\t\tif ( 'status' in update ) {\n\t\t\t\tif ( user === frappe.session.user ) {\n\t\t\t\t\tthis.set_state({\n\t\t\t\t\t\tprofile: { ...this.state.profile, status: update.status }\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tconst status = frappe.chat.profile.STATUSES.find(s => s.name === update.status)\n\t\t\t\t\tconst color  = status.color\n\n\t\t\t\t\tconst alert  = `<span class=\"indicator ${color}\"/> ${frappe.user.full_name(user)} is currently <b>${update.status}</b>`\n\t\t\t\t\tfrappe.show_alert(alert, 3)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tfrappe.chat.room.on.create((room) => {\n\t\t\tfrappe.log.warn(`TRIGGER: Chat Room ${room.name} created.`)\n\t\t\tthis.room.add(room)\n\t\t})\n\n\t\tfrappe.chat.room.on.update((room, update) => {\n\t\t\tfrappe.log.warn(`TRIGGER: Chat Room ${room} update ${JSON.stringify(update)} recieved.`)\n\t\t\tthis.room.update(room, update)\n\t\t})\n\n\t\tfrappe.chat.room.on.typing((room, user) => {\n\t\t\tif ( user !== frappe.session.user ) {\n\t\t\t\tfrappe.log.warn(`User ${user} typing in Chat Room ${room}.`)\n\t\t\t\tthis.room.update(room, { typing: user })\n\n\t\t\t\tsetTimeout(() => this.room.update(room, { typing: null }), 5000)\n\t\t\t}\n\t\t})\n\n\t\tfrappe.chat.message.on.create((r) => {\n\t\t\tconst { state } = this\n\n\t\t\t// play sound.\n\t\t\tif ( state.room.name )\n\t\t\t\tstate.profile.conversation_tones && frappe.chat.sound.play('message')\n\t\t\telse\n\t\t\t\tstate.profile.notification_tones && frappe.chat.sound.play('notification')\n\n\t\t\tif ( r.user !== frappe.session.user && state.profile.message_preview && !state.toggle ) {\n\t\t\t\tconst $element = $('body').find('.frappe-chat-alert')\n\t\t\t\t$element.remove()\n\n\t\t\t\tconst  alert   = // TODO: ellipses content\n\t\t\t\t`\n\t\t\t\t<span data-action=\"show-message\" class=\"cursor-pointer\">\n\t\t\t\t\t<span class=\"indicator yellow\"/>\n\t\t\t\t\t\t<span class=\"avatar avatar-small\">\n\t\t\t\t\t\t\t<span class=\"avatar-frame\" style=\"background-image: url(${frappe.user.image(r.user)})\"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<b>${frappe.user.first_name(r.user)}</b>: ${r.content}\n\t\t\t\t</span>\n\t\t\t\t`\n\t\t\t\tfrappe.show_alert(alert, 15, {\n\t\t\t\t\t\"show-message\": function (r) {\n\t\t\t\t\t\tthis.room.select(r.room)\n\t\t\t\t\t\tthis.base.firstChild._component.toggle()\n\t\t\t\t\t}.bind(this, r)\n\t\t\t\t})\n\t\t\t\tfrappe.notify(`${frappe.user.first_name(r.user)}`, {\n\t\t\t\t\tbody: r.content,\n\t\t\t\t\ticon: frappe.user.image(r.user),\n\t\t\t\t\ttag: r.user\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tif ( r.room === state.room.name ) {\n\t\t\t\tconst mess  = frappe._.copy_array(state.room.messages)\n\t\t\t\tmess.push(r)\n\n\t\t\t\tthis.set_state({ room: { ...state.room, messages: mess } })\n\t\t\t}\n\t\t})\n\n\t\tfrappe.chat.message.on.update((message, update) => {\n\t\t\tfrappe.log.warn(`TRIGGER: Chat Message ${message} update ${JSON.stringify(update)} recieved.`)\n\t\t})\n\t}\n\n\trender ( ) {\n\t\tconst { props, state } = this\n\t\tconst me               = this\n\n\t\tconst ActionBar        = h(frappe.Chat.Widget.ActionBar, {\n\t\t\tplaceholder: __(\"Search or Create a New Chat\"),\n\t\t\t\t  class: \"level\",\n\t\t\t\t layout: props.layout,\n\t\t\t\tactions:\n\t\t\tfrappe._.compact([\n\t\t\t\t{\n\t\t\t\t\t  label: __(\"New\"),\n\t\t\t\t\tonclick: function ( ) {\n\t\t\t\t\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\t\t\t\t\t  title: __(\"New Chat\"),\n\t\t\t\t\t\t\t fields: [\n\t\t\t\t\t\t\t\t {\n\t\t\t\t\t\t\t\t\t\t label: __(\"Chat Type\"),\n\t\t\t\t\t\t\t\t\t fieldname: \"type\",\n\t\t\t\t\t\t\t\t\t fieldtype: \"Select\",\n\t\t\t\t\t\t\t\t\t   options: [\"Group\", \"Direct Chat\"],\n\t\t\t\t\t\t\t\t\t   default: \"Group\",\n\t\t\t\t\t\t\t\t\t  onchange: () =>  {\n\t\t\t\t\t\t\t\t\t\t\tconst type     = dialog.get_value(\"type\")\n\t\t\t\t\t\t\t\t\t\t\tconst is_group = type === \"Group\"\n\n\t\t\t\t\t\t\t\t\t\t\tdialog.set_df_property(\"group_name\", \"reqd\",  is_group)\n\t\t\t\t\t\t\t\t\t\t\tdialog.set_df_property(\"user\",       \"reqd\", !is_group)\n\t\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t },\n\t\t\t\t\t\t\t\t {\n\t\t\t\t\t\t\t\t\t\t label: __(\"Group Name\"),\n\t\t\t\t\t\t\t\t\t fieldname: \"group_name\",\n\t\t\t\t\t\t\t\t\t fieldtype: \"Data\",\n\t\t\t\t\t\t\t\t\t\t  reqd: true,\n\t\t\t\t\t\t\t\t\tdepends_on: \"eval:doc.type == 'Group'\"\n\t\t\t\t\t\t\t\t },\n\t\t\t\t\t\t\t\t {\n\t\t\t\t\t\t\t\t\t\t label: __(\"Users\"),\n\t\t\t\t\t\t\t\t\t fieldname: \"users\",\n\t\t\t\t\t\t\t\t\t fieldtype: \"MultiSelect\",\n\t\t\t\t\t\t\t\t\t   options: frappe.user.get_emails(),\n\t\t\t\t\t\t\t\t\tdepends_on: \"eval:doc.type == 'Group'\"\n\t\t\t\t\t\t\t\t },\n\t\t\t\t\t\t\t\t {\n\t\t\t\t\t\t\t\t\t\t label: __(\"User\"),\n\t\t\t\t\t\t\t\t\t fieldname: \"user\",\n\t\t\t\t\t\t\t\t\t fieldtype: \"Link\",\n\t\t\t\t\t\t\t\t\t   options: \"User\",\n\t\t\t\t\t\t\t\t\tdepends_on: \"eval:doc.type == 'Direct Chat'\"\n\t\t\t\t\t\t\t\t }\n\t\t\t\t\t\t\t ],\n\t\t\t\t\t\t\taction: {\n\t\t\t\t\t\t\t\tprimary: {\n\t\t\t\t\t\t\t\t\t   label: __('Create'),\n\t\t\t\t\t\t\t\t\tonsubmit: (values) => {\n\t\t\t\t\t\t\t\t\t\tif ( values.type === \"Group\" ) {\n\t\t\t\t\t\t\t\t\t\t\tif ( !frappe._.is_empty(values.users) ) {\n\t\t\t\t\t\t\t\t\t\t\t\tconst name  = values.group_name\n\t\t\t\t\t\t\t\t\t\t\t\tconst users = dialog.fields_dict.users.get_values()\n\n\t\t\t\t\t\t\t\t\t\t\t\tfrappe.chat.room.create(\"Group\",  null, users, name)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tconst user      = values.user\n\n\t\t\t\t\t\t\t\t\t\t\tfrappe.chat.room.create(\"Direct\", null, user)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdialog.hide()\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\tdialog.show()\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfrappe._.is_mobile() && {\n\t\t\t\t\t   icon: \"octicon octicon-x\",\n\t\t\t\t\t   class: \"frappe-chat-close\",\n\t\t\t\t\tonclick: () => this.set_state({ toggle: false })\n\t\t\t\t}\n\t\t\t], Boolean),\n\t\t\tchange: query => { me.set_state({ query }) },\n\t\t\t  span: span  => { me.set_state({ span  }) },\n\t\t})\n\n\t\tvar   contacts   = [ ]\n\t\tif ( 'user_info' in frappe.boot ) {\n\t\t\tconst emails = frappe.user.get_emails()\n\t\t\tfor (const email of emails) {\n\t\t\t\tvar exists = false\n\n\t\t\t\tfor (const room of state.rooms) {\n\t\t\t\t\tif ( room.type === 'Direct' ) {\n\t\t\t\t\t\tif ( room.owner === email || frappe._.squash(room.users) === email )\n\t\t\t\t\t\t\texists = true\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( !exists )\n\t\t\t\t\tcontacts.push({ owner: frappe.session.user, users: [email] })\n\t\t\t}\n\t\t}\n\t\tconst rooms      = state.query ? frappe.chat.room.search(state.query, state.rooms.concat(contacts)) : frappe.chat.room.sort(state.rooms)\n\n\t\tconst layout     = state.span  ? frappe.Chat.Layout.PAGE : frappe.Chat.Layout.POPPER\n\n\t\tconst RoomList   = frappe._.is_empty(rooms) && !state.query ?\n\t\t\th(\"div\", { class: \"vcenter\" },\n\t\t\t\th(\"div\", { class: \"text-center text-extra-muted\" },\n\t\t\t\t\th(\"p\",\"\",__(\"You don't have any messages yet.\"))\n\t\t\t\t)\n\t\t\t)\n\t\t\t:\n\t\t\th(frappe.Chat.Widget.RoomList, { rooms: rooms, click: room =>  {\n\t\t\t\tif ( room.name )\n\t\t\t\t\tthis.room.select(room.name)\n\t\t\t\telse\n\t\t\t\t\tfrappe.chat.room.create(\"Direct\", room.owner, frappe._.squash(room.users), ({ name }) => this.room.select(name))\n\t\t\t}})\n\t\tconst Room       = h(frappe.Chat.Widget.Room, { ...state.room, layout: layout, destroy: () => {\n\t\t\tthis.set_state({\n\t\t\t\troom: { name: null, messages: [ ] }\n\t\t\t})\n\t\t}})\n\n\t\tconst component  = layout === frappe.Chat.Layout.POPPER ?\n\t\t\th(frappe.Chat.Widget.Popper, { heading: ActionBar, page: state.room.name && Room, target: props.target,\n\t\t\t\ttoggle: (t) => this.set_state({ toggle: t }) },\n\t\t\t\tRoomList\n\t\t\t)\n\t\t\t:\n\t\t\th(\"div\", { class: \"frappe-chat-popper\" },\n\t\t\t\th(\"div\", { class: \"frappe-chat-popper-collapse\" },\n\t\t\t\t\th(\"div\", { class: \"panel panel-default panel-span\", style: { width: \"25%\" } },\n\t\t\t\t\t\th(\"div\", { class: \"panel-heading\" },\n\t\t\t\t\t\t\tActionBar\n\t\t\t\t\t\t),\n\t\t\t\t\t\tRoomList\n\t\t\t\t\t),\n\t\t\t\t\tRoom\n\t\t\t\t)\n\t\t\t)\n\n\t\treturn (\n\t\t\th(\"div\", { class: \"frappe-chat\" },\n\t\t\t\tcomponent\n\t\t\t)\n\t\t)\n\t}\n}\nfrappe.Chat.Widget.defaultState =  {\n\t  query: \"\",\n\tprofile: { },\n\t  rooms: [ ],\n\t   room: { name: null, messages: [ ], typing: [ ] },\n\t toggle: false,\n\t   span: false\n}\nfrappe.Chat.Widget.defaultProps = {\n\tlayout: frappe.Chat.Layout.POPPER\n}\n\n/**\n * @description Chat Widget Popper HOC.\n */\nfrappe.Chat.Widget.Popper\n=\nclass extends Component {\n\tconstructor (props) {\n\t\tsuper (props)\n\n\t\tthis.setup(props);\n\t}\n\n\tsetup (props) {\n\t\tthis.toggle = this.toggle.bind(this)\n\n\t\tthis.state  = frappe.Chat.Widget.Popper.defaultState\n\n\t\tif ( props.target )\n\t\t\t$(props.target).click(() => this.toggle())\n\n\t\tfrappe.chat.widget = this\n\t}\n\n\ttoggle  (active) {\n\t\tlet toggle\n\t\tif ( arguments.length === 1 )\n\t\t\ttoggle = active\n\t\telse\n\t\t\ttoggle = this.state.active ? false : true\n\n\t\tthis.set_state({ active: toggle })\n\n\t\tthis.props.toggle(toggle)\n\t}\n\n\ton_mounted ( ) {\n\t\t$(document.body).on('click', '.page-container, .frappe-chat-close', ({ currentTarget }) => {\n\t\t\tthis.toggle(false)\n\t\t})\n\t}\n\n\trender  ( )  {\n\t\tconst { props, state } = this\n\n\t\treturn !state.destroy ?\n\t\t(\n\t\t\th(\"div\", { class: \"frappe-chat-popper\", style: !props.target ? { \"margin-bottom\": \"80px\" } : null },\n\t\t\t\t!props.target ?\n\t\t\t\t\th(frappe.components.FAB, {\n\t\t\t\t\t\t  class: \"frappe-fab\",\n\t\t\t\t\t\t   icon: state.active ? \"fa fa-fw fa-times\" : \"font-heavy octicon octicon-comment\",\n\t\t\t\t\t\t   size: frappe._.is_mobile() ? null : \"large\",\n\t\t\t\t\t\t   type: \"primary\",\n\t\t\t\t\t\tonclick: () => this.toggle(),\n\t\t\t\t\t}) : null,\n\t\t\t\tstate.active ?\n\t\t\t\t\th(\"div\", { class: \"frappe-chat-popper-collapse\" },\n\t\t\t\t\t\tprops.page ? props.page : (\n\t\t\t\t\t\t\th(\"div\", { class: `panel panel-default ${frappe._.is_mobile() ? \"panel-span\" : \"\"}` },\n\t\t\t\t\t\t\t\th(\"div\", { class: \"panel-heading\" },\n\t\t\t\t\t\t\t\t\tprops.heading\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tprops.children\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t) : null\n\t\t\t)\n\t\t) : null\n\t}\n}\nfrappe.Chat.Widget.Popper.defaultState\n=\n{\n\t active: false,\n\tdestroy: false\n}\n\n/**\n * @description frappe.Chat.Widget ActionBar Component\n */\nfrappe.Chat.Widget.ActionBar\n=\nclass extends Component {\n\tconstructor (props) {\n\t\tsuper (props)\n\n\t\tthis.change = this.change.bind(this)\n\t\tthis.submit = this.submit.bind(this)\n\n\t\tthis.state  = frappe.Chat.Widget.ActionBar.defaultState\n\t}\n\n\tchange (e) {\n\t\tconst { props, state } = this\n\n\t\tthis.set_state({\n\t\t\t[e.target.name]: e.target.value\n\t\t})\n\n\t\tprops.change(state.query)\n\t}\n\n\tsubmit (e) {\n\t\tconst { props, state } = this\n\n\t\te.preventDefault()\n\n\t\tprops.submit(state.query)\n\t}\n\n\trender ( ) {\n\t\tconst me               = this\n\t\tconst { props, state } = this\n\t\tconst { actions }      = props\n\n\t\treturn (\n\t\t\th(\"div\", { class: `frappe-chat-action-bar ${props.class ? props.class : \"\"}` },\n\t\t\t\th(\"form\", { oninput: this.change, onsubmit: this.submit },\n\t\t\t\t\th(\"input\", { autocomplete: \"off\", class: \"form-control input-sm\", name: \"query\", value: state.query, placeholder: props.placeholder || \"Search\" }),\n\t\t\t\t),\n\t\t\t\t!frappe._.is_empty(actions) ?\n\t\t\t\t\tactions.map(action => h(frappe.Chat.Widget.ActionBar.Action, { ...action })) : null,\n\t\t\t\t!frappe._.is_mobile() ?\n\t\t\t\t\th(frappe.Chat.Widget.ActionBar.Action, {\n\t\t\t\t\t\ticon: `octicon octicon-screen-${state.span ? \"normal\" : \"full\"}`,\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tconst span = !state.span\n\t\t\t\t\t\t\tme.set_state({ span })\n\t\t\t\t\t\t\tprops.span(span)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t:\n\t\t\t\t\tnull\n\t\t\t)\n\t\t)\n\t}\n}\nfrappe.Chat.Widget.ActionBar.defaultState\n=\n{\n\tquery: null,\n\t span: false\n}\n\n/**\n * @description frappe.Chat.Widget ActionBar's Action Component.\n */\nfrappe.Chat.Widget.ActionBar.Action\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props } = this\n\n\t\treturn (\n\t\t\th(frappe.components.Button, { size: \"small\", class: \"btn-action\", ...props },\n\t\t\t\tprops.icon ? h(\"i\", { class: props.icon }) : null,\n\t\t\t\t`${props.icon ? \" \" : \"\"}${props.label ? props.label : \"\"}`\n\t\t\t)\n\t\t)\n\t}\n}\n\n/**\n * @description frappe.Chat.Widget RoomList Component\n */\nfrappe.Chat.Widget.RoomList\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props } = this\n\t\tconst rooms     = props.rooms\n\n\t\treturn !frappe._.is_empty(rooms) ? (\n\t\t\th(\"ul\", { class: \"frappe-chat-room-list nav nav-pills nav-stacked\" },\n\t\t\t\trooms.map(room => h(frappe.Chat.Widget.RoomList.Item, { ...room, click: props.click }))\n\t\t\t)\n\t\t) : null\n\t}\n}\n\n/**\n * @description frappe.Chat.Widget RoomList's Item Component\n */\nfrappe.Chat.Widget.RoomList.Item\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props }    = this\n\t\tconst item         = { }\n\n\t\tif ( props.type === \"Group\" ) {\n\t\t\titem.title     = props.room_name\n\t\t\titem.image     = props.avatar\n\n\t\t\tif ( !frappe._.is_empty(props.typing) ) {\n\t\t\t\tprops.typing  = frappe._.as_array(props.typing) // HACK: (BUG) why does typing return a string?\n\t\t\t\tconst names   = props.typing.map(user => frappe.user.first_name(user))\n\t\t\t\titem.subtitle = `${names.join(\", \")} typing...`\n\t\t\t} else\n\t\t\tif ( props.last_message ) {\n\t\t\t\tconst message = props.last_message\n\t\t\t\tconst content = message.content\n\n\t\t\t\tif ( message.type === \"File\" ) {\n\t\t\t\t\titem.subtitle = `📁 ${content.name}`\n\t\t\t\t} else {\n\t\t\t\t\titem.subtitle = props.last_message.content\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst user     = props.owner === frappe.session.user ? frappe._.squash(props.users) : props.owner\n\n\t\t\titem.title     = frappe.user.full_name(user)\n\t\t\titem.image     = frappe.user.image(user)\n\t\t\titem.abbr      = frappe.user.abbr(user)\n\n\t\t\tif ( !frappe._.is_empty(props.typing) )\n\t\t\t\titem.subtitle = 'typing...'\n\t\t\telse\n\t\t\tif ( props.last_message ) {\n\t\t\t\tconst message = props.last_message\n\t\t\t\tconst content = message.content\n\n\t\t\t\tif ( message.type === \"File\" ) {\n\t\t\t\t\titem.subtitle = `📁 ${content.name}`\n\t\t\t\t} else {\n\t\t\t\t\titem.subtitle = props.last_message.content\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet is_unread = false\n\t\tif ( props.last_message ) {\n\t\t\titem.timestamp = frappe.chat.pretty_datetime(props.last_message.creation)\n\t\t\tis_unread = !props.last_message.seen.includes(frappe.session.user)\n\t\t}\n\n\t\treturn (\n\t\t\th(\"li\", null,\n\t\t\t\th(\"a\", { class: props.active ? \"active\": \"\", onclick: () => {\n\t\t\t\t\tif (props.last_message) {\n\t\t\t\t\t\tfrappe.chat.message.seen(props.last_message.name);\n\t\t\t\t\t}\n\t\t\t\t\tprops.click(props)\n\t\t\t\t} },\n\t\t\t\t\th(\"div\", { class: \"row\" },\n\t\t\t\t\t\th(\"div\", { class: \"col-xs-9\" },\n\t\t\t\t\t\t\th(frappe.Chat.Widget.MediaProfile, { ...item })\n\t\t\t\t\t\t),\n\t\t\t\t\t\th(\"div\", { class: \"col-xs-3 text-right\" },\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\th(\"div\", { class: \"text-muted\", style: { \"font-size\": \"9px\" } }, item.timestamp),\n\t\t\t\t\t\t\t\tis_unread ? h(\"span\", { class: \"indicator red\" }) : null\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t),\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t)\n\t\t)\n\t}\n}\n\n/**\n * @description frappe.Chat.Widget's MediProfile Component.\n */\nfrappe.Chat.Widget.MediaProfile\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props } = this\n\t\tconst position  = frappe.Chat.Widget.MediaProfile.POSITION[props.position || \"left\"]\n\t\tconst avatar    = (\n\t\t\th(\"div\", { class: `${position.class} media-middle` },\n\t\t\t\th(frappe.components.Avatar, { ...props,\n\t\t\t\t\ttitle: props.title,\n\t\t\t\t\timage: props.image,\n\t\t\t\t\t size: props.size,\n\t\t\t\t\t abbr: props.abbr\n\t\t\t\t})\n\t\t\t)\n\t\t)\n\n\t\treturn (\n\t\t\th(\"div\", { class: \"media\", style: position.class === \"media-right\" ? { \"text-align\": \"right\" } : null },\n\t\t\t\tposition.class === \"media-left\"  ? avatar : null,\n\t\t\t\th(\"div\", { class: \"media-body\" },\n\t\t\t\t\th(\"div\", { class: \"media-heading ellipsis small\", style: `max-width: ${props.width_title || \"100%\"} display: inline-block` }, props.title),\n\t\t\t\t\tprops.content  ? h(\"div\",\"\",h(\"small\",\"\",props.content))  : null,\n\t\t\t\t\tprops.subtitle ? h(\"div\",{ class: \"media-subtitle small\" },h(\"small\", { class: \"text-muted\" }, props.subtitle)) : null\n\t\t\t\t),\n\t\t\t\tposition.class === \"media-right\" ? avatar : null\n\t\t\t)\n\t\t)\n\t}\n}\nfrappe.Chat.Widget.MediaProfile.POSITION\n=\n{\n\tleft: { class: \"media-left\" }, right: { class: \"media-right\" }\n}\n\n/**\n * @description frappe.Chat.Widget Room Component\n */\nfrappe.Chat.Widget.Room\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props, state } = this\n\t\tconst hints            =\n\t\t[\n\t\t\t{\n\t\t\t\t match: /@(\\w*)$/,\n\t\t\t\tsearch: function (keyword, callback) {\n\t\t\t\t\tif ( props.type === 'Group' ) {\n\t\t\t\t\t\tconst query = keyword.slice(1)\n\t\t\t\t\t\tconst users = [].concat(frappe._.as_array(props.owner), props.users)\n\t\t\t\t\t\tconst grep  = users.filter(user => user !== frappe.session.user && user.indexOf(query) === 0)\n\n\t\t\t\t\t\tcallback(grep)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcomponent: function (item) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\th(frappe.Chat.Widget.MediaProfile, {\n\t\t\t\t\t\t\ttitle: frappe.user.full_name(item),\n\t\t\t\t\t\t\timage: frappe.user.image(item),\n\t\t\t\t\t\t\t size: \"small\"\n\t\t\t\t\t\t})\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tmatch: /:([a-z]*)$/,\n\t\t\t   search: function (keyword, callback) {\n\t\t\t\t\tfrappe.chat.emoji(function (emojis) {\n\t\t\t\t\t\tconst query = keyword.slice(1)\n\t\t\t\t\t\tconst items = [ ]\n\t\t\t\t\t\tfor (const emoji of emojis)\n\t\t\t\t\t\t\tfor (const alias of emoji.aliases)\n\t\t\t\t\t\t\t\tif ( alias.indexOf(query) === 0 )\n\t\t\t\t\t\t\t\t\titems.push({ name: alias, value: emoji.emoji })\n\n\t\t\t\t\t\tcallback(items)\n\t\t\t\t\t})\n\t\t\t   },\n\t\t\t\t content: (item) => item.value,\n\t\t\t   component: function (item) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\th(frappe.Chat.Widget.MediaProfile, {\n\t\t\t\t\t\t\ttitle: item.name,\n\t\t\t\t\t\t\t abbr: item.value,\n\t\t\t\t\t\t\t size: \"small\"\n\t\t\t\t\t\t})\n\t\t\t\t\t)\n\t\t\t   }\n\t\t   }\n\t\t]\n\n\t\tconst actions = frappe._.compact([\n\t\t\t!frappe._.is_mobile() && {\n\t\t\t\t icon: \"camera\",\n\t\t\t\tlabel: \"Camera\",\n\t\t\t\tonclick: ( ) => {\n\t\t\t\t\tconst capture = new frappe.ui.Capture({\n\t\t\t\t\t\tanimate: false,\n\t\t\t\t\t\t  error: true\n\t\t\t\t\t})\n\t\t\t\t\tcapture.show()\n\n\t\t\t\t\tcapture.submit(data_url => {\n\t\t\t\t\t\t// data_url\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t icon: \"file\",\n\t\t\t\tlabel: \"File\",\n\t\t\t\tonclick: ( ) => {\n\t\t\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\t\t\tdoctype: \"Chat Room\",\n\t\t\t\t\t\tdocname: props.name,\n\t\t\t\t\t\ton_success(file_doc) {\n\t\t\t\t\t\t\tconst { file_url, filename } = file_doc\n\t\t\t\t\t\t\tfrappe.chat.message.send(props.name, { path: file_url, name: filename }, \"File\")\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t])\n\n\t\tif ( frappe.session.user !== 'Guest' ) {\n\t\t\tif (props.messages) {\n\t\t\t\tprops.messages = frappe._.as_array(props.messages)\n\t\t\t\tfor (const message of props.messages)\n\t\t\t\t\tif ( !message.seen.includes(frappe.session.user) )\n\t\t\t\t\t\tfrappe.chat.message.seen(message.name)\n\t\t\t\t\telse\n\t\t\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\th(\"div\", { class: `panel panel-default\n\t\t\t\t${props.name ? \"panel-bg\" : \"\"}\n\t\t\t\t${props.layout === frappe.Chat.Layout.PAGE || frappe._.is_mobile() ? \"panel-span\" : \"\"}`,\n\t\t\t\tstyle: props.layout === frappe.Chat.Layout.PAGE && { width: \"75%\", left: \"25%\", \"box-shadow\": \"none\" } },\n\t\t\t\tprops.name && h(frappe.Chat.Widget.Room.Header, { ...props, on_back: props.destroy }),\n\t\t\t\tprops.name ?\n\t\t\t\t\t!frappe._.is_empty(props.messages) ?\n\t\t\t\t\t\th(frappe.chat.component.ChatList, {\n\t\t\t\t\t\t\tmessages: props.messages\n\t\t\t\t\t\t})\n\t\t\t\t\t\t:\n\t\t\t\t\t\th(\"div\", { class: \"panel-body\", style: { \"height\": \"100%\" } },\n\t\t\t\t\t\t\th(\"div\", { class: \"vcenter\" },\n\t\t\t\t\t\t\t\th(\"div\", { class: \"text-center text-extra-muted\" },\n\t\t\t\t\t\t\t\t\th(frappe.components.Octicon, { type: \"comment-discussion\", style: \"font-size: 48px\" }),\n\t\t\t\t\t\t\t\t\th(\"p\",\"\",__(\"Start a conversation.\"))\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t:\n\t\t\t\t\th(\"div\", { class: \"panel-body\", style: { \"height\": \"100%\" } },\n\t\t\t\t\t\th(\"div\", { class: \"vcenter\" },\n\t\t\t\t\t\t\th(\"div\", { class: \"text-center text-extra-muted\" },\n\t\t\t\t\t\t\t\th(frappe.components.Octicon, { type: \"comment-discussion\", style: \"font-size: 125px\" }),\n\t\t\t\t\t\t\t\th(\"p\",\"\",__(\"Select a chat to start messaging.\"))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\tprops.name ?\n\t\t\t\t\th(\"div\", { class: \"chat-room-footer\" },\n\t\t\t\t\t\th(frappe.chat.component.ChatForm, { actions: actions,\n\t\t\t\t\t\t\tonchange: () => {\n\t\t\t\t\t\t\t\tfrappe.chat.message.typing(props.name)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonsubmit: (message) => {\n\t\t\t\t\t\t\t\tfrappe.chat.message.send(props.name, message)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\thint: hints\n\t\t\t\t\t\t})\n\t\t\t\t\t)\n\t\t\t\t\t:\n\t\t\t\t\tnull\n\t\t\t)\n\t\t)\n\t}\n}\n\nfrappe.Chat.Widget.Room.Header\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props }     = this\n\n\t\tconst item          = { }\n\n\t\tif ( [\"Group\", \"Visitor\"].includes(props.type) ) {\n\t\t\titem.route      = `Form/Chat Room/${props.name}`\n\n\t\t\titem.title      = props.room_name\n\t\t\titem.image      = props.avatar\n\n\t\t\tif ( !frappe._.is_empty(props.typing) ) {\n\t\t\t\tprops.typing  = frappe._.as_array(props.typing) // HACK: (BUG) why does typing return as a string?\n\t\t\t\tconst users   = props.typing.map(user => frappe.user.first_name(user))\n\t\t\t\titem.subtitle = `${users.join(\", \")} typing...`\n\t\t\t} else\n\t\t\t\titem.subtitle = props.type === \"Group\" ?\n\t\t\t\t\t__(`${props.users.length} ${frappe._.pluralize('member', props.users.length)}`)\n\t\t\t\t\t:\n\t\t\t\t\t\"\"\n\t\t}\n\t\telse {\n\t\t\tconst user      = props.owner === frappe.session.user ? frappe._.squash(props.users) : props.owner\n\n\t\t\titem.route      = `Form/User/${user}`\n\n\t\t\titem.title      = frappe.user.full_name(user)\n\t\t\titem.image      = frappe.user.image(user)\n\n\t\t\tif ( !frappe._.is_empty(props.typing) )\n\t\t\t\titem.subtitle = 'typing...'\n\t\t}\n\n\t\tconst popper        = props.layout === frappe.Chat.Layout.POPPER || frappe._.is_mobile()\n\n\t\treturn (\n\t\t\th(\"div\", { class: \"panel-heading\", style: { \"height\": \"50px\" } }, // sorry. :(\n\t\t\t\th(\"div\", { class: \"level\" },\n\t\t\t\t\tpopper && frappe.session.user !== \"Guest\" ?\n\t\t\t\t\t\th(frappe.components.Button,{class:\"btn-back\",onclick:props.on_back},\n\t\t\t\t\t\t\th(frappe.components.Octicon, { type: \"chevron-left\" })\n\t\t\t\t\t\t) : null,\n\t\t\t\t\th(\"div\",\"\",\n\t\t\t\t\t\th(\"div\", { class: \"panel-title\" },\n\t\t\t\t\t\t\th(\"div\", { class: \"cursor-pointer\", onclick: () => {\n\t\t\t\t\t\t\t\tfrappe.session.user !== \"Guest\" ?\n\t\t\t\t\t\t\t\t\tfrappe.set_route(item.route) : null;\n\t\t\t\t\t\t\t}},\n\t\t\t\t\t\t\t\th(frappe.Chat.Widget.MediaProfile, { ...item })\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\t\th(\"div\", { class: popper ? \"col-xs-2\"  : \"col-xs-3\" },\n\t\t\t\t\t\th(\"div\", { class: \"text-right\" },\n\t\t\t\t\t\t\tfrappe._.is_mobile() && h(frappe.components.Button, { class: \"frappe-chat-close\", onclick: props.toggle },\n\t\t\t\t\t\t\t\th(frappe.components.Octicon, { type: \"x\" })\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t)\n\t\t)\n\t}\n}\n\n/**\n * @description ChatList Component\n *\n * @prop {array} messages - ChatMessage(s)\n */\nfrappe.chat.component.ChatList\n=\nclass extends Component {\n\ton_mounted ( ) {\n\t\tthis.$element  = $('.frappe-chat').find('.chat-list')\n\t\tthis.$element.scrollTop(this.$element[0].scrollHeight)\n\t}\n\n\ton_updated ( ) {\n\t\tthis.$element.scrollTop(this.$element[0].scrollHeight)\n\t}\n\n\trender ( ) {\n\t\tvar messages = [ ]\n\t\tfor (var i   = 0 ; i < this.props.messages.length ; ++i) {\n\t\t\tvar   message   = this.props.messages[i]\n\t\t\tconst me        = message.user === frappe.session.user\n\n\t\t\tif ( i === 0 || !frappe.datetime.equal(message.creation, this.props.messages[i - 1].creation, 'day') )\n\t\t\t\tmessages.push({ type: \"Notification\", content: message.creation.format('MMMM DD') })\n\n\t\t\tmessages.push(message)\n\t\t}\n\n\t\treturn (\n\t\t\th(\"div\",{class:\"chat-list list-group\"},\n\t\t\t\t!frappe._.is_empty(messages) ?\n\t\t\t\t\tmessages.map(m => h(frappe.chat.component.ChatList.Item, {...m})) : null\n\t\t\t)\n\t\t)\n\t}\n}\n\n/**\n * @description ChatList.Item Component\n *\n * @prop {string} name       - ChatMessage name\n * @prop {string} user       - ChatMessage user\n * @prop {string} room       - ChatMessage room\n * @prop {string} room_type  - ChatMessage room_type (\"Direct\", \"Group\" or \"Visitor\")\n * @prop {string} content    - ChatMessage content\n * @prop {frappe.datetime.datetime} creation - ChatMessage creation\n *\n * @prop {boolean} groupable - Whether the ChatMessage is groupable.\n */\nfrappe.chat.component.ChatList.Item\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props } = this\n\n\t\tconst me        = props.user === frappe.session.user\n\t\tconst content   = props.content\n\n\t\treturn (\n\t\t\th(\"div\",{class: \"chat-list-item list-group-item\"},\n\t\t\t\tprops.type === \"Notification\" ?\n\t\t\t\t\th(\"div\",{class:\"chat-list-notification\"},\n\t\t\t\t\t\th(\"div\",{class:\"chat-list-notification-content\"},\n\t\t\t\t\t\t\tcontent\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t\t:\n\t\t\t\t\th(\"div\",{class:`${me ? \"text-right\" : \"\"}`},\n\t\t\t\t\t\tprops.room_type === \"Group\" && !me ?\n\t\t\t\t\t\t\th(frappe.components.Avatar, {\n\t\t\t\t\t\t\t\ttitle: frappe.user.full_name(props.user),\n\t\t\t\t\t\t\t\timage: frappe.user.image(props.user)\n\t\t\t\t\t\t\t}) : null,\n\t\t\t\t\t\th(frappe.chat.component.ChatBubble, props)\n\t\t\t\t\t)\n\t\t\t)\n\t\t)\n\t}\n}\n\n/**\n * @description ChatBubble Component\n *\n * @prop {string} name       - ChatMessage name\n * @prop {string} user       - ChatMessage user\n * @prop {string} room       - ChatMessage room\n * @prop {string} room_type  - ChatMessage room_type (\"Direct\", \"Group\" or \"Visitor\")\n * @prop {string} content    - ChatMessage content\n * @prop {frappe.datetime.datetime} creation - ChatMessage creation\n *\n * @prop {boolean} groupable - Whether the ChatMessage is groupable.\n */\nfrappe.chat.component.ChatBubble\n=\nclass extends Component {\n\tconstructor (props) {\n\t\tsuper (props)\n\n\t\tthis.onclick = this.onclick.bind(this)\n\t}\n\n\tonclick ( ) {\n\t\tconst { props } = this\n\t\tif ( props.user === frappe.session.user ) {\n\t\t\tfrappe.quick_edit(\"Chat Message\", props.name, (values) => {\n\n\t\t\t})\n\t\t}\n\t}\n\n\trender  ( ) {\n\t\tconst { props } = this\n\t\tconst creation \t= props.creation.format('hh:mm A')\n\n\t\tconst me        = props.user === frappe.session.user\n\t\tconst read      = !frappe._.is_empty(props.seen) && !props.seen.includes(frappe.session.user)\n\n\t\tconst content   = props.content\n\n\t\treturn (\n\t\t\th(\"div\",{class:`chat-bubble ${props.groupable ? \"chat-groupable\" : \"\"} chat-bubble-${me ? \"r\" : \"l\"}`,\n\t\t\t\tonclick: this.onclick},\n\t\t\t\tprops.room_type === \"Group\" && !me?\n\t\t\t\t\th(\"div\",{class:\"chat-bubble-author\"},\n\t\t\t\t\t\th(\"a\", { onclick: () => { frappe.set_route(`Form/User/${props.user}`) } },\n\t\t\t\t\t\t\tfrappe.user.full_name(props.user)\n\t\t\t\t\t\t)\n\t\t\t\t\t) : null,\n\t\t\t\th(\"div\",{class:\"chat-bubble-content\"},\n\t\t\t\t\t\th(\"small\",\"\",\n\t\t\t\t\t\t\tprops.type === \"File\" ?\n\t\t\t\t\t\t\t\th(\"a\", { class: \"no-decoration\", href: content.path, target: \"_blank\" },\n\t\t\t\t\t\t\t\t\th(frappe.components.FontAwesome, { type: \"file\", fixed: true }), ` ${content.name}`\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t:\n\t\t\t\t\t\t\t\tcontent\n\t\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t\th(\"div\",{class:\"chat-bubble-meta\"},\n\t\t\t\t\th(\"span\",{class:\"chat-bubble-creation\"},creation),\n\t\t\t\t\tme && read ?\n\t\t\t\t\t\th(\"span\",{class:\"chat-bubble-check\"},\n\t\t\t\t\t\t\th(frappe.components.Octicon,{type:\"check\"})\n\t\t\t\t\t\t) : null\n\t\t\t\t)\n\t\t\t)\n\t\t)\n\t}\n}\n\n/**\n * @description ChatForm Component\n */\nfrappe.chat.component.ChatForm\n=\nclass extends Component {\n\tconstructor (props) {\n\t\tsuper (props)\n\n\t\tthis.onchange   = this.onchange.bind(this)\n\t\tthis.onsubmit   = this.onsubmit.bind(this)\n\n\t\tthis.hint        = this.hint.bind(this)\n\n\t\tthis.state       = frappe.chat.component.ChatForm.defaultState\n\t}\n\n\tonchange (e) {\n\t\tconst { props, state } = this\n\t\tconst value            = e.target.value\n\n\t\tthis.set_state({\n\t\t\t[e.target.name]: value\n\t\t})\n\n\t\tprops.onchange(state)\n\n\t\tthis.hint(value)\n\t}\n\n\thint (value) {\n\t\tconst { props, state } = this\n\n\t\tif ( props.hint ) {\n\t\t\tconst tokens =  value.split(\" \")\n\t\t\tconst sliced = tokens.slice(0, tokens.length - 1)\n\n\t\t\tconst token  = tokens[tokens.length - 1]\n\n\t\t\tif ( token ) {\n\t\t\t\tprops.hint   = frappe._.as_array(props.hint)\n\t\t\t\tconst hint   = props.hint.find(hint => hint.match.test(token))\n\n\t\t\t\tif ( hint ) {\n\t\t\t\t\thint.search(token, items => {\n\t\t\t\t\t\tconst hints = items.map(item => {\n\t\t\t\t\t\t\t// You should stop writing one-liners! >_>\n\t\t\t\t\t\t\tconst replace = token.replace(hint.match, hint.content ? hint.content(item) : item)\n\t\t\t\t\t\t\tconst content = `${sliced.join(\" \")} ${replace}`.trim()\n\t\t\t\t\t\t\titem          = { component: hint.component(item), content: content }\n\n\t\t\t\t\t\t\treturn item\n\t\t\t\t\t\t}).slice(0, hint.max || 5)\n\n\t\t\t\t\t\tthis.set_state({ hints })\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthis.set_state({ hints: [ ] })\n\t\t\t} else\n\t\t\t\tthis.set_state({ hints: [ ] })\n\t\t}\n\t}\n\n\tonsubmit (e) {\n\t\te.preventDefault()\n\n\t\tif ( this.state.content ) {\n\t\t\tthis.props.onsubmit(this.state.content)\n\n\t\t\tthis.set_state({ content: null })\n\t\t}\n\t}\n\n\trender ( ) {\n\t\tconst { props, state } = this\n\n\t\treturn (\n\t\t\th(\"div\",{class:\"chat-form\"},\n\t\t\t\tstate.hints.length ?\n\t\t\t\t\th(\"ul\", { class: \"hint-list list-group\" },\n\t\t\t\t\t\tstate.hints.map((item) => {\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\th(\"li\", { class: \"hint-list-item list-group-item\" },\n\t\t\t\t\t\t\t\t\th(\"a\", { href: \"javascript:void(0)\", onclick: () => {\n\t\t\t\t\t\t\t\t\t\tthis.set_state({ content: item.content, hints: [ ] })\n\t\t\t\t\t\t\t\t\t}},\n\t\t\t\t\t\t\t\t\t\titem.component\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t})\n\t\t\t\t\t) : null,\n\t\t\t\th(\"form\", { oninput: this.onchange, onsubmit: this.onsubmit },\n\t\t\t\t\th(\"div\",{class:\"input-group input-group-lg\"},\n\t\t\t\t\t\t!frappe._.is_empty(props.actions) ?\n\t\t\t\t\t\t\th(\"div\",{class:\"input-group-btn dropup\"},\n\t\t\t\t\t\t\t\th(frappe.components.Button,{ class: (frappe.session.user === \"Guest\" ? \"disabled\" : \"dropdown-toggle\"), \"data-toggle\": \"dropdown\"},\n\t\t\t\t\t\t\t\t\th(frappe.components.FontAwesome, { class: \"text-muted\", type: \"paperclip\", fixed: true })\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\th(\"div\",{ class:\"dropdown-menu dropdown-menu-left\", onclick: e => e.stopPropagation() },\n\t\t\t\t\t\t\t\t\t!frappe._.is_empty(props.actions) && props.actions.map((action) => {\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\th(\"li\", null,\n\t\t\t\t\t\t\t\t\t\t\t\th(\"a\",{onclick:action.onclick},\n\t\t\t\t\t\t\t\t\t\t\t\t\th(frappe.components.FontAwesome,{type:action.icon,fixed:true}), ` ${action.label}`,\n\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) : null,\n\t\t\t\t\t\th(\"textarea\", {\n\t\t\t\t\t\t\t\t\tclass: \"form-control\",\n\t\t\t\t\t\t\t\t\t name: \"content\",\n\t\t\t\t\t\t\t\t\tvalue: state.content,\n\t\t\t\t\t\t\t  placeholder: \"Type a message\",\n\t\t\t\t\t\t\t\tautofocus: true,\n\t\t\t\t\t\t\t   onkeypress: (e) => {\n\t\t\t\t\t\t\t\t\tif ( e.which === frappe.ui.keycode.RETURN && !e.shiftKey )\n\t\t\t\t\t\t\t\t\t\tthis.onsubmit(e)\n\t\t\t\t\t\t\t   }\n\t\t\t\t\t\t}),\n\t\t\t\t\t\th(\"div\",{class:\"input-group-btn\"},\n\t\t\t\t\t\t\th(frappe.components.Button, { onclick: this.onsubmit },\n\t\t\t\t\t\t\t\th(frappe.components.FontAwesome, { class: !frappe._.is_empty(state.content) ? \"text-primary\" : \"text-muted\", type: \"send\", fixed: true })\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t)\n\t\t)\n\t}\n}\nfrappe.chat.component.ChatForm.defaultState\n=\n{\n\tcontent: null,\n\t  hints: [ ],\n}\n\n/**\n * @description EmojiPicker Component\n *\n * @todo Under Development\n */\nfrappe.chat.component.EmojiPicker\n=\nclass extends Component  {\n\trender ( ) {\n\t\tconst { props } = this\n\n\t\treturn (\n\t\t\th(\"div\", { class: `frappe-chat-emoji dropup ${props.class}` },\n\t\t\t\th(frappe.components.Button, { type: \"primary\", class: \"dropdown-toggle\", \"data-toggle\": \"dropdown\" },\n\t\t\t\t\th(frappe.components.FontAwesome, { type: \"smile-o\", fixed: true })\n\t\t\t\t),\n\t\t\t\th(\"div\", { class: \"dropdown-menu dropdown-menu-right\", onclick: e => e.stopPropagation() },\n\t\t\t\t\th(\"div\", { class: \"panel panel-default\" },\n\t\t\t\t\t\th(frappe.chat.component.EmojiPicker.List)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t)\n\t\t)\n\t}\n}\nfrappe.chat.component.EmojiPicker.List\n=\nclass extends Component {\n\trender ( ) {\n\t\tconst { props } = this\n\n\t\treturn (\n\t\t\th(\"div\", { class: \"list-group\" },\n\n\t\t\t)\n\t\t)\n\t}\n}\n\n/**\n * @description Python equivalent to sys.platform\n */\nfrappe.provide('frappe._')\nfrappe._.platform   = () => {\n\tconst string    = navigator.appVersion\n\n\tif ( string.includes(\"Win\") ) \treturn \"Windows\"\n\tif ( string.includes(\"Mac\") ) \treturn \"Darwin\"\n\tif ( string.includes(\"X11\") ) \treturn \"UNIX\"\n\tif ( string.includes(\"Linux\") ) return \"Linux\"\n\n\treturn undefined\n}\n\n/**\n * @description Frappe's Asset Helper\n */\nfrappe.provide('frappe.assets')\nfrappe.assets.image = (image, app = 'frappe') => {\n\tconst  path     = `/assets/${app}/images/${image}`\n\treturn path\n}\n\n/**\n * @description Notify using Web Push Notifications\n */\nfrappe.provide('frappe.boot')\nfrappe.provide('frappe.browser')\nfrappe.browser.Notification = 'Notification' in window\n\nfrappe.notify     = (string, options) => {\n\tfrappe.log    = frappe.Logger.get('frappe.notify')\n\n\tconst OPTIONS = {\n\t\ticon: frappe.assets.image('favicon.png', 'frappe'),\n\t\tlang: frappe.boot.lang || \"en\"\n\t}\n\toptions       = Object.assign({ }, OPTIONS, options)\n\n\tif ( !frappe.browser.Notification )\n\t\tfrappe.log.error('ERROR: This browser does not support desktop notifications.')\n\n\tNotification.requestPermission(status => {\n\t\tif ( status === \"granted\" ) {\n\t\t\tconst notification = new Notification(string, options)\n\t\t}\n\t})\n}\n\nfrappe.chat.render = (render = true, force = false) =>\n{\n\tfrappe.log.info(`${render ? \"Enable\" : \"Disable\"} Chat for User.`)\n\n\tconst desk = 'desk' in frappe\n\tif ( desk ) {\n\t\t// With the assumption, that there's only one navbar.\n\t\tconst $placeholder = $('.navbar .frappe-chat-dropdown')\n\n\t\t// Render if frappe-chat-toggle doesn't exist.\n\t\tif ( frappe.utils.is_empty($placeholder.has('.frappe-chat-toggle')) ) {\n\t\t\tconst $template = $(`\n\t\t\t\t<a class=\"dropdown-toggle frappe-chat-toggle\" data-toggle=\"dropdown\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<i class=\"octicon octicon-comment-discussion\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t`)\n\n\t\t\t$placeholder.addClass('dropdown hidden')\n\t\t\t$placeholder.html($template)\n\t\t}\n\n\t\tif ( render ) {\n\t\t\t$placeholder.removeClass('hidden')\n\t\t} else {\n\t\t\t$placeholder.addClass('hidden')\n\t\t}\n\t}\n\n\t// Avoid re-renders. Once is enough.\n\tif ( !frappe.chatter || force ) {\n\t\tfrappe.chatter = new frappe.Chat({\n\t\t\ttarget: desk ? '.frappe-chat-toggle' : null\n\t\t})\n\n\t\tif ( render ) {\n\t\t\tif ( frappe.session.user === 'Guest' && !desk ) {\n\t\t\t\tfrappe.store = frappe.Store.get('frappe.chat')\n\t\t\t\tvar token\t = frappe.store.get('guest_token')\n\n\t\t\t\tfrappe.log.info(`Local Guest Token - ${token}`)\n\n\t\t\t\tconst setup_room = (token) =>\n\t\t\t\t{\n\t\t\t\t\treturn new Promise(resolve => {\n\t\t\t\t\t\tfrappe.chat.room.create(\"Visitor\", token).then(room => {\n\t\t\t\t\t\t\tfrappe.log.info(`Visitor Room Created: ${room.name}`)\n\t\t\t\t\t\t\tfrappe.chat.room.subscribe(room.name)\n\n\t\t\t\t\t\t\tvar reference = room\n\n\t\t\t\t\t\t\tfrappe.chat.room.history(room.name).then(messages => {\n\t\t\t\t\t\t\t\tconst  room = { ...reference, messages: messages }\n\t\t\t\t\t\t\t\treturn room\n\t\t\t\t\t\t\t}).then(room => {\n\t\t\t\t\t\t\t\tresolve(room)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tif ( !token ) {\n\t\t\t\t\tfrappe.chat.website.token().then(token => {\n\t\t\t\t\t\tfrappe.log.info(`Generated Guest Token - ${token}`)\n\t\t\t\t\t\tfrappe.store.set('guest_token', token)\n\n\t\t\t\t\t\tsetup_room(token).then(room => {\n\t\t\t\t\t\t\tfrappe.chatter.render({ room })\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tsetup_room(token).then(room => {\n\t\t\t\t\t\tfrappe.chatter.render({ room })\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfrappe.chatter.render()\n\t\t\t}\n\t\t}\n\t}\n}\n\nfrappe.chat.setup  = () => {\n\tfrappe.log     = frappe.Logger.get('frappe.chat')\n\n\tfrappe.log.info('Setting up frappe.chat')\n\tfrappe.log.warn('TODO: frappe.chat.<object> requires a storage.')\n\n\tif ( frappe.session.user !== 'Guest' ) {\n\t\t// Create/Get Chat Profile for session User, retrieve enable_chat\n\t\tfrappe.log.info('Creating a Chat Profile.')\n\n\t\tfrappe.chat.profile.create('enable_chat').then(({ enable_chat }) => {\n\t\t\tfrappe.log.info(`Chat Profile created for User ${frappe.session.user}.`)\n\n\t\t\tif ( 'desk' in frappe && frappe.sys_defaults ) { // same as desk?\n\t\t\t\tconst should_render = Boolean(parseInt(frappe.sys_defaults.enable_chat)) && enable_chat\n\t\t\t\tfrappe.chat.render(should_render)\n\t\t\t}\n\t\t})\n\n\t\t// Triggered when a User updates his/her Chat Profile.\n\t\t// Don't worry, enable_chat is broadcasted to this user only. No overhead. :)\n\t\tfrappe.chat.profile.on.update((user, profile) => {\n\t\t\tif ( user === frappe.session.user && 'enable_chat' in profile ) {\n\t\t\t\tfrappe.log.warn(`Chat Profile update (Enable Chat - ${Boolean(profile.enable_chat)})`)\n\t\t\t\tconst should_render = Boolean(parseInt(frappe.sys_defaults.enable_chat)) && profile.enable_chat\n\t\t\t\tfrappe.chat.render(should_render)\n\t\t\t}\n\t\t})\n\t} else {\n\t\t// Website Settings\n\t\tfrappe.log.info('Retrieving Chat Website Settings.')\n\t\tfrappe.chat.website.settings([\"socketio\", \"enable\", \"enable_from\", \"enable_to\"])\n\t\t\t.then(settings => {\n\t\t\t\tfrappe.log.info(`Chat Website Setting - ${JSON.stringify(settings)}`)\n\t\t\t\tfrappe.log.info(`Chat Website Setting - ${settings.enable ? \"Enable\" : \"Disable\"}`)\n\n\t\t\t\tvar should_render = settings.enable\n\t\t\t\tif ( settings.enable_from && settings.enable_to ) {\n\t\t\t\t\tfrappe.log.info(`Enabling Chat Schedule - ${settings.enable_from.format()} : ${settings.enable_to.format()}`)\n\n\t\t\t\t\tconst range   = new frappe.datetime.range(settings.enable_from, settings.enable_to)\n\t\t\t\t\tshould_render = range.contains(frappe.datetime.now())\n\t\t\t\t}\n\n\t\t\t\tif ( should_render ) {\n\t\t\t\t\tfrappe.log.info(\"Initializing Socket.IO\")\n\t\t\t\t\tfrappe.socketio.init(settings.socketio.port)\n\t\t\t\t}\n\n\t\t\t\tfrappe.chat.render(should_render)\n\t\t})\n\t}\n}\n\n$(document).on('ready toolbar_setup', () =>\n{\n\tfrappe.chat.setup()\n})\n"],"names":["module","e","t","r","n","exports","o","i","l","call","m","c","d","Object","defineProperty","enumerable","get","Symbol","toStringTag","value","__esModule","create","bind","default","prototype","hasOwnProperty","p","s","iterator","constructor","a","deepValue","isArray","h","location","distance","threshold","maxPatternLength","u","f","caseSensitive","v","tokenSeparator","g","findAllMatches","y","minMatchCharLength","k","b","id","S","x","keys","M","_","shouldSort","w","L","getFn","A","O","sortFn","C","score","j","tokenize","P","I","matchAllTokens","F","T","includeMatches","N","z","includeScore","E","W","verbose","K","TypeError","this","options","isCaseSensitive","setCollection","_processKeys","key","list","_keyWeights","_keyNames","length","push","Error","name","weight","arguments","limit","_log","concat","_prepareSearchers","tokenSearchers","fullSearcher","_search","_computeScore","_sort","slice","_format","split","_analyze","record","index","resultMap","results","arrayIndex","search","pattern","isMatch","matchedIndices","output","item","Number","EPSILON","Math","pow","sort","JSON","stringify","indexOf","matches","indices","console","log","apply","configurable","writable","toLowerCase","patternAlphabet","RegExp","replace","match","errors","currentLocation","expectedLocation","min","lastIndexOf","floor","max","Array","charAt","$","abs","toString","isString","isNum","__d","pop","splitText","nodeName","_componentConstructor","__n","attributes","children","defaultProps","parentNode","removeChild","style","cssText","test","innerHTML","substring","addEventListener","removeEventListener","__l","removeAttribute","removeAttributeNS","setAttributeNS","setAttribute","className","type","on_mounted","D","H","ownerSVGElement","R","appendChild","_component","nodeValue","document","createTextNode","replaceChild","__hyperattr_","createElementNS","createElement","firstChild","nextSibling","html","childNodes","__k","trim","insertBefore","U","ref","lastChild","previousSibling","render","__b","splice","__x","__r","base","on_mount","componentWillReceiveProps","context","__c","__p","props","syncComponentUpdates","state","__s","shouldComponentUpdate","componentWillUpdate","getChildContext","__u","V","unshift","on_updated","afterUpdate","__h","componentWillUnmount","Promise","resolve","then","setTimeout","set_state","forceUpdate","Component","frappe","socketio","open_tasks","open_docs","emit_queue","init","port","window","io","boot","disable_async","socket","protocol","connect","get_host","secure","localStorage","server","on","message","msgprint","eval","data","progress","percent","flt","hide_progress","show_progress","title","__","description","setup_listeners","setup_reconnect","uploader","SocketIOUploader","frm","is_new","doctype","docname","doc_subscribe","doc_open","doc_close","onbeforeunload","cur_frm","doc","host","origin","dev_server","parts","socketio_port","subscribe","task_id","opts","emit","task_subscribe","task_unsubscribe","flags","doc_unsubscribe","filter","last_doc","process_response","status","each","locals","method","callback","request","cleanup","always","status_code","error","provide","realtime","event","off","publish","[object Object]","place","currentSlice","chunk_size","file","size","on_progress","reader","readAsArrayBuffer","started","keep_alive","file_url","substr","disconnect","indicator","throw","connected","sysdefaults","use_socketio_to_upload_file","fallback","FileReader","onload","is_private","filename","result","next_check","clearTimeout","with_message","global","fnTest","Class","extend","_super","proto","fn","tmp","ret","newClass","ui","form","Layout","views","pages","sections","fields_list","fields_dict","make","parent","body","wrapper","appendTo","fields","get_doctype_fields","setup_tabbing","show_empty_form_message","find","show_message","let","fieldtype","fieldname","reqd","hidden","label","get_status","field","meta","autoname","includes","sort_docfields","docfield_map","color","message_color","removeClass","addClass","empty","new_fields","me","section","column","with_dashboard","setup_dashboard_section","no_opening_section","make_section","df","make_page","make_column","make_field","cssClass","collapsible","replace_field","const","fieldobj","init_field","$wrapper","remove","perm","refresh_fields","colspan","make_control","render_input","layout","head","page","fold_btn","next","hasClass","utils","scroll_to","folded","unfold","trigger","Section","Column","refresh","attach_doc_and_docfields","refresh_dependency","refresh_sections","refresh_section_collapse","cnt","$this","fieldnames","map","set_input","add_fields","collapse","collapsible_depends_on","evaluate_depends_on_value","has_missing_mandatory","getItem","get_docfield","refresh_section_count","ev","which","current","target","attr","handle_tab","shiftKey","shift","grid_row","prev","focused","get_open_grid_row","len","set_focus","primary_button","focus","focus_on_next_field","is_visible","idx","grid","grid_rows","toggle_view","start_idx","add_new_row","show_form","in_list","model","no_value_type","disp_status","is","editor","$input","has_dep","fkey","dependencies_clear","depends_on","guardian_has_value","hidden_due_to_dependency","expression","out","get_values","istable","script_manager","row","make_head","collapse_link","hide","get_perm","permlevel","toggleClass","undefined","setItem","forEach","is_collapsed","missing_mandatory","section_df","resize_all_columns","cint","FieldGroup","dirty","values","set_values","def_value","datetime","get_today","no_submit_on_enter","catch_enter_as_submit","run_serially","timeout","first_button","focus_on_first_input","no_focus","keypress","has_primary_action","preventDefault","get_primary_btn","get_input","txt","input","get_field","ignore_errors","get_value","is_null","join","set_value","val","dict","clear","set_df_property","prop","dom","id_count","freeze_count","by_id","getElementById","get_unique_id","set_unique_id","ele","$ele","el","getElementsByTagName","remove_script_and_style","evil_tags","tag","div","found","elements","getAttribute","is_element_in_viewport","tolerance","jQuery","rect","getBoundingClientRect","top","left","bottom","height","right","width","set_style","se","element","styleSheet","add","newtag","cs","onclick","src","css","activate","$parent","$child","common_class","active_class","freeze","msg","css_class","cur_grid","repl","unfreeze","save_selection","getSelection","sel","getRangeAt","rangeCount","ranges","selection","createRange","restore_selection","savedSel","removeAllRanges","addRange","select","is_touchscreen","handle_broken_images","container","currentTarget","scroll_to_bottom","$container","scrollTop","scrollHeight","file_to_base64","file_obj","readAsDataURL","scroll_to_section","section_name","click","scroll","pixel_to_inches","pixels","inches","offsetWidth","ellipsis","text","cstr","tasks","task","load_image","onerror","preprocess","tester","Image","seconds","scrub","spacer","get_modal","content","is_online","developer_mode","navigator","onLine","show_alert","cur_dialog","open_dialogs","Dialog","super","display","is_dialog","animate","static","modal","backdrop","keyboard","get_close_btn","modal_body","$body","$message","header","buttons","set_indicator","action","primary","secondary","primary_action","onsubmit","set_primary_action","primary_action_label","secondary_action","set_secondary_action","secondary_action_label","minimizable","toggle_minimize","get_minimize_btn","onhide","on_hide","on_page_show","blur","clear_message","primary_action_fulfilled","set_title","toggle","closest","removeAttr","is_minimized","on_minimize_toggle","get_data_uri","$element","$canvas","getContext","drawImage","toDataURL","Capture","OPTIONS","set_options","mediaDevices","getUserMedia","video","stream","dialog","$e","TEMPLATE","srcObject","play","data_url","show","catch","err","alert","ERR_MESSAGE","user_info","uid","session","user","fullname","image","abbr","capitalize","get_abbr","get_palette","set_user_background","selector","cordova","base_url","background","full_name","has_role","rl","roles","get_desktop_items","allowed_modules","icon","module_name","modules","allow_modules","is_help","allowed_pages","link","can_read","_doctype","is_report_manager","get_formatted_email","email","quote","get_emails","session_alive","session_alive_timeout","ValueError","ImportError","instance","format","moment","range","start","end","isBetween","now","equal","isSame","compare","isBefore","quick_edit","with_doctype","db","get_doc","required","get_meta","bold","read_only","append","set_route","string","object","fuzzy_search","query","dataset","Fuse","pluralize","word","count","suffix","toUpperCase","arr","is_empty","copy_array","array","as_array","squash","is_mobile","regex","agent","userAgent","compact","Boolean","first_name","keycode","RETURN","stores","Store","Logger","level","ERROR","NOTSET","FORMAT","loggers","DEBUG","INFO","WARN","timestamp","time","chat","profile","exists_ok","response","update","STATUSES","room","kind","owner","users","creation","names","rooms","last_message","history","messages","room_name","typing","send","seen","mess","pretty_datetime","date","today","sound","volume","$audio","paused","info","pause","PATH","emojis","emoji","parse","website","settings","enable_from","enable_to","token","components","Button","SIZE","class","block","small","large","FAB","Indicator","FontAwesome","fixed","Octicon","Avatar","medium","Chat","HTMLElement","set_wrapper","destroy","component","Widget","hyper","PAGE","POPPER","setup","this$1","exists","usr","defaultState","warn","conversation_tones","notification_tones","message_preview","show-message","notify","ActionBar","placeholder","actions","onchange","is_group","group_name","change","span","contacts","RoomList","Room","Popper","heading","widget","active","margin-bottom","submit","oninput","autocomplete","Action","Item","avatar","subtitle","is_unread","MediaProfile","font-size","position","POSITION","text-align","width_title","hints","keyword","items","aliases","alias","capture","FileUploader","on_success","file_doc","path","box-shadow","Header","on_back","ChatList","ChatForm","hint","route","popper","room_type","ChatBubble","read","groupable","href","tokens","sliced","data-toggle","stopPropagation","autofocus","onkeypress","EmojiPicker","List","platform","appVersion","assets","app","browser","Notification","lang","assign","requestPermission","force","desk","$placeholder","has","$template","chatter","store","setup_room","reference","set","sys_defaults","should_render","parseInt","enable_chat","enable","contains"],"mappings":"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"}